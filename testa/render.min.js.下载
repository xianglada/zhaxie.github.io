registerNamespace("InfoPlus.Dynamics.Parser"),InfoPlus.Dynamics.Parser.Expression=function(){function t(){}Object.create||(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__===String.prototype?function(e){return e.__proto__}:function(e){return e.constructor.prototype});function e(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n}var n=[1,3],i=[1,8],a=[1,12],r=[1,16],o=[1,15],s=[1,17],l=[1,13],u=[1,14],d=[1,19],c=[1,20],h=[1,21],p=[1,22],f=[1,23],m=[1,24],$=[1,25],g=[1,26],C=[1,27],_=[1,28],E=[1,29],T=[1,30],I=[1,31],v=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,41,43],A=[1,37],y=[1,57],P=[1,58],S=[5,6,7,25,41,43],D=[5,6,7,9,10,11,12,13,14,25,41,43],b=[5,6,7,9,10,11,12,13,14,15,16,25,41,43],O=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,39,41,42,43],R=[25,41],S={trace:function(){},yy:{},symbols_:{error:2,expressions:3,expression:4,EOF:5,"||":6,"&&":7,"!":8,">":9,"<":10,"==":11,">=":12,"<=":13,"!=":14,"+":15,"-":16,"*":17,"/":18,"%":19,literal:20,parenthesis:21,references:22,functionCall:23,PARENTHESIS:24,CLOSE_PARENTHESIS:25,string:26,number:27,bool:28,NUMBER:29,STRING:30,BOOL:31,DOLLAR:32,ID:33,attributes:34,attribute:35,method:36,index:37,property:38,DOT:39,params:40,COMMA:41,BRACKET:42,CLOSE_BRACKET:43,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"||",7:"&&",8:"!",9:">",10:"<",11:"==",12:">=",13:"<=",14:"!=",15:"+",16:"-",17:"*",18:"/",19:"%",24:"PARENTHESIS",25:"CLOSE_PARENTHESIS",29:"NUMBER",30:"STRING",31:"BOOL",32:"DOLLAR",33:"ID",39:"DOT",41:"COMMA",42:"BRACKET",43:"CLOSE_BRACKET"},productions_:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[21,3],[20,1],[20,1],[20,1],[27,1],[27,2],[26,1],[28,1],[22,3],[22,2],[34,1],[34,2],[35,1],[35,1],[35,1],[36,2],[23,4],[23,3],[40,1],[40,3],[38,2],[37,3]],performAction:function(e,t,n,i,a,r,o){var s=r.length-1;switch(a){case 1:return r[s-1];case 2:case 3:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.$={type:"expression",expression:[r[s-2],r[s]],operator:r[s-1]};break;case 4:this.$={type:"expression",expression:[r[s]],operator:"not"};break;case 16:case 17:case 18:case 25:case 27:case 28:case 36:case 41:this.$=r[s];break;case 19:this.$={type:"functionCall",id:r[s].id,args:r[s].args};break;case 20:this.$={type:"expression",expression:[r[s]],operator:"minus"};break;case 21:this.$={type:"expression",expression:[r[s-1]],operator:"parenthesis"};break;case 22:this.$={type:"string",value:r[s]};break;case 23:this.$={type:"number",value:r[s]};break;case 24:this.$={type:"bool",value:r[s]};break;case 26:this.$="-"+r[s];break;case 29:this.$={type:"references",id:r[s-1],path:r[s]};break;case 30:this.$={type:"references",id:r[s]};break;case 31:case 39:this.$=[r[s]];break;case 32:this.$=[].concat(r[s-1],r[s]);break;case 33:this.$={type:"method",id:r[s].id,args:r[s].args};break;case 34:this.$={type:"index",id:r[s]};break;case 35:this.$={type:"property",id:r[s]};break;case 37:this.$={id:r[s-3],args:r[s-1]};break;case 38:this.$={id:r[s-2],args:void 0};break;case 40:this.$=[].concat(r[s-2],r[s]);break;case 42:this.$=r[s-1]}},table:[{3:1,4:2,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{1:[3]},{5:[1,18],6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I},{4:32,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(v,[2,16]),e(v,[2,17]),e(v,[2,18]),e(v,[2,19]),{21:33,24:a,29:[1,34]},e(v,[2,22]),e(v,[2,23]),e(v,[2,24]),{4:35,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{33:[1,36]},{24:A},e(v,[2,27]),e(v,[2,25]),e(v,[2,28]),{1:[2,1]},{4:38,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:39,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:40,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:41,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:42,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:43,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:44,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:45,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:46,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:47,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:48,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:49,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:50,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(v,[2,4]),e(v,[2,20]),e(v,[2,26]),{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I,25:[1,51]},e(v,[2,30],{34:52,35:53,36:54,37:55,38:56,39:y,42:P}),{4:61,8:n,16:i,20:4,21:5,22:6,23:7,24:a,25:[1,60],26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u,40:59},e(S,[2,2],{9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(S,[2,3],{9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(D,[2,5],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,6],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,7],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,8],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,9],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,10],{15:C,16:_,17:E,18:T,19:I}),e(b,[2,11],{17:E,18:T,19:I}),e(b,[2,12],{17:E,18:T,19:I}),e(v,[2,13]),e(v,[2,14]),e(v,[2,15]),e(v,[2,21]),e(v,[2,29],{36:54,37:55,38:56,35:62,39:y,42:P}),e(O,[2,31]),e(O,[2,33]),e(O,[2,34]),e(O,[2,35]),{23:63,33:[1,64]},{4:65,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{25:[1,66],41:[1,67]},e(O,[2,38]),e(R,[2,39],{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(O,[2,32]),e(O,[2,36]),e(O,[2,41],{24:A}),{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I,43:[1,68]},e(O,[2,37]),{4:69,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(O,[2,42]),e(R,[2,40],{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I})],defaultActions:{18:[2,1]},parseError:function(e,t){var n;if(!t.recoverable)throw(n=new Error(e)).hash=t,n;this.trace(e)},parse:function(e){var t,n=this,i=[0],a=[null],r=[],o=this.table,s="",l=0,u=0,d=0,c=1,h=r.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(t in this.yy)Object.prototype.hasOwnProperty.call(this.yy,t)&&(f.yy[t]=this.yy[t]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,void 0===p.yylloc&&(p.yylloc={});var m=p.yylloc,$=(r.push(m),p.options&&p.options.ranges);"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,C,_,E,T,I,v,A=function(){var e=p.lex()||c;return e="number"!=typeof e?n.symbols_[e]||e:e},y={};;){if(_=i[i.length-1],void 0===(E=this.defaultActions[_]||(null==g&&(g=A()),o[_]&&o[_][g]))||!E.length||!E[0]){var P="",S=[];for(T in o[_])this.terminals_[T]&&2<T&&S.push("'"+this.terminals_[T]+"'");P=p.showPosition?"Parse error on line "+(l+1)+":\n"+p.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(l+1)+": Unexpected "+(g==c?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(P,{text:p.match,token:this.terminals_[g]||g,line:p.yylineno,loc:m,expected:S})}if(E[0]instanceof Array&&1<E.length)throw new Error("Parse Error: multiple actions possible at state: "+_+", token: "+g);switch(E[0]){case 1:i.push(g),a.push(p.yytext),r.push(p.yylloc),i.push(E[1]),g=null,C?(g=C,C=null):(u=p.yyleng,s=p.yytext,l=p.yylineno,m=p.yylloc,0<d&&d--);break;case 2:if(I=this.productions_[E[1]][1],y.$=a[a.length-I],y._$={first_line:r[r.length-(I||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(I||1)].first_column,last_column:r[r.length-1].last_column},$&&(y._$.range=[r[r.length-(I||1)].range[0],r[r.length-1].range[1]]),void 0!==(v=this.performAction.apply(y,[s,u,l,f.yy,E[1],a,r].concat(h))))return v;I&&(i=i.slice(0,-1*I*2),a=a.slice(0,-1*I),r=r.slice(0,-1*I)),i.push(this.productions_[E[1]][0]),a.push(y.$),r.push(y._$),v=o[i[i.length-2]][i[i.length-1]],i.push(v);break;case 3:return!0}}return!0}};function w(){this.yy={}}return S.lexer={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g),e=(this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t,this.match.split(/(?:\r\n?|\n)/g)),i=(this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1),this.yylloc.range);return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===e.length?this.yylloc.first_column:0)+e[e.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(20<e.length?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(20<e.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges)&&(i.yylloc.range=this.yylloc.range.slice(0)),(n=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack)for(var a in i)this[a]=i[a];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var e,t,n,i,a=this._currentRules(),r=0;r<a.length;r++)if((n=this._input.match(this.rules[a[r]]))&&(!t||n[0].length>t[0].length))if(t=n,i=r,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[r])))return e;if(!this._backtrack)return!1;t=!1}else if(!this.options.flex)break;return t?!1!==(e=this.test_match(t,a[i]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]]:this.conditions.INITIAL).rules},topState:function(e){return 0<=(e=this.conditionStack.length-1-Math.abs(e||0))?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:this.begin("ref");break;case 1:return this.begin("fb"),33;case 2:break;case 3:return 29;case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return t.yytext;case 13:return"EQUAL";case 14:case 15:case 16:return 31;case 17:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\'/g,"'"),30;case 18:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),30;case 19:return 32;case 20:return 33;case 21:return 39;case 22:return this.popState(),41;case 23:return 41;case 24:return this.begin("b"),42;case 25:return this.popState(),43;case 26:return this.begin("func"),24;case 27:return 24;case 28:return 25;case 29:return this.begin("p"),24;case 30:return this.popState(),25;case 31:return this.popState(),this.popState(),25;case 32:case 33:this.popState();break;case 34:return this.popState(),5;case 35:return 5}},rules:[/^(?:[.]*?(?=\$))/,/^(?:[a-zA-Z][a-zA-Z_]*?(?=\())/,/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:[%\+\-\*/])/,/^(?:<=)/,/^(?:>=)/,/^(?:[><])/,/^(?:==)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:!=)/,/^(?:!)/,/^(?:=)/,/^(?:null\b)/,/^(?:false\b)/,/^(?:true\b)/,/^(?:'(\\'|[^\'])*')/,/^(?:"(\\"|[^\"])*")/,/^(?:\$(?=[a-zA-Z_]))/,/^(?:[_a-zA-Z][a-zA-Z0-9_]*)/,/^(?:\.)/,/^(?:,[ ]*)/,/^(?:,[ ]*)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\()/,/^(?:\))/,/^(?:\()/,/^(?:\))/,/^(?:\))/,/^(?:\s+)/,/^(?:(?=.))/,/^(?:$)/,/^(?:$)/],conditions:{ref:{rules:[4,19,20,21,22,24,29,32,33,34],inclusive:!1},b:{rules:[0,1,2,3,4,17,18,24,25,27,28],inclusive:!1},p:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,24,29,30],inclusive:!1},func:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,29,31,34],inclusive:!1},fb:{rules:[26],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,27,28,35],inclusive:!0}}},new((w.prototype=S).Parser=w)}(),registerNamespace("InfoPlus.Dynamics.Parser"),InfoPlus.Dynamics.Parser.Expression=function(){function t(){}Object.create||(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__===String.prototype?function(e){return e.__proto__}:function(e){return e.constructor.prototype});function e(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n}var n=[1,3],i=[1,8],a=[1,12],r=[1,16],o=[1,15],s=[1,17],l=[1,13],u=[1,14],d=[1,19],c=[1,20],h=[1,21],p=[1,22],f=[1,23],m=[1,24],$=[1,25],g=[1,26],C=[1,27],_=[1,28],E=[1,29],T=[1,30],I=[1,31],v=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,41,43],A=[1,37],y=[1,57],P=[1,58],S=[5,6,7,25,41,43],D=[5,6,7,9,10,11,12,13,14,25,41,43],b=[5,6,7,9,10,11,12,13,14,15,16,25,41,43],O=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,39,41,42,43],R=[25,41],S={trace:function(){},yy:{},symbols_:{error:2,expressions:3,expression:4,EOF:5,"||":6,"&&":7,"!":8,">":9,"<":10,"==":11,">=":12,"<=":13,"!=":14,"+":15,"-":16,"*":17,"/":18,"%":19,literal:20,parenthesis:21,references:22,functionCall:23,PARENTHESIS:24,CLOSE_PARENTHESIS:25,string:26,number:27,bool:28,NUMBER:29,STRING:30,BOOL:31,DOLLAR:32,ID:33,attributes:34,attribute:35,method:36,index:37,property:38,DOT:39,params:40,COMMA:41,BRACKET:42,CLOSE_BRACKET:43,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"||",7:"&&",8:"!",9:">",10:"<",11:"==",12:">=",13:"<=",14:"!=",15:"+",16:"-",17:"*",18:"/",19:"%",24:"PARENTHESIS",25:"CLOSE_PARENTHESIS",29:"NUMBER",30:"STRING",31:"BOOL",32:"DOLLAR",33:"ID",39:"DOT",41:"COMMA",42:"BRACKET",43:"CLOSE_BRACKET"},productions_:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[21,3],[20,1],[20,1],[20,1],[27,1],[27,2],[26,1],[28,1],[22,3],[22,2],[34,1],[34,2],[35,1],[35,1],[35,1],[36,2],[23,4],[23,3],[40,1],[40,3],[38,2],[37,3]],performAction:function(e,t,n,i,a,r,o){var s=r.length-1;switch(a){case 1:return r[s-1];case 2:case 3:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.$={type:"expression",expression:[r[s-2],r[s]],operator:r[s-1]};break;case 4:this.$={type:"expression",expression:[r[s]],operator:"not"};break;case 16:case 17:case 18:case 25:case 27:case 28:case 36:case 41:this.$=r[s];break;case 19:this.$={type:"functionCall",id:r[s].id,args:r[s].args};break;case 20:this.$={type:"expression",expression:[r[s]],operator:"minus"};break;case 21:this.$={type:"expression",expression:[r[s-1]],operator:"parenthesis"};break;case 22:this.$={type:"string",value:r[s]};break;case 23:this.$={type:"number",value:r[s]};break;case 24:this.$={type:"bool",value:r[s]};break;case 26:this.$="-"+r[s];break;case 29:this.$={type:"references",id:r[s-1],path:r[s]};break;case 30:this.$={type:"references",id:r[s]};break;case 31:case 39:this.$=[r[s]];break;case 32:this.$=[].concat(r[s-1],r[s]);break;case 33:this.$={type:"method",id:r[s].id,args:r[s].args};break;case 34:this.$={type:"index",id:r[s]};break;case 35:this.$={type:"property",id:r[s]};break;case 37:this.$={id:r[s-3],args:r[s-1]};break;case 38:this.$={id:r[s-2],args:void 0};break;case 40:this.$=[].concat(r[s-2],r[s]);break;case 42:this.$=r[s-1]}},table:[{3:1,4:2,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{1:[3]},{5:[1,18],6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I},{4:32,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(v,[2,16]),e(v,[2,17]),e(v,[2,18]),e(v,[2,19]),{21:33,24:a,29:[1,34]},e(v,[2,22]),e(v,[2,23]),e(v,[2,24]),{4:35,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{33:[1,36]},{24:A},e(v,[2,27]),e(v,[2,25]),e(v,[2,28]),{1:[2,1]},{4:38,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:39,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:40,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:41,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:42,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:43,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:44,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:45,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:46,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:47,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:48,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:49,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{4:50,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(v,[2,4]),e(v,[2,20]),e(v,[2,26]),{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I,25:[1,51]},e(v,[2,30],{34:52,35:53,36:54,37:55,38:56,39:y,42:P}),{4:61,8:n,16:i,20:4,21:5,22:6,23:7,24:a,25:[1,60],26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u,40:59},e(S,[2,2],{9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(S,[2,3],{9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(D,[2,5],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,6],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,7],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,8],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,9],{15:C,16:_,17:E,18:T,19:I}),e(D,[2,10],{15:C,16:_,17:E,18:T,19:I}),e(b,[2,11],{17:E,18:T,19:I}),e(b,[2,12],{17:E,18:T,19:I}),e(v,[2,13]),e(v,[2,14]),e(v,[2,15]),e(v,[2,21]),e(v,[2,29],{36:54,37:55,38:56,35:62,39:y,42:P}),e(O,[2,31]),e(O,[2,33]),e(O,[2,34]),e(O,[2,35]),{23:63,33:[1,64]},{4:65,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},{25:[1,66],41:[1,67]},e(O,[2,38]),e(R,[2,39],{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I}),e(O,[2,32]),e(O,[2,36]),e(O,[2,41],{24:A}),{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I,43:[1,68]},e(O,[2,37]),{4:69,8:n,16:i,20:4,21:5,22:6,23:7,24:a,26:9,27:10,28:11,29:r,30:o,31:s,32:l,33:u},e(O,[2,42]),e(R,[2,40],{6:d,7:c,9:h,10:p,11:f,12:m,13:$,14:g,15:C,16:_,17:E,18:T,19:I})],defaultActions:{18:[2,1]},parseError:function(e,t){var n;if(!t.recoverable)throw(n=new Error(e)).hash=t,n;this.trace(e)},parse:function(e){var t,n=this,i=[0],a=[null],r=[],o=this.table,s="",l=0,u=0,d=0,c=1,h=r.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(t in this.yy)Object.prototype.hasOwnProperty.call(this.yy,t)&&(f.yy[t]=this.yy[t]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,void 0===p.yylloc&&(p.yylloc={});var m=p.yylloc,$=(r.push(m),p.options&&p.options.ranges);"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,C,_,E,T,I,v,A=function(){var e=p.lex()||c;return e="number"!=typeof e?n.symbols_[e]||e:e},y={};;){if(_=i[i.length-1],void 0===(E=this.defaultActions[_]||(null==g&&(g=A()),o[_]&&o[_][g]))||!E.length||!E[0]){var P="",S=[];for(T in o[_])this.terminals_[T]&&2<T&&S.push("'"+this.terminals_[T]+"'");P=p.showPosition?"Parse error on line "+(l+1)+":\n"+p.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(l+1)+": Unexpected "+(g==c?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(P,{text:p.match,token:this.terminals_[g]||g,line:p.yylineno,loc:m,expected:S})}if(E[0]instanceof Array&&1<E.length)throw new Error("Parse Error: multiple actions possible at state: "+_+", token: "+g);switch(E[0]){case 1:i.push(g),a.push(p.yytext),r.push(p.yylloc),i.push(E[1]),g=null,C?(g=C,C=null):(u=p.yyleng,s=p.yytext,l=p.yylineno,m=p.yylloc,0<d&&d--);break;case 2:if(I=this.productions_[E[1]][1],y.$=a[a.length-I],y._$={first_line:r[r.length-(I||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(I||1)].first_column,last_column:r[r.length-1].last_column},$&&(y._$.range=[r[r.length-(I||1)].range[0],r[r.length-1].range[1]]),void 0!==(v=this.performAction.apply(y,[s,u,l,f.yy,E[1],a,r].concat(h))))return v;I&&(i=i.slice(0,-1*I*2),a=a.slice(0,-1*I),r=r.slice(0,-1*I)),i.push(this.productions_[E[1]][0]),a.push(y.$),r.push(y._$),v=o[i[i.length-2]][i[i.length-1]],i.push(v);break;case 3:return!0}}return!0}};function w(){this.yy={}}return S.lexer={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g),e=(this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t,this.match.split(/(?:\r\n?|\n)/g)),i=(this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1),this.yylloc.range);return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===e.length?this.yylloc.first_column:0)+e[e.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(20<e.length?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(20<e.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges)&&(i.yylloc.range=this.yylloc.range.slice(0)),(n=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack)for(var a in i)this[a]=i[a];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var e,t,n,i,a=this._currentRules(),r=0;r<a.length;r++)if((n=this._input.match(this.rules[a[r]]))&&(!t||n[0].length>t[0].length))if(t=n,i=r,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[r])))return e;if(!this._backtrack)return!1;t=!1}else if(!this.options.flex)break;return t?!1!==(e=this.test_match(t,a[i]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]]:this.conditions.INITIAL).rules},topState:function(e){return 0<=(e=this.conditionStack.length-1-Math.abs(e||0))?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:this.begin("ref");break;case 1:return this.begin("fb"),33;case 2:break;case 3:return 29;case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return t.yytext;case 13:return"EQUAL";case 14:case 15:case 16:return 31;case 17:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\'/g,"'"),30;case 18:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),30;case 19:return 32;case 20:return 33;case 21:return 39;case 22:return this.popState(),41;case 23:return 41;case 24:return this.begin("b"),42;case 25:return this.popState(),43;case 26:return this.begin("func"),24;case 27:return 24;case 28:return 25;case 29:return this.begin("p"),24;case 30:return this.popState(),25;case 31:return this.popState(),this.popState(),25;case 32:case 33:this.popState();break;case 34:return this.popState(),5;case 35:return 5}},rules:[/^(?:[.]*?(?=\$))/,/^(?:[a-zA-Z][a-zA-Z_]*?(?=\())/,/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:[%\+\-\*/])/,/^(?:<=)/,/^(?:>=)/,/^(?:[><])/,/^(?:==)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:!=)/,/^(?:!)/,/^(?:=)/,/^(?:null\b)/,/^(?:false\b)/,/^(?:true\b)/,/^(?:'(\\'|[^\'])*')/,/^(?:"(\\"|[^\"])*")/,/^(?:\$(?=[a-zA-Z_]))/,/^(?:[_a-zA-Z][a-zA-Z0-9_]*)/,/^(?:\.)/,/^(?:,[ ]*)/,/^(?:,[ ]*)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\()/,/^(?:\))/,/^(?:\()/,/^(?:\))/,/^(?:\))/,/^(?:\s+)/,/^(?:(?=.))/,/^(?:$)/,/^(?:$)/],conditions:{ref:{rules:[4,19,20,21,22,24,29,32,33,34],inclusive:!1},b:{rules:[0,1,2,3,4,17,18,24,25,27,28],inclusive:!1},p:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,24,29,30],inclusive:!1},func:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,29,31,34],inclusive:!1},fb:{rules:[26],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,27,28,35],inclusive:!0}}},new((w.prototype=S).Parser=w)}(),registerNamespace("InfoPlus.Dynamics.Parser"),InfoPlus.Dynamics.Parser.Compile=function(e,t){this.asts=e,this.functions=t||InfoPlus.Dynamics.Functions},InfoPlus.Dynamics.Parser.Compile.prototype={asts:null,context:null,evaluate:function(t,e){this.context=void 0!==t?t:{},void 0!==e&&(this.targetObject=e);try{return this.getExpression(this.asts)}catch(e){t=(t="Error occur while evaluating the dynamic expression.\n\n")+("Error description: "+e.message+"\n\n")+"Click OK to continue.\n\n";alert(t)}return null},getReferenceNameArray:function(){this.references={},this.getRef(this.asts);var e,t=[];for(e in this.references)this.references.hasOwnProperty(e)&&t.push(e);return t},getRef:function(e){var t=e.expression,n=e.type;if("expression"===n)switch(e.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":this.getRef(t[0]),this.getRef(t[1]);break;case"minus":case"not":case"parenthesis":this.getRef(t[0])}else if("references"===n){if(void 0===this.references[e.id]&&(this.references[e.id]=null),void 0!==e.path)for(var i=0;i<e.path.length;i++){var a=e.path[i];if("index"===a.type){var r=a.id;"references"===r.type&&this.getRef(r)}else if("method"===a.type&&void 0!==a.args)for(var o=0;o<a.args.length;o++){var s=a.args[o];"references"===s.type&&this.getRef(s)}}}else if("functionCall"===n&&void 0!==e.args)for(var l=0;l<e.args.length;l++)this.getRef(e.args[l])},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},getArrayExpression:function(e,t,n){var i,a,r=[];if(this.isArray(e))if(this.isArray(t))for(a=Math.min(e.length,t.length),i=0;i<a;i++)r[i]=this.getArrayExpression(e[i],t[i],n);else for(i=0,a=e.length;i<a;i++)r[i]=this.getArrayExpression(e[i],t,n);else if(this.isArray(t))for(i=0,a=t.length;i<a;i++)r[i]=this.getArrayExpression(e,t[i],n);else r=this.getExpressByValue(e,t,n);return r},getExpressByValue:function(e,t,n){var i;switch(null!=e&&e.hasOwnProperty("value")&&(e=e.value),null!=t&&t.hasOwnProperty("value")&&(t=t.value),n){case"+":i=e+t;break;case"-":i=e-t;break;case"/":i=e/t;break;case"%":i=e%t;break;case"*":i=e*t;break;case"||":i=e||t;break;case"&&":i=e&&t;break;case">":i=t<e;break;case"<":i=e<t;break;case"==":i=e==t;break;case">=":i=t<=e;break;case"<=":i=e<=t;break;case"!=":i=e!=t;break;case"minus":i=-e;break;case"not":i=!e}return i},getExpression:function(e){var t,n=e.expression;switch(e.type){case"expression":var i=this.getExpression(n[0]),a=void 0!==n[1]?this.getExpression(n[1]):void 0;switch(e.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":t=this.isArray(i)||this.isArray(a)?this.getArrayExpression(i,a,e.operator):this.getExpressByValue(i,a,e.operator);break;case"minus":t=this.isArray(i)?this.getArrayExpression(i,void 0,e.operator):-i;break;case"not":t=this.isArray(i)?this.getArrayExpression(i,void 0,e.operator):!i;break;case"parenthesis":t=this.getExpression(n[0]);break;default:return}return t;case"string":var r=e.value;return r=null!=r?r.replace(/\\n/g,"\n").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\\\/g,"\\"):r;case"number":return Number(e.value);case"bool":return"null"===e.value?null:"true"===e.value;case"references":return this.getReferences(e);case"functionCall":return this.getFunctionCall(e);default:return}},getLiteral:function(e){var t=e.type,n="";if("string"===t)n=e.value;else if("number"===t)n=Number(e.value);else{if("bool"!==t)return this.getReferences(e);"null"===e.value?n=null:"false"===e.value?n=!1:"true"===e.value&&(n=!0)}return n},getReferences:function(e){var t=this.context[e.id];if(void 0!==e.path&&void 0!==t)for(var n=0;n<e.path.length;n++){var i=e.path[n];if(void 0===(t=this.getAttributes(i,t)))break}return t},getAttributes:function(e,t){var n=e.type,i=e.id;if("method"===n)a=this.getPropMethod(e,t);else if("property"===n)if(this.isArray(t))for(var a=[],r=0,o=t.length;r<o;r++)a[r]=this.getAttributes(e,t[r]);else a=t[i];else a=this.getPropIndex(e,t);return a},getFunctionCall:function(e){var t,n=!1,i=(void 0!==this.targetObject&&(t=this.targetObject[e.id])&&"function"==typeof t||(t=this.functions[e.id],n=!0),[]);if(void 0!==e.args)for(var a=0;a<e.args.length;a++)i.push(this.getExpression(e.args[a]));if(t&&t.call)return n?t.apply(this.context,i):t.apply(this.targetObject,i)},getPropMethod:function(e,t){var n=t[e.id],i=[];if(void 0!==e.args)for(var a=0;a<e.args.length;a++)i.push(this.getExpression(e.args[a]));return n=n&&n.call?n.apply(t,i):void 0},getPropIndex:function(e,t){e=e.id;return t[this.getExpression(e)]}},function(){function e(e){this.control=e}e.TYPE_BOUNDABLE="boundable",e.TYPE_REPEATABLE="repeatable",e.TYPE_VIEW="view",e.prototype={control:null,type:e.TYPE_BOUNDABLE,getGuid:function(){return null==this.control?null:this.control.guid},getId:function(){return null==this.control?null:this.control.getId()},getName:function(){return null==this.control?null:$(this.control.element).attr("name")},getPath:function(){return null==this.control?null:this.control.path},setValue:function(e){},getValue:function(){},setStyle:function(e,t){},getStyle:function(e){return null},registerEvent:function(e,t,n){},unRegisterEvent:function(e,t){},triggerEvent:function(e){},validate:function(){},isReadable:function(){},isWritable:function(){},isEditable:function(){},callMethod:function(){if(0!==arguments.length){var e=arguments[0];if("function"==typeof this[e]){for(var t=[],n=1,i=arguments.length;n<i;n++)t.push(arguments[n]);this[e].apply(this,t)}}},processDynamicParams:function(e){return e instanceof InfoPlus.Dynamics.Params?e.params[0]:e}},define("InfoPlus.Core.CoreControl",e)}(window),function(){function e(e){this.type=InfoPlus.Core.CoreControl.TYPE_BOUNDABLE,InfoPlus.Core.CoreControl.call(this,e)}e.prototype=$.extend(new InfoPlus.Core.CoreControl,{setValue:function(e){if(null!=this.control&&this.control.isWritable()){if(null!=e){var t=e.expando||e.attributes;if(e instanceof InfoPlus.Controls.Data.ValuePair)return void this.control.setValue(e.value,e.displayValue,$$.params.initializing,t);if(e instanceof InfoPlus.Controls.Data.Uri)return void this.control.setValue(e.value);if(e.hasOwnProperty("value")&&e.hasOwnProperty("displayValue"))return void this.control.setValue(e.value,e.displayValue,$$.params.initializing,t);if(e.hasOwnProperty("codeId")&&e.hasOwnProperty("codeName"))return void this.control.setValue(e.codeId,e.codeName,$$.params.initializing,t)}this.control.setValue(e)}},getValue:function(){return null!=this.control&&this.control.isReadable()?this.control.getValue():null},getAttributes:function(){return null!=this.control&&this.control.isReadable()?this.control.getAttributes():null},validate:function(){return null==this.control||$IU.checkControlValidation([this.control],!0,!0)},registerEvent:function(e,t,n){$(this.control.element).on(e,t,n)},unRegisterEvent:function(e,t){$(this.control.element).off(e,t)},trigger:function(e){$(this.control.element).trigger(e)},isReadable:function(){return this.control.isReadable()},isWritable:function(){return this.control.isWritable()},isEditable:function(){return this.control.isEditable()},getDataSource:function(){return this.control.getDataSource()},setStyle:function(e,t){null!=this.control&&this.control.isReadable()&&this.control.setStyle(e,t)},getStyle:function(e){return null==this.control?null:this.control.getStyle(e)},setFocus:function(){null!=this.control&&this.control.isReadable()&&this.control.setFocus()},lostFocus:function(){null!=this.control&&this.control.isReadable()&&this.control.lostFocus()},setOptions:function(e){null!=this.control&&"function"==typeof this.control.setOptions&&this.control.setOptions(this.control.element,e)},setParentValue:function(e,t){null!=this.control&&this.control.isWritable()&&this.control.setParentValue(e,t)},setDataSource:function(e,t){null!=this.control&&"function"==typeof this.control.setDataSource&&this.control.setDataSource(e,t)},visible:function(e,t){null!=this.control&&this.control.visible(e,t)},rowVisible:function(e,t){var n,i;null!=this.control&&((n=this.control.getRow()).is("tr")?$IU.processTrRowVisible(n,e,t):n.hasClass("infoplus_view")?null!=(i=n.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT))&&i.visible(e,t):e?$IU.dynamicShowElement(n):$IU.dynamicHideElement(n))},colVisible:function(e,t){if(null!=this.control){for(var n=$(this.control.element),i=n.parents(".infoplus_repeatParentElement"),a=null,r=0,o=i.length;r<o;r++){var s=$(i[r]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(s.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){a=s;break}}null!=a&&-1!==(n=(n=$(n.parents("td")[0])).parent().children("td").index(n))&&a.setColumnVisible(n,e)}},readOnly:function(e,t){null==this.control||this.control.isReadOnly()||((e=this.processDynamicParams(e))?this.control.setReadOnly():(this.control.element.readOnly=!1,this.control.element.disabled=!1,$(this.control.element).removeClass($Control.CLASSNAME_READONLY).removeClass("disabled")),this.control.setDynamicReadOnly(e,t),this.control.dynamicReadonly=e)},tooltip:function(e){null!=this.control&&this.control.setTooltip(e)}}),define("InfoPlus.Core.CoreBoundControl",e)}(window),function(a){function e(e){this.type=InfoPlus.Core.CoreControl.TYPE_REPEATABLE,InfoPlus.Core.CoreControl.call(this,e)}e.prototype=$.extend(new InfoPlus.Core.CoreControl,{getId:function(){return null==this.control?null:this.control.repeatParentElement.id},getName:function(){return null==this.control?null:$(this.control.repeatParentElement).attr("name")},setValue:function(e){null!==this.control&&this.control.setData(e)},setStyle:function(e,t){$IU.setDynamicStyle(this.control.repeatParentElement,e,t)},getStyle:function(e){return $IU.getElementStyle(this.control.repeatParentElement,e)},getValueByParentElement:function(e,r){function o(e){return(e=e.substr(r.length).split("_")).splice(0,1),e}function s(e){return"field"===e.substr(0,5).toLowerCase()?e.substr(5,1).toLowerCase()+e.substring(6):e.substr(0,1).toLowerCase()+e.substring(1)}var l={},u=function(e){return e instanceof $Controls.Data.Uri?e.value:e instanceof $Controls.Data.ValuePair?{codeId:e.value,codeName:e.displayValue}:e},d=function(e){return"group"===e.substr(0,5).toLowerCase()?e.substr(5,1).toLowerCase()+e.substring(6):e.substr(0,1).toLowerCase()+e.substring(1)},c=function(e,t,n){for(var i=t.slice(t.length-n.length),a=0,r=i.length;a<r;a++){var o=d(i[a]),s=parseInt(n[a],10)+1,l=e[o];if(null==l&&(e[o]=l=[]),l.length<s)for(var u=l.length;u<s;)l[u++]={};e=l[s-1]}return e},h=infoCore.getFields();return $(e).find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t,n=$(this),i=n.data($Control.DATA_PATH),a=n.data($Control.DATA_FIELD),n=n.data($Control.DATA_CONTROL_OBJECT);null!=a&&null!=n&&i.substr(0,r.length)===r&&(a=h[a],n=n.getValue(),t=a.groupArray,null!=n)&&(i===r?l[s(a.name)]=u(n):(e=l,t=t,i=o(i),a=s(a.name),n=n,(e=c(e,t,i))[a]=u(n)))}),$(e).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var e,t,n,i=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);null!=i&&(t=i.path,n=i.groupName,(i=i.fullGroupName.split("//")).splice(i.length-1,1),t===r?l[d(n)]===a&&(l[d(n)]=[]):(e=l,i=i,t=o(t),n=d(n),(e=c(e,i,t))[n]===a&&(e[n]=[])))}),l=r===this.control.path&&(l=l[d(this.control.groupName)])===a?[]:l},getValue:function(){return null==this.control?null:!0===this.control.power.readPower?this.getValueByParentElement(this.control.repeatContentParentElement,this.control.path):[]},getAttributes:function(){return null},validate:function(){var e;return null==this.control||(e=$(this.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter),$IU.checkControlValidation(e,!0,!0))},registerEvent:function(e,t,n){$(this.control.repeatParentElement).on(e,t,n)},unRegisterEvent:function(e,t){$(this.control.repeatParentElement).off(e,t)},trigger:function(e){$(this.control.repeatParentElement).trigger(e)},isReadable:function(){return this.control.power.readPower},isWritable:function(){return this.control.power.writePower},addRow:function(e,t){var n,i=this.control;null!=i&&!1!==i.power.insertPower&&(e===a&&t===a?i.addRepeat(null,null,!0,!1,!1,!1):("object"==typeof e?(t=e,e=null):null!=(n=i.getRepeatChild(e))&&(i.popupMenu.repeatSection=n),n=null==e?i.getRepeatChildren().length:e+1,i.addRepeat(null,null,!0,!1,!1,!1),t!==a&&this.setRowData(n,t)))},deleteRow:function(e){var t,n;null!=e&&null!=(t=this.control)&&!1!==t.power.deletePower&&null!=(n=t.getRepeatChild(e))&&t.deleteRepeat(n,!0)},setRowData:function(e,t){null!=this.control&&(e=this.control.path+"_"+e,$IU.setFormData(t,e,!1))},getRowData:function(e){var t;return null!=this.control&&null!=(t=this.control.getRepeatChild(e))?this.getValueByParentElement(t,this.control.path+"_"+e):null},moveRow:function(e,t){var n;null!=this.control&&!1!==(n=this.control).power.writePower&&n.moveRow(e,t)},sortColumn:function(e,t){null!=this.control&&this.control.sorter.sortColumn(e,t)},getChildren:function(){return this.control.getRepeatChildren()},readOnly:function(e,t){var n;null!=this.control&&((n=this.control).readOnly=e,null!=n.repeatAddLink)&&(n.shouldShowAddLink()?n.repeatAddLink.showLink():n.repeatAddLink.hideLink())},visible:function(e,t){var n=$(this.control.repeatParentElement);e?n.show():n.hide()},rowVisible:function(e,t){var n,i;null!=this.control&&((n=this.control.getRow()).is("tr")?$IU.processTrRowVisible(n,e,t):n.hasClass("infoplus_view")?null!=(i=n.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT))&&i.visible(e,t):e?$IU.dynamicShowElement(n):$IU.dynamicHideElement(n))},colVisible:function(e,t){if(null!=this.control){for(var n=$(this.control.repeatParentElement),i=n.parents(".infoplus_repeatParentElement"),a=null,r=0,o=i.length;r<o;r++){var s=$(i[r]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(s.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){a=s;break}}null!=a&&-1!==(n=(n=$(n.parents("td")[0])).parent().children("td").index(n))&&a.setColumnVisible(n,e)}},itemVisible:function(e,t,n){var i=this.control.getRepeatChildren();0<=t&&t<i.length&&(i=$(i[t]),!0===e?n?$IU.dynamicShowElement(i):$IU.dynamicShowElement(i,"slow"):$IU.dynamicHideElement(i))},itemReadOnly:function(t,e,n){var i=this.control.fullGroupName,a=this.control.getRepeatChildren();0<=e&&e<a.length&&((a=$(a[e])).data("isReadOnly",!!t),a.find(".infoplus_control").each(function(){var e=$(this).data("controlObject");null!=e&&e.field.groupName===i&&$$(e).readOnly(!!t,n)}))}}),define("InfoPlus.Core.CoreRepeatControl",e)}(void window),function(){function e(e){this.type=InfoPlus.Core.CoreControl.TYPE_VIEW,InfoPlus.Core.CoreControl.call(this,e)}e.prototype=$.extend(new InfoPlus.Core.CoreControl,{getId:function(){return null==this.control?null:this.control.element.id},getName:function(){return null==this.control?null:$(this.control.element).attr("name")},getPath:function(){return""},setStyle:function(e,t){null!=this.control&&$IU.setDynamicStyle(this.control.element,e,t)},getStyle:function(e){return null==this.control?null:$IU.getElementStyle(this.control.element,e)},getValue:function(){return null},getAttributes:function(){return null},validate:function(){var e;return null==this.control||(e=$(this.control.element).find("*[class*='validate']").filter($IU.isValidateControlFilter),$IU.checkControlValidation(e,!0,!0))},registerEvent:function(e,t,n){$(this.control.element).on(e,t,n)},unRegisterEvent:function(e,t){$(this.control.element).off(e,t)},trigger:function(e){$(this.control.element).trigger(e)},visible:function(e,t){null!=this.control&&this.control.visible(e,t)},expanded:function(e,t){null!=this.control&&this.control.expanded(e,t)},rowVisible:function(e,t){this.visible(e,t)},readOnly:function(e,t){this.control}}),define("InfoPlus.Core.CoreViewControl",e)}(window),function(){function e(){}e.prototype={requestMap:{},getCodes:function(){return $$.entity.codes},getCode:function(e){return null==$$.entity.codes?null:$$.entity.codes[e]},addRequestCode:function(e,t){void 0===this.requestMap[e]?this.requestMap[e]=[t]:(e=this.requestMap[e],$IU.arrayContains(e,t)||e.push(t))},requestCodes:function(){var e,l=this.requestMap;for(e in l)l.hasOwnProperty(e)&&!function(s){var e={prefix:"",type:"Code",code:s,parent:"",isTopLevel:!0,pageNo:0,pageSize:65534,rand:999*Math.random(),settings:"{}"};$$.ajax({type:"POST",url:$$.params.formRender.suggestService,data:e,needParse:!1,showParseErrMsg:!1,showAjaxErrMsg:!1,addFormParam:!0}).done(function(e){var t=$$.entity.codes,n=t[s];if(!(null!=n&&$IU.isArray(n.items)&&0<n.items.length)){var i=l[s];if($IU.isArray(i))for(var a=0,r=i.length;a<r;a++){var o=i[a];$$("&"+o).options(e)}null==n&&(t[s]=n={}),n.items=e.items,l.hasOwnProperty(s)&&delete l[s]}})}(e)}},define("InfoPlus.CodeManager",e)}(window),function(T,I,v){function f(e){return new f.fn.init(e)}var A=I.document,e=Array.prototype.slice;(f.fn=f.prototype={constructor:f,selector:"",length:0,toArray:function(){return e.call(this,0)},init:function(e){if(e instanceof InfoPlus.Controls.Control)this[0]=new InfoPlus.Core.CoreBoundControl(e),this.length=1;else if(e instanceof InfoPlus.Repeat.RepeatControl)this[0]=new InfoPlus.Core.CoreRepeatControl(e),this.length=1;else if(e instanceof InfoPlus.Layout.View)this[0]=new InfoPlus.Core.CoreViewControl(e),this.length=1;else if(e instanceof InfoPlus.Core.CoreControl)this[0]=e,this.length=1;else if(T.isArray(e)){for(var t=e,n=0,i=0,a=t.length;i<a;i++){var r=t[i];r instanceof InfoPlus.Controls.Control?this[n++]=new InfoPlus.Core.CoreBoundControl(r):r instanceof InfoPlus.Repeat.RepeatControl?this[n++]=new InfoPlus.Core.CoreRepeatControl(r):r instanceof InfoPlus.Layout.View?this[n++]=new InfoPlus.Core.CoreViewControl(r):r instanceof InfoPlus.Core.CoreControl&&(this[n++]=r)}this.length=n}else{"string"==typeof e&&(e=(e=e.replace(/&([a-zA-Z]+[a-zA-Z\d]*)/g,"[name='$1'],[name^='$1_']")).replace(/\*([a-zA-Z]+[a-zA-Z\d]*)/g,".infoplus_$1Control"));var o=T(e);if(0<o.length){for(i=n=0,a=o.length;i<a;i++){var s,l=T(o[i]);(r=l.data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT))!==v?this[n++]=new InfoPlus.Core.CoreBoundControl(r):(s=l.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT))!==v?this[n++]=new InfoPlus.Core.CoreRepeatControl(s):(s=l.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT))!==v&&(this[n++]=new InfoPlus.Core.CoreViewControl(s))}this.length=n}else this.length=0;this.selector=e}return this},each:function(e,t){return f.each(this,e,t)},on:function(e,t,n){return"function"==typeof t&&(n=t,t=v),f.event.isCoreObjectEventTypes(e)?""!==this.selector?f.event.registerCoreObjectEvents(e,this.selector,t,n):this.each(function(){f.event.registerCoreObjectEvents(e,this,t,n)}):""!==this.selector?f.registerEvents(e,this.selector,!1,t,n):this.each(function(){this.callMethod("registerEvent",e,t,n)}),this},off:function(e,t){return f.event.isCoreObjectEventTypes(e)?""!==this.selector?f.event.unregisterCoreObjectEvents(e,this.selector,t):this.each(function(){f.event.unregisterCoreObjectEvents(e,this,t)}):""!==this.selector?f.unregisterEvents(e,this.selector,t):this.each(function(){this.callMethod("unregisterEvent",e,t)}),this},trigger:function(e){return""!==this.selector?T(this.selector).trigger(e):this.each(function(){this.callMethod("trigger",e)}),this},val:function(e){return e!==v?this.each(function(){this.setValue(e)}):0<this.length?this[0].getValue():null},attr:function(){return 0<this.length?this[0].getAttributes():null},isReadable:function(){return 0<this.length?this[0].isReadable():null},isWritable:function(){return 0<this.length?this[0].isWritable():null},isEditable:function(){return 0<this.length?this[0].isEditable():null},css:function(e,t){if("string"==typeof e&&t===v)return 0<this.length?this[0].getStyle(e):null;var n=[];if($IU.isArray(e))n=e;else if("object"==typeof e){var i,a=e;if(null==a)return this;for(i in a)a.hasOwnProperty(i)&&n.push({name:i,value:a[i]})}else"string"==typeof e&&"string"==typeof t&&n.push({name:e,value:t});return this.each(function(){for(var e=0,t=n.length;e<t;e++)this.setStyle(n[e].name,n[e].value)})},getName:function(){return 0<this.length?this[0].getName():null},contains:function(e){for(var t=0;t<this.length;t++)if(this[t].getGuid()===e.getGuid())return!0;return!1},get:function(e){return this.length>e?this[e]:v},filter:function(a){var r=[];return this.each(function(){if("function"==typeof a)!0===a.call(this)&&r.push(this);else{var e,t=!0;for(e in a)if(a.hasOwnProperty(e)){var n=a[e],i=this["get"+e.substring(0,1).toUpperCase()+e.substring(1)];if("function"==typeof i&&i.call(this)!==n){t=!1;break}}t&&r.push(this)}}),f(r)},validate:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];if(n instanceof InfoPlus.Core.CoreBoundControl)e.push(n.control);else for(var i=T(n.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter),a=0,r=i.length;a<r;a++)e.push(i[a])}return $IU.checkControlValidation(e,!0,!0)}}).init.prototype=f.fn,T.extend(f.fn,{visible:function(e,t){var n=this.each(function(){this.callMethod("visible",e,t)});return t||$IU.updateFormTipsAndViews(),n},expanded:function(e,t){var n=this.each(function(){this.callMethod("expanded",e,t)});return t||$IU.updateFormTipsAndViews(),n},itemVisible:function(e,t,n){var i=this.each(function(){this.callMethod("itemVisible",e,t,n)});return n||$IU.updateFormTipsAndViews(),i},rowVisible:function(e,t){var n=this.each(function(){this.callMethod("rowVisible",e,t)});return t||$IU.updateFormTipsAndViews(),n},colVisible:function(e,t){var n=this.each(function(){this.callMethod("colVisible",e,t)});return t||$IU.updateFormTipsAndViews(),n},parentValue:function(e,t){return this.each(function(){this.callMethod("setParentValue",e,t)})},dataSource:function(e,t){return this.each(function(){this.callMethod("setDataSource",e,t)})},readOnly:function(e,t){return this.each(function(){this.callMethod("readOnly",e,t)})},itemReadOnly:function(e,t,n){return this.each(function(){this.callMethod("itemReadOnly",e,t,n)})},tooltip:function(e,t){return this.each(function(){this.callMethod("tooltip",e,t)})}}),T.extend(f.fn,{options:function(e){return this.each(function(){this.callMethod("setOptions",e.items)})}}),T.extend(f,{DEBUG:!1,MOBILE:!1,WECHAT:navigator.userAgent.match(/MicroMessenger/),MINIPROGRAM:navigator.userAgent.match(/miniprogram/i)||"miniprogram"===I.__wxjs_environment,DINGTALK:navigator.userAgent.toLowerCase().match(/dingtalk/),dingTalkJSLoaded:!1,PREVIEW:!1,testFile:null,APP:navigator.userAgent.match(/TaskCenterApp/),params:{renderContainer:T("#div_render_container"),renderForm:T("#renderForm"),holder:{remark:T("#form_remark_holder"),milestone:T("#form_milestone_holder"),renderContent:T("#renderContent_holder"),render:T("#render_holder"),form:T("#form_holder"),title:T("#title_holder"),commandHolder:T("#command_holder"),commandBar:T("#form_command_bar")},fieldChanging:null,fieldSyncing:!1,initControls:[],ajax:{blockingIds:[],blockedCallbacks:[]},rowIndexSuffix:Math.round(9e5*Math.random()+1e5),initializing:!0,showTutorial:!0,ids:{save:"FormCommandSave",print:"FormCommandPrint",download:"FormCommandDownload",admin:"FormCommandAdmin"}},dynamics:{styles:{},referedStyles:{},formulas:{},referedFormulas:{},initialFormulas:{},actions:{},referedActions:{},validations:{},referedValidations:{},globalContext:{}},initVisibility:function(){f.visibility={titleBar:!($$.VIEWS_ONLY||$$.PRINT||$$.PREVIEW||$$.APP),commandBar:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW,milestone:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&"false"!==$$.params.showRemark,remark:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&"false"!==$$.params.showRemark,floatTool:!($$.VIEWS_ONLY||$$.PRINT||$$.PREVIEW||$$.MOBILE),footer:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW}},initCore:function(e){f.params=T.extend(f.params,e),f.initVisibility(),f.codeManager=new InfoPlus.CodeManager,f.dynamics.cache=new InfoPlus.Dynamics.Cache,f.entity=e.formRender.entity},setTestFile:function(e){f.testFile=e},getTestFile:function(){return f.testFile},getFormRender:function(){return f.params.formRender},registerEvents:function(e,t,n,i,a){n===v?f.event.registerGlobalEvents(e,a=t):!0===n&&!0===f.event.findRegisteredEvent(e,t)||("function"==typeof i&&(a=i,i=v),f.event.registerSelectorEvents(e,t,a)&&(i!==v?$$.params.renderForm.on(e,t,i,a):$$.params.renderForm.on(e,t,a)))},unregisterEvents:function(e,t,n){"string"==typeof t?($$.params.renderForm.off(e,t,n),f.event.unregisterSelectorEvents(e,t,n)):f.event.unregisterGlobalEvents(e,n="function"==typeof t?t:v)},registerControlEvents:function(e){var t=e.events;if(T.isArray(t)&&0!==t.length)for(var n=0,i=t.length;n<i;n++){var a=t[n],r=a.selector!==v?a.selector:"."+InfoPlus.Controls.Control.CLASSNAME_CONTROL+"."+e.getElementClassName();f.registerEvents(a.type,r,!0,a.data,a.handler)}},each:function(e,t,n){var i,a=0,r=e.length,o=r===v||T.isFunction(e);if(n)if(o){for(i in e)if(e.hasOwnProperty(i)&&!1===t.apply(e[i],n))break}else for(;a<r&&!1!==t.apply(e[a++],n););else if(o){for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))break}else for(;a<r&&!1!==t.call(e[a],a,e[a++]););return e}}),(f.event={}).GLOBAL_EVENT_BEFORE_RENDER="beforeRender",f.event.GLOBAL_EVENT_READY="ready",f.event.GLOBAL_EVENT_REMARK_READY="remarkReady",f.event.GLOBAL_EVENT_FORM_VISIBLE="visible",f.event.GLOBAL_EVENT_RESIZE="resize",f.event.GLOBAL_EVENT_FIELD_CHANGED="fieldChanged",f.event.GLOBAL_EVENT_FIELD_REFERED="fieldRefered",f.event.GLOBAL_EVENT_ADDING_REPEAT="addingRepeat",f.event.GLOBAL_EVENT_ADDED_REPEAT="addedRepeat",f.event.GLOBAL_EVENT_CANDIDATES_QUERIED="candidatesQueried",f.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED="fieldChanged",f.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED="fieldRefered",f.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED="fieldSuggested",f.event.INFOCORE_OBJECT_EVENT_ADDING_REPEAT="addingRepeat",f.event.INFOCORE_OBJECT_EVENT_ADDED_REPEAT="addedRepeat",f.event.globalEventFlag={ready:!1,remarkReady:!1,visible:!1},T.extend(f.event,{globalEventTypes:[f.event.GLOBAL_EVENT_BEFORE_RENDER,f.event.GLOBAL_EVENT_READY,f.event.GLOBAL_EVENT_REMARK_READY,f.event.GLOBAL_EVENT_FORM_VISIBLE,f.event.GLOBAL_EVENT_RESIZE,f.event.GLOBAL_EVENT_FIELD_CHANGED,f.event.GLOBAL_EVENT_FIELD_REFERED,f.event.GLOBAL_EVENT_ADDING_REPEAT,f.event.GLOBAL_EVENT_ADDED_REPEAT,f.event.GLOBAL_EVENT_CANDIDATES_QUERIED],coreObjectEventTypes:[f.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED,f.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED,f.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED,f.event.INFOCORE_OBJECT_EVENT_ADDING_REPEAT,f.event.INFOCORE_OBJECT_EVENT_ADDED_REPEAT],globalEventHandlers:{},selectorEventHandlers:{},coreObjectEventHandlers:{},isGlobalEventTypes:function(e){for(var t=f.event.globalEventTypes,n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1},isCoreObjectEventTypes:function(e){for(var t=f.event.coreObjectEventTypes,n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1},registerCoreObjectEvents:function(e,t,n,i){if(!f.event.isCoreObjectEventTypes(e))return!1;for(var a=f.event.coreObjectEventHandlers,r=(a[e]===v&&(a[e]=[]),null),o=("string"!=typeof t&&(r=t,t=null),a[e]),s=0,l=o.length;s<l;s++){var u=o[s];if(u.handler===i)if(null!=r){if(null!=u.control&&u.control.getGuid()===r.getGuid())return!1}else if(null!=u.selector&&u.selector===t)return!1}return o.push({control:r,selector:t,data:n,handler:i}),!0},unregisterCoreObjectEvents:function(e,t,n){var i=f.event.coreObjectEventHandlers[e];if(i!==v&&null!==i)if(t!==v&&n!==v){var a=null;"string"!=typeof t&&(a=t,t=null);for(var r=0,o=i.length;r<o;r++){var s=i[r];if(s.handler===n)if(null!=a){if(null!=s.control&&s.control.getGuid()===a.getGuid())return void i.splice(r,1)}else if(null!=s.selector&&s.selector===t)return void i.splice(r,1)}}else f.event.coreObjectEventHandlers[e]=[]},registerGlobalEvents:function(e,t){if(!f.event.isGlobalEventTypes(e))return!1;for(var n=f.event.globalEventHandlers,i=(n[e]===v&&(n[e]=[]),n[e]),a=0,r=i.length;a<r;a++)if(i[a]===t)return!1;return i.push(t),!0},unregisterGlobalEvents:function(e,t){var n=f.event.globalEventHandlers[e];if(n!==v&&null!==n)if(t!==v){for(var i=0,a=n.length;i<a;i++)if(n[i]===t)return void n.splice(i,1)}else f.event.globalEventHandlers[e]=[]},registerSelectorEvents:function(e,t,n){for(var i=f.event.selectorEventHandlers,a=(i[t]===v&&(i[t]={}),i[t][e]===v&&(i[t][e]=[]),i[t][e]),r=0,o=a.length;r<o;r++)if(a[r]===n)return!1;return a.push(n),!0},unregisterSelectorEvents:function(e,t,n){var i=f.event.selectorEventHandlers[t];if(i!==v&&(i=i[e])!==v&&null!==i)if(n!==v){for(var a=0,r=i.length;a<r;a++)if(i[a]===n)return void i.splice(a,1)}else f.event.selectorEventHandlers[t][e]=[]},findRegisteredEvent:function(e,t){t=f.event.selectorEventHandlers[t];return t!==v&&t[e]!==v}});for(var t=0,n=f.event.globalEventTypes.length;t<n;t++)f[f.event.globalEventTypes[t]]=function(r){return function(e){if("function"==typeof e)!0===f.event.globalEventFlag[r]?e.apply(I,arguments):f.event.registerGlobalEvents(r,e);else{f.event.globalEventFlag[r]!==v&&(f.event.globalEventFlag[r]=!0);var t=f.event.globalEventHandlers[r];if(t!==v&&null!==t)for(var n=0,i=t.length;n<i;n++){var a=t[n];"function"==typeof a&&a.apply(I,arguments)}}}}(f.event.globalEventTypes[t]);for(t=0,n=f.event.coreObjectEventTypes.length;t<n;t++)f.fn[f.event.coreObjectEventTypes[t]]=function(p){return function(e){var t,n;if("function"==typeof e)this.on(p,e);else{var i=f.event.coreObjectEventHandlers[p];if(null!=i)for(var a=0,r=this.length;a<r;a++)for(var o=this[a],s=0,l=i.length;s<l;s++){var u=i[s];if(t=o,(!(null==(n=u).selector||!$$(n.selector).contains(t))||null!=n.control&&n.control.getGuid()===t.getGuid())&&"function"==typeof u.handler){var d=[];null!=u.data&&d.push({data:data});for(var c=0,h=arguments.length;c<h;c++)d.push(arguments[c]);u.handler.apply(f(o),d)}}}}}(f.event.coreObjectEventTypes[t]);function d(e,_,t,n,E){function i(){f.ajax({type:"POST",url:f.params.doActionUrl,data:e,requestMsg:$$.lt("submit.requestMsg"),beforeShowErrorMsg:function(){T.unblockUI()}}).always(n).done(function(e){for(var a,r=[],o=[],s=0;s<e.entities.length;s++){var t=e.entities[s];if((null!=$$.params.formEntryIdTop?$$.params.formEntryIdTop:$$.params.formEntryId)!==(null!=t.entryIdTop?t.entryIdTop:t.entryId)){a=t,r=[];break}t.assignUser===$$.params.userId&&r.push(t),$$.params.isRelease||"true"!==$$.params.entrust||"Manual"!==t.type||o.push(t)}function n(){function e(e){null!=e&&t.push(e)}var t=[];return null!=l&&(l.defaultButton=!0===$$.params.printable&&null==c),null!=u&&(u.defaultButton=!0===$$.params.downloadable&&null==c,null!=l)&&!0===l.defaultButton&&(u.defaultButton=!1),null!=C&&(C.defaultButton=null==l&&null==u||!($$.params.printAfterAction||$$.params.downloadAfterAction)),null!=c&&(c.defaultButton=null==C),null!=C&&!0===C.defaultButton||null!=c&&!0===c.defaultButton?(e(C),e(c),e(l),e(u)):(e(l),e(u),e(C),e(c)),e(d),t}function i(e,t,n){return!0===$$.params.printable&&!0!==$$.params.downloadable?$$.lt(e):!0!==$$.params.printable&&!0===$$.params.downloadable?$$.lt(t):$$.lt(n)}var l,u,d,c,h=$IU.isEmptyStr($$.params.back)?$IU.browserCloseable()?$$.lt("common.close"):$$.lt("common.ok"):$$.lt("common.back"),p=null==e.error||""===e.error?$$.lt("submit.success"):'<div class="form_do_action_error">'+e.error+"</div>";if(null!=e.error&&""!==e.error||E||!0!==$$.params.printable&&!0!==$$.params.downloadable||(p=(p+=null!=e.error?"":"<br/>")+i("submit.canDo.print","submit.canDo.download","submit.canDo.printOrDownload"),$$.params.printAfterAction||$$.params.downloadAfterAction||(p+=i("submit.hasNotDo.print","submit.hasNotDo.download","submit.hasNotDo.printOrDownload")),p+=i("submit.canClick.print","submit.canClick.download","submit.canClick.printOrDownload")),!0!==$$.params.printable||E||(l={name:$$.lt("common.print"),defaultButton:!0,preventDefault:!0,callback:function(){var e=null!=f&&null!=f.length&&1<f.length;return $IU.openUrl($IU.processUrl($$.params.printUrl),null,e?"_blank":"_self"),!1}}),!0!==$$.params.downloadable||E||(u={name:$$.lt("common.download"),defaultButton:!0!==$$.params.printable,preventDefault:!0,callback:function(){return $$.params.downloadAfterAction=!1,$$.download(!0),!1}}),$$.params.printInvoice&&$$.params.printAfterAction&&(d={name:$$.lt("thing.printInvoice"),defaultButton:!1,preventDefault:!0,callback:function(){return $$.printInvoice(),!1}}),0===r.length&&a===v){!$$.params.printAfterAction&&!$$.params.downloadAfterAction||E?c={name:h,callback:function(){$IU.closeWindow()},defaultButton:!0,callOnClose:!0}:p+="<div>"+$$.lt("submit.closeAfterPrint")+"</div>";var f=n();if(0<o.length){var m="<div>";for(m+=$$.lt("submit.continueTodoList"),!1===$$.params.isRelease&&(m+="<br/>"+$$.lt("submit.openInNewWindow")),s=0;s<o.length;s++)t=o[s],m+="<br/><input class='infoplus_chooseNextStep' type='radio' value='"+t.flowStepId+"'"+(0===s?"checked":"")+" name='nextStepChooseRadio'/>"+$$.lt("submit.doStep",t.name);m+="</div>",g=function(){for(var e=T(".infoplus_chooseNextStep"),t=0;t<e.length;t++){var n,i=e[t];if(!0===i.checked){for(s=0;s<o.length;s++)if(parseInt(i.value,10)===o[s].flowStepId){!1===$$.params.isRelease?(n=A.createElement("a"),T(n).css("display","none").attr("target","_blank").attr("href",$IU.processUrl(o[s].renderUri)),T("body").append(n),$IU.fireClick(n)):I.location.href=$IU.processUrl(o[s].renderUri);break}break}}return!1},f.push({name:$$.lt("submit.continueToDebug"),preventDefault:!0,callback:function(){var e;return 1===o.length?I.location.href=$IU.processUrl(o[0].renderUri):(e={name:$$.lt("submit.nextStep"),defaultButton:!0,callback:g,preventDefault:!0},$.rebuild({content:m,maxWidth:440,buttons:[e]})),!1}})}var $=new InfoPlus.Render.Dialog({content:p,maxWidth:1<f.length?550:440,buttons:f});$.show()}else{var g=function(){if(a!==v)I.location.href=$IU.processUrl(a.renderUri);else if(1===r.length)I.location.href=$IU.processUrl(r[0].renderUri);else for(var e=T(".infoplus_chooseNextStep"),t=0;t<e.length;t++){var n,i=e[t];if(!0===i.checked){for(s=0;s<r.length;s++)if(parseInt(i.value,10)===r[s].flowStepId){!1===$$.params.isRelease?(n=A.createElement("a"),T(n).css("display","none").attr("target","_blank").attr("href",$IU.processUrl(r[s].renderUri)),T("body").append(n),$IU.fireClick(n)):I.location.href=$IU.processUrl(r[s].renderUri);break}break}}return!1};if(a!==v)p+="<br/>"+$$.lt("submit.continueTodo",$IU.processStepName(a.name));else if(1===r.length){if(_)return void(I.location.href=$IU.processUrl(r[0].renderUri));p+="<br/>"+(null!=l?$$.lt("submit.canContinueTodo",$IU.processStepName(r[0].name)):$$.lt("submit.pleaseContinueTodo",$IU.processStepName(r[0].name)))}else{p+="<br/>"+$$.lt("submit.continueTodoList"),!1===$$.params.isRelease&&(p+="<br/>"+$$.lt("submit.openInNewWindow"));for(var s=0;s<r.length;s++)p+="<br/><input class='infoplus_chooseNextStep' type='radio' value='"+(t=r[s]).flowStepId+"'"+(0===s?"checked":"")+" name='nextStepChooseRadio'/>"+$$.lt("submit.doStep",$IU.processStepName(t.name))}var C={name:a!==v?$$.lt("submit.next"):$$.lt("submit.nextStep"),defaultButton:!0,callback:g,preventDefault:!0};!$$.params.printAfterAction&&!$$.params.downloadAfterAction||E?c={name:h,callback:function(){$IU.closeWindow()},callOnClose:!0}:p+="<div>"+$$.lt("submit.closeAfterPrint")+"</div>",f=n(),($=new InfoPlus.Render.Dialog({content:p,maxWidth:2<f.length?550:400,buttons:f})).show()}})}(t=t())!==v?setTimeout(i,t):i()}T.extend(f,{parseDynamic:function(t,n){try{return InfoPlus.Dynamics.Parser.Expression.parse(t)}catch(e){n="Error occur while parsing the dynamic expression of "+n+".\n\n",n=(n+=t+"\n\n")+("Error description: "+e.message+"\n\n")+"Click OK to continue.\n\n";alert(n)}return null},debug:function(e){f.params.isRelease||f.log(e)},getIeVersion:function(){var e=+(/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1];return e=isNaN(e)?+(/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]:e},log:function(e,t,n){var a;I.console!==v?"object"==typeof e?(t!==v&&console.log(t),null!=console.dirxml?console.dir(e):(a=function(e,t){var n,i="";for(n in e)e.hasOwnProperty(n)&&(T.isArray(e[n])?i+=t+n+": [ \n"+a(e[n],t+"  ")+t+"]\n":"object"==typeof e[n]?null===e[n]?i+=t+n+": null\n":i+=t+n+": { \n"+a(e[n],t+"  ")+t+"}\n":i+=t+n+": "+e[n]+"\n");return i},console.log(a(e,"")))):(t=t===v?e:t+" -> "+e,n!==v?(t="%c"+t,console.log(t,n)):console.log(t)):alert(e)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},getTransitionEndEventName:function(){if(null!=$$.params.transitionEndEventName)return $$.params.transitionEndEventName;var e,t=A.createElement("fake"),n={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"};for(e in n)if(n.hasOwnProperty(e)&&t.style[e]!==v)return $$.params.transitionEndEventName=n[e],n[e];return null},asynchronousInvoke:function(e,t,n){var i,a;if("function"==typeof e)return i=function(){null!=t?null==n?e.apply(t):e.apply(t,n):e.apply()},0<$$.params.ajax.blockingIds.length?(a=$$.guid(),$$.params.ajax.blockedCallbacks.push({id:a,callback:e,invoker:t,args:n}),$$.blockUI({message:"<span class='loading'>...</span>"}),setTimeout(function(){for(var e=0,t=$$.params.ajax.blockedCallbacks.length;e<t;e++)if($$.params.ajax.blockedCallbacks[e].id===a){$$.params.ajax.blockedCallbacks.splice(e,1),T.unblockUI(),i();break}},5e3),!1):void i()},ajax:function(u){var d=T.Deferred();if(null==u||null==u.url)return d.reject({error:$$.lt("error.lackOfPara")});null!=u.data&&(u.data.csrfToken=T(A).find("meta[itemscope=csrfToken]").attr("content"),null==u.data.lang)&&(u.data.lang=$$.params.lang),null!=($$.params.viewToken||transformer.viewToken)&&(u.data.viewToken=$$.params.viewToken||transformer.viewToken),u.cache=!1,u.dataType="json";function c(e,t,n,i,a){var r,o,s,l;!0===m&&("function"==typeof $&&$(),o=null,-1!==(s=(r=n).indexOf(n="|INFOPLUS_SPLITER|"))?(o=r.substr(s+n.length),r=r.substring(0,s)):-1!==(s=r.indexOf("\n\n"))&&(o=r.substr(s+"\n\n".length),r=r.substring(0,s)),"EVENT_CANCELLED"!==t||null!=o&&""!==o||null==u.errorTipElement?$IU.errorMessageBox(r,o,g===v?p+$$.lt("common.fail"):""!==g?g:null,a,t,i):(l=T(u.errorTipElement).data($Control.DATA_CONTROL_OBJECT)).controlType===$Control.CONTROL_TYPE_BUTTON||l.controlType===$Control.CONTROL_TYPE_LINK_BUTTON||l.controlType===$Control.CONTROL_TYPE_CHECKBOX?$IU.errorMessageBox(r,null,null,a,t,!1,!1,null,400):setTimeout(function(){r=$IU.linkifyStr($IU.htmlEncode(r)),T(u.errorTipElement).validationEngine("showPrompt",r,null,"topLeft",!0),l.popError=!0},300))}var h=u.needParse===v||u.needParse,p=u.requestMsg===v?"":u.requestMsg,f=u.parseErrMsg===v?p+$$.lt("common.fail"):u.parseErrMsg,t=u.ajaxErrMsg===v?p+$$.lt("common.fail"):u.ajaxErrMsg,m=u.showParseErrMsg===v||u.showParseErrMsg,n=u.showAjaxErrMsg===v||u.showAjaxErrMsg,$=u.beforeShowErrorMsg,g=u.errorTitle,e=!0===u.block;!0===u.addFormParam&&T.extend(u.data,{instanceId:$$.params.formInstanceId,stepId:null==$$.params.formStepId?-1:$$.params.formStepId,entryId:$$.params.formEntryId,workflowId:$$.params.workflowId,release:$$.params.release});return!0==e&&(u.guid=$$.guid(),$$.params.ajax.blockingIds.push(u.guid)),u.contentType="application/x-www-form-urlencoded; charset=utf-8",T.ajax(u).done(function(e){var t,n,i,a,r,o,s,l;T.isNumeric(e.errno)?0!==e.errno?"FILE_IS_LOCKED"===e.ecode&&!0!==u.requestAgain?setTimeout(function(){u.requestAgain=!0,$$.ajax(u).done(function(e){d.resolve(e)}).fail(function(e){d.reject(e)})},3e3):"SAFETY_PROTECTION_CSRF"===e.ecode&&!0!==u.requestAgain?(T("meta[itemscope=csrfToken]").attr("content",e.entities[0]),u.requestAgain=!0,$$.ajax(u).done(function(e){d.resolve(e)}).fail(function(e){d.reject(e)})):"USER_LOGIN_REQUIRED"===e.ecode?(i=!0===$$.params.entrust||"true"===transformer.entrust?(t=A.createElement("div"),r=A.createElement("span"),T(r).text($$.lt("login.entrust")),T(t).append(r),new InfoPlus.Render.Dialog({content:t,maxWidth:450,buttons:[{name:$$.lt("common.close"),callback:function(){d.reject({msg:e.error,errno:e.errno,data:e,errCode:e.ecode})}},{name:$$.lt("common.reload"),defaultButton:!0,callback:function(){I.location.reload()}}]})):(t=A.createElement("div"),r=A.createElement("div"),o=A.createElement("span"),l=A.createElement("span"),T(r).text($$.lt("login.needReLogin")).css("margin","20px 0 10px 0"),n=$$.params.reLoginUrl,s=A.createElement("a"),a=T(s),s.target="_blank",n!==v&&(-1===n.indexOf("returnUrl")?a.attr("href",n+"?returnUrl="+encodeURIComponent(I.location.href)):a.attr("href",n)),a.text($$.lt("login.reLogin")).addClass("relogin_link dialog_button default rightest fr").css("margin","auto"),a.click(function(){T(I).one("focus",function(){i.close(),$$.ajax(u).done(function(e){d.resolve(e)}).fail(function(e){d.reject(e)})})}),a.attr("href"),T(o).append(s),T(l).text($$.lt("login.retry")),n=A.createElement("div"),T(n).append(s),a=A.createElement("div"),o=A.createElement("a"),l=A.createElement("i"),T(l).addClass("i-icon-close2"),T(o).append(l).addClass("dialog_close button show").attr("href","#").attr("title",$$.lt("common.close")).attr("style","float:right;color:#616161;position:relative;top:-28px;text-decoration:none"),T(o).click(function(){i.close(),d.reject({msg:e.error,errno:e.errno,data:e,errCode:e.ecode})}),T(a).append(o),T(t).append(a).append(r).append(n),new InfoPlus.Render.Dialog({content:t,maxWidth:350,noButton:!0}))).show():(c(e.errno,e.ecode,e.error,e.errno<0,e.entities),d.reject({msg:e.error,errno:e.errno,data:e,errCode:e.ecode})):d.resolve(e):!0===h?(s=f,l={error:null,data:null},null==(o=e)?l.error={msg:$$.lt("submit.parseDataError"),errno:-1}:(o="string"==typeof o?o:null!=o.d?o.d:null!=o.string?o.string:null,"undefined"!=typeof JSON?l.data=JSON.parse(o):l.data=T.parseJSON(o),null==l.data||null==l.data.entities?l.error=s===v?{msg:$$.lt("submit.jsonError"),errno:-1}:{msg:s,errno:-1}:0!==l.data.errno&&(l.error={msg:l.data.error,errno:l.data.errno})),null!=(a=l).error?(c(a.error.errno,a.error.ecode,a.error.msg,a.error.errno<0,a.error.entities),r={msg:a.error.msg,errno:a.error.errno,data:a.data},d.reject(r)):d.resolve(a.data)):d.resolve(e)}).fail(function(e){!0===n&&("function"==typeof $&&$(),0===e.status&&(e.statusText=$$.lt("common.networkError")),$IU.errorMessageBox(t,e.status+":"+e.statusText,p+$$.lt("common.fail"),null,null,!0)),d.reject({msg:e.statusText,errno:-1})}).always(function(){if(!0===u.block){for(var e=0,t=$$.params.ajax.blockingIds.length;e<t;e++)$$.params.ajax.blockingIds[e]===u.guid&&$$.params.ajax.blockingIds.splice(e,1);if(0===$$.params.ajax.blockingIds.length)for(T.unblockUI(),t=$$.params.ajax.blockedCallbacks.length;0<t;){var n=$$.params.ajax.blockedCallbacks.splice(0,1)[0];"function"==typeof n.callback&&(null!=n.invoker?null==n.args?n.callback.apply(n.invoker):n.callback.apply(n.invoker,n.args):n.callback()),t=$$.params.ajax.blockedCallbacks.length}}}),d.promise()},loadHistory:function(e){var t=null!=e.holder?T(e.holder):$$.params.holder.remark,n=e.entryId!==v?e.entryId:e.instanceId||$$.params.formInstanceId,i=e.stepId!==v?e.stepId:null==$$.params.formStepId?-1:$$.params.formStepId,e=e.includingTop||!1;return $$.ajax({type:"POST",url:$$.params.uriHistory.replace("{id}",n),data:{stepId:i,includingTop:e},requestMsg:$$.lt("remarkHistory.request"),beforeShowErrorMsg:function(){$$.MOBILE||t.removeClass("loading").unblock()}})},doAction:function(e,t,n,i,a,r,o,s){if(n===v&&(n=!0),"object"!=typeof e){var l=e,u=null;if(T("a.command_button_content").each(function(){T(this).data("code")===l&&(u=this)}),null==u)return;e={actionId:T(u).data("actionId"),nextUsers:T.toJSON({}),formData:T.toJSON(f.params.formRender.save({},!1)),remark:""}}else t!==v&&(e.nextUsers=T.toJSON(t));e.stepId=null==f.params.formStepId?-1:f.params.formStepId,e.timestamp=f.params.timestamp,e.boundFields=f.params.boundFields.toString(),e.rand=999*Math.random(),r&&(e.transferToes=r,e.transferBack=o),null!=f.params.receiveCode&&(e.thing=f.params.receiveCode),i===v&&(i=function(){$$.blockUI({message:"<span class='loading'>"+$$.lt("submit.submitting")+"</span>"})},a=function(){T.unblockUI()}),d(e,n,i,a,s)},clickActionButton:function(e){var t;null!=e&&(t=null,T("a.command_button_content").each(function(){T(this).data("code")===e&&(t=this)}),null!=t)&&$IU.fireClick(t)},save:function(o){$$.asynchronousInvoke(function(){function t(e){e=e||"";var t={},t=$$.params.formRender.save(t,!1),e={formData:T.toJSON(t),remark:e,timestamp:$$.params.timestamp,rand:999*Math.random(),boundFields:$$.params.boundFields.toString()},n=$IU.getReviewData();return null!=n&&(e.review=T.toJSON(n)),$$.blockUI({message:"<span class='loading'>"+$$.lt("save.wait")+"</span>"}),$$.ajax({type:"POST",url:$$.params.uriSave,data:e,requestMsg:$$.lt("save.saving"),addFormParam:!0}).done(function(){o===v||"function"!=typeof o?$IU.messageBox(null,$$.lt("save.success"),null,240,function(){$$.params.adminView?I.location.href=$IU.processUrl($$.params.adminViewUrl):I.location.reload()}):o()}).always(function(){T.unblockUI()}),t}var e,n,i,a,r;return null==$$.params.formRender||!1===$IU.doValidate(!0)?null:$$.params.adminView?(e=A.createElement("div"),n=T(e),a=A.createElement("div"),T(a).text($$.lt("save.adminModifyReason")),n.append(a),a=A.createElement("div"),(i=T(a)).text($$.lt("save.reasonRequired")).css("color","red").hide(),n.append(a),a=A.createElement("textarea"),(r=T(a)).css("height","120px").css("width","100%"),n.append(a),void new InfoPlus.Render.Dialog({content:e,maxWidth:600,buttons:[{name:$$.lt("common.ok"),callback:function(){var e=r.val()||"";if(""===$IU.trimString(e))return i.is(":visible")?i.effect("pulsate"):i.show().effect("highlight"),!1;t(e)},defaultButton:!0,preventDefault:!0},{name:$$.lt("common.cancel")}]}).show()):t()})},review:function(){$$.MOBILE&&$IU.mobileExpandAllViews(),$IU.refreshReviewByForm();var e=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm(T(e.maskDiv)),e.close(),$IU.refreshFormReviews()},onCancel:function(){e.close(),$IU.refreshFormReviews()}});e.render(),e.show()},print:function(){if(!$$.params.readOnly&&$$.params.printAfterAction)return $IU.messageBox(null,$$.lt("print.printAfterAction"),null,300),!1;$IU.openUrl($IU.processUrl($$.params.printUrl,"membership"),null,"_blank")},download:function(e){if(!$$.params.readOnly&&$$.params.downloadAfterAction)return $IU.messageBox(null,$$.lt("download.pleaseDownloadAfterAction"),null,300),!1;var i=A.createElement("div"),a=A.createElement("input"),t=(a.type="radio",a.name="optDownloadType",A.createElement("label")),n=(t.appendChild(a),T(t).addClass("download_radio_div").val("   "),A.createElement("div")),r=(T(n).addClass("download_word"),n.appendChild(t),i.appendChild(n),A.createElement("input")),t=(r.type="radio",r.name="optDownloadType",(t=A.createElement("label")).appendChild(r),T(t).addClass("download_radio_div").val("   "),n=A.createElement("div"),T(n).addClass("download_pdf"),n.appendChild(t),i.appendChild(n),T(i).addClass("download_content_div"),$$.params.exportReadOnly?(a.disabled=!0,r.checked=!0,T(a).parents("div.download_word").addClass("download_disable")):a.checked=!0,{name:$$.lt("common.cancel")}),n={name:$$.lt("common.ok"),defaultButton:!0,callback:function(){!0===a.checked?$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),i,"_blank"):$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),i,"_blank")}},r={name:$$.lt("download.saveBeforeDownload"),defaultButton:!0,callback:function(){$$.save(function(){function e(){!0!==t&&(!0===a.checked?$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),i,"_blank"):$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),i,"_blank"),t=!0,n.close())}var t=!1,n=new InfoPlus.Render.Dialog({content:$$.lt("save.success"),maxWidth:240,beforeClose:e,buttons:[{name:$$.lt("download.start"),defaultButton:!0,callback:e,callOnClose:!1}]});n.show()})}},t=[n,t],o=(!0!==e&&$$.params.saveable&&(n.defaultButton=!1,n.name=$$.lt("download.downloadDirectly"),n.preventDefault=!0,n.callback=function(){return $IU.confirmBox($$.lt("download.downloadDirectlyTip"),$$.lt("download.confirmDownloadDirectly"),$$.lt("common.ok"),320,function(){!0===a.checked?$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),i,"_blank"):$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),i,"_blank"),o.close()}),!1},t.splice(0,0,r)),new InfoPlus.Render.Dialog({title:$$.lt("download.choose"),content:i,maxWidth:340,buttons:t}));o.show()},instruct:function(){var e,t,n;null!=$$.params.instructionUrl&&($$.MOBILE?new InfoPlus.Render.Mobile.Page({title:$$.lt("common.instruction"),appendToBody:!0,uri:$$.params.instructionUrl}).show():(t=(e=T("#title_holder")).height(),n=T("#command_holder").height(),e=parseInt(e.parent().css("top"),10),t=t+n+(isNaN(e)?0:e),n=T(I).height()-t-40-48-4-20,$IU.iframeBox($$.params.instructionUrl,$$.lt("common.instruction"),!0,!1,T(I).width(),n)))},compare:function(){var e=$$.params.sameStepHistoryList;if(null==e||0===e.length)return!1;var t=A.createElement("div"),n=T(t),i=A.createElement("div"),a=A.createElement("ul");T(i).text($$.lt("compare.introduce")).addClass("compareIntroduce"),n.append(i);for(var r=0,o=e.length;r<o;r++){var s=e[r],l=A.createElement("li"),u=A.createElement("label"),d=A.createElement("input"),s=(d.value=s.formStepId,d.checked=0===r,T(d).attr("type","radio").attr("name","comparedHistoryOption").addClass("comparedHistoryOption"),s=s.actionTime?s.actionTime+" "+$IU.unixTimeToLocalTimeString(s.actionTime):(T(d).data("initIndex",r),s.name||$$.lt("compare.initData")),A.createTextNode(s));T(u).append(d).append(s).addClass("comparedHistoryLabel"),l.appendChild(u),a.appendChild(l)}n.append(a);i=[{name:$$.lt("compare.compare"),defaultButton:!0,callback:function(){var e,t;InfoPlus.Comparer.clearAll(!0),T(".comparedHistoryOption").each(function(){this.checked&&(null!=T(this).data("initIndex")?t=T(this).data("initIndex"):e=this.value)}),null!=e?($$.blockUI({message:$$.lt("compare.requesting")}),$$.ajax({type:"POST",url:$$.params.uriCompare+"/"+e,data:{compareTo:$$.params.formStepId},requestMsg:$$.lt("compare.requestHistory"),beforeShowErrorMsg:function(){T.unblockUI()}}).done(function(e){var t;null!=e.entities&&0<e.entities.length&&(e=$IU.convertData(e.entities[0]),t=$IU.convertData($$.params.formRender.save({})),new InfoPlus.Comparer(e,t).compare())}).always(function(){T.unblockUI()})):$IU.compareInitData(t)}},{name:$$.lt("common.cancel")}];new InfoPlus.Render.Dialog({content:t,maxWidth:400,buttons:i}).show()},printInvoice:function(){if($$.params.printInvoice){function o(){if(r){for(var e=0,t=l.length;e<t;e++)if(!l[e])return;i.focus(),i.print(),i.close()}}function t(r){e.each(function(){var e=T(this).data($Control.DATA_CONTROL_OBJECT);if(null!=e){var t,n=!0;if(null!=r)for(var n=!1,i=0,a=r.length;i<a;i++)r[i]===e.getValue().value&&(n=!0);n&&null!=(t=e.getPrintContent(l,o))&&s.append(t)}})}function n(){i=I.open();function e(){r||(r=!0,o())}var t=s.html();i.document.write("<style>body {text-align:center}</style>"+t),i.document.close();T(i).load(e),T(i.document).ready(e)}var i,a,e=T(".infoplus_thingControl"),s=T("#div_invoice"),l=(s.empty(),[]),r=!1;if(a=!0,e.each(function(){var e=T(this).data($Control.DATA_CONTROL_OBJECT);null!=e&&null!=e.getPrintContent(l,o)&&(a=!1)}),a)$IU.messageBox(null,$$.lt("thing.nothingToPrint"),null,300);else if(1===e.length)t(),n();else{for(var u=A.createElement("div"),d=[],c=0,h=e.length;c<h;c++){var p,f,m=T(e[c]).data($Control.DATA_CONTROL_OBJECT).getValue();""!==m.displayValue&&(p=A.createElement("label"),(f=A.createElement("input")).type="checkbox",f.value=m.value,f.checked=!0,m=A.createTextNode(m.displayValue),T(p).append(f).append(m).addClass("choosePrintThingLabel"),u.appendChild(p),d.push(f))}var $=[{name:$$.lt("common.ok"),defaultButton:!0,callback:function(){var e=[];for(c=0,h=d.length;c<h;c++)d[c].checked&&e.push(d[c].value);setTimeout(function(){t(e),n()},1e3)}},{name:$$.lt("common.cancel")}];new InfoPlus.Render.Dialog({title:$$.lt("thing.choosePrint"),content:u,maxWidth:340,buttons:$}).show()}}},getFields:function(){return null==f.entity?null:f.entity.fields},getGlobalContext:function(e){function t(e,t){for(var n=[],i=0,a=e.length;i<a;i++)n.push(new $Controls.Data.ValuePair(e[i],(t[i]!==v?t:e)[i]));return n}null==e&&(n={},$$.params.renderForm.find("."+$Control.CLASSNAME_VAR).each(function(){var e=T(this).data($Control.DATA_CONTROL_OBJECT);n[e.field.name]=e.getValue()}),e=n);var n,i,a,r={};for(i in e)e.hasOwnProperty(i)&&$IU.beginWith(i,"_VAR_")&&(e[i+"_name"]!==v?r[i]=new $Controls.Data.ValuePair(e[i],e[i+"_name"]):e[i+"_Name"]!==v?r[i]=new $Controls.Data.ValuePair(e[i],e[i+"_Name"]):e[i+"_Names"]!==v?r[i]=t($IU.splitAttribute(e[i]),$IU.splitAttribute(e[i+"_Names"])):$IU.endWith(i,"_Codes")?(r[a=i.substring(0,i.length-6)]=t($IU.splitAttribute(e[i]),e[a+"_Names"]!==v?$IU.splitAttribute(e[a+"_Names"]):[]),r[i]=e[i]):r.hasOwnProperty(i)||(r[i]=e[i]));return r},blockUI:function(e){var t={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff",cursor:"pointer",width:$$.MOBILE?"80%":"45%",top:"40%",left:$$.MOBILE?"10%":"28%",textAlign:"center"};e.css=T.extend({},t,e.css||{}),T.blockUI(e)},getLocaleText:function(e){for(var t=InfoPlus.Language,n=e.split("."),i=0,a=n.length;i<a;i++)if(null==(t=t[n[i]]))return!1===$$.params.isRelease&&$$.log("locale text not found->"+e+"("+$$.params.lang+")"),"";return t},lt:function(e){var t=$$.getLocaleText(e);if(1!==arguments.length)for(var n=1,i=arguments.length;n<i;n++)t=t.replace("{"+(n-1)+"}",arguments[n]);return t},hlt:function(e){var t=$IU.htmlEncode($$.getLocaleText(e));if(1!==arguments.length)for(var n=1,i=arguments.length;n<i;n++)t=t.replace("{"+(n-1)+"}",arguments[n]);return t},transformLocation:function(e,t,n){return!0===n?InfoPlus.CoordTransform.wgstobd(e,t):InfoPlus.CoordTransform.bdtowgs(e,t)}}),I.infoCore=I.$$=f}(jQuery,window),function(){function e(){}e.prototype={blockChangedField:function(e,t){var n;if($(e).is(":visible"))return n=$(e).parents("div")[0],$(n).block({message:t?"<span class='blockingNoText'>&nbsp;&nbsp;&nbsp;&nbsp;</span>":"<span class='blocking'>"+$$.lt("common.wait")+"</span>",css:{border:"none",padding:t?"0":"3px 0 3px 0",backgroundColor:"#AFC5DE",opacity:.6,cursor:"not-allowed",width:"100%",textAlign:"center",height:$(e).outerHeight()+"px",minHeight:"22px"},overlayCSS:{backgroundColor:"#AFC5DE",width:"100%",opacity:.6}}),n},getFieldChangeSendData:function(e,t){var n=e.getValue(),e=(((n=null==n?"":n)instanceof $Controls.Data.ValuePair||n instanceof $Controls.Data.Uri)&&(n=n.value),e.element),i=$(e).data($Control.DATA_FIELD),e=$(e).data($Control.DATA_PATH);return null==i||null==e?null:{formData:void 0!==t?$.toJSON(t):null,fieldName:i,fieldValue:n,path:e,boundFields:$$.params.boundFields.toString()}},fieldChangeEvent:function(e,t){var n,i,s=this.getFieldChangeSendData(e,t);return null==s?$.Deferred().reject({error:""}):(t=e.controlContainer||e.element,n=e.element,!0===e.popError&&(e.popError=!1,$(t).validationEngine("hidePrompt")),n=this.blockChangedField(n,e.clickFireFieldChange),$$.params.fieldChanging={controls:[],names:null},i=function(e){if(null!=e&&null!=e.entities&&$IU.isArray(e.entities)&&0<e.entities.length)if(null==$$.params.fieldChanging&&($$.params.fieldChanging={controls:[],names:null}),e.entities[0].hasOwnProperty("fieldName")){for(var t=e.entities,n=($$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeOldData(t),[]),i=0;i<t.length;i++){var a,r=t[i].fieldName+t[i].fieldPath;0===document.getElementsByName(r).length?((a=$IU.addVariableControl(r,t[i].fieldValue,t[i].fieldDisplayValue)).onFieldRefer=!0,a.addFieldChangeClass(),n.push(a)):$IU.setElementValue(r,t[i].fieldValue,t[i].fieldDisplayValue)}for($$.dynamics.globalContext=$$.getGlobalContext(),i=0;i<n.length;i++)a=n[i],$(a.element).change()}else{var o=$.parseJSON(e.entities[0]),e=(delete o.entityIndex,$$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeData(o),"string"===$.type(e.entities[1])?e.entities[1]:s.path);$IU.setFormData(o,e,!1),$IU.rebindValidationEngine()}},$$.ajax({type:"POST",url:$$.params.formRender.fieldChangeService,data:s,errorTitle:null,errorTipElement:t,block:!0,addFormParam:!0}).always(function(){null!=n&&$(n).unblock(),n=null}).done(function(e){i(e)}).fail(function(e){"EVENT_CANCELLED"===e.errCode&&i(e.data)}).always(function(e){setTimeout(function(){$$.params.fieldChanging=null},0)}))}},define("InfoPlus.Controls.Event.FieldChangeEventProcessor",e)}(window),function(E){function e(){}e.prototype={analysisDynamic:function(e,t,n,i,a){if(o=t,$$.dynamics.styles[o]===E&&$$.dynamics.formulas[o]===E&&$$.dynamics.actions[o]===E&&$$.dynamics.validations[o]===E&&null!=e&&$IU.isArray(e)){function r(e,t){if(null!=t&&$IU.isArray(t))for(var n=0,i=t.length;n<i;n++)e.push(t[n])}a!==E&&(e=e===E?[]:e).push({key:"parentValue",values:[{value:"$"+a,condition:"true"}]});for(var o,s=[],l=[],u=[],d=[],c=[],h=[],p=[],f=0,m=e.length;f<m;f++){var $=e[f],g=$.key,$=$.values;"value"===g?r(d,$):"style"===g?r(s,$):"rowStyle"===g?r(l,$):"itemStyle"===g?r(u,$):"item"===g.substr(0,4)&&"group"===t.substr(0,5)?r(p,[{actionName:g,actions:$}]):"validation"===g?r(h,$):r(c,[{actionName:g,actions:$}])}this.analysisDynamicStyles(s,l,u,t,n,i),this.analysisDynamicFormulas(d,t,n,i),this.analysisDynamicActions(c,p,t,n,i),this.analysisDynamicValidations(h,t,n,i)}},analysisDynamicStyles:function(e,t,n,d,c,h){var p,f,i;0===e.length&&0===t.length&&0===n.length||(p=$$.dynamics).styles[d]===E&&((i=function(e,t,n){for(var i=0,a=e.length;i<a;i++)for(var r=new InfoPlus.Dynamics.Style({style:e[i].value,condition:e[i].condition,isRowStyle:t,isRepeatItemStyle:n,fieldRowIndexName:c,fieldGroupCountName:h,keyName:d}),o=(f.push(r),r.references),s=o.length,l=0;l<s;l++){var u=o[l];p.referedStyles[u]===E&&(p.referedStyles[u]=[]),p.referedStyles[u].push(r.getReferedStyle(d))}})(e,!(f=[]),!1),i(t,!0,!1),i(n,!1,!0),p.styles[d]=f)},analysisDynamicFormulas:function(e,t,n,i){if(0<e.length){var a=$$.dynamics;if(a.formulas[t]===E){for(var r=[],o=0,s=e.length;o<s;o++)if(null!=e[o].value&&""!==e[o].value)for(var l=new InfoPlus.Dynamics.Formula({formula:e[o].value,condition:e[o].condition,fieldRowIndexName:n,fieldGroupCountName:i,keyName:t}),u=(r.push(l),l.references),d=u.length,c=0;c<d;c++){var h=u[c];h!==t&&(a.referedFormulas[h]===E&&(a.referedFormulas[h]=[]),a.referedFormulas[h].push(l.getReferedFormula(t)))}a.formulas[t]=r}}},analysisDynamicActions:function(e,t,m,$,g){var C,_,n;0===e.length&&0===t.length||(C=$$.dynamics).actions[m]===E&&((n=function(e,t){for(var n=0,i=e.length;n<i;n++)for(var a=e[n].actionName,r=e[n].actions,o=0,s=r.length;o<s;o++){var l=r[o],u="";if(null==l.value||""===l.value)$IU.debugTip($$.lt("dynamics.error.valueNotSet",m,a),"warning");else{$IU.isDynamicActionCallWithParams(a,l.value)&&(l.value="params"+$IU.trimString(l.value));for(var u=t?a+"("+l.value+",$"+$+",$fromInit)":a+"("+l.value+",$fromInit)",d=new InfoPlus.Dynamics.Action({action:u,condition:l.condition,isRepeatItemAction:t,fieldRowIndexName:$,fieldGroupCountName:g,keyName:m}),c=(_.push(d),d.references),h=c.length,p=0;p<h;p++){var f=c[p];C.referedActions[f]===E&&(C.referedActions[f]=[]),C.referedActions[f].push(d.getReferedAction(m))}}}})(e,!(_=[])),n(t,!0),C.actions[m]=_)},analysisDynamicValidations:function(e,t,n,i){if(0!==e.length){var a=$$.dynamics;if(a.validations[t]===E){for(var r=[],o=0,s=e.length;o<s;o++)for(var l=new InfoPlus.Dynamics.Validation({tip:e[o].value,condition:e[o].condition,fieldRowIndexName:n,fieldGroupCountName:i,keyName:t}),u=(r.push(l),l.references),d=u.length,c=0;c<d;c++){var h=u[c];a.referedValidations[h]===E&&(a.referedValidations[h]=[]),a.referedValidations[h].push(l.getReferedValidation(t))}a.validations[t]=r}}}},define("InfoPlus.Dynamics.Analyzer",e)}(void window),function(n,E){function e(){}e.prototype={getReferedControls:function(e,t,n){for(var i=[],a=0,r=t.length;a<r;a++){var o=t[a],s=n[o.getDynamicKeyName()];if(s!==E&&null!==s&&$IU.isArray(s))for(var l=0,u=s.length;l<u;l++){var d=s[l];if($IU.dynamicReferControl(d,e)){i.push(o);break}}}return i},processReferPath:function(e){var t=e.referPath!==E?e.referPath:[];return t.push(e.field.name),e.referPath=E,t},processRepeatContext:function(e,t,n){var i,a,r={};for(i in e)e.hasOwnProperty(i)&&($IU.arrayContains(t,i)||-1!==i.indexOf("RowIndex")?(a=e[i],$IU.isArray(a)&&a[n]!==E&&(r[i]=a[n])):r[i]=e[i]);return r.rowIndex=n,r.INDEX=n,r},processDynamicStyle:function(e,t,n,i,a){var r=$$.dynamics.styles[e.getDynamicKeyName()];if($IU.isArray(r)){null!=e.repeatParentElement?$IU.saveOriginStyles(e.repeatParentElement):$IU.saveOriginStyles(e.element);for(var o=$$(e),s=!0===a?this.getInitControlContext(e):this.getControlContext(e,i),l=0,u=r.length;l<u;l++){var d=r[l];if(n===E||n!==E&&$IU.dynamicReferControl(d,n)){var c=new InfoPlus.Dynamics.Parser.Compile(d.conditionAsts);if(!0===d.isRepeatItemStyle){if("function"==typeof e.getRepeatChildren)for(var h=e.getRepeatChildren(),p=0,f=h.length;p<f;p++){var m=this.processRepeatContext(s,e.fieldNames,p);if(!0===d.ignoreCondition||!0===c.evaluate(m))for(var $=h[p],g=0,C=d.styles.length;g<C;g++)$IU.setDynamicStyle($,d.styles[g].name,d.styles[g].value)}}else if(!0===d.ignoreCondition||!0===c.evaluate(s))if(!0===d.isRowStyle){var _=e.getRow();if(0<_.length)for(g=0,C=d.styles.length;g<C;g++)$IU.setDynamicStyle(_[0],d.styles[g].name,d.styles[g].value)}else o.css(d.styles)}}}},processDynamicAction:function(e,t,n,i,a){var r=$$.dynamics.actions[e.getDynamicKeyName()];if($IU.isArray(r))for(var o=$$(e),s=!0===a?this.getInitControlContext(e):this.getControlContext(e,i),l=0,u=r.length;l<u;l++){var d=r[l];if(n===E||n!==E&&$IU.dynamicReferControl(d,n)){var c=new InfoPlus.Dynamics.Parser.Compile(d.conditionAsts);if(!1===d.isRepeatItemAction)!0!==d.ignoreCondition&&!0!==c.evaluate(s)||(c=new InfoPlus.Dynamics.Parser.Compile(d.actionAsts)).evaluate(s,o);else if("function"==typeof e.getRepeatChildren)for(var h=0,p=e.getRepeatChildren().length;h<p;h++){var f=this.processRepeatContext(s,e.fieldNames,h);!0!==d.ignoreCondition&&!0!==c.evaluate(f)||(c=new InfoPlus.Dynamics.Parser.Compile(d.actionAsts)).evaluate(f,o)}}}},processDynamicValidation:function(e,t,n,i){if(!0!==e.ignoreValidation&&!e.isReadOnly()&&!e.isDynamicReadonly()&&e.isVisible()){var a=$$.dynamics.validations[e.getDynamicKeyName()];if($IU.isArray(a)){var r,o,s=this.getControlContext(e,i),i=e.element;"radio"===i.getAttribute("type")&&(r=e.field.name,i=$($("input[name='"+r+"'][type!=hidden]:first"))[0]),$(i).hasClass("infoplus_suggesterControl")&&(i=$(e.controlContainer).find(".active_input")[0]);for(var l=0,u=a.length;l<u;l++){var d,c=a[l];(n===E||n!==E&&$IU.dynamicReferControl(c,n))&&(d=new InfoPlus.Dynamics.Parser.Compile(c.conditionAsts),!0!==c.ignoreCondition&&!0!==d.evaluate(s)||null!=(c=(d=new InfoPlus.Dynamics.Parser.Compile(c.tipAsts)).evaluate(s))&&""!==c&&(o!==E?o+="<br/>"+c:o=c))}o===E?$(i).validationEngine("hidePrompt"):$(i).validationEngine("showPrompt",o,"danger",e.validatorPromptPosition,!0)}}},processDynamicFormula:function(e,t,n,i,a,r){var o=$$.dynamics.formulas[e.getDynamicKeyName()];if($IU.isArray(o)){var s=$$(e);if(e.isWritable()&&e.repeatParentElement===E&&(i===E||!this.foundControlInReferPath(e,i)))for(var l=!0===r?this.getInitControlContext(e):this.getControlContext(e,a),u=0,d=o.length;u<d;u++){var c,h,p=o[u];(n===E||n!==E&&$IU.dynamicReferControl(p,n))&&(c=new InfoPlus.Dynamics.Parser.Compile(p.conditionAsts),!0!==p.ignoreCondition&&!0!==c.evaluate(l)||(c=(c=new InfoPlus.Dynamics.Parser.Compile(p.formulaAsts)).evaluate(l),h=e.repeatParentElement===E&&e.shouldFireChangeEventAgain(c),c===E&&(c=null),s.val(c),p.isRowIndex||e.controlType===$Control.CONTROL_TYPE_MAP||e.element!==E&&$IU.highLightElement(e.element),h&&(e.referPath=i,setTimeout(function(e){return function(){$(e.element).change()}}(e),0))))}}},processReferedStyle:function(e,t,n,i){for(var a=this.getReferedControls(e,t,$$.dynamics.styles),r=0,o=a.length;r<o;r++){var s=a[r];this.processDynamicStyle(s,n,e,i)}},foundControlInReferPath:function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e.getDynamicKeyName())return!0;return!1},processReferedFormula:function(e,t,n,i){for(var a=this.processReferPath(e),r=this.getReferedControls(e,t,$$.dynamics.formulas),o=0,s=r.length;o<s;o++){var l=r[o];this.processDynamicFormula(l,n,e,a,i)}},processReferedAction:function(e,t,n,i){for(var a=this.getReferedControls(e,t,$$.dynamics.actions),r=0,o=a.length;r<o;r++){var s=a[r];this.processDynamicAction(s,n,e,i)}},processReferedValidation:function(e,t,n,i){for(var a=this.getReferedControls(e,t,$$.dynamics.validations),r=0,o=a.length;r<o;r++){var s=a[r];this.processDynamicValidation(s,n,e,i)}},fieldReferEvent:function(e,t,n,i,a,r,o,s){if(null!=$$.params.fieldChanging){var l=!0===r?this.getReferedControlsByPath(e.path,!0,!0,!0):this.getReferedControlsByPath(e.path,n,i,a);if(null!=$$.params.fieldChanging.names){for(var u=[],d=0,c=l.length;d<c;d++)$$.params.fieldChanging.names.hasOwnProperty(l[d].getDynamicKeyName())||u.push(l[d]);l=u}this.processReferedFormula(e,l,t,s)}else{r=!0===o?(l=this.getReferedControlsByPath(e.path,!0,!0,!0),!0===n&&!0===i&&!0===a?l:this.getReferedControlsByPath(e.path,n,i,a)):l=this.getReferedControlsByPath(e.path,n,i,a);this.processReferedAction(e,l,t,s),this.processReferedStyle(e,l,t,s),this.processReferedFormula(e,r,t,s),this.processReferedValidation(e,l,t,s)}},isReferedControl:function(e,t,n,i,a,r){var o,s=n.path;if(null==s||null==e)return{refered:!1};i&&(o=t.length-1),i&&a&&(o=t.length);for(var l=0;l<o;l++)if(t[l]===s)return{refered:!0,children:!1};return r&&s.length>e.length&&s.substr(0,e.length)===e&&"_"===s.substr(e.length,1)?{refered:!0,children:!0,subPath:s.substr(e.length)}:{refered:!1}},getReferedControlsByPath:function(e,t,n,i){for(var a=$IU.getReferedControlPaths(e),r=$IU.getAllControls(),o=[],s=0,l=r.length;s<l;s++){var u=r[s];!0===this.isReferedControl(e,a,u,t,n,i).refered&&o.push(u)}return o},getControlValue:function(e,t){function n(e,t,n){for(var i=[],a=0,r=e.length;a<r;a++)i.push(new $Controls.Data.ValuePair(e[a],(t[a]!==E?t:e)[a],n));return i}var i=e.getValue(t),t=e.field;if(null==t||t.type!==$Control.DATA_TYPE_INT&&t.type!==$Control.DATA_TYPE_DOUBLE||$IU.isString(i)&&""===$IU.trimString(i)&&(i=0),(i="BoundCheckList"===e.controlType&&e.field.type===$Control.DATA_TYPE_STRING&&i instanceof $Controls.Data.ValuePair?i.value:i)instanceof $Controls.Data.ValuePair||i instanceof $Controls.Data.Uri){var a,r,o=e.getAttributes();for(a in i.expando=o)o.hasOwnProperty(a)&&("value"!==a&&"displayValue"!==a||i instanceof $Controls.Data.Uri)&&(o[a+"_name"]!==E?i[a]=new $Controls.Data.ValuePair(o[a],o[a+"_name"],i.value):o[a+"_Name"]!==E?i[a]=new $Controls.Data.ValuePair(o[a],o[a+"_Name"],i.value):o[a+"_Names"]!==E?i[a]=n($IU.splitAttribute(o[a]),$IU.splitAttribute(o[a+"_Names"],i.value)):$IU.endWith(a,"_Codes")?i[r=a.substring(0,a.length-6)]=n($IU.splitAttribute(o[a]),o[r+"_Names"]!==E?$IU.splitAttribute(o[r+"_Names"]):[],i.value):i[a]=o[a])}return i},putValueIntoContext:function(e,t,n,i){if(!0===i.children){e[t]===E&&(e[t]=[]);for(var a=e[t],r=i.subPath.split("_").slice(1),o=0;o<r.length;o++){var s=parseInt(r[o],10);o===r.length-1?a[s]=n:(a[s]===E&&(a[s]=[]),a=a[s])}}else e[t]=n},getReferedKeyNames:function(e){var t,n=[],i={},a=$$.dynamics.referedStyles,r=$$.dynamics.referedFormulas,o=$$.dynamics.referedActions,s=$$.dynamics.referedValidations;for(t in a)if(a.hasOwnProperty(t))for(var l=a[t],u=l.length,d=0;d<u;d++)if(l[d].targetFieldName===e&&!i.hasOwnProperty(t)){i[t]="";break}for(t in r)if(r.hasOwnProperty(t))for(var c=r[t],u=c.length,d=0;d<u;d++)if(c[d].targetFieldName===e&&!i.hasOwnProperty(t)){i[t]="";break}for(t in o)if(o.hasOwnProperty(t)){var h=o[t];for(u=h.length,d=0;d<u;d++)if(h[d].targetFieldName===e&&!i.hasOwnProperty(t)){i[t]="";break}}for(t in s)if(s.hasOwnProperty(t)){var p=s[t];for(u=p.length,d=0;d<u;d++)if(p[d].targetFieldName===e&&!i.hasOwnProperty(t)){i[t]="";break}}for(t in i)i.hasOwnProperty(t)&&n.push(t);return n},getControlContext:function(e,r,o){for(var t,n,s=this,l=e.path,u=$IU.getReferedControlPaths(l),d=this.getReferedKeyNames(e.getDynamicKeyName()),c=$.extend({},$$.dynamics.globalContext),i=$$.dynamics.cache.get(l),a=0,h=i.length;a<h;a++){var p=i[a];null==p.repeatType?function(e){var t=e.getDynamicKeyName(),n=e.getDynamicContextControlName();if((null!==o&&!1!==o||$IU.arrayContains(d,t)||$IU.arrayContains(d,n))&&(r===E||!$IU.pathInclude(e.path,r))){var i=s.isReferedControl(l,u,e,!0,!0,!0);if(!0===i.refered){if($IU.arrayContains(d,t)||!0===o){var a=s.getControlValue(e);if(e.controlType===$Control.CONTROL_TYPE_RADIO&&null==a)return;s.putValueIntoContext(c,t,a,i)}!$IU.arrayContains(d,n)&&!0!==o||s.putValueIntoContext(c,n,new InfoPlus.Dynamics.ControlReference(e),i)}}}(p):(n=t=void 0,n=(p=p).getDynamicContextControlName(),!$IU.arrayContains(d,n)||r!==E&&$IU.pathInclude(p.path,r)||!0===(t=s.isReferedControl(l,u,p,!0,!0,!0)).refered&&s.putValueIntoContext(c,n,new InfoPlus.Dynamics.RepeatControlReference(p),t))}return c.fromInit=!1,this.putViewContext(e,c),c},getInitControls:function(){var a,r;return 0===$$.params.initControls.length&&(a=[],r=this,$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).not("."+$Control.CLASSNAME_VAR).each(function(){var e,t,n,i=$(this).data($Control.DATA_CONTROL_OBJECT);null!=i&&null!=i.path&&null!=i.field&&(e=i.getDynamicKeyName(),t=i.getDynamicContextControlName(),n=r.getControlValue(i,!0),i.controlType!==$Control.CONTROL_TYPE_RADIO||null!=n)&&a.push({control:i,infoCoreControl:$$(i),keyName:e,controlKeyName:t,value:n,isRepeat:!1})}),$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var e,t=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);null!=t&&null!=t.path&&null!=t.groupName&&(e=t.getDynamicContextControlName(),a.push({control:t,infoCoreControl:$$(t),controlKeyName:e,isRepeat:!0}))}),$$.params.initControls=a),$$.params.initControls},getInitControlContext:function(e){for(var t=this.getInitControls(),n=e.path,i=$IU.getReferedControlPaths(n),a=this.getReferedKeyNames(e.getDynamicKeyName()),r=$.extend({},$$.dynamics.globalContext),o=0,s=t.length;o<s;o++){var l,u,d,c,h=t[o];h.isRepeat?(u=h.controlKeyName,$IU.arrayContains(a,u)&&!0===(d=this.isReferedControl(n,i,h.control,!0,!0,!0)).refered&&this.putValueIntoContext(r,u,new InfoPlus.Dynamics.RepeatControlReference(h.control),d)):(l=h.keyName,u=h.controlKeyName,($IU.arrayContains(a,l)||$IU.arrayContains(a,u))&&!0===(d=this.isReferedControl(n,i,h.control,!0,!0,!0)).refered&&($IU.arrayContains(a,l)&&(c=h.value,this.putValueIntoContext(r,l,c,d)),$IU.arrayContains(a,u))&&this.putValueIntoContext(r,u,new InfoPlus.Dynamics.ControlReference(h.control),d))}return r.fromInit=!0,this.putViewContext(e,r),r},putViewContext:function(e,t){e instanceof InfoPlus.Layout.View?(t.viewWidth=e.render.width,t.PAGE=e.render.name):0<(e=$(e.element).parents(".infoplus_view")).length?t.viewWidth=e.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT).render.width:t.viewWidth=n.width}},define("InfoPlus.Dynamics.Processor",e)}(window),function(h,E){function p(e){this.initData=e.initData,this.formRender=e.formRender,this.render=e.render,this.path=e.path,this.repeatParentElement=e.repeatParentElement,this.repeatContentParentElement=e.repeatContentParentElement,this.firstControlNamePrefix=e.firstControlNamePrefix,this.repeatType=e.repeatType,this.addLinkText=e.addLinkText,this.fieldNames=e.fieldNames,this.groupInformation=e.groupInformation,this.groupName=this.groupInformation.name,this.fullGroupName=this.groupInformation.groupName,this.columnVisible=[],this.init()}function t(e){null==InfoPlus.Repeat.RepeatControl.selectedRepeatRow||InfoPlus.Repeat.RepeatControl.selectedRepeatRow===e&&!$$.MOBILE||((e=$(InfoPlus.Repeat.RepeatControl.selectedRepeatRow)).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED),null==e[0].popupMenu)||e[0].popupMenu.hideMenu()}function n(i,a,r,o){$(a).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED),$(a).is(":animated")?setTimeout(function(){i.showPopupMenu(a,r,o)},500):setTimeout(function(){var e=$(a).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION),t=!1;if(0<e.size())for(var n=0;n<e.size();n++)e.eq(n).is(":animated")&&(t=!0);t?setTimeout(function(){i.showPopupMenu(a,r,o)},500):i.showPopupMenu(a,r,o)},0),InfoPlus.Repeat.RepeatControl.selectedRepeatRow=a}p.REPEAT_TYPE_SECTION=0,p.REPEAT_TYPE_TABLE=1,p.CLASS_REPEAT_SECTION_EXPAND="infoplus_repeatSection_expand",p.CLASS_REPEAT_SECTION_SHRINK="infoplus_repeatSection_shrink",p.CLASS_REPEAT_SECTION_SHRUNKEN="infoplus_repeat_section_shrunken",p.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY="opacity5",p.CLASS_REPEAT_SECTION="infoplus_repeatingSection",p.CLASS_SECTION_BUTTON="infoplus_repeatSectionMenuButton",p.CLASS_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeatSectionExpandButton",p.CLASS_REPEAT_TABLE_ROW="infoplus_repeatingTableRow",p.CLASS_TABLE_BUTTON="infoplus_repeatTableMenuButton",p.CLASS_ADD_LINK="infoplus_addLink",p.CLASS_ADD_LINK_DIV="infoplus_addLinkDiv",p.CLASS_ADD_LINK_CONTAINER_DIV="infoplus_addLinkContainerDiv",p.CLASS_MENUBUTTON_SELECTED="infoplus_menuButtonSelected",p.CLASS_POPUP_MENU="infoplus_popupMenu",p.CLASS_MENU_ITEM="infoplus_menuItem",p.CLASS_REPEAT_PARENT_ELEMENT="infoplus_repeatParentElement",p.CLASS_REPEAT_SELECTED="infoplus_repeatingSelected",p.CLASS_REPEAT_MENU_POPUPED="infoplus_repeatingMenuPopuped",p.CLASS_REPEAT_MASTER="infoplus_repeat_master",p.DATA_REPEAT_CONTROL_OBJECT="repeatControl",p.DATA_REPEAT_MENU_DIV="infoplus_repeat_menu_div",p.DATA_REPEAT_DIV="infoplus_repeat_div",p.DATA_REPEAT_SECTION_DIV="infoplus_repeat_section_div",p.DATA_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeat_section_expand_button",p.DATA_REPEAT_SECTION_EXPAND_BUTTON_TOP="infoplus_repeat_expand_top",p.DATA_REPEAT_SECTION_EXPAND_BUTTON_SHRINK_TOP="infoplus_repeat_expand_shrink_top",p.DATA_REPEAT_SECTION_EXPAND_HEIGHT="infoplus_repeat_section_expand_height",p.REPEAT_SECTION_SHRINK_HEIGHT=28,p.NEW_ROW_INDEX=-1,p.prototype={guid:null,initData:null,eventsInitialized:!1,formRender:null,render:null,path:null,popupMenu:null,repeatParentElement:null,repeatContentParentElement:null,repeatAddLink:null,repeatLayout:null,newRepeatData:null,firstControlNamePrefix:null,repeatType:0,power:null,repeatTableBody:null,keyIndex:null,groupName:null,fullGroupName:null,addLinkText:null,fieldNames:null,sorter:null,hideMenuTimer:null,dynamicProcessor:new InfoPlus.Dynamics.Processor,readOnly:!1,columnVisible:[],showingDetail:!1,init:function(){this.guid=$$.guid(),this.groupCountFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"Count"+$$.params.rowIndexSuffix,this.rowIndexFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"RowIndex"+$$.params.rowIndexSuffix,this.repeatParentElement.id=this.groupName+this.path,$(this.repeatParentElement).attr("name",this.repeatParentElement.id).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT,this),this.replaceHeightStyle(),this.initPower(),this.initRepeatableNewData(),this.initCountControl(),this.initRepeatParentElementStyle(),this.initPopupMenu(),this.isRepeatTable()&&(this.initRepeatTableBody(),!0===this.power.writePower)&&this.initTableSorter(),this.createRepeatableContent(this.initData),this.initAddLink(),null!=this.popupMenu&&$(this.repeatParentElement).append($(this.popupMenu.menuDiv).detach()),!1===InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized&&(this.initEvents(),InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized=!0),this.initMasterDetailEvent(),this.initExternalCodeFields()},replaceHeightStyle:function(){if(!this.isRepeatTable()&&null!=this.render&&null!=this.render.attributes){var e=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];if(null!=i.key&&"style"===i.key.toLowerCase())return i}return null}(this.render.attributes);if(null!=e&&null!=e.value){for(var t="",n=e.value.split(";"),i=0,a=n.length;i<a;i++){var r=n[i].split(":");2===r.length&&"height"===$IU.trimString(r[0].toLowerCase())?t+="min-height:"+r[1]+";":t+=n[i]+";"}e.value=t}}},initMasterDetailEvent:function(){var t=this;this.groupInformation.isMasterDetail&&($(this.repeatParentElement).on("click",".infoplus_labelControl",function(){var e=$(this).parentsUntil("tr."+p.CLASS_REPEAT_TABLE_ROW).last();return 0===e.size()||e.hasClass("detailCell")||t.showDetail(e.parent()[0]),!1}),$$.MOBILE||$(this.repeatParentElement).on("click","tr."+p.CLASS_REPEAT_TABLE_ROW,function(e){if($(e.target).hasClass("infoplus_fileControl")||0<$(e.target).parents(".infoplus_fileControl").length){if($(e.target).hasClass("infoplus_fileControl")&&"DIV"===e.target.nodeName)return t.showDetail(this),!1}else if(!$(e.target).hasClass("infoplus_control"))return t.showDetail(this),!1}))},initExternalCodeFields:function(){this.formRender.eachLayout(function(e){var t,n;"BoundSelect"!==e.renderType&&"BoundOptionList"!==e.renderType||null!=(e=$$.entity.fields[e.field])&&null!=e.code&&((t=null)==(t=null!=(n=$$.codeManager.getCode(e.code))?n.items:t)||$IU.isArray(t)&&0===t.length)&&(null==n||null!=n&&"External"===n.codeType)&&$$.codeManager.addRequestCode(e.code,e.name)},this.render,"Boundable")},initEvents:function(){for(var e=InfoPlus.Repeat.RepeatControl.Events.events,t=0,n=e.length;t<n;t++){var i=e[t];$$.registerEvents(i.type,i.selector,!0,i.data,i.handler)}},initTableSorter:function(){this.sorter=new InfoPlus.Repeat.TableSorter(this)},initAddLink:function(){var e=this.power.insertPower?new InfoPlus.Repeat.RepeatAddLink(this.repeatParentElement,6,this.addLinkText):null;null!=e&&(this.shouldShowAddLink()?e.showLink():e.hideLink()),this.repeatAddLink=e},initPower:function(){this.power=new InfoPlus.Repeat.RepeatPower(this.groupInformation)},initRepeatParentElementStyle:function(){!1===this.power.readPower&&$(this.repeatParentElement).css("display","none"),$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT),this.groupInformation.isMasterDetail&&$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MASTER)},initPopupMenu:function(){var e=this.power;!1===e.writePower&&!1===e.insertPower&&!1===e.deletePower&&!1===e.enforceReadPower||(this.popupMenu=new InfoPlus.Repeat.PopupMenu(this))},isRepeatSection:function(){return this.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION},isRepeatTable:function(){return this.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE},shouldShowAddLink:function(){return!0!==this.readOnly&&!1!==this.power.insertPower},createRepeatTable:function(){var e=this.render,t=this.repeatParentElement,n=document.createElement("table"),i=(this.formRender.createAttributes(n,e.attributes),null!=t&&t.appendChild(n),this.formRender.createColGroup(e,n),document.createElement("tbody"));n.appendChild(i);for(var a,r=0,o=e.renders.length;r<o;r++)!0!==e.renders[r].repeating&&(a=this.formRender.createLayout(e.renders[r],this.initData,this.path),$(a).addClass("infoplus_repeatingTableHeader"),i.appendChild(a));return i},initRepeatTableBody:function(){if(this.isRepeatTable()){this.repeatTableBody=this.createRepeatTable();for(var e=-1,t=0,n=this.render.renders.length;t<n;t++)if(!0===this.render.renders[t].repeating){e=t;break}-1!==e?this.render=this.render.renders[e]:$IU.delayedErrorMessageBox($$.lt("repeatControl.settingError",this.groupName)),this.repeatContentParentElement=this.repeatTableBody}},initRepeatableNewData:function(){for(var e=this.fieldNames,t=$$.entity,n={},i=0;i<e.length;i++){var a=e[i];if(null==t.fields[a])return $IU.debugTip($$.lt("repeatControl.fieldNotFound",a),"warning"),void(this.newRepeatData=n);var r=t.fields[a].permission||"";t.fields[a].initialValue===E||-1===r.indexOf("w")&&-1===r.indexOf("t")?n[a]="":(n[a]=t.fields[a].initialValue,t.fields[a].initialText!==E&&(n[a+"_displayText"]=t.fields[a].initialText))}this.newRepeatData=n},sliceEntity:function(e,t,n){var i,a,r,o={keyCount:0,data:{}};for(i in e)e.hasOwnProperty(i)&&(a=e[i],$IU.isArray(a))&&(r=a.length,0<=t)&&t<r&&(null!=n&&!$IU.arrayContains(n,i)||(o.keyCount++,o.data[i]=a[t]));return o},createRepeatLayout:function(e,t){var n,i=$$.params.engine&&"qform"==$$.params.engine;if(this.isRepeatTable()){n=i?this.formRender.createDesignerLayout(this.render,e,t):this.formRender.createLayout(this.render,e,t),$(n).children("td.detailCell").children().first().addClass("detailSection"),n.setAttribute("id",this.groupName+"_row_"+Math.round(1e5*Math.random()));for(var a=this.columnVisible,r=0,o=a.length;r<o;r++)!1===a[r]&&$(n).children("td:nth-child("+(r+1)+")").hide()}else i=i?this.formRender.createDesignerLayout(this.render,e,t):this.formRender.createLayout(this.render,e,t),(n=document.createElement("div")).appendChild(i),$(n).attr("class",$(i).attr("class")),$(i).removeAttr("class"),null!=i.style.width&&(n.style.width=i.style.width);return this.addRowIndexControl(n,t),n},initRepeatable:function(e,t,n){$(e).data($Control.DATA_PATH,t),e.repeatParentElement=this.repeatParentElement,e.popupMenu=this.popupMenu,e.isRepeatTable=this.isRepeatTable(),e.keyIndex=n},createRepeatSectionExpandButton:function(e){var t,n,i,a;null!=e&&(t=(n=$(e).children())[0],n=n[n.length-1],i=document.createElement("div"),(a=$(i)).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY).attr("title",$$.lt("repeatControl.shrink")).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_MENU_DIV,n).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV,t).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV,e),a.hide(),e.appendChild(i),$(e).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON,i))},changeErrorDivToTempClassName:function(e,t,n,i,a){for(var r,o=e+"formError",s=0;s<n.length;s++)-1!==n[s].className.indexOf(o)&&(r=t+i,$(n[s]).removeClass(o),$(n[s]).addClass(r),a.push(r))},changeErrorDivToNewClassName:function(e,t){for(var n=0;n<e.length;n++){var i=e[n],a=$("div."+i)[0];$(a).removeClass(i),$(a).addClass(i.substring(0,i.length-t.length)+"formError")}},changeRadioControlToTempName:function(e,t,n,i){e.name=$(e).data($Control.DATA_FIELD)+t+n,i.push(e)},changeRadioControlToNewName:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.name=i.name.substr(0,i.name.length-t.length)}},changeControlPath:function(e,s,l,u,d,c,h,p){var f=this;$(e).find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t,n,i,a,r,o=$(this).data($Control.DATA_CONTROL_OBJECT);null!=o&&null!=o.element&&(e=o.element,null!=(r=(t=$(e)).data($Control.DATA_PATH)))&&(n=s+r.substr(l.length),r=(a=(null==(i=t.data($Control.DATA_ORIGIN_INPUT))?e:i).id).substr(0,a.length-r.length)+n,null==i?("radio"!==e.type?t.attr("name",t.data($Control.DATA_FIELD)+n):f.changeRadioControlToTempName(e,n,h,c),e.id=r):(i.name=t.data($Control.DATA_FIELD)+n,i.id=r),t.data($Control.DATA_PATH,n),o.controlType===$Control.CONTROL_TYPE_DATE&&o.reInitDatePicker(),o.path=n,t.hasClass($Control.CLASSNAME_ROWINDEX)&&o.setValue(f.getRowIndex(n)),f.changeErrorDivToTempClassName(a,r,u,p,d))})},changeParentElementPath:function(e,t,n){for(var i=$(e).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT),a=0;a<i.length;a++){var r=i[a],o=$(r).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),s=o.path;null!=s&&(s=t+s.substr(n.length),o.path=s,r.id=o.groupName+s,$(r).attr("name",r.id))}},changeRepeatElementPath:function(e,t,n){for(var i=$(e).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),a=0;a<i.length;a++){var r=$(i[a]),o=r.data($Control.DATA_PATH);null!=o&&(o=t+o.substr(n.length),r.data($Control.DATA_PATH,o))}},changeKeyIndex:function(e,t){this.isRepeatSection()?$(e).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=t:$($(e).parent().parent()[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=t},getRepeatChildren:function(){return $(this.repeatContentParentElement).children(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)},getRepeatChild:function(e){var t=this.getRepeatChildren();return e<t.length?t[e]:null},updateRepeatParentElementKeyIndex:function(){for(var e=this.getRepeatChildren(),t=[],n=0;n<e.length;n++){var i=e[n];t.push(i.keyIndex)}this.keyIndex=t},reorganizeRepeatableElement:function(e){$(this.repeatContentParentElement).find(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).each(function(){var e=$(this);e.is(":animated")&&e.stop(!0,!0)});for(var t=this.getRepeatChildren(),n=[],i=[],a="_radio_temp",r="_errorDiv_temp",o=[],s=$("body > div.formError"),l=0,u=t.length;l<u;l++){var d=t[l],c=$(d),h=(o.push(d.keyIndex),c.data($Control.DATA_PATH)),p=h.split("_");if(parseInt(p[p.length-1])!==l){p.shift();for(var f="",m=0;m<p.length-1;m++)f+="_"+p[m];f+="_"+l,c.data($Control.DATA_PATH,f),this.changeControlPath(d,f,h,s,i,n,a,r),this.changeParentElementPath(d,f,h),this.changeRepeatElementPath(d,f,h)}}this.changeRadioControlToNewName(n,a),this.changeErrorDivToNewClassName(i,r),e&&$IU.updateFormTipsAndViews(),this.keyIndex=o},createRepeatableRow:function(e,t,n){var i=this.path+"_"+e,t=this.createRepeatLayout(t,i);return this.initRepeatable(t,i,e),this.repeatContentParentElement.appendChild(t),this.isRepeatTable()?$(t).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW):($(t).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION),this.createRepeatSectionExpandButton(t)),n.push(e),t},createRepeatableContent:function(e){var t=0,n=this.sliceEntity(e,t,this.fieldNames),i=[],a=null==this.groupInformation.minOccur?0:this.groupInformation.minOccur;if(0===n.keyCount){if(0<a&&!0===this.power.insertPower)for(;t<a;){var r=this.newRepeatData,o=this.createRepeatableRow(t,r,i);this.formRender.doDynamicFormulaControls=this.formRender.doDynamicFormulaControls.concat($IU.getAllControls(o)),t++}}else for(;0<n.keyCount;)r=n.data,this.createRepeatableRow(t,r,i),n=this.sliceEntity(e,++t,this.fieldNames);this.keyIndex=i,this.updateCountControl()},deleteRepeat:function(e,t,n){var i,a,r=$(e);(n=n===E?!1:n)||(i=r.data($Control.DATA_PATH),a=this.formRender,$$.dynamics.cache.build(),r.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);null!=e&&e.field!==E&&e.element!==E&&e.onFieldRefer&&e.fieldReferEvent(a,!0,!1,!1,!1,!1,i)})),$IU.clearErrorPrompt(e),r.empty(),r.remove(),t&&(this.reorganizeRepeatableElement(!0),null!=this.repeatAddLink)&&this.shouldShowAddLink()&&this.repeatAddLink.showLink(),this.updateCountControl()},addRepeatingClass:function(e){this.isRepeatSection()?$(e).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION):$(e).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)},addMenuButton:function(e){this.isRepeatSection()&&this.createRepeatSectionExpandButton(e)},reorganizeAndUpdateKeyIndex:function(e){e?this.reorganizeRepeatableElement(!1):this.updateRepeatParentElementKeyIndex()},showRepeatWithEffect:function(e,t,n){var i=this.isRepeatSection()?"slide":"highlight",t=this.isRepeatSection()?{direction:t?"down":"up"}:{color:"#BFD0E6"};null!=n&&"function"==typeof n?$(e).is(":visible")?n():$(e).show(i,t,"slow",n):$(e).is(":visible")||$(e).show(i,t,"slow")},doDynamicsAfterCreate:function(e){var t=this.formRender;$$.dynamics.cache.build();for(var n=0,i=e.length;n<i;n++){var a=e[n];a.setDynamicStyle(t),a.setDynamicValue(t),a.doDynamicAction(t),a.onFieldRefer&&a.fieldReferEvent(t,!0,!1,!1,!1,!1)}this.setDynamicStyle(t)},createAfterShowCallback:function(e,t){var n=this.firstControlNamePrefix,i=this.shouldShowAddLink(),a=i?null:this.repeatAddLink,r=(this.formRender,this);return function(){null!=n&&$IU.setFocusToElement(n+$(this).data($Control.DATA_PATH)),$IU.updateFormTipsAndViews(),$IU.rebindValidationEngine(),null==a||i||a.hideLink(),$$.addedRepeat(r,t),$$(r).addedRepeat(t)}},appendChildToLast:function(e){var t;this.isRepeatSection()&&0<(t=$(this.repeatContentParentElement).children("."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV)).length?t.before(e):$(this.repeatContentParentElement).append(e)},addLayoutToDom:function(e){null!=this.popupMenu&&null!=this.popupMenu.repeatSection?$(this.popupMenu.repeatSection).after(e):this.appendChildToLast(e)},getRowIndex:function(e){e=e.split("_");return parseInt(e[e.length-1],10)},addRowIndexControl:function(e,t){var n={name:this.rowIndexFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"},i={renderCategory:"Boundable",controlId:this.rowIndexFieldName,field:this.rowIndexFieldName},n=new $Controls.Hidden(t,n,i,this.getRowIndex(t));return $(n.element).addClass($Control.CLASSNAME_ROWINDEX),$(e).append(n.element),n},initCountControl:function(){var e=this.path,t={name:this.groupCountFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"},n={renderCategory:"Boundable",controlId:this.groupCountFieldName,field:this.groupCountFieldName},e=new $Controls.Hidden(e,t,n,0);return $(e.element).addClass($Control.CLASSNAME_GROUP_COUNT),$(this.repeatParentElement).append(e.element),e},updateCountControl:function(){var e=$(this.repeatParentElement).children("."+$Control.CLASSNAME_GROUP_COUNT).data($Control.DATA_CONTROL_OBJECT),t=this.isRepeatSection()?p.CLASS_REPEAT_SECTION:p.CLASS_REPEAT_TABLE_ROW,t=$(this.repeatContentParentElement).children("."+t).length;null!=e&&e.setValue(t)},addDetailDialogScrollEvent:function(e){var t;$(e.element).find(".dialog_content").on("scroll",function(){t===E&&(t=setTimeout(function(){t=E,$IU.updateFormTipsAndViews()},300)),$(this).find(".infoplus_popupMenu").each(function(){var e,t,n;$(this).is(":visible")&&null!=$(this).data("menu").repeatSection&&(n=$(this).data("menu").repeatSection,e=(t=$IU.getElementPosition(n)).left+n.offsetWidth,t=t.top,(t-=$(n).parents(".dialog_content").scrollTop())<(n=parseInt($(n).parents(".dialog_body").css("padding-top"),10)+$(n).parents(".dialog_body").children(".dialog_title").outerHeight())&&(t=n),$(this).css("left",e).css("top",t))})})},addRepeat:function(e,t,n,i,a,r){null==e&&(e=this.newRepeatData),null==t&&(t=this.getNewPath());var o,s,l,u,d=this.formRender,c=(n&&d.save(null,!1),this.createRepeatLayout(e,t)),e=$(c);return this.initRepeatable(c,t,p.NEW_ROW_INDEX),c.style.display="none",e.data("isAdded",!0),this.addRepeatingClass(c),n&&(t=$IU.getAllControls(c),this.addLayoutToDom(c),this.updateCountControl(),this.reorganizeRepeatableElement(!1),d.initFieldReferedClass(),!0===a&&$(c).children("."+$Control.CLASSNAME_ROWINDEX).change(),!0===i&&(null!=this.popupMenu&&null!=this.popupMenu.repeatSection?(n=$(this.popupMenu.repeatSection),o=n.offset().top+n.outerHeight(),30<n.outerHeight()&&(o+=30)):(o=$(this.repeatAddLink.linkDiv).offset().top,o+=30),o>$(document).scrollTop()+$(h).height())&&setTimeout(function(){$IU.scrollTo(o-$("#command_holder").outerHeight()-30-10,500)},100),this.groupInformation.isMasterDetail&&r?(s=this,l=e.find("td.detailCell"),(u=l.children()).css("height","auto"),$$.addingRepeat(this,c),$$(this).addingRepeat(c),this.doDynamicsAfterCreate(t),$IU.isDynamicInvisible(e)||e.show(),this.createAfterShowCallback(t,c)(),d={title:this.getDetailTitle(),content:u,buttons:[{name:$$.lt("common.ok"),callback:function(){u.find(".infoplus_richTextControl").each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).setEditorData()}),u.detach().appendTo(l)},callOnClose:!0,defaultButton:!0},{name:$$.lt("common.cancel"),callback:function(){s.deleteRepeat(c,!0)}}]},$IU.clearAllError(),$$.MOBILE?(d.onShow=function(){s.showingDetail=!1},this.showingDetail=!0,new InfoPlus.Render.Mobile.Page(d).show()):(d.container=$$.params.renderForm,d.overflow="visible",d.lowZindex=!0,d.maxWidth="95%",d.autoWidth=!0,d.autoHeight=!0,d.backgroundNoScroll=!0,(a=new InfoPlus.Render.Dialog(d)).show(),this.addDetailDialogScrollEvent(a))):($$.addingRepeat(this,c),$$(this).addingRepeat(c),this.doDynamicsAfterCreate(t),$IU.isDynamicInvisible(e)?this.createAfterShowCallback(t,c)():this.showRepeatWithEffect(c,!1,this.createAfterShowCallback(t,c)))),c},getDetailTitle:function(){return this.groupInformation&&!$IU.isEmptyStr(this.groupInformation.description)?this.groupInformation.description:$$.lt("repeatControl.detail")},showDetail:function(e){var l,u,t,n,d,i,c,h;this.showingDetail||(l=$(e),this.isRepeatTable()&&this.groupInformation.isMasterDetail&&(u=this,t=function(){return!0!==u.readOnly&&(l.data("isAdded")!==E&&!0===l.data("isAdded")||u.power.deletePower)},n=$(e).find("td.detailCell"),(d=n.children()).css("height","auto"),$IU.clearAllError(),d.find(".infoplus_richTextControl").each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).setEditorData()}),d.find("iframe.infoplus_labelControl").each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);e.setValue(e.initValue,e.initDisplayValue,!0,e.initAttributes)}),i={title:this.getDetailTitle(),content:d,onShow:function(){setTimeout(function(){!(u.showingDetail=!1)===l.data("showDetailError")&&(l.removeData("showDetailError"),e=d.find("*[class*='validate']").filter($IU.isValidateControlFilter),$IU.checkControlValidation(e,!0,!1));var e,t=d.data("diffs");if(null!=t)for(var n={new:"infoTip",modify:"warningTip",delete:"errorTip"},i=0,a=t.length;i<a;i++){var r,o=t[i].control,s=t[i].diff;(null!=o.controlContainer&&$(o.controlContainer).is(":visible")||$(o.element).is(":visible"))&&(r=null,"delete"!==s.type&&"modify"!==s.type||(r=""===s.value?$$.lt("compare.previousValue.empty"):$$.lt("compare.previousValue.previous")+s.value),t[i].tip=new InfoPlus.Render.PopTip({popper:o.controlContainer||o.element,container:($$.MOBILE?c:h).element,text:$$.lt("compare.compareType.type"+s.type.substr(0,1).toUpperCase()+s.type.substr(1)),hoverText:r,colorClass:n[s.type],placement:"top",effect:"bounce",onClose:function(e){return function(){e.clearModified()}}(o)}),o.markModified())}},300)},onClose:function(){var e=d.data("diffs");if(null!=e)for(var t=0,n=e.length;t<n;t++)e[t].tip.close(!0)},buttons:[{name:$$.lt("common.close"),callback:function(){d.detach().appendTo(n)},callOnClose:!0,defaultButton:!0}]},$$.MOBILE?(t()&&i.buttons.push({name:$$.lt("common.deleteText"),className:"delete_detail_button",preventDefault:!0,callback:function(){return null!=u.groupInformation&&null!=u.groupInformation.minOccur&&0<u.groupInformation.minOccur&&u.getRepeatChildren().length<=u.groupInformation.minOccur?$IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300):$IU.yesNoBox(u.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow"),300,function(){c.close(),u.deleteRepeat(e,!0)}),!1}}),this.showingDetail=!0,(c=new InfoPlus.Render.Mobile.Page(i)).show()):(i.container=$$.params.renderForm,i.overflow="visible",i.lowZindex=!0,i.maxWidth="95%",i.autoWidth=!0,i.autoHeight=!0,i.backgroundNoScroll=!0,t()&&i.buttons.push({name:$$.lt("common.deleteText"),className:"delete_detail_button",preventDefault:!0,callback:function(){return null!=u.groupInformation&&null!=u.groupInformation.minOccur&&0<u.groupInformation.minOccur&&u.getRepeatChildren().length<=u.groupInformation.minOccur?$IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300):$IU.yesNoBox(u.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow"),300,function(){h.close(),u.deleteRepeat(e,!0)}),!1}}),(h=new InfoPlus.Render.Dialog(i)).show(),this.addDetailDialogScrollEvent(h))))},moveDownRepeatSection:function(e){var t,n,i,a;!1!==this.power.writePower&&(t=$(e),n="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),0<(n=t.next(n)).length)&&((i=t.offset().top+n.outerHeight())>$(document.body).scrollTop()+$(h).height()&&setTimeout(function(){$IU.scrollTo(i-$("#command_holder").outerHeight()-10,500)},100),t.detach().insertAfter(n).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),this.reorganizeRepeatableElement(!0),a=this,setTimeout(function(){a.showRepeatWithEffect(e,!1)},0))},moveUpRepeatSection:function(e){var t,n,i,a;!1!==this.power.writePower&&(t=$(e),n="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),0<(n=t.prev(n)).length)&&((i=n.offset().top)<$(document.body).scrollTop()+$("#command_holder").outerHeight()&&setTimeout(function(){$IU.scrollTo(i-$("#command_holder").outerHeight()-10,500)},100),t.detach().insertBefore(n).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),this.reorganizeRepeatableElement(!0),a=this,setTimeout(function(){a.showRepeatWithEffect(e,!1)},0))},moveRow:function(e,t){var n,i;e<0||t<0||!1===this.power.writePower||e>=(i=this.getRepeatChildren()).length||e!==(t=t>=i.length?i.length-1:t)&&(n=$(i[e]),i=$(i[t]),e<t?n.detach().insertAfter(i):n.detach().insertBefore(i),this.reorganizeRepeatableElement(!0),this.showRepeatWithEffect(n[0],t<e))},getNewPath:function(){var e=null!=this.popupMenu?this.popupMenu.repeatSection:null,t="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);return null!=e?(e=$(e).data($Control.DATA_PATH).split("_"),this.path+"_"+(Number(e[e.length-1])+1)):(e=$(this.repeatContentParentElement).children(t).length,this.path+"_"+e)},getGroupIndexArray:function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e.groupIndex);return t},createFinishShowFlag:function(e){for(var t=[],n=0;n<e.length;n++)e[n]===E?t[n]=!0:t[n]=!$(e[n]).data("isNew");return t},createAfterShowAllCallback:function(n,i,a){var r=this.shouldShowAddLink(),o=this.repeatAddLink,s=this;return function(){$$.addedRepeat(s,n),$$(s).addedRepeat(n);for(var e=i[a]=!0,t=0;t<i.length;t++)if(!1===i[t]){e=!1;break}e&&($$.params.renderForm.validationEngine("detach"),$$.params.renderForm.validationEngine("attach"),null!=o)&&(r?o.showLink():o.hideLink())}},convertData:function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t)&&"entityIndex"!==t){var i=e[t];if(!$IU.isArray(i)&&0<t.length){var a="field"+t.substring(0,1).toUpperCase()+t.substring(1),r=$$.entity.fields[a];if(i.hasOwnProperty("attributes")&&(n[a+"_Attr"]=i.attributes),null!=r){r=r.type.toLocaleLowerCase();if("date"===r){$IU.isString(i)?n[a]=$IU.dateStringToUnixTime(i):n[a]=i;continue}if("user"===r||"organize"===r||"code"===r||null!=i.codeId){n[a]=i.codeId||"",n[a+"_displayText"]=i.codeName||"";continue}}n[a]=i}}return n},addChildren:function(e,t){for(var n=0,i=t.length;n<i;n++)null!=t[n]&&$(t[n]).data("isNew",!1);for(n=0,i=e.length;n<i;n++){var a=e[n].entityIndex;-1!==a&&a!==E||(a=this.path+"_"+n,t[n]=this.addRepeat(this.convertData(e[n]),a,!1,!1,!1,!1),$(t[n]).data("isNew",!0))}for(n=0;n<t.length;n++){var r=t[n];r!==E&&(this.appendChildToLast(r),!0===$(r).data("isNew"))&&($$.addingRepeat(this,r),$$(this).addingRepeat(r))}},preprocessChangedDataGroup:function(n){$IU.clearErrorPrompt(this.repeatParentElement),null!=$$.params.fieldChanging&&$(this.repeatContentParentElement).find(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).each(function(){var e=$(this);e.is(":animated")&&e.stop(!0,!0)});for(var e=this.getRepeatChildren(),t=e.length,i=n.length,a=[],r=[],o=[],s=0;s<t;s++){var l,u=e[s];-1===(l=function(e){for(var t=0;t<i;t++)if(e===n[t].entityIndex)return t;return-1}(s))?(!1===this.power.deletePower?r:o).push(u):a[l]=u}for(var d=0,c=o.length;d<c;d++){var u=o[d],h=null!=$$.params.fieldChanging;this.deleteRepeat(u,!1,!(d===c-1)&&h)}if(!1===this.power.deletePower&&0<r.length)for(var p=0,f=n.length;p<r.length;p++)a[p+f]=r[p];for(l=0;l<a.length;l++){var m=a[l];m!==E&&$(m).detach()}var g=this.formRender,C=(g.save(null,!1),this.addChildren(n,a),this.updateCountControl(),this.reorganizeRepeatableElement(!1),g.initFieldReferedClass(),g.save(null,!1),$$.dynamics.styles),_=($$.dynamics.cache.build(),$(this.repeatContentParentElement).find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t=$(this).data($Control.DATA_CONTROL_OBJECT);null!=t&&t.field!==E&&t.element!==E&&(e=t.field.name,t.onFieldRefer&&t.fieldReferEvent(g,!0,!1,!1,!0,!0),C[e]!==E)&&$IU.saveOriginStyles(this)}),this.createFinishShowFlag(a));for(l=0;l<a.length;l++)(m=a[l])!==E&&(!0===$(m).data("isNew")?null==$$.params.fieldChanging?this.showRepeatWithEffect(m,!1,this.createAfterShowAllCallback(m,_,l)):($(m).show(),$$.addedRepeat(this,m),$$(this).addedRepeat(m)):"none"!==$IU.getComputedStyle(m,"display")&&$(m).show())},setData:function(e){if(!1===this.power.insertPower){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n],r=a.entityIndex===p.NEW_ROW_INDEX||a.entityIndex===E;r||t.push(a)}e=t}for(this.preprocessChangedDataGroup(e),n=0,i=e.length;n<i;n++){var r=(a=e[n]).entityIndex===p.NEW_ROW_INDEX||a.entityIndex===E,o=this.path+"_"+n;$IU.setFormData(a,o,r)}},showPopupMenu:function(e,t,n){var i,a,r,o,s,l,u=this.popupMenu;null!=u&&(i=$(u.menuDiv),u.repeatSection=e,u.adjustMenuItemVisibility(),!0!==u.allMenuItemHide)&&($$.MOBILE&&(l=parseFloat($("html").css("font-size")),a=8,i.find("."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM).each(function(){"none"!==$(this).css("display")&&(a+=parseFloat($(this).css("width")))}),i.css("width",a/l+"rem")),$$.MOBILE?(s=e.offsetTop+e.offsetHeight,l=i.parent().offset().top+s+i.outerHeight(),r=$(document).scrollTop()+$(h).height(),$$.params.mobileAutoView&&n?s=e.offsetTop-i.outerHeight():r<l&&(s=l-r<i.outerHeight()?e.offsetTop+e.offsetHeight-i.outerHeight():r-(l-s)-2),(n=$(e)).offset().left<0&&n.offset().left+n.width()>$(h).width()?o=($(h).width()-i.width())/2-n.offset().left:((o=n.offset().left<0||n.offset().left+n.width()>$(h).width()?n.offset().left<0?e.offsetLeft-n.offset().left+(e.offsetWidth+n.offset().left-a)/2:e.offsetLeft+($(h).width()-n.offset().left-a)/2:e.offsetLeft+(e.offsetWidth-a)/2)+i.parent().offset().left+i.outerWidth()>$(h).width()&&(o=$(h).width()-i.outerWidth()-i.parent().offset().left),i.parent().offset().left<0&&o+i.parent().offset().left<0&&(o=-i.parent().offset().left))):(0<$(e).parents(".detailSection").length?(o=(r=$IU.getElementPosition(e)).left+e.offsetWidth,s=r.top,(s-=$(e).parents(".dialog_content").scrollTop())<(l=parseInt($(e).parents(".dialog_body").css("padding-top"),10)+$(e).parents(".dialog_body").children(".dialog_title").outerHeight())&&(s=l),i.css("position","fixed")):(o=e.offsetLeft+e.offsetWidth,s=e.offsetTop),!1===t&&(o+=(n=e.parentNode.parentNode).offsetLeft,s+=n.offsetTop)),i.css("left",o).css("top",s),u.strategy!==E&&u.strategy.adjustShowPopupMenuPosition(i),$$.MOBILE?i.slideDown(200):i.show())},setColumnVisible:function(e,t){var n;this.repeatType===p.REPEAT_TYPE_TABLE&&(n=$(this.repeatParentElement).children("table"),t?(n.children("colgroup").children("col:nth-child("+(e+1)+")").show(),$IU.dynamicShowElement(n.children("tbody").children("tr").children("td:nth-child("+(e+1)+")")),$IU.dynamicShowElement(n.children("tr").children("td:nth-child("+(e+1)+")"))):(n.children("colgroup").children("col:nth-child("+(e+1)+")").hide(),$IU.dynamicHideElement(n.children("tbody").children("tr").children("td:nth-child("+(e+1)+")")),$IU.dynamicHideElement(n.children("tr").children("td:nth-child("+(e+1)+")"))),this.columnVisible[e]=t)},getDynamicKeyName:function(){return this.groupName},getDynamicContextControlName:function(){return this.groupName},setDynamicStyle:function(e,t){this.dynamicProcessor.processDynamicStyle(this,e,E,E,t)},doDynamicAction:function(e,t){this.dynamicProcessor.processDynamicAction(this,e,E,E,t)},getRow:function(){return $(this.repeatParentElement).parents("tr,.infoplus_repeatingSection,.infoplus_view").first()},setDynamicValue:function(){},setClass:function(e){$(this.repeatParentElement).addClass(e)},removeClass:function(e){$(this.repeatParentElement).removeClass(e),this.getRepeatChildren().removeClass(e)}},p.selectedRepeatRow=null,define("InfoPlus.Repeat.RepeatControl",p);var e={onRepeatSectionExpandButtonClick:function(e){var t=$(this),n=$(t.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV)),i=$(t.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV)),a=$(".formError");e?a.remove():a.fadeTo("fast",.3,function(){$(this).remove()}),t.hasClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND)?(t.hide(),t.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).attr("title",$$.lt("repeatControl.shrink")),n.css("overflow-y",""),i.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN),e===E?n.animate({height:t.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT)+"px"},500,function(){n.css("height",""),t.show()}):(n.css("height",""),t.show())):(t.hide(),t.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT,n.height()),n.css("overflow-y","hidden"),i.addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN),n.animate({height:InfoPlus.Repeat.RepeatControl.REPEAT_SECTION_SHRINK_HEIGHT+"px"},500,function(){t.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).attr("title",$$.lt("repeatControl.expand")).show()}))},onRepeatSectionTouchStart:function(e){null!=this.popupMenu&&(this.popupMenu.menuResetTimeout(),t(this),e.stopPropagation())},onRepeatSectionTouchEnd:function(e){var t;null!=this.popupMenu&&(t=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),n(t,this,!0),e.stopPropagation())},onRepeatSectionMouseEnter:function(){var e;return $$.MOBILE||null!=this.popupMenu&&(this.popupMenu.menuResetTimeout(),t(this),e=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),n(e,this,!0)),!1},onRepeatSectionMouseLeave:function(e){var t;return null!=this.popupMenu&&($(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),!$$.MOBILE||InfoPlus.Repeat.RepeatControl.selectedRepeatRow===this)&&(t=$$.MOBILE?null:$(this.repeatParentElement).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION),void(null!=this.popupMenu&&this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,e.pageX,e.pageY,t)))},onRepeatTableRowTouchStart:function(e){null!=this.popupMenu&&(this.popupMenu.menuResetTimeout(),t(this),e.stopPropagation())},onRepeatTableRowTouchEnd:function(e){var t;null!=this.popupMenu&&(t=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),n(t,this,!1,0===$(this).next("tr").length),e.stopPropagation())},onRepeatTableRowMouseEnter:function(){var e;return $$.MOBILE||null!=this.popupMenu&&(this.popupMenu.menuResetTimeout(),t(this),e=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),n(e,this,!1)),!1},onRepeatTableRowMouseLeave:function(e){var t;return null!=this.popupMenu&&($(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),!$$.MOBILE||InfoPlus.Repeat.RepeatControl.selectedRepeatRow===this)&&(t=$$.MOBILE?null:$(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION),void(null!=this.popupMenu&&this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,e.pageX,e.pageY,t)))},onAddLinkClick:function(){var e=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT),t=e.popupMenu;return null!=t&&!1===e.readOnly&&(t.repeatSection=null,t.onAddClick()),!1},onMenuMouseLeave:function(e){if($$.MOBILE)return!1;$(this).data("menu").menuStartTimeout($(this).data("menu").menuTimeout,e.pageX,e.pageY)},onMenuMouseEnter:function(){if($$.MOBILE)return!1;$(this).data("menu").menuResetTimeout()},onMenuItemMouseLeave:function(){if($$.MOBILE)return!1;$(this).data("menuType")!==InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION&&$(this).removeClass("infoplus_repeatMenuOn")},onMenuItemMouseEnter:function(){if($$.MOBILE)return!1;$(this).data("menuType")!==InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION&&($(this).addClass("infoplus_repeatMenuOn"),$(this).data("menu").menuResetTimeout())},onMenuItemTouchStart:function(e){e.stopPropagation()},onMenuItemTouchEnd:function(e){var t=$(this).data("menu");switch(setTimeout(function(){$(t.menuDiv).hide()},100),$(t.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),$(this).data("menuType")){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:t.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:t.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:t.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox(t.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow"),300,function(){t.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:t.onDetailClick()}e.stopPropagation()},onMenuItemClick:function(){if($$.MOBILE)return!1;var e=$(this).data("menu");switch($$.MOBILE?setTimeout(function(){$(e.menuDiv).hide()},100):$(e.menuDiv).hide(),$(e.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),$(this).data("menuType")){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:e.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:e.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:e.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox(e.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow"),300,function(){e.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:e.onDetailClick()}}};e.events=[{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchstart",handler:e.onRepeatSectionTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchend",handler:e.onRepeatSectionTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseenter",handler:e.onRepeatSectionMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseleave",handler:e.onRepeatSectionMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchstart",handler:e.onRepeatTableRowTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchend",handler:e.onRepeatTableRowTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseenter",handler:e.onRepeatTableRowMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseleave",handler:e.onRepeatTableRowMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK,type:"click",handler:e.onAddLinkClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseenter",handler:e.onMenuMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseleave",handler:e.onMenuMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseenter",handler:e.onMenuItemMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseleave",handler:e.onMenuItemMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"click",handler:e.onMenuItemClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchstart",handler:e.onMenuItemTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchend",handler:e.onMenuItemTouchEnd}],define("InfoPlus.Repeat.RepeatControl.Events",e)}(window),function(){function e(e){null==e||null==e.permission?(this.readPower=!1,this.enforceReadPower=!1,this.writePower=!1,this.insertPower=!1,this.deletePower=!1):(e=e.permission||"",this.readPower=-1!==e.indexOf("r"),this.enforceReadPower=-1!==e.indexOf("R"),this.writePower=-1!==e.indexOf("w"),this.insertPower=-1!==e.indexOf("i"),this.deletePower=-1!==e.indexOf("d"))}e.prototype={readPower:!1,enforceReadPower:!1,writePower:!1,insertPower:!1,deletePower:!1},define("InfoPlus.Repeat.RepeatPower",e)}(window),function(){function e(e,t,n){this.repeatParentElement=e,"Insert item"!==n&&""!==n||(n=$$.lt("repeatAddLink.addText")),this.createLinkDiv(t,n)}e.prototype={repeatParentElement:null,linkDiv:null,createLinkDiv:function(e,t){var n=document.createElement("a"),t=(n.className=InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK,n.href="javascript:void(0);",n.innerHTML=null==t?$$.lt("repeatAddLink.addText"):t,$(n).css("text-align","left"),n.repeatParentElement=this.repeatParentElement,document.createElement("div")),e=($(t).css("display","none").css("left",e+"px").addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_DIV),t.appendChild(n),this.linkDiv=t,document.createElement("div"));$(e).addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV).append(this.linkDiv),this.repeatParentElement.appendChild(e)},showLink:function(){$(this.linkDiv).show()},hideLink:function(){$(this.linkDiv).hide()}},define("InfoPlus.Repeat.RepeatAddLink",e)}(window),function(n){function e(e){this.repeatControl=e,this.render=e.formRender,this.repeatParentElement=e.repeatParentElement,this.createMenuDiv(),this.strategy=new InfoPlus.Repeat.PopupMenu.Strategy}function t(){}e.MENU_ITEM_TYPE_MOVEUP=0,e.MENU_ITEM_TYPE_MOVEDOWN=1,e.MENU_ITEM_TYPE_ADD=2,e.MENU_ITEM_TYPE_DELETE=3,e.MENU_ITEM_TYPE_NO_ACTION=4,e.MENU_ITEM_TYPE_DETAIL=5,e.prototype={menuDiv:null,menuButton:null,repeatParentElement:null,repeatSection:null,render:null,hideMenuTimer:null,menuTimeout:200,menuItemMoveUp:null,menuItemMoveDown:null,menuItemAdd:null,menuItemDelete:null,menuItemNoAction:null,allMenuItemHide:!1,menuOverMenuItem:function(){this.menuResetTimeout()},menuStartTimeout:function(e,t,n,i){this.menuResetTimeout(),this.hideMenuTimer=setTimeout($.proxy(this.hideMenuWithMousePosition,this,t,n,i),e)},menuResetTimeout:function(){null!=this.hideMenuTimer&&clearTimeout(this.hideMenuTimer),this.hideMenuTimer=null},createMenuDiv:function(){var e=document.createElement("ul");e.id=""+Math.round(1e5*Math.random()),this.menuDiv=e,$(e).data("menu",this),e.style.display="none",$(e).addClass(InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU),this.menuItemDetail=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL),this.menuItemMoveUp=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP),this.menuItemMoveDown=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN),this.menuItemAdd=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD),this.menuItemDelete=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE),this.repeatParentElement.appendChild(this.menuDiv)},createMenuItem:function(e){var t=document.createElement("li");switch($(t).addClass(InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM),$(t).data("menu",this).data("menuType",e),e){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:$(t).text($$.lt("popupMenu.up")),$(t).addClass("infoplus_menuUp");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:$(t).text($$.lt("popupMenu.down")),$(t).addClass("infoplus_menuDown");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:$(t).text($$.lt("popupMenu.add")),$(t).addClass("infoplus_menuAdd");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$(t).text($$.lt("popupMenu.deleteText")),$(t).addClass("infoplus_menuDelete");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:$(t).text($$.lt("popupMenu.noAction")),$(t).addClass("infoplus_menuNoAction");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:$(t).text($$.lt("popupMenu.detail")),$(t).addClass("infoplus_menuDetail")}return this.menuDiv.appendChild(t),t},hideMenuWithMousePosition:function(e,t,n){var i,a;null!=this.repeatSection&&((i=$(this.repeatSection)).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED),e>=(a=$IU.getElementPosition(this.repeatSection)).left&&e<=a.left+this.repeatSection.scrollWidth&&t>=a.top&&t<=a.top+this.repeatSection.scrollHeight||(i.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED),this.isRepeatSection())),this.hideMenu(),null!=n&&0<n.length&&($(n[0].repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).showPopupMenu(n[0],!0),InfoPlus.Repeat.RepeatControl.selectedRepeatRow=n[0],$(n[0]).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED))},hideMenu:function(){$(this.menuDiv).hide()},shouldShowDetailMenu:function(){return null!=this.repeatSection&&!this.isRepeatSection()&&!1!==this.repeatControl.power.readPower&&!0===this.repeatControl.groupInformation.isMasterDetail},shouldShowMoveUpMenu:function(){return null!=this.repeatSection&&!0!==this.repeatControl.readOnly&&!1!==this.repeatControl.power.writePower&&(this.isRepeatSection()?0!==$(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length:0!==$(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length)},shouldShowMoveDownMenu:function(){return null!=this.repeatSection&&!0!==this.repeatControl.readOnly&&!1!==this.repeatControl.power.writePower&&(this.isRepeatSection()?0!==$(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length:0!==$(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length)},shouldShowAddMenu:function(){return null!=this.repeatSection&&!0!==this.repeatControl.readOnly&&this.repeatControl.power.insertPower},shouldShowDeleteMenu:function(){return null!=this.repeatSection&&!0!==this.repeatControl.readOnly&&!0!==$(this.repeatSection).data("isReadOnly")&&($(this.repeatSection).data("isAdded")!==n&&!0===$(this.repeatSection).data("isAdded")||this.repeatControl.power.deletePower)},adjustMenuItemVisibility:function(){function e(e,t){t?($(e).show(),n=!1):$(e).hide()}var n=!0;e(this.menuItemDetail,this.shouldShowDetailMenu()),e(this.menuItemMoveUp,this.shouldShowMoveUpMenu()),e(this.menuItemMoveDown,this.shouldShowMoveDownMenu()),e(this.menuItemAdd,this.shouldShowAddMenu()),e(this.menuItemDelete,this.shouldShowDeleteMenu()),this.allMenuItemHide=n},getRepeatControlFieldNames:function(e){var t=[];return $(e).find("."+$Control.CLASSNAME_CONTROL).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);null!=e&&e.field!==n&&e.element!==n&&e.onFieldRefer&&t.push(e.field.name)}),t},onDetailClick:function(){this.repeatControl.showDetail(this.repeatSection)},onMoveUpClick:function(){this.repeatControl.moveUpRepeatSection(this.repeatSection)},onMoveDownClick:function(){this.repeatControl.moveDownRepeatSection(this.repeatSection)},onAddClick:function(){var e=this.repeatControl;if(null!=e.groupInformation&&0<e.groupInformation.maxOccur&&e.getRepeatChildren().length>=e.groupInformation.maxOccur)return $IU.messageBox(null,$$.lt("popupMenu.maxLimit"),null,300),!1;e.addRepeat(null,null,!0,!0,!0,!0)},onDeleteClick:function(){var e=this.repeatControl;if(null!=e.groupInformation&&0<e.groupInformation.minOccur&&e.getRepeatChildren().length<=e.groupInformation.minOccur)return $IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300),!1;this.repeatControl.deleteRepeat(this.repeatSection,!0)},isRepeatSection:function(){return this.repeatControl.isRepeatSection()},isRepeatTable:function(){return this.repeatControl.isRepeatTable()}},define("InfoPlus.Repeat.PopupMenu",e);t.prototype={adjustShowPopupMenuPosition:function(e){}},define("InfoPlus.Repeat.PopupMenu.Strategy",t)}(void window),function(){function e(t){var n=this;if(this.repeatTableBody=t.repeatTableBody,this.repeatControl=t,this.needReorganize=!0===t.power.writePower||!0===t.power.insertPower||!0===t.power.deletePower,!0===t.power.writePower){var e=$(this.repeatTableBody).children(".infoplus_repeatingTableHeader");if(0<e.length){$IU.analysisTable($(e[0]));for(var i=0,a=e.length;i<a;i++)for(var r=e[i].cells,o=0;o<r.length;o++){var s=r[o],s=$(s),l=s.data("rawTdIndex");this.sortType[l]=InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE,null==s.attr("colspan")?s.addClass("infoplus_table_sort").click(function(e){t.readOnly||null==$(e.srcElement).data($Control.DATA_CONTROL_OBJECT)&&n.onHeaderClick($(this).data("rawTdIndex"))}):s.removeData("rawTdIndex")}}}}e.SORT_TYPE_NONE=0,e.SORT_TYPE_ASC=1,e.SORT_TYPE_DESC=2,e.prototype={repeatTableBody:null,sortType:{},render:null,needReorganize:!1,sortColumn:function(e,t){this.repeatTableBody.rows[0].cells.length<=e||(t===InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC?this.sortType[e]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC:this.sortType[e]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC,this.onHeaderClick(e))},onHeaderClick:function(e){for(var t,n,i,a=$(this.repeatTableBody).children(".infoplus_repeatingTableRow"),r=a.length,o=new InfoPlus.QuickSortArray,s=!1,l=0;l<r;l++){var u=a[l].cells[e],u=$(u).find("*").filter($IU.isControlFilter);1===l&&(s=0!==(i=u).length&&(i=i[0],null!=(i=$(i).data($Control.DATA_CONTROL_OBJECT)))&&((i=i.field.type)===$Control.DATA_TYPE_BOOL||i===$Control.DATA_TYPE_INT||i===$Control.DATA_TYPE_DOUBLE||i===$Control.DATA_TYPE_DATE)),o.push({oldIndex:l,value:(n=t=i=void 0,0===(u=u).length?"":(i=u[0],n=$(i).data($Control.DATA_CONTROL_TYPE),t=$(i).data($Control.DATA_CONTROL_OBJECT),n===$Control.CONTROL_TYPE_RADIO?(n="",0<(u=$(u).filter("[name='"+i.name+"']:checked")).length?$(u[0]).val():n):t.getSortValue()))})}this.sortType[e]===InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE||this.sortType[e]===InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC?(s?o.numberQuickSort():o.sort(function(e,t){return $IU.localeCompare(e.value,t.value)}),this.sortType[e]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC):(s?(o.numberQuickSort(),o.reverse()):o.sort(function(e,t){return-$IU.localeCompare(e.value,t.value)}),this.sortType[e]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC);for(var d=[],c=0;c<r-1;c++)d.push(a[o[c].oldIndex]);for(var h=$(a[0]).prev(),c=0;c<d.length;c++)$(h).after($(d[c])),h=d[c];this.needReorganize?this.repeatControl.reorganizeRepeatableElement(!0):this.repeatControl.updateRepeatParentElementKeyIndex();var p=$(this.repeatTableBody).children(".infoplus_repeatingTableHeader");for(c=0;c<p.length;c++)for(var f=p[c].cells,m=0;m<f.length;m++){var g=$(f[m]);null!=g.data("rawTdIndex")&&(g.data("rawTdIndex")===e?this.sortType[e]===InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC?(g.removeClass("infoplus_table_sort_desc"),g.addClass("infoplus_table_sort_asc")):(g.removeClass("infoplus_table_sort_asc"),g.addClass("infoplus_table_sort_desc")):(g.removeClass("infoplus_table_sort_desc"),g.removeClass("infoplus_table_sort_asc")))}}},define("InfoPlus.Repeat.TableSorter",e)}(window),function(){function e(e){this.params=e}e.prototype={},define("InfoPlus.Dynamics.Params",e)}(window),function(l){function s(e,t,n){if(t=t||"",null==e)return l;if($IU.isString(e))return e;if($IU.isBoolean(e))return!0===e?"1":"0";if($IU.isNumberExactly(e))return e+"";if(n!==l&&e.hasOwnProperty(n))return e[n];if($IU.isArray(e)){for(var i="",a=e.length,r=0;r<a;r++){var o=s(e[r],t,n);o!==l&&(i=i+o+(r!==a-1?t:""))}return i}return""}for(var e={toFixed:function(e,t){t=parseInt(t,10),t=0<(t=isNaN(t)?0:t)?Math.pow(10,t):1;return Math.round(e*t)/t},_add:function(e,t){var n,i;try{n=e.toString().split(".")[1].length}catch(e){n=0}try{i=t.toString().split(".")[1].length}catch(e){i=0}return(e*(e=Math.pow(10,Math.max(n,i)))+t*e)/e},_sum:function(e){if($IU.isNumberExactly(e))return{value:e,count:1};if($IU.isArray(e)){for(var t=0,n=0,i=e.length,a=0;a<i;a++){var r=InfoPlus.Dynamics.Functions._sum(e[a]),t=InfoPlus.Dynamics.Functions._add(t,r.value);n+=r.count}return{value:t,count:n}}null!=e&&e.hasOwnProperty("value")&&(e=e.value);var o=parseFloat(e);return isNaN(o)?{value:0,count:0}:{value:o,count:1}},_sumByCondition:function(e,t){if($IU.isNumberExactly(e)){if(t===l||!0===t)return{value:e,count:1}}else{if($IU.isArray(e)){for(var n=0,i=0,a=e.length,r=0;r<a;r++){var o=t[r]===l?InfoPlus.Dynamics.Functions._sum(e[r]):InfoPlus.Dynamics.Functions._sumByCondition(e[r],t[r]),n=InfoPlus.Dynamics.Functions._add(n,o.value);i+=o.count}return{value:n,count:i}}if(t===l||!0===t){null!=e&&e.hasOwnProperty("value")&&(e=e.value);var s=parseFloat(e);if(!isNaN(s))return{value:s,count:1}}}return{value:0,count:0}},sum:function(e,t){return(t===l?InfoPlus.Dynamics.Functions._sum(e):InfoPlus.Dynamics.Functions._sumByCondition(e,t)).value},avg:function(e,t){e=t===l?InfoPlus.Dynamics.Functions._sum(e):InfoPlus.Dynamics.Functions._sumByCondition(e,t);return 0===e.count?0:e.value/e.count}},t=(e.concat=s,e.reduce=function(e,t,n){if($IU.isNumberExactly(t)&&$IU.isInt(t)&&1<t){var i=[];if($IU.isArray(e))for(var a=0,r=e.length;a<r;a++)for(var o=0;o++<t;)i.push(e[a]);else for(o=0;o++<t;)i.push(e);return s(i,n)}return s(e,n)},e._length=function(e){if(null!=e){if($IU.isString(e))return e.length;if($IU.isArray(e)){for(var t=[],n=e.length,i=0;i<n;i++)t[i]=InfoPlus.Dynamics.Functions._length(e[i]);return t}}return 0},e.length=function(e){return InfoPlus.Dynamics.Functions._length(e)},e._countByCondition=function(e,t){if($IU.isArray(e)){for(var n=e.length,i=0,a=0;a<n;a++)t[a]===l?i+=InfoPlus.Dynamics.Functions._count(e[a]):i+=InfoPlus.Dynamics.Functions._countByCondition(e[a],t[a]);return i}if(t===l||!0===t)return e!==l?1:0},e._count=function(e){if($IU.isArray(e)){for(var t=e.length,n=0,i=0;i<t;i++)n+=InfoPlus.Dynamics.Functions._count(e[i]);return n}return e!==l?1:0},e.count=function(e,t){return t===l?InfoPlus.Dynamics.Functions._count(e):InfoPlus.Dynamics.Functions._countByCondition(e,t)},e.dateSpan=function(e,t){return""===e||""===t?"":parseInt(Math.abs(t-e)/86400,10)+1},e.getBirthday=function(e){if(e===l||null===e)return null;if(!$IU.isString(e))return null;if(15!==e.length&&18!==e.length)return null;var t;if(15===e.length){for(var n=6;n<=13;n++)if(isNaN(parseInt(e.charAt(n),10)))return null;var i,a=parseInt(e.substr(6,2),10),a=a<20?2e3+a:1900+a;return 1<=(i=parseInt(e.substr(8,2),10))&&i<=12?1<=(t=parseInt(e.substr(10,2),10))&&t<=31?new Date(a,i-1,t).getTime()/1e3:null:null}for(n=6;n<=15;n++)if(isNaN(parseInt(e.charAt(n),10)))return null;return!((a=parseInt(e.substr(6,4),10))<1900||2100<a)&&1<=(i=parseInt(e.substr(10,2),10))&&i<=12&&1<=(t=parseInt(e.substr(12,2),10))&&t<=31?new Date(a,i-1,t).getTime()/1e3:null},e.chineseAmount=function(e){if(isNaN(e))return"";var t=e<0?"()":"";if(1e12<=(e=Math.abs(e)))return"";var n="",i="",a=(e+="00").indexOf(".");0<=a&&(e=e.substring(0,a)+e.substr(a+1,2));for(var i=i.substr(i.length-e.length),r=0;r<e.length;r++)n+="".substr(e.substr(r,1),1)+i.substr(r,1);return t+n.replace(/$/,"").replace(/[]/g,"").replace(/{2,}/g,"").replace(/([|])/g,"$1").replace(/+/,"").replace(/{0,3}/,"").replace(/^/,"")},e.encodeURI=function(e){return encodeURI(e)},e.encodeURIComponent=function(e){return encodeURIComponent(e)},e.startWith=function(e,t){return null!=e&&null!=t&&e.slice(0,t.length)===t},e.endWith=function(e,t){return null!=e&&null!=t&&-1!==e.indexOf(t,e.length-t.length)},e.params=function(){return new InfoPlus.Dynamics.Params(arguments)},e.isNaN=isNaN,e.parseInt=parseInt,e.parseFloat=parseFloat,["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"]),n=0,i=t.length;n<i;n++){var a=t[n];"function"==typeof Math[a]&&(e[a]=Math[a])}define("InfoPlus.Dynamics.Functions",e)}(void window),function(R,w){var x={};x.DIALOG_ID="_ID_INFOPLUS_MESSAGE_"+Math.round(1e3*Math.random()),x.DYNAMIC_INVISIBLE_ATTRIBUTE="dynamic-invisible",x.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},x.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},x.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},x.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},x.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===Object.prototype.toString.call(e)},x.isNumberExactly=function(e){return"[object Number]"===Object.prototype.toString.call(e)},x.isInt=function(e){return!isNaN(parseInt(e))},x.isPositiveInt=function(e){return/^\+?[1-9][0-9]*$/.test(e)},x.isNumber=function(e){return!isNaN(parseFloat(e))},x.isUrl=function(e){return!!x.isString(e)&&new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e)},x.isEmptyStr=function(e){return null==e||""===e},x.cookie={setCookie:function(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=e+"="+encodeURI(t)+";expires="+i.toGMTString()+";path=/"},getCookie:function(e){e=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=e?decodeURI(e[2]):null},removeCookie:function(e){var t=$IU.cookie.getCookie(e);null!=t&&$IU.cookie.setCookie(e,t,-1)}},x.arrayContains=function(e,t){if(!1!==this.isArray(e))for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},x.arrayAContainArrayB=function(e,t){if(!this.isArray(e)||!this.isArray(t))return!1;if(t.length>e.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0},x.arrayUnique=function(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var i=n+1;i<t.length;++i)t[n]===t[i]&&t.splice(i--,1);return t},x.chineseLength=function(e){return e.replace(/[^\x00-\xff]/g,"**").length},x.stringReplaceAll=function(e,t,n,i){return null==e||null==t||null==n?null:e.replace(new RegExp(t,i?"gi":"g"),n)},x.getElementsByClassName=function(e){for(var t,n=new RegExp("(?:^|\\s)"+e+"(?:$|\\s)"),i=document.getElementsByTagName("*"),a=[],r=0;null!=(t=i[r]);r++){var o=t.className;o&&-1!==o.indexOf(e)&&n.test(o)&&a.push(t)}return a},x.getDateIsoString=function(e){var t;return null==e?"":Date.prototype.toISOString!==w?e.toISOString():(t=function(e){e=String(e);return e=1===e.length?"0"+e:e},e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z")},x.stdTimezoneOffset=function(){var e=new Date,t=new Date(e.getFullYear(),0,1),e=new Date(e.getFullYear(),6,1);return Math.max(t.getTimezoneOffset(),e.getTimezoneOffset())},x.unixTimeToDate=function(e){var t,n;return isNaN(e)?null:((t=new Date).setTime(1e3*(e+(null!=infoCore.params.tenantTimeZoneOffset?infoCore.params:transformer).tenantTimeZoneOffset)),e=t.getTimezoneOffset(),t.setTime(1e3*(t.getTime()/1e3+60*t.getTimezoneOffset())),(n=t.getTimezoneOffset())!==e&&t.setTime(1e3*(t.getTime()/1e3+60*(n-e))),t)},x.unixTimeToDateString=function(e){e=InfoPlus.Utilities.unixTimeToDate(e);return null==e?null:InfoPlus.Utilities.dateFormat(e,"yyyy-MM-dd")},x.unixTimeToString=function(e){e=InfoPlus.Utilities.unixTimeToDate(e);return null==e?null:InfoPlus.Utilities.dateFormat(e,"yyyy-MM-dd hh:mm:ss")},x.unixTimeToTimeString=function(e){var t;return isNaN(e)?null:((t=new Date).setTime(1e3*e),t.setTime(1e3*(t.getTime()/1e3+60*t.getTimezoneOffset())),InfoPlus.Utilities.dateFormat(t,"hh:mm"))},x.unixTimeToLocalTime=function(e){var t;return isNaN(e)?null:((t=new Date).setTime(1e3*e),t)},x.unixTimeToLocalTimeString=function(e){var t;return isNaN(e)?null:((t=new Date).setTime(1e3*e),InfoPlus.Utilities.dateFormat(t,"yyyy-MM-dd hh:mm:ss"))},x.dateStringToUnixTime=function(e){try{e=(e=e.replace(/-/g,"/")).substr(0,10);var t=Date.parse(e);return isNaN(t)?null:t/1e3-60*new Date(t).getTimezoneOffset()-infoCore.params.tenantTimeZoneOffset}catch(e){return null}},x.timeStringToUnixTime=function(e){try{var t=Date.parse("1970/01/01 "+e);return isNaN(t)?null:t/1e3-60*new Date(t).getTimezoneOffset()}catch(e){return null}},x.isSameTimezone=function(){var e=new Date;return infoCore.params.tenantTimeZoneOffset/60==-e.getTimezoneOffset()},x.getTimezoneString=function(e){var t=parseInt(e/60,10),e=Math.abs(e-60*t),n="UTC";return(0!==t||0!==e)&&(0<=t&&(n+="+"),n=(n+=t.toString()+":")+(0<e?e.toString():"00"),null!=$$.timezone[n])?$$.lt("timezone."+n)+$$.lt("timezone.time")+n:n},x.mobileExpandAllViews=function(){var t={};if($$.MOBILE)return $$.params.holder.form.find("."+InfoPlus.Layout.View.CLASS_VIEW).each(function(){var e=$(this).data("viewControl").label;null==e||e.isExpanded()||(e.expand(!1),t[e.getId()]=e)}),t},x.mobileShrinkViewsWithNoTips=function(e){if($$.MOBILE&&e!==w){t={},$("body").children("div.formError").each(function(){var e=$(this).data("element");null!=e&&(e=e.parents(".infoplus_view_wrap_outer").children(".infoplus_view_label").data("label"))!==w&&(t[e.getId()]=e)}),$("div.popTip").each(function(){var e=$(this).data(InfoPlus.Render.PopTip.DATA_TIP_CONTROL);null!=e&&(e=$(e.options.popper).parents(".infoplus_view_wrap_outer").children(".infoplus_view_label").data("label"))!==w&&(t[e.getId()]=e)});var t,n,i=t;for(n in e)e.hasOwnProperty(n)&&i[n]===w&&e[n].shrink(!1)}},x.doValidate=function(e,t){var n,i=$$.MOBILE&&!0!==t,a=(x.clearAllError(),i&&(n=$IU.mobileExpandAllViews()),null==e||!1===e),r=$$.params.renderForm.find("*[class*='validate']").filter($IU.isValidateControlFilter);return $$.dynamics.cache.build(),e&&(r=r.filter(function(){var e=$(this),t=(null!=e.data($Control.DATA_ORIGIN_INPUT)?$(e.data($Control.DATA_ORIGIN_INPUT)):e).data($Control.DATA_VALIDATOR);if(null!=t){if(t.builtIn)return!0;if(null!=t.dynamics)for(var n=0,i=t.dynamics.length;n<i;n++)if(t.dynamics[n].builtIn)return!0}return!1})),!1===$IU.checkControlValidation(r,a,!0)?(i&&$IU.mobileShrinkViewsWithNoTips(n),e=$$.lt("validation.ensure"),1===(r=$(".formErrorContent")).length&&("* "===(e=r.text()).substr(0,2)&&(e=e.substr(2)),!0!==t)&&null!=(a=r.parent().data("element").data($Control.DATA_CONTROL_OBJECT))&&null!=a.field&&null!=a.field.label&&""!==$IU.trimString(a.field.label)&&(e=$IU.trimString(a.field.label)+":"+e),$IU.messageBox(null,e,null,350,function(){$(".formError").effect("bounce",{},150)}),setTimeout(function(){var t=null;$("body").children("div.formError").each(function(){var e=parseInt($(this).css("top"),10);isNaN(e)||(null==t||e<t)&&(t=e)}),null!=t&&60<t&&$IU.scrollTo(t-60,500)},1e3),!1):(i&&$IU.mobileShrinkViewsWithNoTips(n),!0)},x.getPageScroll=function(){var e=0,t=0;return R.pageYOffset?(t=R.pageYOffset,e=R.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),{X:e,Y:t}},x.getPageSize=function(){var e=0,t=0,n=(R.innerHeight&&R.scrollMaxY?(e=R.innerWidth+R.scrollMaxX,t=R.innerHeight+R.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):document.body&&(e=document.body.offsetWidth,t=document.body.offsetHeight),0),i=0;return R.innerHeight?(n=R.innerWidth,i=R.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,i=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,i=document.body.clientHeight),{PageW:e<n?n:e,PageH:t<i?i:t,WinW:n,WinH:i}},x.getElementPosition=function(e){var t=+(/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],n=(isNaN(t)&&(t=+(/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]),e.offsetTop),i=e.offsetLeft;for(e=e.offsetParent;e;){if(isNaN(t)||9===t){var a=$(e).css("transform");if(""!==a&&"none"!==a&&null!=a)break}n+=e.offsetTop,i+=e.offsetLeft,e=e.offsetParent}return{top:n,left:i}},x.getDialog=function(){var e,t=$("#"+InfoPlus.Utilities.DIALOG_ID);return 0===t.length&&((e=document.createElement("div")).id=InfoPlus.Utilities.DIALOG_ID,document.body.appendChild(e),t=$(e)),t},x.setMessageBoxButtonText=function(e,t){var n=$(InfoPlus.Utilities.getDialog()).parent().find(".ui-dialog-buttonset").children();0<n.length&&e<n.length&&(n=n[e].childNodes[0],$(n).text(t))},x.backUrlSkip=function(e){var t,n,i,a,r=!1;/^(http|https|ftp):\/\/([\w-]+\.)+[\w-]+(:[0-9]+)?(\/[\w-.\/?%&=#]*)?$/.test(e)&&((r=(n=e.match(/([\w-]+\.)+[\w-]+/))&&(n=n[0],location.hostname==n)?!0:r)?location.href=e:(t=null,n=[{name:$$.lt("common.ok"),callback:function(){t&&clearInterval(t),location.href=e},defaultButton:!0,preventDefault:!0},{name:$$.lt("common.cancel"),callback:function(){t&&clearInterval(t)}}],i=5,a=$("<div class='backUrlTip'>"+$$.lt("back.dialog.content","<span>"+i+"</span>")+"</div>"),new InfoPlus.Render.Dialog({content:a,maxWidth:450,buttons:n}).show(),t=setInterval(function(){i--,a.find("span").html(i),0==i&&(clearInterval(t),location.href=e)},1e3)))},x.processBack=function(e){var t;x.isEmptyStr(e)||(x.isPositiveInt(e)?(0<x.historyAdd()&&(e=parseInt(e,10)+x.historyAdd()),t=-parseInt(e,10),R.history.go(t)):$IU.backUrlSkip(e))},x.historyAdd=function(){var e=0;return e=$IU.isPositiveInt($$.params.nowHistory)&&R.history.length>parseInt($$.params.nowHistory,10)?R.history.length-parseInt($$.params.nowHistory,10):e},x.browserCloseable=function(){return!!navigator.userAgent.match(/TaskCenterApp/)||!(null==R.opener||R.top!==R)},x.closeWindow=function(){if($$.APP)if(R.webViewInterface===w||R.webViewInterface.close===w)R.close();else try{R.webViewInterface.close()}catch(e){console.error("TaskCenterApp/webViewInterface.close exception:"+e)}else{var e=$$.params.back||transformer.back;if($$.MINIPROGRAM)if(x.isEmptyStr(e)){if(wx&&wx.miniProgram&&"function"==typeof wx.miniProgram.navigateBack)return void wx.miniProgram.navigateBack()}else{if(!x.isPositiveInt(e))return void $IU.backUrlSkip(e);if(0<x.historyAdd()&&(e=parseInt(e,10)+x.historyAdd()),wx&&wx.miniProgram&&"function"==typeof wx.miniProgram.navigateBack)return t=R.history.length,void((e=parseInt(e,10))<t?R.history.go(-e):wx.miniProgram.navigateBack({delta:parseInt(e,10)-R.history.length+1}))}if($IU.isPositiveInt(e)&&parseInt(e,10)>=R.history.length&&(e=w,$$.params.back=w),x.isEmptyStr(e))if("object"==typeof R.WeixinJSBridge&&"function"==typeof R.WeixinJSBridge.invoke){R.WeixinJSBridge.invoke("closeWindow");var t=navigator.userAgent.toLowerCase();-1<t.indexOf("windowswechat")&&-1<t.indexOf("wxwork")&&R.close()}else if(R.WhistleBrowser!==w&&R.WhistleBrowser.close!==w)try{R.WhistleBrowser.close()}catch(e){console.error("WhistleBrowser.close exception:"+e)}else R.open("","_self",""),R.close(),R.closed||setTimeout(function(){R.location.reload()},500);else x.processBack(e)}},x.setDocumentTitle=function(e){var t;$$.DINGTALK?$$.dingTalkJSLoaded?dd.ready(function(){dd.biz.navigation.setTitle({title:e})}):t=setInterval(function(){$$.dingTalkJSLoaded&&(clearInterval(t),dd.ready(function(){dd.biz.navigation.setTitle({title:e})}))},100):document.title=e},x.wxWebviewDownloadFile=function(e,t){wx&&wx.miniProgram&&"function"==typeof wx.miniProgram.navigateTo&&wx.miniProgram.navigateTo({url:"/pages/fileDownload/fileDownload?fileInfo="+JSON.stringify({uri:e,name:t})})},x.delayedErrorMessageBox=function(e){null==x.errorMessage?(x.errorMessage=e,setTimeout(function(){x.errorMessageBox(x.errorMessage,null,$$.lt("error.error"),null,null,!1,!1,"#ff0000"),x.errorMessage=null},0)):x.errorMessage=x.errorMessage+"\n"+e},x.errorMessageBox=function(e,t,n,i,a,r,o,s,l){var u,d,c,h,p,f,m=$(document.createElement("div")),t=(!0===r&&((u=document.createElement("span")).style.color="#FF0000",$(u).text($$.lt("error.occur")),m.append(u)),u=document.createElement("span"),$(u).addClass("error_message_content").html($IU.linkifyStr($IU.htmlEncode(e))),m.append(u),null!=t&&((r=document.createElement("div")).style.height="5px",e=document.createElement("div"),(u=document.createElement("a")).href="#",u.style.color="#2446AB",u.title=$$.lt("error.showDetail"),$(u).text($$.lt("error.detail")).addClass("moreDetail"),$(u).one("click",{link:u,dialogDiv:m},InfoPlus.Utilities.moreDetailClick),d=document.createElement("div"),c=document.createElement("div"),$(c).html($IU.linkifyStr($IU.htmlEncode(t))).addClass("error_detail_message"),$(d).addClass("error_detail_message_container").append(c),d.style.display="none",$(e).append(u),$(e).append(d),m.append(r),m.append(e)),[]);return o&&t.push({name:$$.lt("common.close"),defaultButton:!0,callOnClose:!0,callback:function(){$IU.closeWindow()}}),"ENTRUST_MOCK_NOT_ALLOWED"!==a&&"ENTRUST_MODE_NOT_ALLOWED"!==a||null!=entrusts&&null!=entrusts.app&&null!=entrusts.app.id&&(h=entrusts.app.id,p=transformer.interface_entrust,t.push({name:(f="ENTRUST_MODE_NOT_ALLOWED"===a)?$$.lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug"),callback:function(){$$.blockUI({message:f?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug")}),$$.ajax({type:"POST",url:p,data:{entrusted:!1,app:h},requestMsg:f?$$.lt("entrust.request.abort.request.entrust"):$$.lt("entrust.request.abort.request.debug"),errorTitle:f?$$.lt("entrust.request.abort.fail.entrust"):$$.lt("entrust.request.abort.fail.debug"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){$$.MOBILE?setTimeout(function(){R.location.reload()},600):R.location.reload()})}})),"INSTANCE_START_EXCEEDED"===a&&null!=i&&0<i.length&&(t=[{name:$$.lt("common.close")},{defaultButton:!0,name:$$.lt("start.viewInstance"),callback:function(){R.location.href=x.processUrl(i[0])}}]),new InfoPlus.Render.Dialog({title:n,titleColor:s,content:m,maxWidth:null!=l?l:800,buttons:t}).show(),!1},x.getMaxZIndex=function(){for(var e=$("div"),t=0,n=0;n<e.length;n++)t<e[n].style.zIndex&&(t=e[n].style.zIndex);return t+1},x.confirmBox=function(e,t,n,i,a){var r=$$.lt("common.cancel");new InfoPlus.Render.Dialog({title:t!==n?t:null,content:e,maxWidth:i,buttons:[{name:n,defaultButton:!0,callback:a},{name:r}]}).show()},x.yesNoBox=function(e,t,n){new InfoPlus.Render.Dialog({title:null,content:e,maxWidth:t,buttons:[{name:$$.lt("common.yes"),defaultButton:!0,callback:n},{name:$$.lt("common.no")}]}).show()},x.messageBox=function(e,t,n,i,a){null!=n&&""!==n||(n=$$.lt("common.ok")),new InfoPlus.Render.Dialog({title:e,content:t,maxWidth:i,buttons:[{name:n,defaultButton:!0,callback:a,callOnClose:null!=a}]}).show()},x.debugBox=function(e,t,n,i,a){!1===$$.params.isRelease&&x.messageBox(e,t,n,i,a)},x.iframeBox=function(e,t,n,i,a,r,o){var s,l=!1;(l=!n&&o&&0<(s=$("[key="+o+"]")).size()&&s.hasClass("minimise")?!0:l)?s.find(".dialog_minimise").click():((l=document.createElement("iframe")).src=e,l.setAttribute("width","100%"),l.setAttribute("height",(0===r||null==r?.75*$(R).height():r)+"px"),new InfoPlus.Render.Dialog({title:t,content:l,maxWidth:null==a||0===a?$(R).width:a,openNewUrl:e,showFooter:!1,showCloseButton:!0,showOpenNewButton:i,showMinimiseButton:!n,modal:n,key:o}).show())},x.tip=function(e,t,n){new InfoPlus.Tip({text:e,type:t,position:n})},x.debugTip=function(e,t){!1===$$.params.isRelease&&(x.tip(e,t,"left"),console.log(e))},x.infoTip=function(e){x.tip(e,"info","right")},x.shouldShowSuggesterPage=function(){return $$.MOBILE&&!/iPad/i.test(navigator.userAgent)},x.showSuggester2PageOnce=function(e){var t,n=!1;$(".mobile_page_div").each(function(){if($(this).data($Control.DATA_ORIGIN_CONTROL)===e)return!(n=!0)}),n||(t=x.showSuggester2Page(e),$(t.element).data($Control.DATA_ORIGIN_CONTROL,e))},x.showSuggester2Page=function(t){var e=t.getValue(),n=new $Controls.Suggester2(t.path,t.field,t.render,e.value,e.displayValue,t.parentValue,t.suggestService,t.getAttributes(),t),e=($(n.element).removeClass("xdTextBox"),n.initSelect2(),n.onFieldRefer=t.onFieldRefer,t.tooltip),i=n.getControlContainer(),e=(null!=e&&null!=e.tip&&""!==e.tip&&(i=document.createElement("div"),a=document.createElement("div"),$(a).text(e.tip).addClass("infoplus_suggester_tooltip"),$(i).append(a).append(n.getControlContainer())),{title:t.field.label,content:i,onShow:function(){var e=$(n.element).data($Control.DATA_ORIGIN_INPUT);$(e).select2("open")},onClose:function(){var e=$(n.element).data($Control.DATA_ORIGIN_INPUT);$(e).select2("destroy"),t.onSuggestPage=!1}}),a=new InfoPlus.Render.Mobile.Page(e);return a.show(),a},x.showSuggester2ThisPage=function(e){var t,n=e.getValue(),i=e.controlContainer,n=new $Controls.Suggester2(e.path,e.field,e.render,n.value,n.displayValue,e.parentValue,e.suggestService,e.getAttributes(),e),e=($(n.element).removeClass("xdTextBox"),n.initSelect2(),n.onFieldRefer=e.onFieldRefer,e.tooltip),a=n.getControlContainer(),e=(null!=e&&null!=e.tip&&""!==e.tip&&(a=document.createElement("div"),t=document.createElement("div"),$(t).text(e.tip).addClass("infoplus_suggester_tooltip"),$(a).append(t).append(n.getControlContainer())),$(a).find(".select2-container").attr("ispagepopup",!1),$(i).empty().append(a),$(n.element).data($Control.DATA_ORIGIN_INPUT));$(e).select2("open")},x.getTransitionEndEventName=function(){var e,t=document.createElement("fake"),n={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"};for(e in n)if(n.hasOwnProperty(e)&&t.style[e]!==w)return n[e];return null},x.initValidationEngine=function(){$$.params.renderForm.validationEngine("attach",{validationEventTriggers:"blur",success:!1,promptPosition:$$.MOBILE?"topLeft":"topRight"})},x.rebindValidationEngine=function(){$$.params.renderForm.validationEngine("detach"),x.initValidationEngine()},x.clearErrorPrompt=function(e){for(var t=$(e).find("*[class*='validate']"),n=0;n<t.length;n++)$(t[n]).validationEngine("hidePrompt")},x.clearAllError=function(){$("div.formError").stop(!0,!0).remove(),$("div.ui-effects-wrapper").remove()},x.adjustRenderWidth=function(){var e;null==$$.params.currentWidth&&($$.params.currentWidth=0),$$.MOBILE?0<(e=$(R).width())&&($$.params.holder.remark.css("width",e+"px"),$$.params.holder.form.css("width",e+"px"),e!==$$.params.currentWidth)&&($$.params.currentWidth=e,$$.resize(e)):(e=$$.params.holder.form[0].clientWidth)!==$$.params.currentWidth&&($$.params.currentWidth=e,$$.resize(e))},x.updateFormTips=function(e){$IU.updateErrorPromptPosition(e),InfoPlus.Render.PopTip.fixPosition(e)},x.updateFormTipsAndViews=function(e){$IU.checkViewVisibility(),$IU.updateFormTips(e)},x.checkViewVisibility=function(e){if(!0!==$$.PREVIEW){function t(e,t){var n=$(e.element),i=n.find("table").first();0===n.height()||!i.hasClass("uploadProgressTable")&&0===i.height()?e.hide():t&&e.show()}for(var n=$$.params.formRender.views,i=0,a=n.length;i<a;i++){var r=n[i],o=$(r.element),s=!1;!0===e?t(r):($$.MOBILE&&!1===r.expanded&&(r.expand(!1,!0),s=!0),o.is(":visible")?t(r):$IU.isDynamicInvisible(o)||(o.show(),t(r,!0)),s&&r.shrink(!1,!0))}}},x.updateErrorPromptPosition=function(e){for(var t=$("body").children("div.formError"),n=0;n<t.length;n++){var i=$(t[n]),a=i.data("element");null!=a&&(a.is(":visible")?a.validationEngine("updatePromptPosition",e):i.hasClass("hideShrink")||a.validationEngine("hide",!0))}},x.setFocusToFirstEditableTextBox=function(){var e,t=document.documentElement.clientHeight,n=$(".infoplus_editControl.infoplus_writable:visible,.infoplus_textareaControl.infoplus_writable:visible,.infoplus_richTextControl.infoplus_writable:visible").first();0<n.length&&n.offset().top<t&&(n.hasClass("infoplus_richTextControl")?null!=(e=n.data("controlObject")).editor&&setTimeout(function(){e.editor.focus()},500):n.focus())},x.fixPopTipPosition=function(e){$($$.params.renderContainer).children(".popTip").each(function(){var e=$(this).data("tipControl");null!=e&&e.fixPosition()})},x.isControlFilter=function(){var e;return"OBJECT"!==this.tagName&&null!=(e=$(this).data($Control.DATA_IS_CONTROL))&&!0===e},x.isSuggesterFilter=function(){return"OBJECT"!==this.tagName&&null!=$(this).data($Control.DATA_SUGGESTER)},x.isValidateControlFilter=function(){if("OBJECT"===this.tagName)return!1;var e=$(this),t=e.data($Control.DATA_IS_CONTROL);if(null==t)return!1;if(!1===t)return!1;t=e.data("controlObject");if(null==t){var n=e.data($Control.DATA_ORIGIN_INPUT);if(null!=n&&((t=$(n).data("controlObject")).isDynamicReadonly()||!t.isWritable()))return!1}else if(t.isDynamicReadonly()||!t.isWritable())return!1;if(0<e.parents(".detailCell").length){if("none"===e.css("display"))return!1;if(0<e.parents("["+x.DYNAMIC_INVISIBLE_ATTRIBUTE+"]").length)return!1}else if(!e.is(":visible"))return!1;return!0},x.isValidateFilter=function(){var e;return"OBJECT"!==this.tagName&&null!=(e=this.getAttribute("class"))&&-1!==e.indexOf("validate")},x.addElementValidateClass=function(e){$(e).addClass("validate[funcCall[checkRenderFormFields]]")},x.removeElementValidateClass=function(e){$(e).removeClass("validate[funcCall[checkRenderFormFields]]")},x.trimString=function(e){return null==e?null:e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},x.clearSuggester=function(e){for(var t=$(e).find("*").filter(InfoPlus.Utilities.isSuggesterFilter),n=0;n<t.length;n++)$(t[n]).data($Control.DATA_SUGGESTER).dispose()},x.highLightElement=function(e){var t=$(e).data($Control.DATA_CONTROL_TYPE);if(t!==$Control.CONTROL_TYPE_IFRAME&&(t===$Control.CONTROL_TYPE_SUGGESTER||t===$Control.CONTROL_TYPE_SUGGESTER2||$(e).is(":visible"))){function n(e){if($(e).data("isEffecting")===w){var t=e;if($.browser.msie)try{var n=document.body.createTextRange(),i=(n.moveToElementText(t),n.queryCommandValue("BackColor"));t.style.backgroundColor=null==i?"rgb(255,255,255)":"rgb("+(255&i)+","+((65280&i)>>8)+","+((16711680&i)>>16)+")"}catch(e){}$(e).data("isEffecting",!0).effect("highlight",{},1e3,function(){$(this).removeData("isEffecting")})}}if(null!=t)switch(t){case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_HIDDEN:break;case $Control.CONTROL_TYPE_LABEL:var i=$(e).data($Control.DATA_CONTROL_OBJECT);null!=i&&n(i.element);break;case $Control.CONTROL_TYPE_SUGGESTER:i=$(e).data($Control.DATA_SUGGESTER);null!=i&&n(i.activeInput);break;case $Control.CONTROL_TYPE_SUGGESTER2:null!=$(e).data("select2Object")&&n($(e).siblings(".select2").find(".select2-selection")[0]);break;default:n(e)}}},x.htmlEncode=function(e){var t="";if(0===e.length)return"";for(var n=0;n<e.length;n++)switch(e.substr(n,1)){case"<":t+="&lt;";break;case">":t+="&gt;";break;case"&":t+="&amp;";break;case" ":t+="&ensp;";break;case'"':t+="&quot;";break;case"\n":t+="<br>";break;default:t+=e.substr(n,1)}return t},x.moreDetailClick=function(e){var t=e.data.link,n=$(t).siblings("div")[0],e=e.data.dialogDiv;return null!=n&&(e.dialog("option","width",850),e.dialog("option","position","center"),n.style.display="block",$(t).empty()),!1},x.dateFormat=function(e,t){var n,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)i.hasOwnProperty(n)&&new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t},x.variablesFormat=function(e,t){var n=e.match(/\${\w+}/g);if(null!=n)for(var i=0;i<n.length;i++){var a=n[i],r=a.substring(2,a.length-1);e=null!=t[r]?e.replace(a,InfoPlus.Utilities.trimString(t[r])):e.replace(a,"")}return InfoPlus.Utilities.trimString(e)},x.checkFieldEmpty=function(e,t){var n="required";if(e.hasClass("infoplus_richTextControl"))return x.trimString(CKEDITOR.instances[e.attr("id")+"_text"].getData())?!!t&&w:!t||t.allrules[n].alertText;switch(e.attr("type")){case"text":case"password":case"textarea":case"file":default:if(x.trimString(e.val()))break;return!t||t.allrules[n].alertText;case"radio":case"checkbox":var i=e.attr("name");if(0===$("input[name='"+i+"']:checked").size())return 1===$("input[name='"+i+"']").size()?!t||t.allrules[n].alertTextCheckboxe:!t||t.allrules[n].alertTextCheckboxMultiple;break;case"select-one":if(e.val())break;return!t||t.allrules[n].alertText;case"select-multiple":if(e.find("option:selected").val())break;return!t||t.allrules[n].alertText}return!!t&&w},x.getReferedControlPaths=function(e){for(var t=[],n=e.split("_"),i=n.length,a=0;a<i;a++){var r=n[a];t.push(0===a?r:t[t.length-1]+"_"+r)}return t},x.isSibling=function(e,t){if(null==e||null==t||""===e||""===t)return!1;var n=e.split("_"),i=t.split("_");if(n.length!==i.length)return!1;for(var a=0,r=n.length;a<r-1;a++)if(n[a]!==i[a])return!1;return n[r-1]!==i[r-1]},x.convertFileSize=function(e){return null!=e&&InfoPlus.Utilities.isNumber(e)?e<1024?{size:e.toString(),unit:"B"}:(e/=1024)<1024?{size:e.toFixed(1).toString(),unit:"K"}:(e/=1024)<1024?{size:e.toFixed(1).toString(),unit:"M"}:{size:(e/=1024).toFixed(1).toString(),unit:"G"}:{size:"",unit:""}},x.getElementStyle=function(e,t){e=e.getAttribute("style");if(null!=e)for(var n=e.split(";"),i=n.length-1;0<=i;i--){var a=$IU.trimString(n[i]);if(""!==a){a=a.split(":");if(2===a.length&&$IU.trimString(a[0].toLowerCase())===$IU.trimString(t.toLowerCase()))return $IU.trimString(a[1])}}return null},x.saveOriginStyles=function(e){if($(e).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE)!==w)return null;var t={},n=$(e).attr("style");if(null!=n)for(var i=n.split(";"),a=i.length,r=0;r<a;r++){var o=$IU.trimString(i[r]);""!==o&&2===(o=o.split(":")).length&&(t[$IU.trimString(o[0]).toLowerCase()]=$IU.trimString(o[1]))}return $(e).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE,t),t},x.setDynamicStyle=function(e,t,n){function i(e,t,n){t=InfoPlus.Utilities.trimString(t.toLowerCase()),n=InfoPlus.Utilities.trimString(n);var i=e.getAttribute("style");if(null==i)e.setAttribute("style",t+":"+n);else{for(var a=i.split(";"),r=a.length,o="",s=0;s<r;s++){var l,u=InfoPlus.Utilities.trimString(a[s]);""!==u&&2===(l=u.split(":")).length&&(l[0].toLowerCase()!==t?o=o+(""!==o?";":"")+u:""!==n&&(o=o+(""!==o?";":"")+t+":"+n))}e.setAttribute("style",o)}}t=InfoPlus.Utilities.trimString(t.toLowerCase());var a=$(e).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE);a===w&&(a=$IU.saveOriginStyles(e)),"null"===(n=InfoPlus.Utilities.trimString(n))||""===n?a[t]!==w?i(e,t,a[t]):i(e,t,""):$(e).css(t,n)},x.setElementValue=function(e,t,n,i){null==t&&(t=""),null==n&&(n="");for(var a=document.getElementsByName(e),r=0;r<a.length;r++){var o,s,l=a[r],u=$(l).data($Control.DATA_CONTROL_OBJECT),d=!1;null!=u&&u.isWritable()&&((d=(o=null!=(o=u.getValue())&&o.value!==w?o.value:o)!==t)?(u.field.type===InfoPlus.Controls.Control.DATA_TYPE_DATE&&$IU.isString(t)?(s=$IU.dateStringToUnixTime(t))!==o?u.setValue(s):d=!1:u.setValue(t,n,$$.params.initializing,i),d&&u.autoTriggerFieldChangeEvent&&(u.onFieldChange||u.onFieldRefer)&&!u.clickFireFieldChange&&$(u.element).change()):null!=i&&u.setValue(t,n,$$.params.initializing,i),null!=$$.params.fieldChanging)&&$$.params.fieldChanging.controls.push(u),d&&$IU.highLightElement(l)}},x.getFieldNamesFromFieldChangeOldData=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].fieldName]=null;return t},x.getFieldNamesFromFieldChangeData=function(e){function t(e){null==e||a.hasOwnProperty(e)||(a[e]=null)}var n,i,a={};for(n in e)if(e.hasOwnProperty(n)&&"entityIndex"!==n){var r=e[n];if($IU.isArray(r)){t(0<(i=n).length?"group"+i.substring(0,1).toUpperCase()+i.substring(1):null);for(var o=0,s=r.length;o<s;o++){var l,u=$IU.getFieldNamesFromFieldChangeData(r[o]),d=(l=void 0,u);for(l in d)d.hasOwnProperty(l)&&t(l)}}else t(0<(i=n).length?"field"+i.substring(0,1).toUpperCase()+i.substring(1):null)}return a},x.setFormData=function(e,t,n){function d(e,t){return 0<e.length?"field"+e.substring(0,1).toUpperCase()+e.substring(1)+(t!==w?t:""):null}for(var c=$$.entity.fields,i=function(e){var t,n=[],i=[];for(t in e)if(e.hasOwnProperty(t)&&"entityIndex"!==t){var a=e[t],r=t,o={key:r,value:a};if($IU.isArray(a))i.push(o);else{for(var s=0,l=n.length;s<l;s++){var u=n[s].key;if(function(e,t){if(null!=c[t])for(var n=c[t].parent,i=[];n!==w;){if(i.push(n),e===n)return!0;if(null==c[n])return!1;if((n=c[n].parent)!==w&&$IU.arrayContains(i,n))return x.errorMessageBox($$.lt("validation.selfLoop",e)),!1}return!1}(d(r),d(u))){n.splice(s,0,o);break}}l===n.length&&n.push({key:r,value:a})}}return n.concat(i)}(e),a=0,r=i.length;a<r;a++){var o,s,l=i[a].key,u=i[a].value;$IU.isArray(u)?(o=t,null!=(s=0<(s=l).length?"group"+s.substring(0,1).toUpperCase()+s.substring(1)+o:null)&&0<(o=$("#"+s)).length&&(s=o[0],null!=(o=$(s).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT)))&&(o.setData(u),null!=$$.params.fieldChanging)&&$$.params.fieldChanging.controls.push(o)):n||(s=d(l,t),l=0<(o=l).length?c["field"+o.substring(0,1).toUpperCase()+o.substring(1)]:null,null!=s&&null!=l&&(!$IU.isString(u)&&(u.hasOwnProperty("codeId")||l.type===$Control.DATA_TYPE_CODE)?$IU.setElementValue(s,u.codeId,u.codeName,u.attributes):$IU.setElementValue(s,u)))}},x.setFocusToElement=function(e){var t;$$.MOBILE||0<(e=document.getElementsByName(e)).length&&(t=e[0],e=function(){var e=$(t).data($Control.DATA_SUGGESTER);if(null!=e)e.containerClick();else try{document.getElementById(t.id).focus()}catch(e){}},-1!==navigator.appVersion.indexOf("MSIE")?setTimeout(e,1e3):e())},x.getComputedStyle=function(e,t){return null==e||null==t?null:null!=R.getComputedStyle?R.getComputedStyle(e)[t]:null!=e.currentStyle?e.currentStyle[t]:null},x.fireClick=function(e){var t;(e="string"==typeof e?document.getElementById(e):e)&&(document.dispatchEvent?((t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,R,1,1,1,1,1,!1,!1,!1,!1,0,e),e.dispatchEvent(t)):document.fireEvent&&e.click())},x.openLink=function(e,t){var n=document.createElement("a");t?n.setAttribute("target","_blank"):n.setAttribute("target","_self"),n.setAttribute("href",e),document.body.appendChild(n),$IU.fireClick(n),document.body.removeChild(n)},x.splitAttribute=function(e){var t;return null==e?[]:1===(t=e.split("\r\n")).length?e.split("\n"):t},x.beginWith=function(e,t){return null!=e&&""!==e&&null!=t&&""!==t&&!(t.length>e.length)&&e.substr(0,t.length)===t},x.endWith=function(e,t){return null!=e&&""!==e&&null!=t&&""!==t&&!(t.length>e.length)&&e.lastIndexOf(t)===e.length-t.length},x.checkControlValidation=function(e,r,o){function s(e){e.is(":visible")&&(e.validationEngine("showPrompt",$$.lt("validation.detailError"),null,"row",!0),e.data("showDetailError",!0))}for(var t,n=!0,i=0,a=e.length;i<a;i++)!1===function(e){var e=$(e),t=0<e.parents(".detailCell").size(),n="#"+e[0].id;if(r){if(!0===$$.params.renderForm.validationEngine("validateField",n,!t||!o))return t&&o&&s(e.parents(".detailCell").parent()),!1}else{var i,a=(i=(null!=e.data($Control.DATA_ORIGIN_INPUT)?$(e.data($Control.DATA_ORIGIN_INPUT)):e).data($Control.DATA_VALIDATOR)).required;if(!(i.required=!1)===$$.params.renderForm.validationEngine("validateField",n,!t||!o))return i.required=a,t&&o&&s(e.parents(".detailCell").parent()),!1;i.required=a}return!0}((t=e[i])instanceof InfoPlus.Controls.Suggester?$(t.element).data($Control.DATA_SUGGESTER).activeInput:t instanceof InfoPlus.Controls.Control?t.element:t)&&(n=!1);return n},x.clacImgZoomParam=function(e,t,n,i){var a,r,o={top:0,left:0,width:n,height:i};return(e<n||t<i)&&((r=i/t)<(a=n/e)?(o.width=e,o.height=Math.round(i/a)):(o.width=Math.round(n/r),o.height=t)),o.left=Math.round((e-o.width)/2),o.top=Math.round((t-o.height)/2),o},x.dynamicReferControl=function(e,t){var n=t.getDynamicKeyName(),t=t.getDynamicContextControlName();return x.arrayContains(e.references,n)||x.arrayContains(e.references,t)},x.scrollTo=function(e,t,n){$("html,body").animate({scrollTop:e},t,n)},x.adjustWidth=function(e,t,n){for(var i=0,a=0,r=e.length;a<r;a++)e[a]=Math.round(e[a]*n),i+=e[a];if(i!==t)for(var o=Math.ceil((t-i)/e.length),a=0,r=e.length;a<r&&t!==i;a++)0<o&&o<t-i||o<0&&t-i<o?(e[a]+=o,i+=o):(e[a]+=t-i,i=t),i!==t&&a===r-1&&(e[a]+=t-i)},x.addVariableControl=function(e,t,n,i){null==t&&(t="");var a,r,o=$("#"+e);return 0<o.length?null!=(r=o.data($Control.DATA_CONTROL_OBJECT))&&r.setValue(t,n,!0,i):(o=$("#variables_container"),a={name:e,type:null==n&&"_VAR_URL"!==e?$Control.DATA_TYPE_STRING:$Control.DATA_TYPE_CODE,permission:"rw"},r=new $Controls.Hidden("",a,{renderCategory:"Boundable",controlId:e,field:e},t,n,i),o.append(r.element),$IU.beginWith(e,"_VAR_")&&$(r.element).addClass($Control.CLASSNAME_VAR)),r},x.getAllControls=function(e){e===w&&(e=$$.params.renderForm);var t=[];return $(e).find("."+$Control.CLASSNAME_CONTROL+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT+",."+InfoPlus.Layout.View.CLASS_VIEW).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);null==e&&null==(e=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT))&&null==(e=$(this).data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT))||t.push(e)}),t},x.pathInclude=function(e,t){var n=e.split("_"),i=t.split("_");if(i.length>n.length)return!1;for(var a=0,r=i.length;a<r;a++)if(i[a]!==n[a])return!1;return!0},x.processUrl=function(i,a){function e(e,t){var n;a!==e&&(t===w&&(t=e),null!=$$.params[e])&&""!==$$.params[e]&&(n=t,-1===i.indexOf("&"+n+"="))&&-1===i.indexOf("?"+n+"=")&&("back"===e&&$IU.isPositiveInt($$.params.back)?(n=$$.params.back,0<x.historyAdd()&&(n=parseInt(n,10)+x.historyAdd()),i+=(-1!==i.indexOf("?")?"&":"?")+t+"="+(parseInt(n,10)+1)):i+=(-1!==i.indexOf("?")?"&":"?")+t+"="+encodeURIComponent($$.params[e]))}return null!=$$.getTestFile()&&(i+=(-1!==i.indexOf("?")?"&":"?")+"jsTestFile="+$$.getTestFile()),e("back"),e("membership"),e("showRemark"),e("theme"),e("urlLang","lang"),e("entrust"),i},x.getParamFromUrl=function(e){var t={};if(x.isString(e)&&null!=e){var n=[],e=e.split("?");1<e.length?(n=e[0].split("#").concat(e[1].split("#"))).splice(0,1):n=e[0].split("#");for(var i=0,a=n.length;i<a;i++)for(var r=n[i].split("&"),o=0,s=r.length;o<s;o++){var l=r[o].split("=");2===l.length&&(t[l[0]]=decodeURIComponent(l[1]))}}return t},x.base64ImgtoFile=function(e,t){t=t||"filename";for(var e=e.split(","),n=e[0].match(/:(.*?);/)[1],i=n.split("/")[1],a=atob(e[1]),r=a.length,o=new Uint8Array(r);r--;)o[r]=a.charCodeAt(r);return new File([o],t+"."+i,{type:n})},x.fileTobase64Img=function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)},x.openUrl=function(e,t,n){var i=document.createElement("a");i.href=e,i.target=n===w?"_self":n,$(i).css("display","none"),(null!=t?$(t):$(document.body)).append(i),$IU.fireClick(i)},x.getWindowWidth=function(){var e=$(R).width();return e=0===(e=0===e?R.outerWidth:e)?R.screen.width:e},x.getBarcodePrintUrl=function(e){if(null==e||""===e)return null;if(null==(i=$$.params.uriBarcode))return null;var t=i.split("?");if(1<t.length){for(var n=t[1].split("&"),i=t[0]+"?",a=!1,r=!1,o=0,s=n.length;o<s;o++){var l=n[o].split("=");1<l.length&&("width"===l[0].toLocaleLowerCase()&&(a=!0),"isTextDrawn"===l[0])&&(r=!0),i+=0===o?n[o]:"&"+n[o]}a||(i+="&width=300"),r||(i+="&isTextDrawn=1")}else i+="?isTextDrawn=1&width=300";return i.replace("%s",e)},x.analysisTable=function(e){var t=e.closest("table"),n=e.parent().children("tr");if(null==t.data("analysed")){for(var i=0,a=n.size();i<a;i++)for(var r=$(n[i]).children("td"),o=0,s=r.size();o<s;o++){var l=$(r[o]);if(null!=l.attr("colspan"))for(var u=parseInt(l.attr("colspan"),10)-1,d=0;d<u;d++){var c=document.createElement("td");$(c).addClass("fake").css("display","none"),l.after(c)}if(null!=l.attr("rowspan"))for(var h=parseInt(l.attr("rowspan"),10)-1,u=null!=l.attr("colspan")?parseInt(l.attr("colspan"),10):1,p=1;p<=h;p++)if(i+p<n.size()){var f=$(n[i+p]);if(0<l.index())for(d=0;d<u;d++){c=document.createElement("td"),$(c).addClass("fake").css("display","none");for(var m=l.index()-1,g=f.children("td"),C=0,_=0,E=g.size();C<E;C++){var T=$(g[C]);if(_===m){T.after(c);break}null!=T.attr("colspan")&&(_+=parseInt(T.attr("colspan"),10)-1),_++}}else for(d=0;d<u;d++)c=document.createElement("td"),$(c).addClass("fake").css("display","none"),f.prepend(c)}}n.each(function(){$(this).index();$(this).children("td").each(function(){$(this).index(),$(this).data("rawTdIndex",$(this).index())}),$(this).children("td.fake").remove()}),t.data("analysed",!0)}},x.processTrRowVisible=function(o,e,t){function n(){for(var e=!1,t=[],n=(o.nextAll("tr:not(.fake)").each(function(){e||(t.push($(this)),"none"!==$(this).css("display")&&(e=!0))}),o.children("td")),i=0,a=n.size();i<a;i++){var r=$(n[i]);null!=r.attr("rowspan")&&!function(l,e){for(var t=function(e,t){var n=l.clone();n.attr("rowspan",t);n.data("rawTdIndex",l.data("rawTdIndex"));n.addClass("fake");var i=l.data("rawTdIndex");var a=e.children("td");for(var r=0,o=a.size();r<o;r++){var s=$(a[r]);if(s.data("rawTdIndex")!=null)if(s.data("rawTdIndex")>i){s.before(n);return}}e.append(n)},n=parseInt(l.attr("rowspan"),10),i=0,a=e.length;i<a;i++)if(n>1){var r=e[i];t(r,--n)}}(r,t)}}var c,i;null==o.closest("table").data("analysed")&&$IU.analysisTable(o),e?("none"===o.css("display")&&(0<o.prev("tr").size()&&o.prev("tr.fake").remove(),c=o.nextAll("tr"),o.children("td").each(function(){if(null!=$(this).attr("rowspan"))for(var e=c,t=$(this),n=parseInt(t.attr("rowspan"),10)-1,i=t.data("rawTdIndex"),a=0,r=0;a<n&&r<e.size();){for(var o=$(e[r]),s=o.children("td"),l=0,u=s.size();l<u;l++){var d=$(s[l]);d.data("rawTdIndex")===i&&d.hasClass("fake")&&d.remove()}o.hasClass("fake")||a++,r++}})),$IU.dynamicShowElement(o),o.removeData("visible")):(!1!==o.data("visible")&&(0<o.prev("tr").size()&&((i=(e=o).clone()).children("td").removeAttr("rowspan").css("border-width","0").css("border-style","none").css("padding","0").empty(),i.addClass("fake").removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),null!=i.css("min-height")&&i.css("min-height",""),null!=i.css("height")&&i.css("height",""),null!=i.css("display")&&i.css("display",""),e.before(i)),n()),$IU.dynamicHideElement(o),o.data("visible",!1))},x.convertData=function(i){function c(e){return $IU.endWith(e,"_Attr")}function r(e,t,a){function n(){var e,t,n={},i=$.parseJSON(a);for(e in i)i.hasOwnProperty(e)&&(l(e)?(t=e.substr(0,e.length-5),g(n,t,i[e])):f(e)?(t=e.substr(0,e.length-5),E(n,t,i[e])):d(e)?(t=e.substr(0,e.length-6),_(n,t,i[e])):u(e)||i.hasOwnProperty(e+"_Names")||i.hasOwnProperty(e+"_names")?(t=u(e)?e.substr(0,e.length-6):e,C(n,t,i[e])):i.hasOwnProperty(e+"_Name")||i.hasOwnProperty(e+"_name")?g(n,e,i[e]):n[e]=i[e]);return n}null!=e[t]&&($IU.isObject(e[t])?e[t].attributes=n():e[t]={value:e[t],attributes:n()})}function h(e,t,n,i){var a=(t="User"===t.type||"Organize"===t.type||"Code"===t.type||"Thing"===t.type)&&f(n);(t=t&&c(n))||a?(n=function(e){e=m(e);return null==e?null:e.name}(n),a&&E(e,n,i),t&&r(e,n,i)):null!=e[n]&&$IU.isObject(e[n])?e[n].value=i:e[n]=i}function p(e,t,n,i){var a=f(n),r=c(n),o=m(n);if($IU.isArray(t)){var s=function(){if(null==i)return o.groupArray[1];for(var e=1,t=o.groupArray.length;e<t;e++){var n=o.groupArray[e];if(i===n&&e!==t-1)return o.groupArray[e+1]}return null}();null==e[s]&&(e[s]=[]);for(var l=0,u=t.length;l<u;l++){null!=e[s][l]||a||r||(e[s][l]={});var d=e[s][l];null!=d&&p(d,t[l],n,s)}}else h(e,o,n,t)}for(var e,t,n,a,o,s,l=function(e){return $IU.endWith(e,"_Code")||$IU.endWith(e,"_code")},u=function(e){return $IU.endWith(e,"_Codes")||$IU.endWith(e,"_codes")},f=function(e){return $IU.endWith(e,"_Name")||$IU.endWith(e,"_name")},d=function(e){return $IU.endWith(e,"_Names")||$IU.endWith(e,"_names")},m=function(e){return(c(e)||f(e))&&(e=e.substr(0,e.length-5)),$$.entity.fields[e]},g=function(e,t,n){null!=e[t]&&$IU.isObject(e[t])?e[t].value=n:e[t]={value:n}},C=function(e,t,n){var i=$IU.splitAttribute(n);if(null!=e[t]){$IU.isArray(e[t])||(e[t]=[]);for(var a=0,r=i.length;a<r;a++)null!=e[t][a]&&$IU.isObject(e[t][a])?e[t][a].value=i[a]:e[t][a]={value:i[a]}}else for(e[t]=[],a=0,r=i.length;a<r;a++)e[t].push({value:i[a]})},_=function(e,t,n){var i=$IU.splitAttribute(n);if(null!=e[t]){$IU.isArray(e[t])||(e[t]=[]);for(var a=0,r=i.length;a<r;a++)null==e[t][a]?e[t][a]={name:i[a]}:$IU.isObject(e[t][a])?e[t][a].name=i[a]:e[t][a]={value:e[t][a],name:i[a]}}else for(e[t]=[],a=0,r=i.length;a<r;a++)e[t].push({name:i[a]})},E=function(e,t,n){null!=e[t]&&($IU.isObject(e[t])?e[t].name=n:e[t]={value:e[t],name:n})},T=function(){var e,t,n=[];for(e in i)i.hasOwnProperty(e)&&(t=e,!$$.entity.groups.hasOwnProperty(t))&&n.push(e);return n.sort(),n}(),I={},v=0,A=T.length;v<A;v++){var y,P=T[v],S=i[P],D=m(P);null==D?(e=I,n=S,s=o=a=y=void 0,y=f(t=P),a=c(t),o=u(t),s=d(t),y||a?(t=t.substr(0,t.length-5),y&&E(e,t,n),a&&r(e,t,n)):o||s?(t=t.substr(0,t.length-6),o&&C(e,t,n),s&&_(e,t,n)):null!=e[t]&&$IU.isObject(e[t])?e[t].value=n:e[t]=n):null==(y=D.groupArray)||1===y.length?h(I,D,P,S):p(I,S,P)}return I},x.linkifyStr=function(e){var t=/\[([\u4e00-\u9fa5_A-Z0-9]+)\]\((\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])\)/gim;return e.match(t)?e.replace(t,'<a href="$2" target="_blank">$1</a>'):e.replace(/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>')},x.createReviewPopTip=function(e,t,n){var i=document.createElement("div"),a=$(i),r=document.createElement("div"),o=$(r),s=(o.attr("contenteditable","true").addClass("memo_input_div"),null!=n&&(null!=n.html&&o.html(n.html),null!=n.remark)&&o.html($IU.htmlEncode(n.remark)),a.append(r),new InfoPlus.Render.PopTip({popper:t,container:e,content:i,colorClass:"remarkTip",placement:"top",location:"top",unclearable:!0,onMaximized:function(){l.showMenuItems(["minimize","remove"])},onClose:$IU.refreshReviewByForm})),l=new InfoPlus.Render.PopMenu({container:s.element,items:[{id:"maximize",text:$$.lt("review.menu.maximize"),iconClass:"i-icon-triangle-up",initVisible:!1,switchItems:["minimize","remove"],click:function(){s.maximize(),l.show()}},{id:"minimize",text:$$.lt("review.menu.minimize"),iconClass:"i-icon-triangle-down",switchItems:["maximize"],click:function(){s.minimize()}},{id:"remove",text:$$.lt("review.menu.remove"),iconClass:"i-icon-delete",click:function(){s.close(!0)}}]})},x.refreshReviewByForm=function(e){var n=[];(e=null==e?$$.params.renderContainer:e).find(".memo_input_div").each(function(){var e,t;""!==x.trimString(this.innerText)&&(e=$(this).parents(".popTip").data("tipControl"),null!=(t=$(e.options.popper).data($Control.DATA_CONTROL_OBJECT)))&&(e.isHideByShrinkView()||null!=t.controlContainer&&$(t.controlContainer).is(":visible")||$(t.element).is(":visible"))&&n.push({field:t.field.name,path:t.path,remark:x.trimString(this.innerText),html:this.innerHTML})}),$$.params.review=n,$IU.refreshReviewButton(n.length)},x.refreshFormReviews=function(){var e=0;if(0<$$.params.review.length)for(var t=0,n=$$.params.review.length;t<n;t++){var i,a,r=$$.params.review[t];null!=r.remark&&""!==r.remark&&(0<(a=$$("&"+r.field).filter({path:r.path})).length&&(null!=(i=a[0].control).controlContainer&&$(i.controlContainer).is(":visible")||$(i.element).is(":visible")))&&(a=i.controlContainer||i.element,$IU.createReviewPopTip($$.params.renderContainer[0],a,r),e++)}return e},x.refreshReviewButton=function(e){var t=$("#FormCommandReview").data("buttonControl");null!=t&&(0<e?(t.mark(),t.setTip($$.lt("review.buttonTip")+"<br>"+$$.lt("review.tipCount",e))):(t.removeMark(),t.setTip($$.lt("review.buttonTip"))))},x.createFormReviews=function(e){if(!$$.params.readOnly&&null!=e&&null!=e.review){var t;try{t=$.parseJSON(e.review)}catch(e){}null!=t&&null!=t.remarks&&$IU.isArray(t.remarks)&&($$.params.review=t.remarks,e=$IU.refreshFormReviews(),$IU.refreshReviewButton(e))}},x.getReviewData=function(){var e=$$.params.review;if(null!=e&&$IU.isArray(e)&&0<e.length){for(var t=[],n=0,i=e.length;n<i;n++)t.push({field:e[n].field,path:e[n].path,remark:e[n].remark});return{remarks:t}}return null},x.clearStack=function(){x.stack=null},x.pushStack=function(e){null==x.stack&&(x.stack=[]),x.stack.push(e)},x.popStack=function(){return null==x.stack?null:x.stack.pop()},x.removePrintZeroHeightView=function(){$$.PRINT&&$$.params.holder.form.find(".infoplus_view").each(function(){0===$(this).find("table").first().height()&&$(this).remove()})},x.localeCompare=function(t,n){try{return t.localeCompare(n)}catch(e){return n=n||"",0===(t=t||"").length||0===n.length?t.length===n.length?0:0===t.length?-1:1:t.charAt(0)===n.charAt(0)?0:t.charAt(0)>n.charAt(0)?1:-1}},x.processEmptyDiv=function(e,t){var n;if(null==(n=e).renders||0===n.renders.length)"DisplayText"===(n=e).renderType&&""===x.trimString(n.text)&&(null!=t&&(t.length=t.length-1),null!=(n=x.popStack()))?x.processEmptyDiv(n.renders[n.index],n.renders):x.clearStack();else{for(var i=0,a=e.renders.length;i<a-1;i++)x.pushStack({index:i,renders:e.renders});x.processEmptyDiv(e.renders[e.renders.length-1],e.renders)}},x.processStepName=function(e){return"<span class='color_b2'>"+e+"</span>"},x.listSteps=function(e,o,t,n){var s,i,l=$.Deferred();return null==e?l.reject({error:$$.lt("submit.needAction")}):(i=$$.params.formRender.save(null,!1),s=$.toJSON(i),n||$$.blockUI({message:"<span class='loading'>"+$$.lt("submit.prepare")+"</span>"}),i={stepId:null==$$.params.formStepId?-1:$$.params.formStepId,actionId:e,formData:s,timestamp:$$.params.timestamp,rand:999*Math.random(),boundFields:$$.params.boundFields.toString()},t&&(i.transferToes=t),$$.ajax({type:"POST",url:$$.params.uriListNextSteps,data:i,requestMsg:$$.lt("submit.request"),errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).always(function(){$.unblockUI()}).done(function(e){var t=e.entities,n=t.length,i=!1,a=function(e){var t=null;if(null!=e&&0<e.length)for(var n=0;n<e.length;n++){var i=e[n];if(i.type===InfoPlus.Settings.STEP_TYPE_AUTO){t=i,e.splice(n,1);break}}return t}(t);if(null==a&&0<n){for(var i=!0,r=0;r<n;r++)if(3!==t[r].executorSelection){i=!1;break}}else i=o;!0===i?l.resolve({showSelectUser:!1,steps:[],jsonData:s,remark:e.error}):l.resolve({showSelectUser:!0,steps:t,isEndStep:null!=a,jsonData:s,remark:e.error})}).fail(function(e){l.reject(e)}),l.promise())},x.closeAllDoc=function(){var t=!1;return $$("*doc").each(function(){var e=this.control;e.hasFile()&&(e.isWritable()||e.isEditable())&&(e.closeIframe(),t=!0)}),t},x.reopenAllDoc=function(){$$("*doc").each(function(){this.control.reopenIframe()})},x.showDoAction=function(e,t,a,p){var n=e.children("nobr").text(),i=e.data("description"),r=$IU.isEmptyStr(t.remark)?e.data("lastRemark"):t.remark,o=e.data("remarkRequired"),s=e.data("remarkRequiredTip"),u=e.data("hidePrintPrompt"),l=e.data("actionPrintable"),d=e.data("actionId"),c=t.jsonData,h=t.steps,f=t.isEndStep,m=$("#form_do_action_remark"),g=$("#form_do_action_dialog"),C=e.data("transferTo"),_=[],E=!1,T=(p?d=-1:p=!1,null!=o&&o),I=$IU.trimString(s);if(null!=I&&""!==I||(I="*"),null==d)$IU.messageBox(null,$$.lt("submit.noAction"),null,300);else{function v(e,t){var n={},i=!1,a="",r="";if("none"!==$("#form_do_action_next_steps").css("display")){var o=$("#form_do_action_user_list");if((o=p||C?$(".form_do_tansfer_user_list"):o).find("select").each(function(){var e=$(this).parents(".form_do_tansfer_user_list").parents(".transfer_step_title");if(!p||0<e.find(".transferToStepCheckBox:checked").size()){var t,e=$(this).val();if(e===InfoPlus.Settings.NOBODY_ACCOUNT){if($(this).data("mustSelectNextUser"))return $$.MOBILE||((t=$(this).parent().siblings(".form_do_action_must_select_user")).is(":visible")?t.effect("pulsate"):t.show().effect("highlight")),a+=(""!==a?"<br>":"")+$$.lt("submit.chooseStepExecutor",$(this).data("stepName")),void(i=!0);e=""}n[$(this).data("stepId")]=e}}),o.find("input[type*=hidden]").each(function(){n[$(this).data("stepId")]=$(this).val()}),i)return $$.MOBILE&&$IU.messageBox($$.lt("common.choose"),a,null,400),!1}var o=$("#form_do_action_remark");if($$.MOBILE?o.is(":visible")&&(r=o.val()):"block"===$("#form_do_action_remark_div").css("display")&&(r=o.val()),!0===T&&0===$IU.trimString(r).length)return $$.MOBILE?$IU.messageBox(null,I,null,300):(o=$("#form_do_action_remark_tip").children(".form_do_action_must_input_remark")).is(":visible")?o.effect("pulsate"):o.show().effect("highlight"),!1;function s(){var e=$IU.closeAllDoc();if($$.blockUI({message:"<span class='loading'>"+$$.lt("submit.submitting")+"</span>"}),e)return 3e3}function l(){$IU.reopenAllDoc(),$.unblockUI()}o=$IU.getReviewData(),e={actionId:e,formData:t,remark:r,rand:999*Math.random()};null!=o&&(e.review=$.toJSON(o)),p||C?(E=$("#return_this_step_chb").prop("checked"),p?($(".transferToStepCheckBox:checked").each(function(){_.push($(this).data("transferTo"))}),1==$(".transferToStepCheckBox:checked").size()?e.actionId=$(".transferToStepCheckBox:checked").data("actionId"):e.actionId=-1):_.push(C),0<_.length?(_=_.join(","),$$.doAction(e,n,!1,s,l,_,E,u)):$IU.messageBox(null,$$.lt("forward.chooseMessage"),null,300)):$$.doAction(e,n,!1,s,l,null,null,u)}function A(e,t){if(!0!==f){if(0<e.length){function n(e,t,n){function i(e){null!=e.tenantUserId?e.displayName=e.trueName+"("+e.tenantUserId+")":e.displayName=e.trueName}for(var a={},r=0,o=t.length;r<o;r++){var s=t[r];a.hasOwnProperty(s.trueName)?(i(a[s.trueName]),i(s)):(a[s.trueName]=s).displayName=s.trueName}for(var l=document.createElement("select"),u=0;u<t.length;u++){var d=t[u],c=d.displayName,h=d.organizeName,h=(null!=h&&""!==h&&(c=c+"("+h+")"),new Option(c,d.userId));$.browser.msie?l.add(h):l.add(h,null)}var p=null==e.splitIdentifier?"":e.splitIdentifier,p=($(l).data("stepId",e.stepId+","+p).data("stepName",e.name).data("mustSelectNextUser",n),document.createElement("span"));return $(p).append(l).addClass("userSpan"),p}for(var i,a={trueName:$$.lt("submit.choose"),userId:InfoPlus.Settings.NOBODY_ACCOUNT},r={trueName:$$.lt("submit.allUser"),userId:InfoPlus.Settings.NOBODY_ACCOUNT},o=0,s=e.length;o<s;o++){var l,u,d=e[o],c=function(e){for(var t=new InfoPlus.QuickSortArray,n=0,i=e.length;n<i;n++)t.push(e[n]);return t.sort(function(e,t){return $IU.localeCompare(e.trueName,t.trueName)}),t}(d.users),h=document.createElement("li");switch(h.innerHTML=p||C?"<span class='stepName'>:"+d.name+"&nbsp;</span>"+$$.lt("submit.executor")+"&nbsp;":"<span class='stepName'>"+d.name+"</span>"+$$.lt("submit.executor")+"&nbsp;",$(h).addClass("userLi"),d.executorSelection){case 0:c.splice(0,0,r),h.appendChild(n(d,c,!1)),i=document.createElement("span"),$(i).attr("class","tip_help").attr("original-title",$$.hlt("submit.helper.title")).data("selectUser",d.executorSelection).data("tipContent",$$.lt("submit.helper.content")),h.appendChild(i);break;case 1:1===c.length?(l=c[0],h.innerHTML=h.innerHTML+("<b>"+l.trueName)+"</b>",(u=document.createElement("input")).type="hidden",u.value=l.userId,h.appendChild(u),l=null==d.splitIdentifier?"":d.splitIdentifier,$(u).data("stepId",d.stepId+","+l)):(c.splice(0,0,a),h.appendChild(n(d,c,!0)),u=document.createElement("span"),$(u).text("(*)").css("color","red"),h.appendChild(u),u=document.createElement("span"),$(u).text($$.lt("submit.helper.mustChoose")).addClass("form_do_action_must_select_user").css("display","none"),h.appendChild(u),i=document.createElement("span"),$(i).attr("class","tip_help").attr("original-title",$$.lt("submit.helper.mustChoose")).data("selectUser",d.executorSelection).data("tipContent",$$.lt("submit.helper.mustChoose")),h.appendChild(i));break;case 2:case 3:h.innerHTML=h.innerHTML+"<b>"+$$.lt("submit.helper.chooseBySystem")+"</b>";break;case 4:h.innerHTML=h.innerHTML+"<b>"+$$.lt("submit.helper.chooseOneBySystem")+"</b>"}t.appendChild(h)}$(i).tipsy({html:!0,fade:!0,gravity:"w",trigger:"manual",opacity:.8}),$("#form_do_action_show_next_steps").show()}else $("#form_do_action_show_next_steps").hide();S.show()}}var s=$("#form_do_action_show_remark"),y=$("#form_do_action_remark_tip"),P=$("#form_do_action_remark_div"),y=(s.empty().html("<span class='form_do_action_info ui-icon ui-icon-info'></span><span>"+$$.lt("submit.clickComment")+"</span><a href='#' class='show_comment'>"+$$.lt("submit.linkComment")+"</a><span>"+$$.lt("submit.orComment")+"</span><a class='make_remark' href='#'>"+$$.lt("submit.makeRemark")+"</a><span class='form_do_action_remark_made'></span><span>"+$$.lt("submit.remarkInForm")+"</span></span>"),$(".form_do_action_next_steps").html($$.lt("submit.nextSteps")),C&&1<a.length&&($(".form_do_action_next_steps").append("<a class='add_forward_button' href='#'>"+$$.lt("forward.addForwardButton")+"</a>"),$(".add_forward_button").click(function(){p=!0,$(".form_do_transfer_list").addClass("is_transfer_group"),$(this).remove()})),null!=r?m.val(r):m.val(""),!0===o?y.html($$.lt("submit.inputRemark")+"<span>"+$$.lt("submit.orComment")+"</span><a href='#' class='make_remark'>"+$$.lt("submit.makeRemark")+"</a><span class='form_do_action_remark_made'></span><span>"+$$.lt("submit.remarkInForm")+'</span><span style="color:red">('+I+')</span><span class="form_do_action_must_input_remark" style="display:none">'+$$.lt("submit.mustInputRemark")+"</span>"):y.html($$.lt("submit.inputRemark")),!e||$IU.isEmptyStr(e.data("lastRemark"))||$IU.isEmptyStr(t.remark)||e.data("lastRemark")===t.remark?P.find(".hint_div").hide():0===P.find(".hint_div").length?(y=document.createElement("div"),t=$(y),D=document.createElement("a"),D=$(D),t.addClass("hint_div"),D.attr("href","#").text($$.lt("submit.lastRemark")).addClass("last_remark_link"),D.attr("original-title",$IU.htmlEncode(e.data("lastRemark"))),t.html($$.lt("submit.lastRemarkDiff",D[0].outerHTML)),P.append(y),(D=t.find(".last_remark_link")).tipsy({html:!0,fade:!0,gravity:"n",trigger:"manual",opacity:.8}).data("lastRemark",e.data("lastRemark")).data("copied",!1).click(function(){$$.MOBILE||$(this).tipsy("show"),$(this).data("copied")||(m.val(m.val()+"\n"+e.data("lastRemark")),$(this).data("copied",!0))}),$$.MOBILE||D.mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")})):(P.find(".last_remark_link").attr("original-title",$IU.htmlEncode(e.data("lastRemark"))).data("copied",!1),P.find(".hint_div").show()),null!=$$.params.review&&0<$$.params.review.length&&$(".form_do_action_remark_made").html($$.lt("submit.remarkDone",$$.params.review.length)),!0===o?(s.hide(),P.show()):null!=r&&""!==r?(s.show(),P.show()):(s.show(),P.hide()),$("#form_do_action_message_description")),t=(null==i||""===i?y.hide().text(""):y.text(i).show(),[]),S=($$.params.printable&&!0===l&&t.push({name:$$.lt("common.print"),callback:function(){$("#linkPrint").attr("href",$IU.processUrl($$.params.printUrl)),$IU.fireClick("linkPrint")}}),t=t.concat([{name:$$.lt("common.confirmAction"),callback:function(){return v(d,c)},preventDefault:!0,defaultButton:!0},{name:$$.lt("common.cancel"),callback:function(){e.data("lastRemark",m.val())},callOnClose:!0}]),$("#form_do_action_next_steps")),D=(S.hide(),$("#form_do_action_user_list")[0]);$(D).empty();if(p||C){var b=$(".form_do_transfer_list"),O=(0==b.size()&&(b=$("<ul class='form_do_transfer_list'></ul>"),S.append(b)),b.empty(),p?b.addClass("is_transfer_group"):b.removeClass("is_transfer_group"),a);p||(O=O.sort(function(e,t){return t.id==d?1:-1}));for(var R=0;R<O.length;R++){var w,L=$("<li><div class='transfer_step_title'><input type='checkbox' id='transferToStepCheckBox_"+R+"' class='transferToStepCheckBox' /><label for='transferToStepCheckBox_"+R+"'>"+O[R].name+"</label><span class='user_loading'></span><div class='form_do_tansfer_user_list'></div></div></li>");L.find(".transferToStepCheckBox").data("transferTo",O[R].transferTo),L.find(".transferToStepCheckBox").data("actionId",O[R].id),b.append(L),O[R].id==d?(L.find(".transferToStepCheckBox").prop("checked",!0),L.find("label").hide(),w=L.find(".form_do_tansfer_user_list")[0],A(h,w)):L.addClass("other_transfer_li"),$("form_do_tansfer_user_list").hide()}o=b.find(".transferToStepCheckBox");0<o.size()&&o.change(function(){var n=$(this),i=(1<b.find(".transferToStepCheckBox:checked").length?$("#return_this_step_chb").prop("checked",!0).prop("disabled",!0):$("#return_this_step_chb").prop("checked",!0).prop("disabled",!1),$(this).parents("li").find(".form_do_tansfer_user_list")[0]),e=a[$(this).parents("li").index()],t=e.id,e=e.transferTo;$(this).prop("checked")?0<$(i).find("li").size()?($(i).show(),$(this).next("label").hide()):($(this).siblings(".user_loading").show(),x.listSteps(t,!0,e,!0).done(function(e){$IU.refreshReviewByForm();var t=e.steps;n.siblings(".user_loading").hide(),n.next("label").hide(),c=e.jsonData,A(t,i)})):($(this).next("label").show(),$(i).hide())}),S.show()}else A(h,D),$(".form_do_transfer_list").remove(),$("#form_do_action_return_this_step").remove();(C||p)&&(t=[{name:$$.lt("forward.forwardButton"),callback:function(){return v(d,c)},preventDefault:!0,defaultButton:!0},{name:$$.lt("common.cancel"),callback:function(){e.data("lastRemark",m.val())},callOnClose:!0}],0==(r=$("#form_do_action_return_this_step")).size()?(r=$("<div id='form_do_action_return_this_step'><input type='checkbox' name='return_this_step_chb' id='return_this_step_chb' checked /><label for='return_this_step_chb'>"+$$.lt("forward.returnMessage")+"</label></div>"),S.after(r)):($("#return_this_step_chb").prop("disabled",!1),$("#return_this_step_chb").prop("checked",!0)));var N,k;$(".tip_help");$(".show_comment").one("click",function(){return $("#form_do_action_remark_div").show(),!1}),$$.MOBILE?($$.WECHAT&&/(iPhone|iPad)/i.test(navigator.userAgent)&&(m.blur(function(){document.body.scrollTop=document.body.scrollTop}),$("#form_do_action_user_list").on("blur","select",function(){document.body.scrollTop=document.body.scrollTop})),(N=new InfoPlus.Render.Mobile.BottomSheet({content:g,onClose:function(){g.detach().hide().appendTo(document.body)},buttons:t})).show(),S.delegate(".tip_help","click",function(){$(this).next("div").remove();var e=document.createElement("div"),t=($(e).html($(this).data("tipContent")).css("display","none"),$(this));0===t.data("selectUser")?$(e).css("color","#616161"):$(e).css("color","red"),t.parent().append(e),t.hide(),$(e).slideDown("slow")})):((k=new InfoPlus.Render.Dialog({title:n,content:g,maxWidth:650,onClose:function(){g.detach().hide().appendTo(document.body)},buttons:t})).show(),S.delegate(".tip_help","click",function(){$(this).tipsy("show")}),S.delegate(".tip_help","mouseenter",function(){$(this).tipsy("show")}),S.delegate(".tip_help","mouseleave",function(){$(this).tipsy("hide")})),$(".make_remark").click(function(){var t,n=$(".form_do_action_remark_made");return $$.MOBILE?($IU.mobileExpandAllViews(),(t=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm($(t.maskDiv));var e=m.val()||"";0<$$.params.review.length?n.html($$.lt("submit.remarkDone",$$.params.review.length)):n.empty(),""===$IU.trimString(e)&&0<$$.params.review.length&&(m.val($$.lt("submit.viewRemarks")),$("#form_do_action_remark_div").show()),t.close(),N.animateShow(),$IU.refreshFormReviews()},onCancel:function(){t.close(),N.animateShow(),$IU.refreshFormReviews()}})).render(),N.animateHide(t.getMenuDivPosition(["left","bottom","width","height"]),function(){t.show()})):((t=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm($(t.maskDiv));var e=m.val()||"";0<$$.params.review.length?n.html($$.lt("submit.remarkDone",$$.params.review.length)):n.empty(),""===$IU.trimString(e)&&0<$$.params.review.length&&(m.val($$.lt("submit.viewRemarks")),$("#form_do_action_remark_div").show()),t.close(),k.animateShow(),$IU.refreshFormReviews()},onCancel:function(){t.close(),k.animateShow(),$IU.refreshFormReviews()}})).render(),k.animateHide(t.getMenuDivPosition(["margin-top","margin-left","width","height"]),function(){t.show()})),!1})}return!1},x.chooseEntrust=function(e,t,i,n){function a(e){var t=document.createElement("label"),n=document.createElement("input"),i=document.createElement("span"),a=($(n).attr("type","radio").attr("name","chooseEntrustee").data("entrusted",e.entrusted).data("account",e.entruster.account),e.entruster.userName||e.entruster.account),a=(null!=e.tip?e.tip+" ":"")+e.entruster.name+"("+a+")";null!=e.from&&null!=e.to&&(a+="  "+$IU.unixTimeToDateString(e.from)+"  "+$IU.unixTimeToDateString(e.to)),$(i).text(a),$(t).append(n).append(i).addClass("entrust_label"),f.append(t)}function r(){var e=document.createElement("label"),t=document.createElement("input"),n=document.createElement("span"),i=document.createElement("input");$(t).attr("type","radio").attr("name","chooseEntrustee").data("entrusted",!1),$(n).text($$.lt("entrust.specified")),$(i).addClass("entrust_specifiedUser").focus(function(){$(t).attr("checked",!0)}),$(e).append(t).append(n).append(i).addClass("entrust_label"),f.append(e)}var o=e.app.id,s=$$.params.uriEntrust!==w?$$.params.uriEntrust:n,n=[{defaultButton:!0,preventDefault:!0,name:$$.lt("entrust.continueButton"),callback:function(){var e=f.find("input[type=radio]:checked");if(0===e.length)null!=i&&"function"==typeof i&&i();else{var t=e.data("account");if(null==t){if(t=e.siblings(".entrust_specifiedUser").val(),""===$IU.trimString(t))return $IU.messageBox(null,$$.lt("entrust.chooseSpecifiedAccount"),null,200),!1}else if(t===g||t===m)return null!=i&&"function"==typeof i&&i(),!0;var n=e.data("entrusted");$$.blockUI({message:n?$$.lt("entrust.request.entrust.requesting.entrust"):$$.lt("entrust.request.entrust.requesting.debug")}),$$.ajax({type:"POST",url:s,data:{entrustee:t,entrusted:e.data("entrusted"),app:o},requestMsg:n?$$.lt("entrust.request.entrust.request.entrust"):$$.lt("entrust.request.entrust.request.debug"),errorTitle:n?$$.lt("entrust.request.entrust.fail.entrust"):$$.lt("entrust.request.entrust.fail.debug"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){$$.MOBILE?setTimeout(function(){R.location.reload()},600):R.location.reload()})}}}],l=(null!=e.entruster&&n.push({name:e.entrusted?$$.lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug"),callback:function(){$$.blockUI({message:e.entrusted?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug")}),$$.ajax({type:"POST",url:s,data:{entrusted:!1,app:o},requestMsg:e.entrusted?$$.lt("entrust.request.abort.request.entrust"):$$.lt("entrust.request.abort.request.debug"),errorTitle:e.entrusted?$$.lt("entrust.request.abort.fail.entrust"):$$.lt("entrust.request.abort.fail.debug"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){$$.MOBILE?setTimeout(function(){R.location.reload()},600):R.location.reload()})}}),document.createElement("div")),u=$(l),d=document.createElement("div"),c=$(d),h=document.createElement("div"),p=document.createElement("div"),f=$(p),m=null!=e.entrustee?e.entrustee.account:null,g=null!=e.entruster?e.entruster.account:null,C=(c.append(h).append(p),f.addClass("entrust_choose_user_div"),[]);if(null!=e.entrusts)for(var _=0,E=e.entrusts.length;_<E;_++){var T=e.entrusts[_].entruster;T.account!==g&&T.account!==m&&C.push(e.entrusts[_])}if(null!=e.entruster){var c=e.entruster.userName||e.entruster.account,p=e.entrustee.userName||e.entrustee.account,c="<span class='entruster'>"+e.entruster.name+"("+c+")</span>",p=e.entrustee.name+"("+p+")",I=document.createElement("div"),v=$(I),A=document.createElement("div"),y=$(A),P=(v.addClass("entrust_current_user"),y.addClass("entrust_current_user_attention"),document.createElement("i")),S=($(P).addClass("i-icon-user-secret").addClass("entrust_mark"),document.createElement("span"));if($(S).html(e.entrusted?$$.lt("entrust.tip.entrust",c):$$.lt("entrust.tip.debug",c)),v.append(P).append(S),null!=t&&(S=document.createElement("span"),$(S).text("("+t.msg+")").addClass("entrust_error"),v.append(S)),y.html($$.lt("entrust.attention",c,p)),0<C.length){for(a({entruster:e.entruster,entrusted:e.entrusted,from:e.from,to:e.to,tip:e.entrusted?$$.lt("entrust.current.entrust"):$$.lt("entrust.current.debug")}),!1===e.released&&r(),_=0,E=C.length;_<E;_++)a(C[_]);$(h).text($$.lt("entrust.continueDo")+$$.lt("entrust.choose"))}else!1===e.released?(a({entruster:e.entruster,entrusted:e.entrusted,from:e.from,to:e.to,tip:e.entrusted?$$.lt("entrust.current.entrust"):$$.lt("entrust.current.debug")}),r(),$(h).text($$.lt("entrust.continueDo")+$$.lt("entrust.choose"))):$(h).text($$.lt("entrust.continueDo"));u.append(I).append(A)}else if(0<C.length){for(a({entruster:e.entrustee,entrusted:!1,tip:$$.lt("entrust.current.login")}),!1===e.released&&r(),_=0,E=C.length;_<E;_++)a(C[_]);P=document.createElement("i"),$(P).addClass("i-icon-user-secret").addClass("entrust_mark");var D=document.createElement("span");$(D).text($$.lt("entrust.support")+$$.lt("entrust.continueDo")+$$.lt("entrust.choose")),$(h).append(P).append(D)}else!1===e.released?(a({entruster:e.entrustee,entrusted:!1,tip:$$.lt("entrust.current.login")}),r(),P=document.createElement("i"),$(P).addClass("i-icon-user-secret").addClass("entrust_mark"),D=document.createElement("span"),$(D).text($$.lt("entrust.support")+$$.lt("entrust.continueDo")+$$.lt("entrust.choose")),$(h).append(P).append(D)):f.text($$.lt("entrust.noUser"));var b,O,t=f.find("input[type=radio]");0<t.length&&(t.first().attr("checked","true"),t.click(function(){var e=$(this).data("account");e===g||e===m?($$.MOBILE?b:O).changeButton(0,{name:$$.lt("entrust.continueButton")}):($$.MOBILE?b:O).changeButton(0,{name:$$.lt("entrust.switchButton")})})),u.append(d).addClass("entrust_choose"),($$.MOBILE?b=new InfoPlus.Render.Mobile.Page({isDoAction:!0,omitReturn:!0,content:l,buttons:n}):O=new InfoPlus.Render.Dialog({content:l,maxWidth:600,buttons:n})).show()},x.mobileDebug=function(e){var t,n,i="mobileDebugDiv",a=$("#"+i);0===a.length&&(t=document.createElement("div"),$(t).attr("style","position:fixed;top:40px;right:0;font-size:2rem;color:red").text("clear").click(function(){n.innerHTML=""}),$(document.body).append(t),n=document.createElement("div"),(a=$(n)).css("position","fixed").css("top","0").attr("id",i),$(document.body).append(n)),a.html(a[0].innerHTML+"<br>"+e)},x.showBackIcon=function(){var e;return!$IU.isEmptyStr($$.params.back)&&(!$IU.isPositiveInt($$.params.back)||((e=parseInt($$.params.back,10))<R.history.length&&($$.params.nowHistory=R.history.length),e<R.history.length))},x.compareInitData=function(e){var t;null!=e&&$$.params.sameStepHistoryList&&(e=$IU.convertData($$.params.sameStepHistoryList[e].data),t=$IU.convertData($$.params.formRender.save({})),new InfoPlus.Comparer(e,t).compare())},x.isDynamicActionCallWithParams=function(n,e){if(function(){for(var e=["dataSource","readOnly"],t=0;t<e.length;t++)if(n===e[t])return!0;return!1}()&&(e=x.trimString(e),$IU.beginWith(e,"("))&&$IU.endWith(e,")"))for(var t=[0],i=1,a=e.length;i<a;i++){var r=e[i];if("("===r)t.push(i);else if(")"===r&&(t.pop(),0===t.length))return i===a-1}return!1},x.dynamicShowElement=function(e,t){e.show(t).removeAttr(x.DYNAMIC_INVISIBLE_ATTRIBUTE)},x.dynamicHideElement=function(e){e.hide().attr(x.DYNAMIC_INVISIBLE_ATTRIBUTE,"true")},x.isDynamicInvisible=function(e){return"true"===e.attr(x.DYNAMIC_INVISIBLE_ATTRIBUTE)},define("InfoPlus.Utilities",x),R.$IU=x,R.checkRenderFormFields=function(e,t,n,i){e=e[0];if("none"!==e.style.display&&"hidden"!==e.type){var a=$(e),r=a.data($Control.DATA_VALIDATOR_PROMPT_POSITION),r=(r!==w&&(i.promptPosition=r),(a=null!=a.data($Control.DATA_ORIGIN_INPUT)?$(a.data($Control.DATA_ORIGIN_INPUT)):a).data($Control.DATA_VALIDATOR));if(r){var o=a.data($Control.DATA_CONTROL_OBJECT);if(null!=o&&!0!==o.onSuggestPage&&o.isWritable()&&!o.isDynamicReadonly()){var e=a.hasClass("infoplus_richTextControl")?CKEDITOR.instances[e.id+"_text"].getData():"checkbox"===e.type?e.checked:a.hasClass("hasCleaveFormat")?a.val().replace(/,/g,""):a.val(),s=w;if(r.required&&(s=InfoPlus.Utilities.checkFieldEmpty(a,i)),(r.required||!r.required&&""!==e)&&r.regEx){try{var l=new RegExp(r.regEx)}catch(e){var a=o.field.name;return $$.log("invalid reg("+a+"):"+r.regEx),w}l.test(e)||(a=null!=r.prompt&&""!==r.prompt?r.prompt:i.allrules.formatError.alertText,s!==w?s+="<br/>"+a:s=a)}if(null!=r.dynamics&&0<r.dynamics.length){var u=$$.dynamics.validations[o.getDynamicKeyName()];if($IU.isArray(u))for(var d=o.dynamicProcessor.getControlContext(o),c=0,h=u.length;c<h;c++){var p=u[c],f=new InfoPlus.Dynamics.Parser.Compile(p.conditionAsts);!0!==p.ignoreCondition&&!0!==f.evaluate(d)||null!=(p=(f=new InfoPlus.Dynamics.Parser.Compile(p.tipAsts)).evaluate(d))&&""!==p&&(s!==w?s+="<br/>"+p:s=p)}}return s}}}}}(window),function(){function e(){Array.call(this,arguments)}(e.prototype=new Array).numberQuickSort=function(){return function e(t,n,i){if(n<i){for(var a=t[parseInt((n+i)/2)],r=n-1,o=i+1;;){for(;t[++r].value<a.value;);for(;t[--o].value>a.value;);if(o<=r)break;var s=t[r];t[r]=t[o],t[o]=s}e(t,n,r-1),e(t,o+1,i)}}(this,0,this.length-1)},define("InfoPlus.QuickSortArray",e)}(window),window,$$.timezone={time:"","UTC-12:00":"","UTC-11:00":"-11","UTC-10:00":"","UTC-9:00":"","UTC-8:00":"","UTC-7:00":"","UTC-6:00":"","UTC-5:00":"","UTC-4:30":"","UTC-4:00":"","UTC-3:30":"","UTC-3:00":"","UTC-2:00":"-02","UTC-1:00":"",UTC:"","UTC+1:00":"","UTC+2:00":"","UTC+3:00":"","UTC+3:30":"","UTC+4:00":"","UTC+4:30":"","UTC+5:00":"","UTC+5:30":"","UTC+5:45":"","UTC+6:00":"","UTC+6:30":"","UTC+7:00":"","UTC+8:00":"","UTC+8:30":"","UTC+9:00":"","UTC+9:30":"","UTC+10:00":"","UTC+11:00":"","UTC+12:00":"","UTC+13:00":"","UTC+14:00":""},function(o){function s(e){this.options=$.extend({},s.DEFAULT_OPTIONS,e),!0===$$.MOBILE&&(this.options.position=this.options.position+" bottom"),this.init(this.options),this.strategy=new InfoPlus.Tip.Strategy}function e(){}s.CLASSNAME_TIP="infoplus_tip",s.CLASSNAME_CLOSE="infoplus_tip_close",s.DEFAULT_OPTIONS={color:"#FFFFFF",type:"info",text:"",position:"left",hideClose:!1,autoClose:!1,unique:!1},s.SPACE_HEIGHT=8,s.prototype={options:{},element:null,getMinTop:function(){var e=$("body"),t=$(o).height(),n=t,i=null,a=0,r=0;return e.children("."+s.CLASSNAME_TIP+"."+this.options.position).each(function(){var e=parseFloat($(this).css("top"));e<n&&(n=e,i=$(this)),a++,r+=$(this).outerHeight()+s.SPACE_HEIGHT}),null!=i&&i.css("z-index",2),n=0<a&&t-r<n?t-r:n},render:function(){var e,t=this.options,n=(!0===t.unique&&$("."+s.CLASSNAME_TIP).remove(),document.createElement("div")),i=$(n),a=$("body"),r=this.getMinTop(),o=(null!=t.content?(i.append(t.content).addClass("custom"),!0===t.hideClose&&i.addClass("noCloseButton")):i.html(t.text).addClass(t.type+"_tip"),i.css("top",r).addClass(s.CLASSNAME_TIP).addClass(t.position).addClass("z-depth-1"),null!=t.width&&i.css("width",t.width+"px"),null!=t.maxWidth&&i.css("max-width",maxWidth+"px"),null!=t.minWidth&&i.css("min-width",t.minWidth+"px"),null!=t.color&&i.css("color",t.color),null!=t.backgroundColor&&i.css("background-color",t.backgroundColor),$$.MOBILE,!0!==t.hideClose&&(e=document.createElement("i"),$(e).addClass("i-icon-close2").addClass(s.CLASSNAME_CLOSE).data("position",t.position),i.append(e)),a.append(n),this);return setTimeout(function(){var e=i.outerHeight();i.css("top",r-e-s.SPACE_HEIGHT),void 0!==o.strategy&&o.strategy.adjustTop(i),!0===t.autoClose&&setTimeout(function(){o.hide()},2e3)},0),n},init:function(){this.element=this.render(),this.initEvents()},initEvents:function(){var e=this;$(this.element).children("."+s.CLASSNAME_CLOSE).click(function(){return e.hide(),!1})},remove:function(){var t=-1!==this.options.position.indexOf("bottom")?parseFloat($(this.element).data("oldTop")):parseFloat($(this.element).css("top")),n=$(this.element).outerHeight()+s.SPACE_HEIGHT;$(this.element).siblings("."+s.CLASSNAME_TIP+"."+this.options.position).each(function(){var e=parseFloat($(this).css("top"));e<t&&$(this).css("top",e+n+"px")}),$(this.element).remove()},hide:function(){var e=this,t=$(this.element),n=$IU.getTransitionEndEventName();if(null!=n){var i=this.options.position.split(" ");if(0<i.length)switch(i[i.length-1]){case"left":t.css("left","-"+t.outerWidth()+"px");break;case"right":t.css("right","-"+t.outerWidth()+"px");break;case"bottom":t.data("oldTop",t.css("top")),t.css("top",$(o).height()+"px")}t.one(n,function(){e.remove()})}else this.remove()}},define("InfoPlus.Tip",s);e.prototype={adjustTop:function(){}},define("InfoPlus.Tip.Strategy",e)}(window),function(h){function g(){this.init()}function C(e,t,n,i){e=T(e,t,i),t=document.createElement("span"),$(t).addClass("debug_content_null").text(n),e.append(t)}function _(e){var t=document.createElement("div"),n=document.createElement("i");$(n).addClass("i-icon-triangle-right"),$(t).append(n).addClass("arrowDiv").data("expand",!1),e.append(t),e.children(".debug_content_name").addClass("expandable"),e.children(".debug_content_value").addClass("expandable")}function E(e,t,n,i,a){if(null!=i&&e.css("padding-left",i+"px"),$IU.isObject(n)){var r,i=T(e,t,a),o=document.createElement("span"),o=($(o).text("Object").addClass("debug_content_value"),i.append(o).addClass("object"),document.createElement("div")),s=$(o),l=(i.append(s),[]);for(r in n)n.hasOwnProperty(r)&&l.push(r);for(l.sort(),f=0,m=l.length;f<m;f++)E(s,r=l[f],n[r],g.CONTENT_PADDING,!1);s.addClass("innerDiv").hide(),_(i)}else{var u,d,c;if(null===n)C(e,t,"null",a);else if(void 0===n)C(e,t,"undefined",a);else if($IU.isString(n))o=n,i=T(i=e,u=t,a),u=document.createElement("span"),$(u).addClass("debug_content_string").text('"'+o+'"'),i.append(u);else if($IU.isBoolean(n))i=n,u=T(u=e,d=t,a),d=document.createElement("span"),$(d).addClass("debug_content_boolean").text(i),u.append(d);else if($IU.isNumberExactly(n))i=n,d=T(d=e,c=t,a),c=document.createElement("span"),$(c).addClass("debug_content_number").text(i),d.append(c);else if($IU.isDate(n))i=n,c=T(c=e,h=t,a),h=document.createElement("span"),$(h).addClass("debug_content_date").text($IU.dateFormat(i,"yyyy-MM-dd hh:mm:ss.S")),c.append(h);else if($IU.isArray(n)){var i=T(e,t,a),h=document.createElement("span"),a=($(h).text("Array["+n.length+"]").addClass("debug_content_value"),i.append(h).addClass("array"),document.createElement("div")),p=$(a);i.append(a);for(var f=0,m=n.length;f<m;f++)E(p,f+"",n[f],g.CONTENT_PADDING,!1);p.addClass("innerDiv").hide(),_(i)}else{a=e,i=t,t=n;a=T(e,i,void 0),i=document.createElement("span"),$(i).addClass("debug_content_normal").text(t),a.append(i)}}}g.CLASSNAME_CONSOLE="infoplus_debugConsole",g.CLASSNAME_TITLE="infoplus_debugConsole_title",g.CLASSNAME_COMMAND="infoplus_debugConsole_command",g.CLASSNAME_CONTROL="infoplus_debugConsole_control",g.CLASSNAME_CLOSE="infoplus_debugConsole_close",g.CLASSNAME_TO_RIGHT="infoplus_debugConsole_toRight",g.CLASSNAME_TO_BOTTOM="infoplus_debugConsole_toBottom",g.CLASSNAME_TITLE="infoplus_debugConsole_title",g.CLASSNAME_CONTENT="infoplus_debugConsole_content",g.CLASSNAME_CONTENT_OUTER="infoplus_debugConsole_content_outer",g.CLASSNAME_CONTENT_INNER="infoplus_debugConsole_content_inner",g.CLASSNAME_COMMAND_BAR="infoplus_debugConsole_command_bar",g.CONTENT_PADDING=20,g.CONTENT_MAX_LINE_COUNT=100;var T=function(e,t,n){var i=document.createElement("div"),a=document.createElement("span"),t=($(a).addClass("debug_content_name").text(t),!0===n&&$(a).addClass("firstLevel"),document.createElement("span"));return $(t).addClass("debug_content_colon").text(": "),$(i).append(a).append(t).addClass("line"),e.append(i),$(i)};g.prototype={element:null,createCommand:function(e,t){var n=document.createElement("li");return $(n).addClass(g.CLASSNAME_COMMAND).addClass("round-corner").text(e).click(t),n},createMockSelect2:function(){var e=document.createElement("li"),t=$(e),n=(t.addClass(g.CLASSNAME_CONTROL),document.createElement("select"));return $(n).attr("id","mockUser").addClass(g.CLASSNAME_CONTROL).css("width","100%"),t.append(n),$(n).select2({dropdownAutoWidth:"true",dropdownCssClass:"infoplus_debugConsole_dropdown",placeholder:"",ajax:{url:$$.params.uriUsers,dataType:"json",type:"POST",delay:250,data:function(e){return{prefix:e.term,type:"User",code:"",parent:"",isTopLevel:!0,pageNo:0,settings:"{}",stepId:$$.params.formStepId,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content")}},processResults:function(e,t){if(void 0!==e.errno)return console.log(e),{results:[{id:e.errno,name:e.ecode,text:e.error}]};for(var n=e.items,i=0,a=n.length,r=[];i<a;i++){var o=n[i];r.push({id:o.codeId,name:$IU.trimString(o.codeName)||"",text:($IU.trimString(o.codeName)||"")+"("+o.codeId+")",item:o})}return{results:r}}},language:{errorLoading:function(){return $$.lt("suggester2.errorLoading")},noResults:function(){return $$.lt("suggester2.noResult")}},escapeMarkup:function(e){return e},minimumInputLength:2}),e},changeContentTop:function(){var e=$(this.element),t=e.find("."+g.CLASSNAME_TITLE);e.find("."+g.CLASSNAME_CONTENT_OUTER).css("top",t.outerHeight()+"px")},addContent:function(e,t){var n=$(this.element),i=n.find("."+g.CLASSNAME_CONTENT),a=n.find("."+g.CLASSNAME_CONTENT_INNER),n=n.find("."+g.CLASSNAME_CONTENT_OUTER),r=i.children(".line");r.length>g.CONTENT_MAX_LINE_COUNT&&$(r[0]).remove(),E(i,e,t,null,!0),a.scrollTop(i.height()-n.height()-parseInt(a.css("top"),10))},clearContent:function(){$(this.element).find("."+g.CLASSNAME_CONTENT).children(".line").remove()},render:function(){var e=document.createElement("div"),t=$(e),n=$("body"),i=(t.addClass(g.CLASSNAME_CONSOLE).addClass("z-depth-1"),document.createElement("div")),a=$(i),r=document.createElement("ul"),o=$(r),s=(o.addClass(g.CLASSNAME_COMMAND_BAR),document.createElement("i")),l=($(s).addClass("i-icon-close2").addClass(g.CLASSNAME_CLOSE).attr("title",""),document.createElement("i")),u=($(l).addClass("i-icon-keyboard-tab").addClass(g.CLASSNAME_TO_RIGHT).attr("title",""),document.createElement("i")),d=($(u).addClass("i-icon-vertical-align-bottom").addClass(g.CLASSNAME_TO_BOTTOM).attr("title",""),this),o=(o.append(this.createCommand("",function(){var e=$$.entity;return d.addContent("",{app:e.app,step:e.step,actions:e.actions,permission:e.permission,fields:e.fields,groups:e.groups}),!1})).append(this.createCommand("",function(){return d.addContent("",$IU.convertData($$.entity.data)),!1})).append(this.createCommand("",function(){return d.addContent("",$IU.convertData(transformer.render.save({}))),!1})).append(this.createCommand("",function(){var e,t={};for(e in $$.params)$$.params.hasOwnProperty(e)&&"formRender"!==e&&"renderForm"!==e&&(t[e]=$$.params[e]);return d.addContent("",t),!1})).append(this.createCommand("",function(){var e={"":$$.params.entrusts.entrustee.name};return null!=$$.params.entrusts.entruster?e[""]=$$.params.entrusts.entruster.name+($$.params.entrusts.entrusted?"()":"()"):e[""]=$$.params.entrusts.entrustee.name,d.addContent("",e),!1})).append(this.createCommand("",function(){return d.clearContent(),!1})).append(this.createMockSelect2()).append(this.createCommand("",function(){var e,t=$("#mockUser").select2("data");return 0<t.length&&(e=t[0].id,t=t[0].name,null!=e)&&""!==e&&$IU.confirmBox(""+t+"("+e+")<br>","",$$.lt("common.ok"),400,function(){$$.blockUI({message:"..."}),$$.ajax({type:"POST",url:$$.params.uriEntrust,data:{entrustee:e,entrusted:!1,app:$$.entity.app.id},requestMsg:"",errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){h.location.reload()})}),!1})).append(this.createCommand("",function(){return $IU.confirmBox("<br>","",$$.lt("common.ok"),400,function(){$$.blockUI({message:"..."}),$$.ajax({type:"POST",url:$$.params.uriEntrust,data:{entrusted:!1,app:$$.entity.app.id},requestMsg:"",errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){h.location.reload()})}),!1})),a.append(r).append(s).append(l).append(u).addClass(g.CLASSNAME_TITLE),document.createElement("div")),a=document.createElement("div"),r=document.createElement("div");return $(r).addClass(g.CLASSNAME_CONTENT),$(o).append(a).addClass(g.CLASSNAME_CONTENT_OUTER),$(a).append(r).addClass(g.CLASSNAME_CONTENT_INNER).css("width","calc(100% + 10px)").css("height","calc(100% + 45px)"),t.append(i).append(o),n.append(e),setTimeout(function(){d.changeContentTop()},500),t.css("left","20px").css("top","100px").css("width","400px").css("height","400px"),e},init:function(){this.element=this.render(),this.initEvents()},initEvents:function(){var c=this,n=$(this.element),e=n.find("."+g.CLASSNAME_CLOSE),t=n.find("."+g.CLASSNAME_TO_RIGHT),i=n.find("."+g.CLASSNAME_TO_BOTTOM),r=n.find("."+g.CLASSNAME_TITLE);e.click(function(){n.hide()}),t.click(function(){var e=0,t=$("#header_holder");0<t.length&&(e=parseInt(t.css("top"),10)+t.height()+3),n.css("top",e+"px"),n.css("left",$(h).width()-parseInt(n.css("min-width"),10)+"px"),n.css("width",n.css("min-width")),n.css("height",$(h).height()-e-3+"px"),c.changeContentTop()}),i.click(function(){n.css("top",$(h).height()-parseInt(n.css("min-height"),10)+"px"),n.css("height",n.css("min-height")),n.css("left","0px"),n.css("width",$(h).width()+"px"),c.changeContentTop()}),r.mousedown(function(e){var t,n,i,a;return!$(e.srcElement).hasClass(g.CLASSNAME_COMMAND)&&(!!$(e.srcElement).hasClass(g.CLASSNAME_CONTROL)||("top"!==(t=r.parent()).data("resize")?(n=r.offset(),i=e.pageX-n.left,a=e.pageY-n.top,$(document).on("mousemove.drag",function(e){t.offset({top:e.pageY-a,left:e.pageX-i})}),!1):void 0))}),r.mouseup(function(e){$(document).off("mousemove.drag");var t=$(this).parent();null!=t.data("resize")&&(t.removeData("resize"),$(document).off("mousemove.drag"))}),n.mousemove(function(e){var t=$(this),n=t.offset().left,i=t.offset().top;return e.pageX-n<5?(t.data("resize","left"),t.css("cursor","w-resize"),!1):t.outerWidth()-(e.pageX-n)<5?(t.data("resize","right"),t.css("cursor","e-resize"),!1):e.pageY-i<5?(t.data("resize","top"),t.css("cursor","n-resize"),!1):t.outerHeight()-(e.pageY-i)<5?(t.data("resize","bottom"),t.css("cursor","s-resize"),!1):void("default"!==t.css("cursor")&&0===e.which&&(t.removeData("resize"),t.css("cursor","default")))}),n.mousedown(function(e){var a=$(this),t=a.offset(),r=a.height(),o=a.width(),s=e.pageX,l=e.pageY,u=e.pageX-t.left,d=e.pageY-t.top;null!=a.data("resize")&&$(document).on("mousemove.drag",function(e){switch(a.data("resize")){case"left":var t=a.offset().left,n=e.pageX-u,t=a.width()+t-n;t>parseInt(a.css("min-width"),10)&&(a.offset({left:n}),a.width(t),c.changeContentTop());break;case"right":(t=o+e.pageX-s)>parseInt(a.css("min-width"),10)&&(a.width(t),c.changeContentTop());break;case"top":var n=a.offset().top,t=e.pageY-d,i=a.height()+n-t;i>parseInt(a.css("min-height"),10)&&(a.offset({top:t}),a.height(i));break;case"bottom":(i=r+e.pageY-l)>parseInt(a.css("min-height"),10)&&a.height(i)}})}),n.mouseup(function(e){var t=$(this);null!=t.data("resize")&&(t.removeData("resize"),$(document).off("mousemove.drag"))}),n.on("click",".arrowDiv",function(){var e=$(this);!1===e.data("expand")?(e.siblings(".innerDiv").show(),e.data("expand",!0),e.children("i").removeClass("i-icon-triangle-right").addClass("i-icon-triangle-down")):(e.siblings(".innerDiv").hide(),e.data("expand",!1),e.children("i").removeClass("i-icon-triangle-down").addClass("i-icon-triangle-right"))}),n.on("click",".expandable",function(){$(this).siblings(".arrowDiv").click()})}},define("InfoPlus.DebugConsole",g)}(window),function(){function c(e,t){this.oldData=e,this.newData=t}function _(e){var t,n=$$.entity.groups;for(t in n)if(n.hasOwnProperty(t)&&t===e)return 1}function E(e,t){return e=$IU.isBoolean(e)?e:e||"","User"===t||"Organize"===t||"Code"===t||"Thing"===t?""===(e.value||""):""===e}function T(e,t,n,i){for(var a in t)if(t.hasOwnProperty(a)){var r=function(e){var t,n=$$.entity.fields;for(t in n)if(n.hasOwnProperty(t)&&t===e)return n[t];return null}(a);if(null!=r){var o=t[a],s=e[a],r=r.type;if(f=o,m=s,g=r,C=void 0,f=$IU.isBoolean(f)?f:f||"",m=$IU.isBoolean(m)?m:m||"",!("User"===g||"Organize"===g||"Code"===g||"Thing"===g?(f.value||"")===(m.value||""):"File"===g?""===(f||"")&&""===(m||"")||(g=$.parseJSON(f),C=$.parseJSON(m),null!=g&&null!=C&&g.id===C.id):f===m)){g=function(e,t){switch(t){case"User":case"Organize":case"Code":case"Thing":return null!=e&&null!=e.name?e.name:"";case"string":case"anyURI":return e||"";case"File":var n=$.parseJSON(e);return null!=n?n.name:"";case"integer":case"double":return(e||"")+"";case"boolean":return!1===e?"false":e||"";case"date":return $IU.unixTimeToDateString(e)||"";case"XHTML":return e||"";case"time":return $IU.unixTimeToTimeString(e)||"";case"dateTime":break;default:return e||""}}(s,r);if(E(s,r)&&!E(o,r)){i[a]={value:g,type:"new",path:n};continue}if(!E(s,r)&&E(o,r)){i[a]={value:g,type:"delete",path:n};continue}i[a]={value:g,type:"modify",path:n}}}if(_(a)){var l=t[a],u=e[a];if(null!=u&&$IU.isArray(u)){i[a]={rows:[],path:n};var d=(l.length>u.length?u:l).length;u.length>l.length?i[a].deleteRows=u.length-l.length:u.length<l.length&&(i[a].newRowIndex=u.length);for(var c=0;c<d;c++){var h=n+"_"+c,p=i[a].rows[c]={};T(u[c],l[c],h,p)}}else i[a]={newRowIndex:0,rows:[],path:n}}}var f,m,g,C;for(a in e)e.hasOwnProperty(a)&&_(a)&&(l=t[a],u=e[a],null==l)&&null!=u&&0<u.length&&(i[a]={rows:[],path:n,deleteRows:u.length})}c.clearAll=function(e){InfoPlus.Render.PopTip.clear(e);var t=$(".detailCell");t.children().removeData("diffs"),null!=$$.params.diffHelper&&($$.params.diffHelper.hide(e),$$.params.diffHelper=null),t.parent().removeData("detailModified")};c.prototype={oldData:{},newData:{},compare:function(){var e={};T(this.oldData,this.newData,"",e),this.showDiff(e),this.createCompareHelper(0<$(".popTip").not(".remarkTip").length)},showDiff:function(e){function t(e){return function(){e.removeClass("modified")}}var n,i={new:"infoTip",modify:"warningTip",delete:"errorTip"},a=$IU.mobileExpandAllViews();for(n in e)if(e.hasOwnProperty(n)){var r=e[n];if(null!=r.rows){var o=$$("&"+n).filter({path:r.path});if(0<o.length){var s=o[0].control,o=s.repeatParentElement;if($(o).is(":visible")){if(null!=r.deleteRows&&0<r.deleteRows&&(new InfoPlus.Render.PopTip({popper:o,text:0===r.rows.length?$$.lt("compare.compareType.typeDeleteAll"):$$.lt("compare.compareType.typeDeleteRows",r.deleteRows),colorClass:"errorTip",placement:"top",onClose:t(s)}),s.setClass("modified")),null!=r.newRowIndex&&0<=r.newRowIndex)for(var l=s.getRepeatChildren(),u=r.newRowIndex,d=l.length;u<d;u++){new InfoPlus.Render.PopTip({popper:l[u],text:s.isRepeatTable()?$$.lt("compare.compareType.typeNewRow"):$$.lt("compare.compareType.typeNewSection"),colorClass:"infoTip",placement:"top",onClose:t(s)});var c=s.getRepeatChildren();u<c.length&&$(c[u]).addClass("modified")}for(u=0,d=r.rows.length;u<d;u++)this.showDiff(r.rows[u])}}}else{var h=$$("&"+n).filter({path:r.path});if(0<h.length)for(u=0,d=h.length;u<d;u++){var p,f=h[u].control,m=$(f.element).parents(".detailCell");if("BoundCheckList"===f.controlType&&null!=f.field.code){var g=$$.entity.codes;if(null!=g&&null!=g[f.field.code]){var C=g[f.field.code].items;if(null!=r.value){for(var _="",E=r.value.split(","),T=0,I=E.length;T<I;T++)_+=function(e,t){for(var n=0,i=e.length;n<i;n++)if(t===e[n].codeId)return e[n].codeName;return t}(C,E[T])+(T===I-1?"":",");r.value=_}}}if("BoundOption"===f.controlType&&null!=r.value&&(r.value=function(e,t){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(1===a.nodeType&&"input"===a.nodeName.toLocaleLowerCase()&&a.value===t&&n+1<i){a=e[n+1];if(3===a.nodeType)return a.nodeValue}}return t}($(f.element).parent()[0].childNodes,r.value)),0<m.size()?((p=null==(p=(g=m.children()).data("diffs"))?[]:p).push({control:f,diff:r}),g.data("diffs",p),0===u&&(m=(p=m.parent()).parents(".infoplus_repeatParentElement").first().data("repeatControl"),!0!==p.data("detailModified"))&&(p.data("detailModified",!0),new InfoPlus.Render.PopTip({popper:p[0],text:$$.lt("compare.compareType.typeDetail"),colorClass:"warningTip",placement:"top-right",onClick:function(e,t){return function(){return null!=e&&(e.showDetail(t),!0)}}(m,p[0])}))):(null!=f.controlContainer&&$(f.controlContainer).is(":visible")||$(f.element).is(":visible"))&&(m=null,"delete"!==r.type&&"modify"!==r.type||(m=""===r.value?$$.lt("compare.previousValue.empty"):$$.lt("compare.previousValue.previous")+r.value),new InfoPlus.Render.PopTip({popper:f.controlContainer||f.element,text:$$.lt("compare.compareType.type"+r.type.substr(0,1).toUpperCase()+r.type.substr(1)),hoverText:m,colorClass:i[r.type],placement:"top-left",onClose:function(e){return function(){e.clearModified()}}(f)}),f.markModified()),0===u&&"BoundOption"===f.controlType)break}}}$IU.mobileShrinkViewsWithNoTips(a)},createCompareHelper:function(e){var t,n,i=document.createElement("div"),a=$(i),r=document.createElement("span"),o=$(r),s=document.createElement("i"),l=$(s),u=(e?(t=document.createElement("a"),e=document.createTextNode($$.lt("compare.compared")),n=document.createTextNode($$.lt("compare.removeTips")),$(t).text($$.lt("compare.clickHereToRemove")).css("font-weight","bold").css("margin","0 2px 0 0").css("cursor","pointer"),o.append(e).append(t).append(n),setTimeout(function(){var t=null;$("#div_render_container").children("div.popTip").each(function(){var e=parseInt($(this).css("top"),10);isNaN(e)||(null==t||e<t)&&(t=e)}),null!=t&&60<t&&($IU.scrollTo(t-60,500),setTimeout(function(){$(".popTip").effect("bounce",{},150)},500))},1e3)):$(r).text($$.lt("compare.same")),l.addClass("i-icon-close2 infoplus_tip_close").attr("title",$$.lt("entrust.close")),a.append(r).append(s),new InfoPlus.Render.CommandBarHelper({content:i,position:"top",backgroundColor:"#fff9c4"})),d=$("#form_command_bar");(0<d.length?d:$(document.body)).append(u.element),$(t).click(function(){return c.clearAll(),!1}),$(s).click(function(){return c.clearAll(),!1}),setTimeout(function(){u.show(0===d.length)},500),$$.params.diffHelper=u}},define("InfoPlus.Comparer",c)}(window),function(b){function e(e){this.options=e,this.init()}function t(){function e(e,t){return e-t}function n(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return;e.push(t)}$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t;$(this).is(":visible")&&(null==(e=$(this).data($Control.DATA_CONTROL_OBJECT))&&(t=$(this).data($Control.DATA_ORIGIN_INPUT),e=$(t).data($Control.DATA_CONTROL_OBJECT)),null!=e)&&null!=(t=e.getPosition())&&(C.push({control:e,position:t}),n(_,Math.ceil(t.left)),n(_,Math.floor(t.left+t.width)),n(E,Math.ceil(t.top)),n(E,Math.floor(t.top+t.height)))}),C.sort(function(e,t){return e.position.top-t.position.top}),_.unshift(0),_.push(document.body.scrollWidth),E.unshift(0),E.push(document.body.scrollHeight),_.sort(e),E.sort(e)}function n(){function e(t,e){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(function(e){e=e.position;return t.x2>Math.ceil(e.left)&&t.x1<Math.floor(e.left+e.width)}(a))return a.control}return null}for(var t=1,n=E.length;t<n;t++){var i=E[t-1],a=E[t],r=function(e,t,n){for(var i=[],a=0,r=n.length;a<r;a++){var o=n[a].position;if(!(t>Math.ceil(o.top)))break;e<Math.floor(o.top+o.height)&&i.push(n[a])}return i}(i,a,C),o=[];if(0===r.length)o.push({rect:{x1:0,y1:i,x2:_[_.length-1],y2:a}});else for(var s=1,l=_.length;s<l;s++){var u,d={x1:_[s-1],y1:i,x2:_[s],y2:a},c=e(d,r);0<o.length?null==(u=o[o.length-1]).control?null==c?(u.rect.x2=d.x2,u.rect.y2=d.y2):o.push({rect:d,control:c}):null!=c&&u.control.field.name===c.field.name?(u.rect.x2=d.x2,u.rect.y2=d.y2):o.push({rect:d,control:c}):o.push({rect:d,control:c})}O.push(o)}for(var h=O.length-1;0<h;h--){for(var p=O[h],f=O[h-1],m=[],$=0;$<p.length;$++){var g=p[$];!function(e,t){for(var n=0,i=t.length;n<i;n++){var a=t[n];if(e.rect.x1===a.rect.x1&&e.rect.x2===a.rect.x2&&e.rect.y1===a.rect.y2)return a.rect.y2=e.rect.y2,!0}return!1}(g,f)&&m.push(g)}O[h]=m}}var C=[],O=[],_=[],E=[];e.prototype={init:function(){InfoPlus.Render.PopTip.clear(!0,!0),t(),n()},renderRemarkDiv:function(){function t(e,t,n){var i=document.createElement("div"),a=$(i),r=document.createElement("div"),o=$(r),s=(o.attr("contenteditable","true").addClass("memo_input_div"),null!=n&&o.html(n.html),a.append(r),new InfoPlus.Render.PopTip({popper:t,container:e,content:i,colorClass:"remarkTip",placement:"top",location:"bottom",onMaximized:function(){l.showMenuItems(["minimize","remove"])}})),l=new InfoPlus.Render.PopMenu({container:s.element,items:[{id:"maximize",text:$$.lt("review.menu.maximize"),iconClass:"i-icon-triangle-up",initVisible:!1,switchItems:["minimize","remove"],click:function(){d(),s.maximize(function(){u()}),l.show()}},{id:"minimize",text:$$.lt("review.menu.minimize"),iconClass:"i-icon-triangle-down",switchItems:["maximize"],click:function(){d(),s.minimize(function(){u()})}},{id:"remove",text:$$.lt("review.menu.remove"),iconClass:"i-icon-delete",click:function(){s.close(),$(t).removeData("memoContentDiv")}}]});null==n&&o.focus(),$(t).data("memoContentDiv",r)}for(var e,n=this.options,i=n.data,a=function(){y=0;o.find(".popTip.remarkTip").each(function(){0;var e=$(this).find(".memo_input_div");0<e.length&&""!==$IU.trimString(e[0].innerText)&&y++}),y!==I.data("count")&&(0<y?I.html($$.lt("review.tipCount",y,1<y?"s":"")):I.text($$.lt("review.tip")),E.css("left","0").css("margin-left","-"+E.outerWidth()/2+"px").css("left",""),I.data("count",y))},u=function(){e=setInterval(a,100)},d=function(){clearInterval(e)},r=document.createElement("div"),o=$(r),s=(this.maskDiv=r,o.attr("id","memo_mask_div"),0),l=O.length;s<l;s++)for(var c=O[s],h=0,p=c.length;h<p;h++){var f,m=c[h],g=document.createElement("div"),C=$(g);null==m.control?C.addClass("memo_dark_block_div"):(C.addClass("memo_white_block_div"),f=document.createElement("div"),$(f).addClass("memo_white_inner_block_div"),C.append(f)),C.css("left",m.rect.x1+"px").css("top",m.rect.y1+"px").css("width",m.rect.x2-m.rect.x1+"px").css("height",m.rect.y2-m.rect.y1+"px").data("position",{left:m.rect.x1,top:m.rect.y1,width:m.rect.x2-m.rect.x1,height:m.rect.y2-m.rect.y1}).data($Control.DATA_CONTROL_OBJECT,m.control),o.append(g),0}o.on("click",".memo_white_block_div",function(e){if($(e.target).hasClass("memo_white_inner_block_div"))return null!=$(this).data("memoContentDiv")?$($(this).data("memoContentDiv")).focus():t(r,this),!1});var _=document.createElement("div"),E=$(_),T=(this.menuDiv=_,document.createElement("div")),I=$(T),v=document.createElement("div"),A=$(v),T=(I.text($$.lt("review.tip")),E.addClass("memo_input_menu round-corner z-depth-1").append(T).append(v),I.addClass("memo_input_tip"),document.createElement("a")),v=document.createElement("a");if($(T).attr("href","#").text($$.lt("review.cancel")).hide(),$(v).attr("href","#").text($$.lt("review.ok")).addClass("default"),A.addClass("memo_input_tool").append(T).append(v),o.append(_),$(document.body).append(r),$(v).click(function(){return clearInterval(e),n.onFinish(),!1}),$(T).click(function(){return clearInterval(e),n.onCancel(),!1}),I.data("count",0),null!=i&&0<i.length){for(var y=0,P=0,S=i.length;P<S;P++){var D=function(t,n){var i=null;return o.children(".memo_white_block_div").each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);e.field.name===t&&e.path===n&&(i=this)}),i}(i[P].field,i[P].path);null!=D&&(t(r,D,i[P]),y++)}0<y&&(I.html($$.lt("review.tipCount",y,1<y?"s":"")),I.data("count",y))}E.css("left","0").css("margin-left","-"+E.outerWidth()/2+"px").css("left",""),E.data("position",{"margin-top":"-"+($(b).height()/2-E.offset().top)+"px","margin-left":E.css("margin-left"),left:E.offset().left+"px",top:E.offset().top+"px",bottom:$(b).height()-E.offset().top-E.outerHeight()+"px",width:E.outerWidth()+"px",height:E.outerHeight()+"px"}),o.hide(),setTimeout(u,1e3)},getMenuDivPosition:function(e){for(var t=$(this.menuDiv).data("position"),n={},i=0,a=e.length;i<a;i++)t.hasOwnProperty(e[i])&&(n[e[i]]=t[e[i]]);return n},render:function(){this.renderRemarkDiv()},show:function(){$(this.maskDiv).show()},close:function(){C=[],O=[],_=[],E=[],$(this.maskDiv).empty().remove()}},define("InfoPlus.MemoMaker",e)}(window),function(){function s(e,t){var e=(e=+e)-.0065,t=(t=+t)-.006,n=Math.sqrt(e*e+t*t)-2e-5*Math.sin(t*i),t=Math.atan2(t,e)-3e-6*Math.cos(e*i);return[n*Math.cos(t),n*Math.sin(t)]}function l(e,t){var t=+t,e=+e,n=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*i),t=Math.atan2(t,e)+3e-6*Math.cos(e*i);return[n*Math.cos(t)+.0065,n*Math.sin(t)+.006]}function u(e,t){var n=2*(e=+e)-100+3*(t=+t)+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return(n+=2*(20*Math.sin(6*e*h)+20*Math.sin(2*e*h))/3)+2*(20*Math.sin(t*h)+40*Math.sin(t/3*h))/3+2*(160*Math.sin(t/12*h)+320*Math.sin(t*h/30))/3}function d(e,t){return t=300+(e=+e)+2*(t=+t)+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e)),(t+=2*(20*Math.sin(6*e*h)+20*Math.sin(2*e*h))/3)+2*(20*Math.sin(e*h)+40*Math.sin(e/3*h))/3+2*(150*Math.sin(e/12*h)+300*Math.sin(e/30*h))/3}function c(e,t){return t=+t,!(73.66<(e=+e)&&e<135.05&&3.86<t&&t<53.55)}var i=52.35987755982988,h=3.141592653589793,p=6378245,f=.006693421622965943;define("InfoPlus.CoordTransform",{bdtowgs:function(e,t){var n,i,a,r,o,e=s(e,t);return t=e[0],e=e[1],c(t=+t,e=+e)?[t,e]:(r=u(t-105,e-35),o=d(t-105,e-35),n=e/180*h,i=Math.sin(n),i=1-f*i*i,a=Math.sqrt(i),r=180*r/(p*(1-f)/(i*a)*h),[2*t-(t+(o=180*o/(p/a*Math.cos(n)*h))),2*e-(e+r)])},wgstobd:function(e,t){var n,i,a,r,o=c(e=+(e=e),t=+(t=t))?[e,t]:(a=u(e-105,t-35),r=d(e-105,t-35),n=t/180*h,o=Math.sin(n),o=1-f*o*o,i=Math.sqrt(o),a=180*a/(p*(1-f)/(o*i)*h),[e+(r=180*r/(p/i*Math.cos(n)*h)),t+a]);return l(o[0],o[1])},bdtogcj:s,gcjtobd:l})}(window),function(){function e(e,t,n,i,a,r,o,s,l,u){this.field=e,this.mode=o,this.tipFormat=s,this.type=a,this.code=r,this.data=n,this.text=i,this.dataElement=t,this.path=$(t).data($Control.DATA_PATH),this.suggestService=l||"",this.suggestMinimizeSize=this.type===$Control.DATA_TYPE_USER?2:0,this.type===$Control.DATA_TYPE_USER&&null!=e.settings&&!0===e.settings.userTraversal&&(this.suggestMinimizeSize=0),this.suggestInitializeService=u,this.clearFocusFlag(),this.createSuggester()}e.KEY_CODE_ENTER=13,e.KEY_CODE_BACKSPACE=8,e.KEY_CODE_ESC=27,e.KEY_CODE_PAGE_UP=33,e.KEY_CODE_PAGE_DOWN=34,e.KEY_CODE_UP=38,e.KEY_CODE_DOWN=40,e.KEY_CODE_DELETE=46,e.KEY_CODE_TAB=9,e.CLASSNAME_SUGGESTER_ITEM="infoplus_suggester_item",e.CLASSNAME_SUGGESTER_ITEM_SELECT="suggest_selected",e.CLASSNAME_SUGGESTER_ITEM_UNSELECT="suggest_unselected",e.CLASSNAME_SUGGESTER_DIV="suggest_div",e.CLASSNAME_SUGGESTER_LOADING="suggest_loading",e.CLASSNAME_SUGGESTER_FRAME_OUTER="suggest_frame_outer",e.CLASSNAME_SUGGESTER_FRAME_INNER="suggest_frame_inner",e.CLASSNAME_SUGGESTER_ACTIVE_DIV="active_div",e.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER="active_tip_container",e.CLASSNAME_SUGGESTER_BUTTON="suggest_button",e.CLASSNAME_SUGGESTER_ACTIVE_INPUT="active_input",e.CLASSNAME_SUGGESTER_ACTIVE_INPUT_GRAY="active_input_gray",e.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS="active_input_focus",e.CLASSNAME_SUGGESTER_MORE_ITEM="infoplus_suggester_item_more",e.CLASSNAME_SUGGESTER_MORE_USER="infoplus_suggester_user_more",e.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN="infoplus_suggester_item_more_down",e.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING="infoplus_suggester_item_more_loading",e.CLASSNAME_SUGGESTER_EMPTY_ITEM="infoplus_suggester_item_empty",e.CLASSNAME_CONTROL="infoplus_control",e.CLASSNAME_READONLY="infoplus_readonly",e.DATA_SUGGESTER_ATTRIBUTES="attributes",e.DATA_SUGGESTER_MORE_ITEM="moreItem",e.DATA_SUGGESTER_EMPTY_ITEM="emptyItem",e.PAGE_ITEM_COUNT=15,e.PAGE_ITEM_HEIGHT=25,e.PAGE_ITEM_PADDING_TOP=2,e.PAGE_ITEM_PADDING_BOTTOM=2,e.SUGGEST_DIV_PADDING_TOP=2,e.SUGGEST_DIV_PADDING_BOTTOM=2,e.MODE_FLAG_EXTERNAL_VALUE=1,e.MODE_FLAG_AUTOSIZE=2,e.MODE_FLAG_READONLY=4,e.MODE_FLAG_DISAPPEAR=8,e.MODE_FLAG_DISABLE_MULTIPAGE=16,e.MODE_FLAG_EMPTY_ITEM_APPEAR=32,e.SUBMIT_DELAY=500,e.isPagePopup=function(){return!0},e.prototype={activeInputValidateClass:null,createSuggester:function(){this.initOuterFrame(),this.initInnerFrame(),this.initData(),this.initActiveDiv(),this.initActiveInput(),this.initSuggestDiv(),this.initEmptyDiv(),this.initSuggestButton(),this.initFieldChange(),this.initValidateClass(),this.delegateEvent()},initOuterFrame:function(){var e,t=document.createElement("div");if(this.container=t,null!=this.dataElement.style)for(var n=this.dataElement.style.cssText.split(";"),i=0;i<n.length;i++){var a,r=n[i].split(":");2===r.length&&(a=$IU.trimString(r[0]),r=$IU.trimString(r[1]),-1===(e=(e=a).toLowerCase()).indexOf("font")&&"height"!==e&&"width"!==e||$(t).css(a,r))}this.dataElement.style.display="none",t.appendChild(this.dataElement),t.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER,this.isDisappear()&&(t.style.display="none")},initInnerFrame:function(){var e=document.createElement("div"),t=$(e),e=(this.inputDiv=e,$(e).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER),t.css("width",this.container.style.width),$(this.container).outerHeight());t.css("height",(e<22?24:e+2)+"px"),this.container.appendChild(this.inputDiv)},initData:function(){this.suggestData=[],this.suggestItems=[],this.currentLastPageNo=1,this.lastSubmitTime=0,this.lastInitialize=0,this.initializeInterval=3e4,this.lastSubmitValue="",this.prefix=this.container.id,null!=this.prefix&&""!==this.prefix||(this.prefix=this.dataElement.id),this.prefix+=Math.round(1e3*Math.random())},initActiveDiv:function(){var e=document.createElement("div");e.setAttribute("id",this.prefix+"_activeDiv"),e.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_DIV),this.inputDiv.appendChild(e),this.activeDiv=e},initActiveInput:function(){var e,t=document.createElement("input");if(t.style.width="100%",null!=this.dataElement.style&&null!=this.dataElement.style.cssText)for(var n=this.dataElement.style.cssText.split(";"),i=0;i<n.length;i++){var a,r=n[i].split(":");2===r.length&&(a=$IU.trimString(r[0]).toLowerCase(),r=$IU.trimString(r[1]).toLowerCase(),-1===(e=(e=a).toLowerCase()).indexOf("font")&&"height"!==e||$(t).css(a,r))}t.setAttribute("id",this.prefix+"_activeInput"),t.setAttribute("type","text"),t.setAttribute("maxlength","100"),$(t).data($Control.DATA_ORIGIN_INPUT,this.dataElement).data($Control.DATA_IS_CONTROL,!0).css("display","block"),this.isReadOnly()&&t.setAttribute("readOnly","true"),t.value=this.text||"",t.setAttribute("class",this.getActiveInputClass(!1)),this.activeDiv.appendChild(t),this.activeInput=t},initSuggestDiv:function(){var e=document.createElement("div");e.id=this.prefix+"_suggestDiv",e.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,e.style.display="none",$(e).attr("tabindex",1e3*Math.random()+1e5),this.activeDiv.appendChild(e),this.suggestDiv=e},initEmptyDiv:function(){var e=document.createElement("div");(this.emptyDiv=e).id=this.prefix+"_emptyDiv",e.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,e.style.backgroundColor="#eeeeee",this.setEmptyDivContent(),e.style.display="none",this.activeDiv.appendChild(e)},initSuggestButton:function(){var e=document.createElement("div"),t=document.createElement("div"),n=$(t);switch(e.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER),n.attr("id",this.prefix+"_suggestButton").addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON),this.type){case"User":n.css("backgroundPosition","-80px 0px");break;case"Organize":n.css("backgroundPosition","-128px 0px");break;default:n.css("backgroundPosition","0px 0px")}var i=this.container.style.height,a=$(this.activeInput).height();0!==a&&($IU.endWith(i,"rem")?(i=parseFloat($("html").css("font-size")),n.css("top",(a-16/i)/2+"rem")):n.css("top",(a-16)/2+"px")),e.appendChild(t),this.activeDiv.appendChild(e),this.activeTip=e,this.suggestButton=t},initValidateClass:function(){for(var e=this.dataElement.className.split(" "),t=0;t<e.length;t++){var n=e[t];"validate["===n.substr(0,9)&&(this.activeInputValidateClass=n,$(this.activeInput).addClass(n).data($Control.DATA_VALIDATOR,$(this.dataElement).data($Control.DATA_VALIDATOR)).data($Control.DATA_VALIDATOR_PROMPT_POSITION,$(this.dataElement).data($Control.DATA_VALIDATOR_PROMPT_POSITION)),$(this.dataElement).removeClass(n))}},setSuggesterStyle:function(e,t){$IU.setDynamicStyle(this.container,e,t),$IU.setDynamicStyle(this.activeInput,e,t)},getSuggesterStyle:function(e){$IU.getElementStyle(this.container,e)},delegateEvent:function(){$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mouseenter",{suggester:this},this.onSuggesterItemMouseEnter),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mousedown",{suggester:this},this.onSuggesterItemMouseDown),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM,"click",{suggester:this},this.onSuggesterMoreItemClick),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER,"click",{suggester:this},this.onSuggesterContainerClick),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER,"click",{suggester:this},this.onSuggesterContainerClick),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterContainerClick),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"blur",{suggester:this},this.onSuggesterActiveInputBlur),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"focus",{suggester:this},this.onSuggesterActiveInputFocus),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keydown",{suggester:this},this.onSuggesterActiveInputKeyDown),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keyup",{suggester:this},this.onSuggesterActiveInputKeyUp),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keypress",{suggester:this},this.onSuggesterActiveInputKeyPress),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterButtonClick),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"focus",{suggester:this},this.onSuggesterDivFocus),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"blur",{suggester:this},this.onSuggesterDivBlur),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseup",{suggester:this},this.onSuggesterDivMouseUp),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseenter",{suggester:this},this.onSuggesterDivMouseEnter),$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseleave",{suggester:this},this.onSuggesterDivMouseLeave)},initFieldChange:function(){var e=this.field;null!=e&&!0===e.fieldChanging&&(this.onFieldChange=!0)},dispose:function(){this.field=null,this.suggestData=null,this.suggestItems=null,(this.dataElement=null)!=this.container&&$(this.container).undelegate(),this.container=null,$(this.container).empty()},isAutoSize:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_AUTOSIZE)},isAllowExtern:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE)},isReadOnly:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_READONLY)||!0===this.dataElement.readOnly},isDisappear:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_DISAPPEAR)},isMultiPageDisabled:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE)},isEmptyItemAppear:function(){return null!=this.mode&&0!=(this.mode&InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR)},setData:function(e,t,n,i){t=$IU.trimString(t),null==e?this.data=this.text=null:(this.data=null!=e.codeId?e.codeId:e,this.text=null!=t?t:null!=e.codeName?e.codeName:e);var a,t=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT),r=!1,o=this.getData();if(null==e||o!==e&&o!==e.codeId){if(null!=this.children)for(var s=0;s<this.children.length;s++)this.children[s].setData(null);(t.onFieldChange||t.onFieldRefer||t.onFieldSync)&&(r=!0)}null!=this.dataElement&&("select"===this.dataElement.tagName.toLowerCase()?((o=this.dataElement).options.length=0,(a=document.createElement("option")).value=this.data||"",$(a).text(this.text),o.appendChild(a),a.value=this.data||""):this.dataElement.value=this.data||""),this.activeInput.value=this.text||"";o=null;null!=e&&null!=e.attributes&&(o=e.attributes),t.setAttributes(o),!0===r&&$(this.dataElement).change()},getData:function(){return null==this.dataElement?"":this.dataElement.value},setCursor:function(e,t){e=e.createTextRange();e.collapse(!0),e.moveStart("character",t),e.select()},activeFocus:function(){for(var e=0;e<1;e++)this.activeInput&&this.activeInput.focus()},getActiveInputClass:function(e){var t=InfoPlus.Suggester.CLASSNAME_CONTROL;return t+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,null!=this.activeInputValidateClass&&(t+=" "+this.activeInputValidateClass),this.isReadOnly()?t+=" "+InfoPlus.Suggester.CLASSNAME_READONLY:e&&(t+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS),t},adjustView:function(){var e,t;this.isAutoSize()?(e=10*(function(e){for(var t=0,n=0;n<e.length;n++)e.charCodeAt(n)<0||255<e.charCodeAt(n)?t+=2:t+=1;return t}(this.activeInput.value)/10+1)*6+5,this.isMobileView()?(t=parseFloat($("html").css("font-size")),this.activeInput.style.width=1.35*e/t+"rem"):this.activeInput.style.width=e+"px"):this.activeInput.style.width="100%"},getSuggest:function(){for(var e=0;e<this.suggestItems.length;e++)if($(this.suggestItems[e]).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT))return e;return-1},emptyItemIsSelected:function(){var e=this.getEmptyItem();return null!=e&&$(e).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},selectSuggesterItem:function(e){$(e).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT),$(e).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},unselectSuggesterItem:function(e){$(e).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT),$(e).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT)},requestCode:function(t,n){function i(){return""===t&&1===e&&null!=o&&null!=r[o]&&"Internal"===r[o].codeType}var a=this,r=$$.entity.codes,o=this.code,e=this.currentLastPageNo,s=(new Date).getTime();if(i()){var l=null!=r[o].cache&&null!=r[o].cache[n]?r[o].cache[n]:null;if(null!=l)return this.onAjaxCallback(t,l,s),void(a.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV)}this.lastSubmitTime=s;l={prefix:t,type:this.type,code:this.code||null,parent:n,isTopLevel:null==this.field.parent,pageNo:this.currentLastPageNo-1,rand:999*Math.random(),settings:$.toJSON(null==this.field.settings?{}:this.field.settings)};$$.ajax({type:"POST",url:this.suggestService,data:l,needParse:!1,showParseErrMsg:!1,showAjaxErrMsg:!1,addFormParam:!0}).done(function(e){a.onAjaxCallback(t,e,s),i()&&(null==r[o].cache&&(r[o].cache={}),r[o].cache[n]=e)}).always(function(){a.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV})},suggestAjaxSubmit:function(){var r,o,s,l,e,t;this.activeInput.value.length<this.suggestMinimizeSize?(this.suggestData=[],this.suggestDiv.style.display="none",this.emptyDiv.style.display="block",this.setEmptyDivContent()):""!==this.suggestService&&(this.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV+" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING,this.changeLoadingStatus(!0),r=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT),o=r.parentValue,null!=this.field.parent&&null==o&&(s=$IU.getReferedControlPaths(this.path),l=this.field.parent,$(document).find("."+$Control.CLASSNAME_CONTROL).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);if(null!=e&&null!=e.path&&null!=e.field&&e.field.name===l)for(var t,n=e.path,i=s.length,a=0;a<i;a++)if(s[a]===n)return t=e.getValue(),o=t instanceof $Controls.Data.ValuePair||t instanceof $Controls.Data.Uri?t.value:t,void(r.parentValue=o)})),e=this.activeInput.value,t=null==o?"":o,this.requestCode(e,t))},onAjaxCallback:function(e,a,t){if(!(this.lastSubmitTime>t)&&!1!==this.focused){this.changeLoadingStatus(!1);var n=function(){for(var e=void 0===a.items?"undefined"!=typeof JSON?JSON.parse(a.d):$.parseJSON(a.d):a,t=0,n=e.items.length;t<n;t++){var i=e.items[t];i.codeName=$IU.trimString(i.codeName),i.description=$IU.trimString(i.description)}return e}(),t=1===this.currentLastPageNo||null==this.suggestData?0:this.suggestData.length;if(1===this.currentLastPageNo)this.suggestData=n.items,this.totalResults=n.total;else{for(var i=0;i<n.items.length;i++)this.suggestData[this.suggestData.length]=n.items[i];n.items.length<InfoPlus.Suggester.PAGE_ITEM_COUNT&&this.removeMoreItem()}if(null==this.suggestData||0===this.suggestData.length)this.suggestData=[],this.totalResults=null,this.suggestDiv.style.display="none",this.emptyDiv.style.display="block",this.activeInput.value.length<this.suggestMinimizeSize?this.setEmptyDivContent():this.emptyDiv.innerHTML=$$.lt("suggester.noData"),this.currentLastPageNo=1;else if(0===n.items.length&&1<this.currentLastPageNo){for(--this.currentLastPageNo,i=0;i<this.suggestData.length;i++){var r=this.suggestItems[i];null!=r&&(r.style.background="")}this.adjustSuggestDiv((this.currentLastPageNo-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,InfoPlus.Suggester.PAGE_ITEM_COUNT),this.lastNextPageRequest=null}else{this.suggestAjaxShow(t,e);t=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);$$(t).fieldSuggested(e,n.items)}}},hasMoreItem:function(){return!this.isMultiPageDisabled()&&null!=$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)},shouldShowMoreItemInSuggestDiv:function(e,t){return!this.isMultiPageDisabled()&&null!=this.getMoreItem()&&!(this.suggestItems.length<InfoPlus.Suggester.PAGE_ITEM_COUNT||t<InfoPlus.Suggester.PAGE_ITEM_COUNT)&&e+t>=this.suggestItems.length},getMoreItem:function(){return this.isMultiPageDisabled()?null:$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)},removeMoreItem:function(){var e=this.getMoreItem();null!=e&&($(e).remove(),$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM))},changeLoadingStatus:function(e){for(var t=0;t<this.suggestItems.length;t++){var n=this.suggestItems[t];e?$(n).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING):$(n).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING)}},changeMoreItemIcon:function(e){var t=this.getMoreItem();null!=t&&(!0===e?($(t).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN),$(t).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING)):($(t).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING),$(t).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN)))},getEmptyItem:function(){return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM)},suggestAjaxShow:function(e,l){for(var t,n,s,i,a,o=function(e){var t=parseFloat($("html").css("font-size"));if(null==e)return 0;for(var n=0,i=0;i<e.length;i++)e.charCodeAt(i)<0||255<e.charCodeAt(i)?n+=$$.MOBILE?1.2*t:13:n+=$$.MOBILE?Math.ceil(1.2*t/2):7;return n},r=function(e,t){return t<(a=o(e))?a:t},u=function(e,t,n){var i=$IU.trimString(e.codeName),e=(null!=e.description&&""!==e.description&&(i+="("+$IU.trimString(e.description)+")"),e.codeIdReadable||e.codeId);return $(t).html('<div class="item_code_id">'+c($IU.trimString(e))+"</div>"+c(i)).addClass("infoplus_suggester_item_duplicated"),i+=$IU.trimString(e),r(i,n)},d=function(e,t){var n=l.toLocaleLowerCase().split(/[ ]|,/);if(0===n.length)return{index:-1,len:0};for(var i,a=-1,r=0,o=0,s=n.length;o<s;o++)0!==n[o].length&&-1!==(i=e.indexOf(n[o],t))&&(-1===a||i<a)&&(a=i,r=n[o].length);return{index:a,len:r}},c=function(e){for(var t=e.toLocaleLowerCase(),n=0,i="",a=d(t,n);-1!==a.index;)i=(i+=e.substring(n,a.index))+("<u>"+e.substr(a.index,a.len))+"</u>",n=a.index+a.len,a=d(t,n);return i+=e.substr(n)},h=(1===this.currentLastPageNo&&(this.suggestItems=[],$(this.suggestDiv).empty(),this.isEmptyItemAppear()&&(t=document.createElement("div"),$(t).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM),t.innerHTML=$$.lt("suggester.emptyItem"),$(t).data("code",null),this.suggestDiv.appendChild(t),$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM,t)),this.isMultiPageDisabled()?"User"===this.type&&((null==(t=this.field).settings||!0!==t.settings.userTraversal)&&this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT?(f=document.createElement("div"),$(f).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_USER),f.innerHTML=$$.hlt("suggester.moreUser",null!=this.totalResults?1e5<(t=this.totalResults)?$$.lt("suggester.inaccurateTotal.hundredThousand"):1e4<t?$$.lt("suggester.inaccurateTotal.tenThousand"):1e3<t?$$.lt("suggester.inaccurateTotal.thousand"):t:this.suggestData.length),this.suggestDiv.appendChild(f),$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,f)):$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)):($(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM),this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT&&(f=document.createElement("div"),$(f).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM),f.innerHTML=$$.lt("suggester.moreItem"),this.suggestDiv.appendChild(f),$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,f)))),1===this.currentLastPageNo?0:parseInt($(this.suggestDiv).width())-20),p=0,f="User"!==this.type?this.getMoreItem():$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM),m=0;m<this.suggestData.length;m++)m<e?null!=(s=this.suggestItems[m])&&(s.style.background=""):(n=this.suggestData[m],s=document.createElement("div"),$(s).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT),$(s).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM),null!=this.tipFormat&&null!=n.attributes&&$(s).attr("title",$IU.variablesFormat(this.tipFormat,n.attributes)),i=$IU.trimString(n.codeName),null!=n.description&&""!==n.description&&(i+="("+$IU.trimString(n.description)+")"),h<(a=o(i))&&(h=a),$(s).html(c(i)),$(s).data("code",n),this.suggestItems[m]=s,null!=f?$(f).before(s):this.suggestDiv.appendChild(s),p++);h=function(e,t){for(var n,i,a={},r=0,o=e.length;r<o;r++)null!=(s=e[r])&&(i=(n=$(s).data("code")).codeName,a.hasOwnProperty(i)?(t=u(n,s,t),t=u($(a[i]).data("code"),a[i],t)):a[i]=s);return t}(this.suggestItems,h);var h=function(e,t){for(var n,i,a=0,r=e.length;a<r;a++)null!=(s=e[a])&&(i=(n=$(s).data("code")).codeIdReadable||n.codeId,-1!==d(i.toLocaleLowerCase(),0).index)&&(t=u(n,s,t));return t}(this.suggestItems,h),g=this.activeInput.offsetWidth,C=(g=null!=f&&g<(C=function(e){for(var t=e.innerHTML.split("<br>"),n=0,i=0,a=t.length;i<a;i++){var r=o(t[i]);n<r&&(n=r)}return n}(f))?C:g)<h?h+20:g+20;if(this.isMobileView()?(g=parseFloat($("html").css("font-size")),$(this.suggestDiv).width(C/g+"rem")):$(this.suggestDiv).width(C),this.suggestDiv.style.display="block",this.emptyDiv.style.display="none",1!==this.currentLastPageNo){g="down"===this.lastNextPageRequest.key?this.lastNextPageRequest.selectIndex+1:0<this.lastNextPageRequest.selectIndex?this.lastNextPageRequest.selectIndex+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT,C=(g>=this.suggestItems.length&&(g=this.suggestItems.length-1),0);0<this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT&&(C=this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT),this.adjustSuggestDiv(C,InfoPlus.Suggester.PAGE_ITEM_COUNT),"block"===this.suggestDiv.style.display&&this.changeSelectedSuggesterItemStyle(this.lastNextPageRequest.selectIndex,g),this.lastNextPageRequest=null}else if("block"===this.suggestDiv.style.display){if(!this.isAllowExtern())if(this.isEmptyItemAppear())if(1===this.suggestData.length)this.selectSuggesterItem(this.suggestItems[0]);else{for(var _=!1,m=0;m<this.suggestData.length;m++)if(this.activeInput.value===this.suggestData[m].codeName){this.selectSuggesterItem(this.suggestItems[m]),this.unselectSuggesterItem(this.getEmptyItem()),_=!0;break}_||this.selectSuggesterItem(this.getEmptyItem())}else null!=this.suggestItems[0]&&this.selectSuggesterItem(this.suggestItems[0]);this.adjustSuggestDiv(0,p)}o=null},getSuggestDivScrollTop:function(e){return null==e?0:e.offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP},requestNextPage:function(e,t){null==this.lastNextPageRequest&&(this.currentLastPageNo++,this.lastNextPageRequest={selectIndex:e,requestPageNo:this.currentLastPageNo,key:t},this.suggestAjaxSubmit())},containerClick:function(){this.isReadOnly()||this.activeInput&&this.activeInput.focus()},getCurrentPageTopIndex:function(){for(var e=this.getSuggest(),t=this.suggestItems,n=e;0<=n;){if(t[n].offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP<this.suggestDiv.scrollTop){n+=1;break}n--}return n<0?0:n},moveDownOneRow:function(e){var t=this.getCurrentPageTopIndex(),n=this.suggestItems;(e||t+1<n.length)&&(this.suggestDiv.scrollTop=this.getSuggestDivScrollTop(n[t+1]))},changeSelectedSuggesterItemStyle:function(e,t){this.isEmptyItemAppear()?(-1===e?this.unselectSuggesterItem(this.getEmptyItem()):null!=this.suggestItems[e]&&this.unselectSuggesterItem(this.suggestItems[e]),-1===t?this.selectSuggesterItem(this.getEmptyItem()):null!=this.suggestItems[t]&&this.selectSuggesterItem(this.suggestItems[t])):(null!=this.suggestItems[e]&&this.unselectSuggesterItem(this.suggestItems[e]),null!=this.suggestItems[t]&&this.selectSuggesterItem(this.suggestItems[t]))},isMobileView:function(){return $(document.body).hasClass("infoplus_mobile_view")},adjustSuggestDiv:function(e,t){var n,i,a,r=parseFloat($("html").css("font-size")),o=(this.shouldShowMoreItemInSuggestDiv(e,t)&&t++,this.isEmptyItemAppear()&&0===e);o&&t++,this.isMobileView()?(n=2,"User"===this.type&&null!=$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)&&(i=$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight()/r),this.suggestDiv.style.height=(a=t*n+8/r+(null!=i?i:0))+"rem"):(a=t*(n=InfoPlus.Suggester.PAGE_ITEM_HEIGHT)+8+(null!=(i="User"===this.type&&null!=$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)?$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight():i)?i:0),this.suggestDiv.style.height=a+"px"),this.suggestDiv.scrollTop=!0===o?0:this.getSuggestDivScrollTop(this.suggestItems[e])},activeInputKeyDown:function(e){this.activeInput.className=this.getActiveInputClass(!0);var t,n,i,a=this.getSuggest(),r=this.suggestItems,o=this.suggestDiv;switch(e){case InfoPlus.Suggester.KEY_CODE_BACKSPACE:""===this.activeDiv.value&&this.setData(null);break;case InfoPlus.Suggester.KEY_CODE_UP:null!=r[0]&&"block"===o.style.display&&-1!==a&&((s=a-1)<0&&(s=this.isEmptyItemAppear()?-1:0),this.changeSelectedSuggesterItemStyle(a,s),-1!==s)&&r[s].offsetTop<this.suggestDiv.scrollTop&&this.adjustSuggestDiv(s,InfoPlus.Suggester.PAGE_ITEM_COUNT);break;case InfoPlus.Suggester.KEY_CODE_DOWN:if(null!=r[0]&&"block"===o.style.display)if(-1===a)this.isEmptyItemAppear()?this.emptyItemIsSelected()?(this.unselectSuggesterItem(this.getEmptyItem()),this.selectSuggesterItem(r[0])):this.selectSuggesterItem(this.getEmptyItem()):this.selectSuggesterItem(r[0]);else{var s=a+1;if(s>=r.length)return void(this.hasMoreItem()&&(this.moveDownOneRow(!0),this.requestNextPage(a,"down")));this.changeSelectedSuggesterItemStyle(a,s),this.suggestDiv.scrollTop+this.suggestDiv.offsetHeight<r[s].offsetTop+InfoPlus.Suggester.PAGE_ITEM_HEIGHT&&this.adjustSuggestDiv(s-InfoPlus.Suggester.PAGE_ITEM_COUNT+1,InfoPlus.Suggester.PAGE_ITEM_COUNT)}break;case InfoPlus.Suggester.KEY_CODE_PAGE_UP:this.isMultiPageDisabled()||(s=(n=0<a?Math.floor(a/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1:1)-1,(i=a-InfoPlus.Suggester.PAGE_ITEM_COUNT)<0&&(i=0,s=1),t=InfoPlus.Suggester.PAGE_ITEM_COUNT,s*InfoPlus.Suggester.PAGE_ITEM_COUNT>r.length&&(t=r.length%InfoPlus.Suggester.PAGE_ITEM_COUNT),this.adjustSuggestDiv((s-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,t),this.changeSelectedSuggesterItemStyle(a,i));break;case InfoPlus.Suggester.KEY_CODE_PAGE_DOWN:this.isMultiPageDisabled()||(n=0<(a=this.getSuggest())?Math.floor(a/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1:1,r=this.suggestItems,(i=0<a?a+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT)>=r.length&&this.hasMoreItem()?this.requestNextPage(a,"pageDown"):(s=n*InfoPlus.Suggester.PAGE_ITEM_COUNT,i>=r.length&&(i=r.length-1,s>=r.length)&&(s=r.length-InfoPlus.Suggester.PAGE_ITEM_COUNT)<0&&(s=0),t=InfoPlus.Suggester.PAGE_ITEM_COUNT,1===n&&r.length<InfoPlus.Suggester.PAGE_ITEM_COUNT&&(t=r.length%InfoPlus.Suggester.PAGE_ITEM_COUNT),this.adjustSuggestDiv(s,t),this.changeSelectedSuggesterItemStyle(a,i)))}},setFocusToNextControl:function(e,t){var n=e.eq(t+1)[0];null!=n&&(n.disabled||"none"===n.style.display?this.setFocusToNextControl(e,t+1):$(n).trigger("focus"))},activeInputKeyPress:function(e){var t;e===InfoPlus.Suggester.KEY_CODE_ENTER&&(e=this.getSuggest(),t=this.activeInput.value,this.isEmptyItemAppear()&&-1===e?!this.emptyItemIsSelected()&&this.isAllowExtern()?this.text!==t&&this.setData(t,t,!1,!0):this.setData(""):"block"===this.suggestDiv.style.display&&-1!==e&&0<this.suggestItems.length?this.setData(this.suggestData[e]):this.isAllowExtern()&&this.text!==t&&this.setData(t,t,!1,!0),this.activeInputBlur())},activeInputKeyUp:function(e){this.adjustView(),e===InfoPlus.Suggester.KEY_CODE_ESC&&(this.activeInput.value=this.text||"",this.activeInputBlur())},clearFocusFlag:function(){this.focused=!1,this.activeInputOnFocus=!1,this.mouseInSuggestDiv=!1,this.suggestDivScrolled=!1},activeInputBlur:function(){this.clearFocusFlag(),this.suggestDiv.style.display="none",this.emptyDiv.style.display="none",this.isAllowExtern()?this.dataElement.options[0].text!==this.activeInput.value&&this.setData(this.activeInput.value,this.activeInput.value,!1,!0):this.activeInput.value=this.text||"",this.activeInput.className=this.getActiveInputClass(!1),this.activeInput.blur()},setEmptyDivContent:function(){this.type===$Control.DATA_TYPE_USER?(this.emptyDiv.style.width=$$.MOBILE?"32rem":"zh"===$$.params.lang?"320px":"400px",this.emptyDiv.innerHTML=$$.lt("suggester.emptyUser")):(this.emptyDiv.style.width=$$.MOBILE?"25rem":"250px",this.emptyDiv.innerHTML=$$.lt("suggester.emptyHint"))},activeInputFocus:function(){this.focused=!0,this.activeInput.className=this.getActiveInputClass(!0),this.activeDiv.style.position="relative",""===this.activeInput.value?(this.emptyDiv.style.display="block",this.setEmptyDivContent()):this.emptyDiv.style.display="none",this.currentLastPageNo=1,this.suggestAjaxSubmit()},onSuggesterItemMouseEnter:function(e){for(var t=e.data.suggester,n=0;n<t.suggestItems.length;n++)t.unselectSuggesterItem(t.suggestItems[n]);t.isEmptyItemAppear()&&t.unselectSuggesterItem(t.getEmptyItem()),t.selectSuggesterItem(this)},onSuggesterItemMouseDown:function(e){e=e.data.suggester;return e.setData($(this).data("code")),e.suggestDiv.style.display="none",e.emptyDiv.style.display="none",e.activeInput.className=e.getActiveInputClass(!1),e.focused=!1,e.activeInput.blur(),!1},onSuggesterMoreItemClick:function(e){var e=e.data.suggester,t=e.getSuggest();return e.moveDownOneRow(!0),e.requestNextPage(t,"down"),!1},onSuggesterContainerClick:function(e){e.data.suggester.containerClick()},onSuggesterActiveInputKeyDown:function(e){var t=e.data.suggester;return!t.isReadOnly()&&(t.activeInputKeyDown(e.keyCode),e.keyCode!==InfoPlus.Suggester.KEY_CODE_PAGE_DOWN)},onSuggesterActiveInputKeyUp:function(e){var t=e.data.suggester;t.isReadOnly()||t.activeInputKeyUp(e.keyCode)},onSuggesterActiveInputKeyPress:function(e){var t=e.data.suggester;if(!t.isReadOnly())return t.activeInputKeyPress(e.keyCode),e.keyCode!==InfoPlus.Suggester.KEY_CODE_ENTER},onSuggesterActiveInputFocus:function(e){var t,n,e=e.data.suggester;if(e.activeInputOnFocus=!0,!e.isReadOnly()&&!1===e.mouseInSuggestDiv){if($IU.shouldShowSuggesterPage())return $IU.clearAllError(),(t=$(e.dataElement).data($Control.DATA_CONTROL_OBJECT)).onSuggestPage=!0,n=this,setTimeout(function(){n.blur(),0==InfoPlus.Suggester.isPagePopup()?$IU.showSuggester2ThisPage(t):$IU.showSuggester2PageOnce(t)},0),!1;e.activeInputFocus(),setTimeout($.proxy(e.submitSuggester,e),InfoPlus.Suggester.SUBMIT_DELAY)}},onSuggesterActiveInputBlur:function(e){e=e.data.suggester;e.activeInputOnFocus=!1,e.isReadOnly()||!1===e.mouseInSuggestDiv&&e.activeInputBlur()},onSuggesterDivFocus:function(e){e.data.suggester},onSuggesterDivBlur:function(e){e=e.data.suggester;!1===e.activeInputOnFocus&&!1===e.suggestDivScrolled&&e.activeInputBlur()},onSuggesterDivMouseUp:function(e){e=e.data.suggester;e.suggestDivScrolled=!0,e.activeInput.focus()},onSuggesterDivMouseEnter:function(e){e.data.suggester.mouseInSuggestDiv=!0},onSuggesterDivMouseLeave:function(e){e.data.suggester.mouseInSuggestDiv=!1},onSuggesterButtonClick:function(e){return e.data.suggester.isReadOnly(),!1},submitSuggester:function(){this.focused&&(this.lastSubmitValue!==this.activeInput.value&&(this.currentLastPageNo=1,this.suggestAjaxSubmit(),this.lastSubmitValue=this.activeInput.value),setTimeout($.proxy(this.submitSuggester,this),InfoPlus.Suggester.SUBMIT_DELAY))}},define("InfoPlus.Suggester",e)}(window),function(){var e={DEFINITION_STATUS_ONLINE:1,DEFINITION_STATUS_OFFLINE:2,INSTANCE_STATE_UNKNOWN:-1,INSTANCE_STATE_CREATED:0,INSTANCE_STATE_ONLINE:1,INSTANCE_STATE_OFFLINE:2,INSTANCE_STATE_TERMINATED:3,INSTANCE_STATE_COMPLETE:4,STEP_STATE_TODO:1,STEP_STATE_DONE:2,STEP_STATE_DRAFT:3,STEP_STATE_SUB:4,STEP_TYPE_MANUAL:"Manual",STEP_TYPE_AUTO:"Auto",STEP_TYPE_SPLIT:"Split",STEP_TYPE_JOIN:"Join",STEP_TYPE_CONDITIONAL:"Conditional",NOBODY_ACCOUNT:"__INFOPLUS_SELECT_USER__",MESSAGE_BOX_TITLE:"InfoPlus"};define("InfoPlus.Settings",e)}(window),function(i,v){function e(e){this.initializeConfig(e),this.dynamicAnalyzer=new InfoPlus.Dynamics.Analyzer}var d={autoSize:!0};e.prototype={holder:null,entity:null,prefix:"infoplus_view_"+Math.round(9e3*Math.random()+1e3)+"_",selectedDiv:null,events:[],initializeConfig:function(e){for(var t in this.config={},e)e.hasOwnProperty(t)&&(e[t],this.config[t]=e[t]);return this.assertConfig()},assertConfig:function(){var e=this.config.formStepId,t=this.config.workflowId;if(e===v&&t===v)return!1;this.formStepId=e;t=this.config.holderId;if(t===v)return!1;e=document.getElementById(t);if(null===e)return!1;this.holder=e;t=this.config.entity;return t!==v&&(this.entity=t,null!=this.config.suggest)&&(this.suggestService=this.config.suggest,null!=this.config.suggestInitialize)&&(this.suggestInitializeService=this.config.suggestInitialize,null!=this.config.fieldChange)&&(this.fieldChangeService=this.config.fieldChange,null!=this.config.buttonService)&&(this.buttonService=this.config.buttonService,null!=this.config.thingService)&&(this.thingService=this.config.thingService,null!=this.config.tenantTimeZoneOffset)&&(this.tenantTimeZoneOffset=this.config.tenantTimeZoneOffset,this.discard(),this.events=[],!0)},dispose:function(){this.holder=null,this.entity=null,this.selectedDiv=null},addQformCss:function(){var e,t,n;$$.params.engine&&"qform"==$$.params.engine&&(e=$$.params.baseUrl+"static/css/DesignerFormRender.css",t="designerFormRender_style",$("#"+t).size()||((n=document.createElement("link")).type="text/css",n.media="all",n.rel="stylesheet",n.id=t,document.getElementsByTagName("head")[0].appendChild(n)),n.href=e)},addViewCss:function(){for(var e=this.entity.views,t=0;t<e.length;t++){var n=this.prefix+t;this.addCssStyle(e[t],n),this.addCssStyleSheet(e[t],n)}},addCssStyle:function(e,t){var n=e.styleSheet,i=t+"_style";if($IU.isArray(n)){var a=null;if(null==document.getElementById(i))(a=document.createElement("style")).type="text/css",a.media="all",a.id=i,document.getElementsByTagName("head")[0].appendChild(a),a=document.styleSheets[document.styleSheets.length-1];else for(var r=0;r<document.styleSheets.length&&(a=document.styleSheets[r]).id!==i;r++);if(a.rules)for(;0<a.rules.length;)a.removeRule(0);else if(a.cssRules)for(;0<a.cssRules.length;)a.deleteRule(0);for(r=0;r<n.length;r++){var o=n[r];if(a.rules)for(var s=o.split("{"),l=s[0].split(/,/),u=s[1].split("}")[0],d=0;d<l.length;d++)a.addRule(l[d],u);else!a.cssRules||/\s$/.test(o)||a.insertRule(o,0)}}},addCssStyleSheet:function(e,t){var n=e.styleSheetUri,e=$$.params.engine&&"qform"==$$.params.engine;if(null!=n&&""!==n&&!e){for(var i=0;i<document.styleSheets.length;i++){var a=document.styleSheets[i].href;if(null!=a&&a.length>=n.length&&a.substr(a.length-n.length)===n)break}var r,e=t+"_cached_link";i>=document.styleSheets.length?(null==(r=document.getElementById(e))&&((r=document.createElement("link")).type="text/css",r.media="all",r.rel="stylesheet",r.id=e,document.getElementsByTagName("head")[0].appendChild(r)),r.href=n):(r=(t=document.styleSheets[i]).ownerNode||t.owningElement||document.getElementById(e),document.getElementsByTagName("head")[0].removeChild(r),document.getElementsByTagName("head")[0].appendChild(r))}},processEvent:function(){$(document.body).on("change","."+InfoPlus.Controls.Control.CLASSNAME_FIELD_CHANGE,{render:this},this.onFieldChange),$(document.body).on("focus","."+InfoPlus.Controls.Control.CLASSNAME_CONTROL,this.onFieldFocus);var n=this;$$.addedRepeat(function(e,t){n.initSelect2($(t).find(".infoplus_select2")),n.initRichText($(t).find(".infoplus_richTextControl")),n.initLabel($(t).find(".infoplus_labelControl")),n.initRadio($(t).find(".infoplus_radioControl")),n.initCheck($(t).find(".infoplus_checkControl"))})},initVarControls:function(){var e,t=document.createElement("div"),n=(t.setAttribute("id","variables_container"),$(this.holder).append(t),this.entity.data);for(e in n)n.hasOwnProperty(e)&&"field"!==e.substr(0,5)&&$IU.addVariableControl(e,n[e]);t=$IU.getParamFromUrl(i.location.href);null!=this.data._VAR_URL_Attr&&(t=$.extend($.parseJSON(this.data._VAR_URL_Attr),t)),$IU.addVariableControl("_VAR_URL",i.location.href,i.location.href,t),$IU.addVariableControl("_VAR_ENTRY_NAME",$$.params.instanceName),$IU.addVariableControl("_VAR_ENTRY_TAGS",$$.params.instanceTags)},initDynamicParallel:function(){if(null!=$$.params.dynamicParallel)for(var i=$$.params.dynamicParallel.splitPath,e=$$.params.dynamicParallel.splitPathGroup,t=0,n=e.length;t<n;t++){var a=e[t],o=(o=this.entity.groups[a].permission||"").replace(/[w|i|d]/g,""),s=(this.entity.groups[a].permission=o,function(e){for(var t="",n=0;n<=e;n++)t+="_"+i[n];return t}(t));$$("&"+a).each(function(){for(var e=this.getChildren(),t=!0,n=0,i=e.length;n<i;n++){var a=$(e[n]),r=this.getPath()+"_"+n;s===r?-1!==o.indexOf("r")?(a.show(),t=!1):a.hide():-1!==o.indexOf("R")?(a.show(),a.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);null!=e&&e.setDynamicParallelReadOnly()}),a.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var e=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);null!=e&&(e.readOnly=!0,null!=e.repeatAddLink)&&e.repeatAddLink.hideLink()}),t=!1):a.hide()}t&&this.visible(!1,!0)})}},convertSize:function(){function m(e,t){var n=r(e),i=parseFloat(e);if(isNaN(i))return e;switch(n){case"cm":i=96*i/2.54;break;case"mm":i=9.6*i/2.54;break;case"in":i*=96;break;case"pt":i=4*i/3;break;case"px":break;case"pc":i=12*i*4/3;break;default:return e}return i/a*t+"rem"}function g(e){switch(e){case"xx-small":case"1":case"x-small":case"2":return"12px";case"small":case"3":return"14px";case"medium":case"4":return"16px";case"large":case"5":return"18px";case"x-large":case"6":return"32px";case"xx-large":case"7":return"48px"}return null}var e,a=e=(e=i.screen.width)<600?Math.floor(16+2*(e-375)/225):e<1e3?Math.floor(18+4*(e-600)/400):Math.floor(22+5*(e-1e3)/1e3),r=($("html").css("font-size",a+"px"),function(e){return null==e||e.length<2?null:e.substr(e.length-2).toLocaleLowerCase()});this.eachLayout(function(e){if(null!=e.attributes&&$IU.isArray(e.attributes)){if("LayoutFont"===e.renderType){for(var t,n=-1,i=0,a=e.attributes.length;i<a;i++)null!=e.attributes[i].key&&null!=e.attributes[i].value&&"style"===e.attributes[i].key.toLocaleLowerCase()&&(n=i);for(i=0,a=e.attributes.length;i<a;i++)null!=e.attributes[i].key&&null!=e.attributes[i].value&&"size"===e.attributes[i].key.toLocaleLowerCase()&&null!=(t=g($IU.trimString(e.attributes[i].value)))&&(-1!==n?e.attributes[n].value+=";font-size:"+t:(e.attributes[i].key="style",e.attributes[i].value="font-size:"+t))}for(i=0,a=e.attributes.length;i<a;i++)if(null!=e.attributes[i].key&&null!=e.attributes[i].value&&"style"===e.attributes[i].key.toLocaleLowerCase()){for(var r=e.attributes[i].value.split(";"),o=[],s=0,l=r.length;s<l;s++){var u=r[s].split(":");if(2===u.length){var d=$IU.trimString(u[0]),c=$IU.trimString(u[1]);switch(d.toLocaleLowerCase()){case"height":case"min-height":$$.MOBILE&&"BoundPicture"!==e.renderType&&o.push(d+":"+m(c,1));break;case"font-size":c=g(c),$$.MOBILE?(null==c&&(c=$IU.trimString(u[1])),o.push(d+":"+m(c,1.2))):null!=c&&o.push(d+":"+c)}}}for(var h="",p=0,f=o.length;p<f;p++)h+=o[p]+";";""!==h&&(e.attributes[i].value=e.attributes[i].value+";"+h)}}})},processEmptyDiv:function(){for(var e=this.entity.views,t=0;t<e.length;t++){var n=e[t];$IU.clearStack(),$IU.processEmptyDiv(n)}},processAutoViewWidth:function(){function a(e){return null!=e.key&&null!=e.value}function r(e,t,n){for(var i=t.attributes[n].value.split(";"),a=0,r=i.length;a<r;a++){var o,s=i[a].split(":");2===s.length&&(o=$IU.trimString(s[0]),s=$IU.trimString(s[1]),"width"===o.toLocaleLowerCase())&&"%"!==s.substr(s.length-1)&&(o=parseInt(s,10))<=1.1*e&&.9*e<=o&&(t.attributes[n].value=t.attributes[n].value+";width:100%")}}for(var e=this.entity.views,t=!0,n=0;n<e.length;n++){var o=e[n];!0===o.autoWidth?o.width!==v&&o.width<=$(i).width()&&this.eachLayout(function(e){if(null!=e.attributes&&$IU.isArray(e.attributes)){if("LayoutTable"===e.renderType)for(var t=0,n=e.attributes.length;t<n;t++)a(e.attributes[t])&&"style"===e.attributes[t].key.toLocaleLowerCase()&&r(o.width,e,t);if("LayoutDivision"===e.renderType){for(var i=!1,t=0,n=e.attributes.length;t<n;t++)null!=e.attributes[t].key&&null!=e.attributes[t].value&&("class"===e.attributes[t].key.toLocaleLowerCase()&&-1!==e.attributes[t].value.indexOf("xdRepeatingSection")&&(i=!0),"xctname"===e.attributes[t].key.toLocaleLowerCase())&&-1!==e.attributes[t].value.indexOf("RepeatingSection")&&(i=!0);if(i)for(t=0,n=e.attributes.length;t<n;t++)a(e.attributes[t])&&"style"===e.attributes[t].key.toLocaleLowerCase()&&r(o.width,e,t)}}},o):t=!1}$$.params.allAutoWidth=t},createRendersTree:function(e,t){var n=[],i=[];if(e&&0<e.length){for(var a=[],r=0;r<e.length;r++)"Layoutable"==e[r].category&&a.push(e[r]);for(r=0;r<e.length;r++){for(var o=!0,s=this.createRenderItem(e[r],t),l=0;l<a.length;l++){var u=a[l].renders,d=[];if(u&&0<u.length)for(var c=0;c<u.length;c++)u[c].nameRef==s.name&&d.push(u[c]);if(d&&0<d.length){o=!1;break}}o?n.push(s):i.push(e[r])}}return n&&0<n.length&&this.createChildRenders(n,i,t),n},createChildRenders:function(e,t,n){if(e&&0<e.length){for(var i=0;i<e.length;i++){var a=e[i];if("Layoutable"==a.renderCategory){var r=[],o=a._renders;if(o&&0<o.length)for(var s=0;s<o.length;s++)for(var l=0;l<t.length;l++){var u="",u="object"==typeof o[s]&&o[s].nameRef?o[s].nameRef:o[s];if(t[l].name==u){u=this.createRenderItem(t[l],n);r.push(u);break}}0<(a.renders=r).length&&this.createChildRenders(r,t,n)}}this.setGuideLineNumbering(e)}},setGuideLineNumbering:function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n];"Guideline"==i.kind?(i.number=0,i.numbering&&i.numbering.format&&"1/"==i.numbering.format&&(t++,i.number=t)):t=0}},createStyle:function(e){var t="";if(e&&0<e.length)for(var n=0;n<e.length;n++)e[n]&&e[n].value&&(t+=e[n].value);return t},createProperties:function(e,t){var n=[];if(e&&0<e.length){for(var i,a={},r=0;r<e.length;r++){var o=e[r].kind;o&&(a[o]||(a[o]=[]),s={value:e[r].value,condition:e[r].condition},a[o].push(s))}for(i in a){var s={key:i,values:a[i]};n.push(s)}}return n},createRenderAttributes:function(e){var t,n=this.createStyle(e.styles),e=(e.lines&&(n+="height:"+30*parseInt(e.lines)+"px;"),e.numbering&&e.numbering.format?e.numbering.format:""),i=(e&&1<(e=this.getTitleLevel(e))&&(n+="margin-left:"+20*(e-1)+"px;"),{}),a=(n&&(i.style=n),[]);for(t in i)a.push({key:t,value:i[t]});return a},getTitleLevel:function(e){var t=1;if(e){for(var n=e.split("1."),i=!0,a=0;a<n.length;a++)if(n[a]){i=!1;break}i&&(t=n.length-1)}else t=1;return t},createRenderItem:function(e,t){var t={controlId:"V"+t+"_"+e.name,renderCategory:e.category,renderType:"Displayable"==e.category?"Display"+e.kind:"Bound"+e.kind,repeatable:"RepeatSection"==e.kind||"RepeatTable"==e.kind,_renders:[]},n="";return"Displayable"==e.category?n="Display"+e.kind:"Boundable"==e.category?n="Bound"+e.kind:"RepeatSection"==e.kind?n="LayoutSection":"RepeatTable"==e.kind&&(n="LayoutTable"),n&&(t.renderType=n),e.name&&(t.name=e.name),e.kind&&(t.kind=e.kind),e.field&&(t.field=e.field),e.required&&(t.required=e.required),e.textContent&&(t.textContent=e.textContent),e.format&&(t.format=e.format),e.placeholder&&(t.placeholder=e.placeholder),e.minLength&&(t.minLength=e.minLength),e.maxLength&&(t.maxLength=e.maxLength),e.fileTypes&&0<e.fileTypes.length&&(t.fileTypes=e.fileTypes),e.fileSecure&&(t.fileSecure=e.fileSecure),e.fileDownload&&(t.fileDownload=e.fileDownload),e.windowMode&&(t.windowMode=e.windowMode),e.serverEvent&&(t.serverEvent=e.serverEvent),e.label&&(t.label=e.label),e.layout&&(t.layout=e.layout),e.tooltip&&(t.tooltip=e.tooltip),e.validations&&0<e.validations.length&&(t.validations=e.validations),e.source&&(t.source=e.source),e.icons&&0<e.icons.length&&(t.icons=e.icons),e.numbering&&(t.numbering=e.numbering),e.renders&&0<e.renders.length&&(t._renders=e.renders),t.properties=this.createProperties(e.properties),t.attributes=this.createRenderAttributes(e),t},createViewsStructure:function(e){for(var t=[],n=0;n<e.length;n++){var i=this.createRendersTree(e[n].renders,n),i={label:e[n].label,renders:i},a=this.countMaxLabelWidthRecursion(e[n].renders);i.maxLabelWidth=a,t.push(i)}return t},countLabelWidth:function(e,t){return(t=this.entity.views[0]).label&&"top"==t.label.dock?"auto":e.label&&(e.label.width||0==e.label.width)?e.label.width+"px":t.label&&t.label.width?t.label.width+"px":t.maxLabelWidth+12+"px"},countMaxLabelWidthRecursion:function(e){var t=0;if(e&&0<e.length)for(var n=0;n<e.length;n++){var i=e[n].label;i&&!i.width&&0!=i.width&&t<(i=7.5*(i.text?i.text.replace(/[^\x00-\xff]/g,"**").length:0))&&(t=i)}return t},createViews:function(){var e,t,n,i;i=$$.params.engine&&"qform"==$$.params.engine?(e=this.entity.qform.spec.content.views,t=this.createViewsStructure(e),this.entity.views[0].renders=t[0].renders,this.entity.views[0].maxLabelWidth=t[0].maxLabelWidth,this.entity.views[0].label=t[0].label,1<(n=t.length)):1<(n=(t=this.entity.views).length),$$.MOBILE&&0<n&&!0===t[0].mobileFont&&this.convertSize(),this.findSyncFields(),this.convertReadOnlyControls(),this.findMasterDetailGroups(),this.filterUnusableAttributes(),this.changeFontStyle(),this.processAutoViewWidth(),this.processEmptyDiv(),this.addViewCss(),this.addQformCss(),$$.params.printInvoice=$$.params.printInvoice&&this.findBoundThingControl(),this.views=[];for(var a=0;a<n;a++)this.createView(t[a],a,!$$.PREVIEW&&!$$.PRINT&&!0===i,$$.params.engine&&"qform"==$$.params.engine);this.initSpecialControls(),this.initVarControls(),this.initDynamicParallel()},initSpecialControls:function(){this.initSelect2($(".infoplus_select2")),this.initRichText($(".infoplus_richTextControl")),this.initRadio($(".infoplus_radioControl")),this.initCheck($(".infoplus_checkControl"))},initCheck:function(e){null!=e&&0!==e.length&&e.each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).initCheck()})},initRadio:function(e){null!=e&&0!==e.length&&e.each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).initRadio()})},initSelect2:function(e){null!=e&&0!==e.length&&e.each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).initSelect2()})},initRichText:function(e){var t;null!=e&&0!==e.length&&(t=function(e){$(e).data($Control.DATA_CONTROL_OBJECT).init()},null==i.CKEDITOR?loadAllScript([$$.params.libs.ckeditor],function(){e.each(function(){null!=i.CKEDITOR?t(this):$IU.debugTip("ckeditor","warning")})}):e.each(function(){t(this)}))},initLabel:function(e){null!=e&&0!==e.length&&e.each(function(){$(this).data($Control.DATA_CONTROL_OBJECT).addRepeatInitHeightStyle()})},findSyncFields:function(){var n=this,i={};this.eachLayout(function(e){var t,e=e.field;i.hasOwnProperty(e)?i[e].needSync=!0:null!=(t=n.getField(e))&&(i[e]=t)},null,"Boundable")},convertReadOnlyControls:function(){var n,i;"None"!==$$.params.tenantReadOnlyStyle&&(i=["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundSuggester","BoundSuggester2","BoundSelect","BoundOptionList"],(n=this).eachLayout(function(e){var t=n.getField(e.field);null!=t&&-1!==(t=(t=t.permission)||"").indexOf("r")&&-1===t.indexOf("w")&&$IU.arrayContains(i,e.renderType)&&(e.convertFromText="BoundTextArea"===e.renderType||"BoundRichText"===e.renderType,e.renderType="BoundConvertedLabel")},null,"Boundable"))},findBoundThingControl:function(){var t=!1;return this.eachLayout(function(e){"BoundThing"===e.renderType&&(t=!0)},null,"Boundable"),t},changeFontStyle:function(){function h(e){if($IU.isArray(e))for(var t=0,n=e.length;t<n;t++){var i=e[t];if(null!=i.key&&"style"===i.key.toLocaleLowerCase())return i}return null}function p(e){switch(e){case"":case"Microsoft YaHei":return"'PingFang SC',"+e;case"":case"SimSun":return"'Songti SC',"+e;case"":case"SimHei":return"'Heiti SC',"+e;case"":case"KaiTi":return"'Kaiti SC',"+e}return""}var e=this;e.eachLayout(function(e){if(null!=e.attributes){e=h(e.attributes);if(null!=e&&null!=e.value){for(var t=e.value.split(";"),n=!1,i=0,a=t.length;i<a;i++)if(-1!==t[i].toLocaleLowerCase().indexOf("font-family")){var r=t[i].toLocaleLowerCase().split(":");r[1]!==v&&""!==(r=p($IU.trimString(r[1])))&&(t[i]="font-family:"+r,n=!0);break}if(n){for(var o="",i=0,a=t.length;i<a;i++)o+=t[i]+";";e.value=o}}}}),e.eachLayout(function(e){if("LayoutFont"===e.renderType&&null!=e.attributes)for(var t=h(e.attributes),n=0,i=e.attributes.length;n<i;n++){var a=e.attributes[n];if("face"===a.key.toLocaleLowerCase()){a=p(a.value);if(""!==a)if(null!=t){c=d=u=l=s=void 0;for(var r=t,o=a,s=r.value.split(";"),l=!1,u=0,d=s.length;u<d;u++)if(-1!==s[u].toLocaleLowerCase().indexOf("font-family")){s[u]+=","+o,l=!0;break}if(l){for(var c="",u=0,d=s.length;u<d;u++)c+=s[u]+";";r.value=c}else r.value+=";font-family:"+o}else e.attributes[i]={key:"style",value:"font-family:"+a}}}},null,"Layoutable")},filterUnusableAttributes:function(){var i=["type","binding","ctrlid","xctname","tabindex","hidefocus","onvalue","boundprop"];this.eachLayout(function(e){if(null!=e.attributes&&$IU.isArray(e.attributes))for(var t=0;t<e.attributes.length;)!function(e){for(var t=0,n=i.length;t<n;t++)if(i[t]===e.toLocaleLowerCase())return!0;return!1}(e.attributes[t].key)?t++:e.attributes.splice(t,1)},null,"Boundable")},findMasterDetailGroups:function(){if(!$$.PRINT){var e,n=this,i={},a=(this.eachLayout(function(e){var t,n;!0===e.repeatable&&(t=e.groupName,n="LayoutTable"===e.renderType,n=n,e=e,i.hasOwnProperty(t=t)||(i[t]={}),n?i[t].rtRender=e:i[t].rsRender=e)},null,"Layoutable"),["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundSuggester","BoundSuggester2","BoundSelect","BoundOption","BoundOptionList","BoundCheckList","BoundThing"]);for(e in i)if(i.hasOwnProperty(e)&&null!=i[e].rtRender&&null!=i[e].rsRender){n.entity.groups[e].isMasterDetail=!0;for(var t=$.extend(!0,{},i[e].rsRender),r=(t.repeatable=!1,i[e].rtRender.columns.push({renderType:"Renderable",renderCategory:"Renderable",width:0,attributes:[{key:"style",value:"WIDTH: 0px"}]}),-1),o=0,s=i[e].rtRender.renders.length;o<s;o++)!0!==i[e].rtRender.renders[o].repeating?i[e].rtRender.renders[o].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:!1,attributes:[{key:"class",value:"detailCell"}],renders:[]}):r=o;var l=function(e){var t=[];return n.eachLayout(function(e){t.push(e.field)},e,"Boundable"),t}(t);-1!==r&&(this.eachLayout(function(e){(function(e){if(null!=e)for(var t=0,n=a.length;t<n;t++)if(a[t]===e)return!0;return!1})(e.renderType)&&$IU.arrayContains(l,e.field)&&(e.renderType="BoundLabel")},i[e].rtRender.renders[r],"Boundable"),i[e].rtRender.renders[r].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:!1,attributes:[{key:"class",value:"detailCell"}],renders:[t]}))}}},draw:function(){var e=$.Deferred();if(null==this.holder||null==this.entity)return e.reject();var t,n=$(this.holder);n.undelegate(),n.empty();try{CollectGarbage()}catch(e){}null!=this.entity.step&&(n=(null!=this.entity.step.name?this.entity.step.name+" - ":"")+this.entity.app.name,$IU.setDocumentTitle(n),$$.WECHAT)&&(n=$("body"),(t=$("<iframe style='display:none;' src='/static/img/favicon.ico'></iframe>")).on("load",function(){setTimeout(function(){t.off("load").remove()},0)}).appendTo(n)),$$.dynamics.globalContext=$$.getGlobalContext(this.data);var i=this,a=function(){var e=Array.prototype.slice.call(arguments);0<e.length&&(e[0].apply(),e.splice(0,1),setTimeout(function(){a.apply(null,e)},0))};return this.doDynamicFormulaControls=[],a(function(){i.createViews(),progress($$.lt("load.loadPage"),80)},function(){i.initDynamicStyles(),progress($$.lt("load.loadPage"),83)},function(){i.initDynamicActions(),progress($$.lt("load.loadPage"),87)},function(){i.initDynamicValues(),progress($$.lt("load.loadPage"),90)},function(){$$.params.initControls=[],i.initFieldReferedClass(),i.processEvent(),i.triggerVarUrlChange(),$$.codeManager.requestCodes(),progress($$.lt("load.loadPage"),95),setTimeout(function(){e.resolve()},0)}),e.promise()},triggerVarUrlChange:function(){$("#_VAR_URL").change()},doDynamicFormulas:function(e,t){if(null!=e)for(var n=$$.dynamics.formulas,i=0,a=e.length;i<a;i++){var r=e[i],o=r.getDynamicKeyName();null!=o&&n.hasOwnProperty(o)&&r.setDynamicValue(this,t)}},doDynamicStyles:function(e,t){for(var n=$$.dynamics.styles,i=0,a=e.length;i<a;i++){var r=e[i],o=r.getDynamicKeyName();null!=o&&n.hasOwnProperty(o)&&r.setDynamicStyle(this,t)}},doDynamicActions:function(e,t){for(var n=$$.dynamics.actions,i=0,a=e.length;i<a;i++){var r=e[i],o=r.getDynamicKeyName();null!=o&&n.hasOwnProperty(o)&&r.doDynamicAction(this,t)}},doDynamicValidations:function(e,t){for(var n=$$.dynamics.validations,i=0,a=e.length;i<a;i++){var r=e[i],o=r.getDynamicKeyName();null!=o&&n.hasOwnProperty(o)&&r.doDynamicValidation(this,t)}},initDynamicValues:function(){this.doDynamicFormulas(this.doDynamicFormulaControls,!0)},initDynamicStyles:function(){this.doDynamicStyles($IU.getAllControls(),!0)},initDynamicActions:function(){this.doDynamicActions($IU.getAllControls(),!0)},initFieldReferedClass:function(){var i=$$.dynamics.referedFormulas,a=$$.dynamics.referedStyles,r=$$.dynamics.referedActions,o=$$.dynamics.referedValidations;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t,n=$(this).data($Control.DATA_CONTROL_OBJECT);null!=n&&n.field!==v&&!1===n.onFieldRefer&&(e=n.getDynamicKeyName(),t=n.getDynamicContextControlName(),i[e]===v&&a[e]===v&&r[e]===v&&o[e]===v&&i[t]===v&&a[t]===v&&r[t]===v&&o[t]===v||(n.onFieldRefer=!0,n.addFieldChangeClass()))})},updateAllRowIndex:function(){$$.params.renderForm.find("."+$Control.CLASSNAME_ROWINDEX).each(function(){var e=this;setTimeout(function(){$(e).change()},0)})},doDynamicsAfterFieldChange:function(){$$.dynamics.cache.build();var e=$IU.getAllControls();this.doDynamicStyles(e,!1),this.doDynamicActions(e,!1),this.doDynamicValidations(e,!1),this.updateAllRowIndex()},getEntity:function(e,t,n){var i=t.split("_"),a=(i.shift(),n[e]);if(null==a)return null;for(var r=0;r<i.length;r++){var o=parseInt(i[r]);if(!($IU.isArray(a)&&o<a.length))return null;if(null==(a=a[o]))return null}return a},setEntity:function(e,t,n,i,a){null==i&&(i=this.data);var r=[];if(null!=n&&""!==n.length)for(var o,s=(r=n.split("_"))[o=0];null!=s;)""===$IU.trimString(s)?r.splice(o,1):o++,s=r[o];if(0<r.length){o=0,null==i[t]&&(i[t]=[]);for(var l,u=i[t];o<r.length-1;)null==u[l=parseInt(r[o++])]&&(u[l]=[]),u=u[l];l=parseInt(r[r.length-1]),null==e?u.splice(l,1):null!=u[l]&&a||(u[l]=e)}else null!=i[t]&&a||(i[t]=e);return i},diceLayout:function(e){var t=[];return this.eachLayout(function(e){e=e.field;null==e||$IU.arrayContains(t,e)||t.push(e)},e,"Boundable"),t},createView:function(e,t,n,i){var a,r;i?null!=(a=this.createDesignerLayout(e,this.data,""))&&(r=new InfoPlus.Layout.View({prefix:this.prefix,index:t,render:e,element:a,holder:this.holder,hasLabel:n}),this.views.push(r),this.dynamicAnalyzer.analysisDynamic(e.properties,r.getDynamicKeyName())):null!=(a=this.createLayout(e,this.data,"",e.fixTableHeight))&&(r=new InfoPlus.Layout.View({prefix:this.prefix,index:t,render:e,element:a,holder:this.holder,hasLabel:n}),this.views.push(r),this.dynamicAnalyzer.analysisDynamic(e.properties,r.getDynamicKeyName()))},createDisplayElement:function(e){var t,n;switch(e.renderType){case"DisplayText":"mdx"===e.syntax?(n=document.createElement("span"),null!=e.cssClass&&$(n).addClass(e.cssClass),null!=e.emoji&&(t=document.createElement("span"),$(t).addClass("mdx_emoji mdx_emoji_"+e.emoji),$(n).append(t)),$(n).append(document.createTextNode(e.text))):n=document.createTextNode(e.text);break;case"DisplayBreak":n=document.createElement("br");break;case"DisplayAnchor":(n=document.createElement("a")).setAttribute("href",e.uri||""),n.setAttribute("target","_blank"),$(n).text(e.text||"");break;case"DisplayImage":if((n=document.createElement("img")).setAttribute("border","0"),null!=e.uri&&n.setAttribute("src",$$.params.baseUrl+"file/form/"+this.entity.viewId+"/"+e.uri),null!=e.attributes&&$IU.isArray(e.attributes))for(var i=0,a=e.attributes.length;i<a;i++){var r=e.attributes[i];if("style"===r.key){n.setAttribute("style",r.value);break}}break;case"DisplayLabel":if((n=document.createElement("label")).innerText=e.text,n.setAttribute("for",e.labelFor||""),null!=e.attributes&&$IU.isArray(e.attributes))for(var o=0;o<e.attributes.length;o++)"class"===e.attributes[o].key&&(n.className+=" "+e.attributes[o].value)}return n},createDesignerDisplayElement:function(e){switch(e.renderType){case"DisplayText":r=document.createElement("div"),$(r).addClass("kt-style-text-container");var t=[];e.textContent&&(t=e.textContent.split("\n"));for(var n=0;n<t.length;n++)(u=document.createElement("div")).innerHTML=t[n],$(u).addClass("text-p"),r.appendChild(u);break;case"DisplayTitle":var i=e.label&&e.label.text?e.label.text:"",a=e.tooltip&&e.tooltip.text?e.tooltip.text:"",r=document.createElement("div"),o=($(r).addClass("kt-style-title-container"),document.createElement("div")),i=($(o).addClass("kt-style-title"),o.innerText=i,document.createElement("div"));$(i).addClass("kt-style-subtitle"),i.innerText=a,r.appendChild(o),r.appendChild(i);break;case"DisplaySectionBreak":var s=e.label&&e.label.text?e.label.text:"",a=(r=document.createElement("div"),$(r).addClass("kt-style-section-break-container"),document.createElement("div"));$(a).addClass("left_span"),r.innerText=s,r.appendChild(a);break;case"DisplayGuideline":var s=e.label&&e.label.text?e.label.text:"",o=(r=document.createElement("div"),$(r).addClass("kt-style-guild-line-container"),document.createElement("div")),l=($(o).addClass("guildline-label"),e.number&&(i=$("<div class='numbering'><div>"+e.number+"</div>/</div>"),$(o).append(i)),$(o).append(s),r.appendChild(o),document.createElement("div")),t=($(l).addClass("guildline-text"),r.appendChild(l),[]);e.textContent&&(t=e.textContent.split("\n"));for(var u,n=0;n<t.length;n++)(u=document.createElement("div")).innerHTML=t[n],$(u).addClass("guildline-text-p"),l.appendChild(u);0<t.length&&(a=document.createElement("div"),$(a).addClass("guildline-line"),l.appendChild(a))}return r},createDesignerLayout:function(e,t,n){for(var i=this.createDesignerLayoutElement(e),a=$(i).find("div")[0],r=e.renders,o=!1,s=0;s<r.length;s++){var l=r[s];if(null!=l){var u=l.renderCategory;if(null!=u)switch(u){case"Boundable":var d=(h=this.createElementContainer(l,e)).find(".kt-control-content")[0],c=this.createControl(l,t,n,e);null!=d&&null!=c&&(d.appendChild(c),this.setElementAttributes(c,l)),$(a).append(h);break;case"Displayable":var h,d=(h=this.createElementContainer(l,e)).find(".kt-control-content")[0];c=this.createDesignerDisplayElement(l),null!=d&&null!=c&&(d.appendChild(c),this.setElementAttributes(c,l)),$(a).append(h);break;case"Layoutable":if(!0===l.repeatable){var p=document.createElement("div"),f="LayoutTable"===l.renderType,m=l.field;if(null==m){$IU.debugTip("","warning");break}if(f){for(var g=-1,C=0,_=l.renders.length;C<_;C++)if(!0===l.renders[C].repeating){g=C;break}if(-1===g){$IU.debugTip(""+m+"","warning");break}E=this.diceLayout(l.renders[g])}else var E=this.diceLayout(l);var T,I=0<E.length?E[E.length-1]:null,m=this.entity.groups[m];!0!==m.isMasterDetail||f?(T=null!=(T=r[s+1])&&T.renders!==v&&0<T.renders.length&&T.renders[0].text!==v?T.renders[0].text:null,I=new InfoPlus.Repeat.RepeatControl({initData:t,formRender:this,render:l,path:n,repeatParentElement:p,repeatContentParentElement:p,firstControlNamePrefix:I,repeatType:f?InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE:InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION,addLinkText:T,fieldNames:E,groupInformation:m}),f=$("<div class='kt-col kt-col-xs-24'></div>")[0],l.layout&&l.layout.columns&&$(f).addClass("kt-col-md-"+l.layout.columns),f.appendChild(p),i.getElementsByTagName("div")[0].appendChild(f),this.dynamicAnalyzer.analysisDynamic(l.properties,I.getDynamicKeyName(),I.rowIndexFieldName,I.groupCountFieldName)):m.detailRender=l,o=!0}else!0===o?o=!1:(c=this.createDesignerLayout(l,t,n),null!=a&&(a.appendChild(c),$$.params.mobileAutoView)&&$(c).hasClass("infoplus_auto_view_repeatTable_wrap_outer")&&0<(T=$(c).children().children(".infoplus_addLinkContainerDiv").first()).length&&T.detach().appendTo(a))}}}return i},createElementContainer:function(e,t){var n,i=$("<div class='kt-col  kt-col-xs-24'><div class='kt-control'></div></div>"),a=(e.renderType==$Control.CONTROL_TYPE_HIDDEN&&i.hide(),e.layout&&e.layout.columns&&i.addClass("kt-col-md-"+e.layout.columns),$("<div class='kt-control-content'></div>"));return e.label&&e.label.text&&(t=this.countLabelWidth(e,t),e="true"==e.label.visible?e.label.text:"",n="width:"+t+";","0px"==t&&(n+="padding-right:1px;"),t=$("<div class='kt-control-label' style='"+n+"'>"+e+"</div>"),i.find(".kt-control").append(t)),i.find(".kt-control").append(a),i},setElementAttributes:function(e,t){if(e){var n,i=$(e).parents(".kt-control"),a=("none"==$(e).css("display")&&i.hide(),"Boundable"==t.renderCategory&&t.tooltip&&t.tooltip.text&&(n=$("<div class='kt-control-content-tip'>"+t.tooltip.text+"</div>"),(l=$(e).parent(".kt-control-content")).size())&&l.append(n),t.icons);if(a&&0<a.length){var r=$("<div class='kt-style-input-container'></div>");r.insertAfter($(e)),r.append(e);for(var o,s=0;s<a.length;s++)a[s].dock&&a[s].value&&((o=$("<i></i>")).addClass("kt-style-"+("right"==a[s].dock?"suffix":"prefix")+"-icon"),o.addClass(a[s].value),r.append(o),$(e).addClass("kt-style-has-"+("right"==a[s].dock?"suffix":"prefix")+"-icon"))}t.required&&i.addClass("is-required");var l="kt-style-"+t.kind.toLowerCase();if($(e).addClass(l),"Displayable"==t.renderCategory){var u=t.attributes;if(u&&0<u.length)for(s=0;s<u.length;s++)u[s].key&&u[s].value&&$(e).attr(u[s].key,u[s].value)}}},createLayout:function(e,t,n,i){for(var a,r=this.createLayoutElement(e),o=r,s=(this.createAttributes(r,e.attributes,i),"LayoutTable"===e.renderType&&(a=document.createElement("tbody"),r.appendChild(a),o=a),e.renders),l=!1,u=0;u<s.length;u++){var d=s[u];if(null!=d){var c,h=d.renderCategory;if(null!=h)switch(h){case"Boundable":c=this.createControl(d,t,n),null!=o&&null!=c&&o.appendChild(c);break;case"Displayable":c=this.createDisplayElement(d),null!=o&&null!=c&&o.appendChild(c);break;case"Layoutable":if(!0===d.repeatable){var p=o,f="LayoutTable"===d.renderType,m=d.groupName;if(null==m){$IU.debugTip("","warning");break}if(f){for(var g=-1,C=0,_=d.renders.length;C<_;C++)if(!0===d.renders[C].repeating){g=C;break}if(-1===g){$IU.debugTip(""+m+"","warning");break}E=this.diceLayout(d.renders[g])}else var E=this.diceLayout(d);var T,I=0<E.length?E[E.length-1]:null,m=this.entity.groups[m];!0!==m.isMasterDetail||f?(T=null!=(T=s[u+1])&&T.renders!==v&&0<T.renders.length&&T.renders[0].text!==v?T.renders[0].text:null,p=new InfoPlus.Repeat.RepeatControl({initData:t,formRender:this,render:d,path:n,repeatParentElement:p,repeatContentParentElement:p,firstControlNamePrefix:I,repeatType:f?InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE:InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION,addLinkText:T,fieldNames:E,groupInformation:m}),this.dynamicAnalyzer.analysisDynamic(d.properties,p.getDynamicKeyName(),p.rowIndexFieldName,p.groupCountFieldName)):m.detailRender=d,l=!0}else!0===l?l=!1:(c=this.createLayout(d,t,n,i),null!=o&&(o.appendChild(c),$$.params.mobileAutoView)&&$(c).hasClass("infoplus_auto_view_repeatTable_wrap_outer")&&0<(I=$(c).children().children(".infoplus_addLinkContainerDiv").first()).length&&I.detach().appendTo(o))}}}return r},createColGroup:function(e,t){var n=e.columns;if(null!=n){for(var i=document.createElement("colgroup"),a=0;a<n.length;a++){var r=document.createElement("col");0<n[a].width&&(r.width=n[a].width),this.createAttributes(r,n[a].attributes),i.appendChild(r)}t.appendChild(i)}},createDesignerLayoutElement:function(e){var t,n,i=null,i=document.createElement("div");return e.renderType?"LayoutSection"===e.renderType?(t=document.createElement("div")).classList="kt-style-repeatSection":t=document.createElement("div"):(t=document.createElement("div"),$(t).addClass("kt-style-form"),n="kt-style-form-label-"+(e.label&&e.label.dock?e.label.dock:"left"),$(t).addClass(n),e.styles&&0<e.styles.length&&(style=e.styles.join(";"),t.setAttribute("style",style))),i.appendChild(t),i},createLayoutElement:function(e){var t=null;switch(e.renderType){case"FormView":case"LayoutDivision":t=document.createElement("div");break;case"LayoutTable":t=document.createElement("table"),this.createColGroup(e,t);break;case"LayoutTableRow":t=document.createElement("tr");break;case"LayoutTableCell":t=document.createElement("td");break;case"LayoutHeader":t=document.createElement("h"+e.size);break;case"LayoutFont":t=document.createElement("font");break;case"LayoutPhrase":switch(e.phraseType){case"Emphasized":t=document.createElement("em");break;case"Strong":t=document.createElement("strong");break;case"Definition":t=document.createElement("dfn");break;case"Code":t=document.createElement("code");break;case"Keyboard":t=document.createElement("kbd");break;case"Sample":t=document.createElement("samp");break;case"Variable":t=document.createElement("var");break;case"Citation":t=document.createElement("cite");break;case"Superscript":t=document.createElement("sup");break;case"Subscript":t=document.createElement("sub");break;case"Underline":t=document.createElement("u");break;case"Italic":t=document.createElement("i");break;case"Small":t=document.createElement("small");break;case"StrikeThrough":t=document.createElement("s");break;case"Big":t=document.createElement("big")}break;case"LayoutOrderedList":t=document.createElement("ol");break;case"LayoutUnorderedList":t=document.createElement("ul");break;case"LayoutListItem":t=document.createElement("li");break;case"LayoutAnchor":(t=document.createElement("a")).setAttribute("href",e.uri||""),t.setAttribute("target","_blank");break;case"LayoutLabel":t=document.createElement("label");break;default:t=document.createElement("div")}return t},getDisplayText:function(e,t,n,i){return t[i+"_displayText"]!==v?t[i+"_displayText"]:(t=e.fieldText||i+"_Name",this.getEntity(t,n,this.data))},getAttributeValue:function(e,t,n){if(!0===$$.params.initializing){e=this.getEntity(t+"_Attr",e,this.data);if(null!=e)return $.parseJSON(e)}return null!=n&&n.hasOwnProperty(t+"_Attr")?n[t+"_Attr"]:null},getParentValue:function(e,t,n){t=this.getAttributeValue(e,t);return null!=t&&null!=t._parent?t._parent:n!==v?this.getParentValueOrAttributes(e,n,!0):null},getParentValueOrAttributes:function(e,t,n){var i=[],a=e.split("_");i.push("");for(var r=1;r<a.length;r++)i.push(i[i.length-1]+"_"+a[r]);for(var o=i.pop(),s=null;o!==v&&null==(s=!0===n?this.getEntity(t,o,this.data):this.getAttributeValue(o,t));)o=i.pop();return s},getParentAttributes:function(e,t){return this.getParentValueOrAttributes(e,t,!1)},getField:function(e){var t=null;return null!=e&&null!=this.entity.fields&&null==(t=this.entity.fields[e])&&$IU.debugTip(""+e+",","warning"),t},setFieldProperties:function(e,t){e.notNull=1==t.required,t.validations&&0<t.validations.length&&(t.validations[0].text&&(e.prompt=t.validations[0].text),t.validations[0].value)&&(e.regEx=t.validations[0].value),e.settings||(e.settings={}),e.settings.fileDownload=1==t.fileDownload,t.fileSecure&&(e.settings.fileSecure=t.fileSecure),t.fileTypes&&0<t.fileTypes.length&&(e.settings.fileTypes=t.fileTypes.join(",")),t.maxLength&&(e.settings.maxLength=t.maxLength)},createControl:function(e,t,n){var i=e.field;if(null==i)return null;var a=this.getField(i);if(null==a)return null;$$.params.engine&&"qform"==$$.params.engine&&this.setFieldProperties(a,e);var r=t[i],o="",s=null,i=(r!==v&&""!==r&&(o=this.getDisplayText(e,t,n,i)),a.parent!==v&&(s=this.getParentValue(n,i,a.parent)),this.getAttributeValue(n,a.name,t));return this.createControlElement(n,a,e,r,o,s,i)},getSelectDataSource:function(e){var t=null;return t=null!=e.code&&null!=this.entity.codes[e.code]?this.entity.codes[e.code].items:t},createControlElement:function(e,t,n,i,a,r,o){var s=null,l=null;switch(n.settings=$.extend(d,n.settings),n.renderType){case $Control.CONTROL_TYPE_EDIT:l=new $Controls.Edit(e,t,n,i);break;case $Control.CONTROL_TYPE_PASSWORD:l=new $Controls.Password(e,t,n,i);break;case $Control.CONTROL_TYPE_TEXT:l=new $Controls.Text(e,t,n,i);break;case $Control.CONTROL_TYPE_RICHTEXT:l=new $Controls.RichText(e,t,n,i);break;case $Control.CONTROL_TYPE_DATE:l=new $Controls.Date(e,t,n,i);break;case $Control.CONTROL_TYPE_TIME:l=new $Controls.Time(e,t,n,i);break;case $Control.CONTROL_TYPE_CHECKBOX:l=new $Controls.Check(e,t,n,i);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:l=new $Controls.CheckList(e,t,n,i,a);break;case $Control.CONTROL_TYPE_RADIO:l=new(t.type===$Control.DATA_TYPE_BOOL?$Controls.RadioGroup:$Controls.Radio)(e,t,n,i);break;case $Control.CONTROL_TYPE_RADIO_LIST:l=new $Controls.RadioList(e,t,n,i,a,r,o);break;case $Control.CONTROL_TYPE_SELECT:l=new $Controls.Select(e,t,n,i,a,r,o);break;case $Control.CONTROL_TYPE_REMARK:l=new $Controls.Remark(e,t,n,i);break;case $Control.CONTROL_TYPE_BUTTON:l=new $Controls.Button(e,t,n,i,a);break;case $Control.CONTROL_TYPE_CHECK_BUTTON:l=new $Controls.CheckButton(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_LINK_BUTTON:l=new $Controls.LinkButton(e,t,n,i,a);break;case $Control.CONTROL_TYPE_ANCHOR:l=new $Controls.Anchor(e,t,n,i,a);break;case $Control.CONTROL_TYPE_LABEL:l=new $Controls.Label(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_CONVERTED_LABEL:l=new $Controls.Label(e,t,n,i,a,o,!0);break;case $Control.CONTROL_TYPE_HIDDEN:l=new $Controls.Hidden(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_SUGGESTER:var u=null!=t.code?this.entity.codes[t.code].tipFormat:null,l=new $Controls.Suggester(e,t,n,this,i,a,r,u,this.suggestService,this.suggestInitializeService,o);break;case $Control.CONTROL_TYPE_SUGGESTER2:l=new $Controls.Suggester2(e,t,n,i,a,r,this.suggestService,o);break;case $Control.CONTROL_TYPE_DOC:l=new $Controls.Doc(e,t,n,i);break;case $Control.CONTROL_TYPE_FILE:l=new $Controls.File(e,t,n,i);break;case $Control.CONTROL_TYPE_HELP:l=new $Controls.Help(e,t,n,i);break;case $Control.CONTROL_TYPE_IMAGE:l=new $Controls.Image(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_PICTURE:l=new $Controls.Picture(e,t,n,i);break;case $Control.CONTROL_TYPE_IFRAME:l=new $Controls.Iframe(e,t,n,i);break;case $Control.CONTROL_TYPE_THING:l=new $Controls.Thing(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_SWITCH:l=new $Controls.Switch(e,t,n,i);break;case $Control.CONTROL_TYPE_MAP:l=new $Controls.Map(e,t,n,i,a,o);break;case $Control.CONTROL_TYPE_SIGNATURE:l=new $Controls.Signature(e,t,n,i,a);break;case $Control.CONTROL_TYPE_SEAL:l=new $Controls.Seal(e,t,n,i,a)}return null!=l&&(this.dynamicAnalyzer.analysisDynamic(n.properties,l.getDynamicKeyName(),l.getGroupRowIndexName(),l.getGroupCountName(),t.parent),s=l.getControlContainer(),$$.registerControlEvents(l),l instanceof $Controls.Edit||($(l.element).removeClass("xdTextBox"),$(s).removeClass("xdTextBox"))),s},createAttributes:function(s,e,l){if(null!=s&&null!=e&&$IU.isArray(e))for(var t,n=0;n<e.length;n++){var i,a=e[n],r=a.key;null!=a.namespace&&""!==a.namespace&&(r=a.namespace+":"+r);try{switch(r.toLocaleLowerCase()){case"class":$(s).addClass(a.value);break;case"onclick":case"value":break;case"style":t=void 0,null==s.nodeName||"table"!==(t=s.nodeName.toLocaleLowerCase())&&"tbody"!==t&&"tr"!==t&&"td"!==t&&"th"!==t?s.setAttribute(r,a.value):""!==(i=function(e){if(null==e||""===e)return"";if(-1===e.toLocaleLowerCase().indexOf("min-height"))return e;for(var t=s.nodeName.toLocaleLowerCase(),n=e.split(";"),i=[],a=0,r=n.length;a<r;a++){var o=$IU.trimString(n[a]);""!==o&&(-1===o.toLocaleLowerCase().indexOf("min-height")?i.push(o):l&&"tr"==t&&(o=o.replace(/min-/gi,""),i.push(o)))}return i.join(";")}(a.value))&&s.setAttribute(r,i);break;default:s.setAttribute(r,a.value)}}catch(e){}}},saveAttributes:function(e,t,n,i,a){var r=e.getAttributes(),o=e.getParentValue();null==r&&null==o||(null==r&&(r={}),null!=o&&(r._parent=o)),null!=r?this.setEntity($.toJSON(r),t+"_Attr",n,i,a):null!=e.initAttributes&&this.setEntity("",t+"_Attr",n,i,a)},save:function(r,o){if(o===v&&(o=!1),null!=this.holder&&null!=this.entity){if(null==r){var e,t=this.entity.fields;for(e in t)t.hasOwnProperty(e)&&(this.data.hasOwnProperty(e)&&delete this.data[e],this.data.hasOwnProperty(e+"_Name")&&delete this.data[e+"_Name"],this.data.hasOwnProperty(e+"_Attr"))&&delete this.data[e+"_Attr"];r=this.data}for(var n=$("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT),i=0,a=n.length;i<a;i++){var s=$(n[i]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);null!=s&&this.setEntity(s.keyIndex,s.groupName,s.path,r,!1)}var l=this;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e,t,n,i,a=$(this);a.hasClass($Control.CLASSNAME_ROWINDEX)||a.hasClass($Control.CLASSNAME_GROUP_COUNT)||(e=a.data($Control.DATA_PATH),t=a.data($Control.DATA_FIELD),a=a.data($Control.DATA_CONTROL_OBJECT),null!=t&&null!=a&&(n=!0===o&&!a.isDetailControl()||!1===o&&a.isDetailControl(),(i=a.getValue(!0))instanceof $Controls.Data.ValuePair?(l.setEntity(i.value,t,e,r,n),l.setEntity(i.displayValue,t+"_Name",e,r,n),l.saveAttributes(a,t,e,r,n)):i instanceof $Controls.Data.Uri?l.setEntity(i.value,t,e,r,n):null!=i&&l.setEntity(i,t,e,r,n)))})}return r},discard:function(){null==this.entity.data&&(this.entity.data={}),this.data=$.extend(!0,{},this.entity.data)},eachLayout:function(e,t,n){if(null==t){for(var i=[],a=0;a<this.entity.views.length;a++){var r=this.entity.views[a];if(null!=r)for(var o=this.eachLayout(e,r,n),s=0;s<o.length;s++)i.push(o[s])}return i}for(var l=[],u=(null!=n&&n!==t.renderCategory||("function"==typeof e&&e(t),l.push(t)),[]),d=t;null!=d;){for(var c=d.renders,a=0;a<c.length;a++){var h=c[a],p=h.renderCategory;null!=n&&n!==h.renderCategory||("function"==typeof e&&e(h),l.push(h)),"Layoutable"===p&&u.push(h)}d=u.pop()}return l},onFieldChange:function(e){var t,n,i;!0!==$$.params.fieldSyncing&&null!=(t=(t=$(this).data($Control.DATA_SOURCE_CONTROL))===v?$(this).data($Control.DATA_CONTROL_OBJECT):t)&&(n=e.data.render,i=function(){var e;null!=$$.params.fieldChanging&&!t.clickFireFieldChange||(t instanceof InfoPlus.Controls.Suggester2&&t.isOnPagePopup&&null!=t.originSuggester&&(t=t.originSuggester),e=n.save(e={},t.isDetailControl()),t.fieldChangeEvent(e).done(function(){n.doDynamicsAfterFieldChange(),$$.fieldChanged($$(t)),$$(t).fieldChanged()}).fail(function(e){"EVENT_CANCELLED"===e.errCode&&n.doDynamicsAfterFieldChange()}).always(function(){(t instanceof $Controls.Button||t instanceof $Controls.LinkButton||t instanceof $Controls.CheckButton)&&$(t.element).removeAttr("disabled")}))},t.onFieldSync&&t.fieldSyncEvent(),t.onFieldRefer&&($$.dynamics.cache.build(),t.fieldReferEvent(n,!0,!0,!0,!0,!0),$$.fieldRefered($$(t)),$$(t).fieldRefered()),t.onFieldChange)&&(null==$$.params.fieldChanging||t.clickFireFieldChange)&&(t.onFieldRefer?setTimeout(i,200):i())},onFieldFocus:function(){var e=$(this).data($Control.DATA_SOURCE_CONTROL);null!=(e=null==(e=null==e?$(this).data($Control.DATA_CONTROL_OBJECT):e)?$($(this).data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_CONTROL_OBJECT):e)&&e.showTooltip()}},define("InfoPlus.FormRender",e)}(window),function(n,M){function e(e){this.progress=e.progress,this.stepId=e.stepId,this.instanceId=e.instanceId,this.userId=e.userId,this.readOnly=e.readOnly,this.administrable=e.administrable,this.subEntryId=e.subEntryId,this.slide=e.slide}function u(e,t){return new InfoPlus.Render.PopTip({popper:e,container:$$.params.renderContainer[0],text:t,colorClass:"remarkTip",placement:(t=e,e="top-left",e=$$.MOBILE&&$(t).offset().left>$(n).width()/2?"top-right":e),effect:"bounce",onClick:function(){return!1},onClose:$IU.refreshReviewByForm})}function d(e,t){var r;new InfoPlus.Render.PopMenu({container:t.element,items:(r=e,function(){var n=this.element,i=function(){for(var e=[],t=0;t<r.length;t++){var n=r[t];$(n).is(":visible")&&e.push(n)}return e}(),e=(i.sort(function(e,t){e=$(e).offset(),t=$(t).offset();return e.top===t?e.left-t.left:e.top-t.top}),function(){for(var e=$(n).parent().data("tipControl"),t=0;t<i.length;t++)if(i[t]===e.options.popper)return t;return-1}()),t=-1!==e&&e<i.length-1,a=[];return-1!==e&&0<e&&a.push({id:"prev",text:$$.lt("remarkHistory.review.previous"),iconClass:"i-icon-triangle-left",click:function(){return o(i[e-1],i)}}),t&&a.push({id:"next",text:$$.lt("remarkHistory.review.next"),iconClass:"i-icon-triangle-right",click:function(){return o(i[e+1],i)}}),a.push({id:"close",text:$$.lt("remarkHistory.review.close"),iconClass:"i-icon-cross",click:function(){return $(n).parent().data("tipControl").close(),!1}}),a})})}var F="[Hidden]",o=function(e,t){var n,i;return null!=$(e).data("popTip")?(n=parseInt($($(e).data("popTip").element).css("top"),10),$IU.scrollTo(60<n?n-60:0,500),setTimeout(function(){$($(e).data("popTip").element).effect("bounce",{},150)},500)):(n=function(e){var t=0;if(e.offsetParent)for(;t+=e.offsetTop,e=e.offsetParent;);return t}(e),i=u(e,$(e).data("remark")),d(t,i),$IU.scrollTo(100<n?n-100:0,500)),!1};e.prototype={progress:null,stepId:null,instanceId:null,prefix:"infoplus_remark_"+Math.round(9e3*Math.random()+1e3)+"_",sortSteps:function(){function e(e,t,n){for(var i=e.length,a=0;a<i;a++)if(n){if(e[a].actionTime>t.actionTime)break}else if(e[a].assignTime>t.assignTime)break;e.splice(a,0,t)}var n,i=[],t=[],a=this.progress.remarks,r=this.progress.activities,o=this.progress.status,s=this.administrable,l=this.stepId;if(s||$$.params.adminView)for(var u=0,d=r.length;u<d;u++){var c=r[u];a.push({actionTime:c.timestamp,trueName:null!=c.user?c.user.name:$$.lt("remarkHistory.user.system"),userName:null!=c.user?c.user.id:"",activityType:c.tags,remark:c.description})}else if("killed"===o)for(u=r.length-1;0<=u;u--)if("INSTANCE_KILL"===(c=r[u]).tags){a.push({actionTime:c.timestamp,trueName:null!=c.user?c.user.name:$$.lt("remarkHistory.user.system"),userName:null!=c.user?c.user.id:"",activityType:c.tags,remark:c.description});break}for(var h=0,p=a.length;h<p;h++){var f=a[h];f.actionTime!==M?!s&&null!=f.withdrawTo||e(i,f,!0):f.formStepId===l?n=f:e(t,f,!1)}return function(){if(!0!==$$.params.snapshot&&!this.readOnly&&n!==M&&n.prevStepId!==M)for(var e=i.length-1;0<=e;e--){var t=i[e];if(t.formStepId===n.prevStepId){t.isPreviousDone=!0;break}}}(),"doing"===this.progress.status?(o=i.concat(t),n!==M&&o.push(n),o):i},showReviews:function(e){var t,n=0;if(null!=e.review){try{t=$.parseJSON(e.review)}catch(e){}if(null!=t&&null!=t.remarks&&$IU.isArray(t.remarks)){for(var i=[],a=0,r=t.remarks.length;a<r;a++){var o,s,l=t.remarks[a];null!=l.remark&&""!==l.remark&&(0<(s=$$("&"+l.field).filter({path:l.path})).length&&(o=s[0].control,$$.MOBILE&&(s=$(o.element).parents(".infoplus_view_wrap_outer")).hasClass("unexpanded")&&null!=(s=s.children(".infoplus_view_label").data("label"))&&s.expand(!1),null!=o.controlContainer&&$(o.controlContainer).is(":visible")||$(o.element).is(":visible")))&&(n++,s=o.controlContainer||o.element,i.push(s),u(s,l.remark))}for(a=0,r=i.length;a<r;a++)d(i,$(i[a]).data("popTip"))}}return n},showPreviousStepRemark:function(e){var n=this,t=document.createElement("div"),i=$(t),a=document.createElement("div"),r=$(a),o=document.createElement("div"),s=$(o),l=document.createElement("div"),u=$(l);r.addClass("done_remark_user").text(e.trueName===F?$$.lt("remarkHistory.user.related"):e.trueName),s.html($IU.htmlEncode(e.remark===F?$$.lt("remarkHistory.hideRemark"):e.remark)).addClass("done_remark_content"),u.text($IU.unixTimeToString(e.actionTime)).addClass("done_remark_time"),i.append(a).append(o),null!=e.review&&0<(r=this.showReviews(e))&&(s=document.createElement("div"),u=$(s),a=document.createElement("a"),(o=$(a)).attr("href","#").text($$.lt("remarkHistory.showReview",r,1<r?"s":"")),u.append(a).addClass("done_remark_review"),i.append(s),o.click(function(){InfoPlus.Render.PopTip.clear(!0),n.showReviews(e);var t=null;return $(".popTip.remarkTip").each(function(){var e=$(this).data("tipControl");null!=e&&(e=$(e.options.popper).offset().top,t=null==t||e<t?e:t)}),null!=t&&$IU.scrollTo(100<t?t-100:0,500),!1})),i.append(l),new InfoPlus.Tip({content:t,position:"right",width:"310"})},createHistoryList:function(e,t){function n(e,t,n,i,a){function r(e){for(var t=e.prevAll(),n=0,i=t.length;n<i;n++)if(!0===$(t[n]).data("hide")){$(t[n]).show();break}}var o=$(t);i||a||n.isPreviousDone||null!=n.activityType||null!=n.withdrawTo||b||(o.css("display","none").data("hide",!0),A++),0<A&&((i||a||n.isPreviousDone)&&"INSTANCE_ADMIN"!==n.activityType&&"INSTANCE_WITHDRAW"!==n.activityType&&"INSTANCE_KILL"!==n.activityType&&null==n.withdrawTo?(1!==A?f(t,e).after(p(A,!1)):r(o),A=0):D&&(1!==A?f(t,e).after(p(A,!0)):!0===o.data("hide")?o.show():r(o),A=0))}for(var i,a,r,o,s,l,u,d,c,h=this,p=function(e,t){var n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("span");return $(i).css("height","0px"),$(a).addClass("moreHistory").html("<i class='i-icon-angle-double-down'></i> "+$$.lt("remarkHistory.showHide",e)).attr("title",""),t&&$(n).addClass("lastMore"),$(n).click(function(){$(this).hide(),$(this).nextAll().not(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").filter("li:lt("+$(this).data("hideHistoryCount")+")").show("slide",{direction:"up"},"slow",function(){$$.params.holder.remark.css("height","100%")}),$(this).prev("li").css("border-bottom","")}),i.appendChild(a),n.appendChild(i),$(n).data("hideHistoryCount",e),n},f=function(e,t){function n(){return"none"!==$(this).css("display")&&!$(this).hasClass("remark_admin")&&!$(this).hasClass("remark_withdraw")&&!$(this).hasClass("remark_withdrawn")&&(!$(this).hasClass("remark_kill")||$(this).hasClass("firstStep"))}var i;return null!=e?(i=0===(i=$(e).prevAll().filter(n)).length?$(e).prevAll().filter(function(){return"none"!==$(this).css("display")}):i).first():$(t).children("li").filter(n).last()},m=function(e){return $$.params.baseUrl+"form/"+e.formStepId+"/render?snapshot=true"},g=function(e){return"<a target='_blank' title='"+$$.lt("remarkHistory.snapshotTitle")+"' href='"+m(e)+"'>"+(e.stepName||"")+"</a>"},C=function(e){return"<a target='_blank' href='"+$$.params.baseUrl+"form/"+P.formStepId+"/render?entrust=true'>"+e+"</a>"},_=function(e,t,n){var i,a;return!0===n?$$.lt("remarkHistory.user.related"):(n=function(){return"PUBLIC"===e.userVisibility?"<a class='relatedUser' stepId='"+e.formStepId+"'>"+$$.lt("remarkHistory.user.related")+"</a>":$$.lt("remarkHistory.user.related")},(a=(i=e.trueName||e.userName||"")===F)?i=$$.lt("remarkHistory.user.related"):""===i?i=!h.readOnly&&t?$$.lt("remarkHistory.user.you"):n():e.userName===h.userId&&(i=$$.lt("remarkHistory.user.you")+"("+i+")"),!0!==$$.params.adminView&&h.userId!==e.userName&&h.userId!==e.entrusteeId||null==e.entrusteeName||(i+="("+(!0===e.entrusted?$$.lt("remarkHistory.entrust")+(a?$$.lt("remarkHistory.user.related"):e.entrusteeName):e.entrusteeName+$$.lt("remarkHistory.debug"))+")"),i)},E=function(e){return null!=e.actionTime?g(e):"true"===$$.params.entrust?C(e.stepName||""):e.stepName||""},T=function(e,t,n,i){var a;if(null==t)switch(e){case InfoPlus.Settings.STEP_STATE_TODO:case InfoPlus.Settings.STEP_STATE_DRAFT:a=n?$$.lt("remarkHistory.action.youDoing"):$$.lt("remarkHistory.action.doing");break;case InfoPlus.Settings.STEP_STATE_SUB:a=$$.lt("remarkHistory.action.sub");break;default:a=!0===i?$$.lt("remarkHistory.action.doneSub"):$$.lt("remarkHistory.action.done")}else switch(t){case"INSTANCE_ADMIN":a=$$.lt("remarkHistory.action.admin");break;case"INSTANCE_KILL":a=$$.lt("remarkHistory.action.kill");break;case"INSTANCE_WITHDRAW":a=$$.lt("remarkHistory.action.withdraw");break;default:a=$$.lt("remarkHistory.action.done2")}return a},I=function(e){var t,n=0;if(null!=e.review){try{t=$.parseJSON(e.review)}catch(e){}if(null!=t&&null!=t.remarks&&$IU.isArray(t.remarks))for(var i=0,a=t.remarks.length;i<a;i++){var r=t.remarks[i];null!=r.remark&&""!==r.remark&&n++}}return n},v=(this.showAdminButton=!1,document.createElement("ul")),A=(t&&0<t.size()&&(t=t,null!=(i=this.subEntryId))&&(a=document.createElement("div"),$(a).text($$.lt("remarkHistory.subHistory.title",i)).addClass("sub_entry_title"),t)&&0<t.size()&&((i=t.children(".form_remark_title")).find(".show_sub_workflow").remove(),i.append($(a))),0),y=e.length-1;0<=y;y--){var P=e[y],S=!this.readOnly&&this.stepId===P.formStepId,D=0===y,b=y===e.length-1,O=!$IU.isEmptyStr(P.remark),R=P.status!==InfoPlus.Settings.STEP_STATE_TODO&&!$IU.isEmptyStr(P.review),w=P.ccUsers!==M&&$IU.isArray(P.ccUsers)&&0<P.ccUsers.length,L=(!0===$$.params.snapshot&&P.formStepId===$$.params.formStepId&&(this.currentSnapshotStep=P),document.createElement("li"));x=void 0;var N=P,U=b,k=D,x=$(L);switch(x.addClass("remark_item"),N.activityType){case"INSTANCE_ADMIN":x.addClass("remark_admin"),h.showAdminButton=!0;break;case"INSTANCE_WITHDRAW":x.addClass("remark_withdraw"),h.showAdminButton=!0;break;case"INSTANCE_KILL":x.addClass("remark_kill"),U?x.addClass("firstStep"):h.showAdminButton=!0;break;default:null!=N.withdrawTo?(x.addClass("remark_withdrawn"),h.showAdminButton=!0):x.css("display","block")}k&&x.css("border-bottom","none"),k=L,r=P,S=S,c=d=u=l=s=o=void 0,s=document.createElement("div"),$(s).addClass("form_remark_title"),l=r.sub!==M||r.subEntry!==M,u=E(r),d=_(r,S,l),c=T(r.status,r.activityType,S,l),null==r.thing?null!=r.activityType?s.innerHTML="<span class='color_b4'><b>"+d+"</b>   "+c+"</span>":(o=null!=r.actionName&&""!=r.actionName?"(<span class='color_b3'><b>"+r.actionName+"</b></span>)":"",s.innerHTML="<span class='color_b2' style='"+(null!=r.withdrawTo?"text-decoration:line-through":"")+"'><span class='"+(S?"color_o1":"")+"'>"+(l?"":"<b>"+d+"</b></span>   "+c)+"<b>"+u+"</b>"+o+"</span>"):(null!=r.activitytype?s.innerHTML="<span class='color_b4'><b>"+d+"</b>   "+c+"</span>":(u=null!=r.stepName?"(<span><b>"+u+"</b></span>)":"",null!=r.actionName?s.innerHTML="<span class='color_b2' style='"+(null!=r.withdrawTo?"text-decoration:line-through":"")+"'><span class='"+(S?"color_o1":"")+"'><b>"+d+"</b></span>   <span class='color_b4' style='font-weight:bold'>"+r.actionName+"</span> "+r.thing.thingName+" "+u+"</span>":s.innerHTML="<span class='color_b2'><span class='"+(S?"color_o1":"")+"'><b>"+d+"</b></span>   <span class='color_b4' style='font-weight:bold'>"+$$.lt("remarkHistory.action.receiving")+"</span> "+r.thing.thingName+" "+u+"</span>"),l=document.createElement("span"),o=document.createElement("i"),$(o).addClass("i-icon-truck"),$(l).append(o).css("margin-right","6px").addClass("color_b4"),$(s).addClass("thing").prepend(l)),S||(c="yyyy/MM/dd hh:mm",d=document.createElement("span"),$(d).addClass("form_remark_time"),o=null!=r.assignTime?(u=new Date(1e3*r.assignTime),$$.lt("remarkHistory.createTime")+":"+$IU.dateFormat(u,c)):"",null!=r.actionTime?(l=new Date(1e3*r.actionTime),o+="  "+$$.lt("remarkHistory.actionTime")+":"+$IU.dateFormat(l,c)):$(d).addClass("form_remark_todo"),S=null==r.actionTime?r.assignTime:r.actionTime,d.innerHTML=$IU.dateFormat(new Date(1e3*S),c),d.title=o,(new Date).getTime()-1e3*S<432e5&&$(d).attr("datetime",$IU.getDateIsoString(new Date(1e3*S))).addClass("remark_display_time").data("originDisplayTime",$IU.dateFormat(new Date(1e3*S),c)).click(function(){this.innerHTML=$(this).data("originDisplayTime")}),r.status===InfoPlus.Settings.STEP_STATE_TODO&&null!=r.renderTime?(u=document.createElement("span"),$(u).addClass("form_remark_read round-corner").text($$.lt("remarkHistory.read")),l=document.createElement("span"),$(l).append(d).append(u).css("float","right"),s.appendChild(l)):s.appendChild(d)),k.appendChild(s),O&&(o=L,S=P,c=void 0,c=document.createElement("div"),$(c).addClass("form_remark_content"),null!=S.activityType&&$(c).addClass("activity"),S=S.remark===F?$$.lt("remarkHistory.hideRemark"):S.remark||"",S=$IU.htmlEncode(S),$(c).html(S),o.appendChild(c)),(R||w)&&!function(e,t){var n=document.createElement("div"),i=$(n);if(i.addClass("form_remark_review_cc"),e.appendChild(n),R&&(e=document.createElement("a"),a=I(t),$(e).attr("href",m(t)).attr("target","_blank").attr("title",$$.lt("remarkHistory.viewReviews")).text($$.lt("remarkHistory.viewReviewLink",a,1<a?"s":"")),i.append(e)),w){var n=document.createElement("a"),a=t.ccUsers.length,e=($(n).attr("href","#").addClass("ccUser").data("stepId",t.formStepId).attr("title",$$.lt("remarkHistory.viewCcs")).text($$.lt("remarkHistory.viewCcLink",a)).click(function(){var e,t;return r.is(":visible")?null!=(e=$(this).data("stepId"))&&(t=$(document).find("meta[itemscope=csrfToken]").attr("content"),new InfoPlus.Render.Candidates({popper:this,requestUrl:$$.params.graphqlUrl+"?csrfToken="+t,requestData:"{reviewers(stepId:"+e+",keyword:?){id,name,account,userName,email}}",dataEntityName:"reviewers"})):(r.show("slide",{direction:"up"},"slow"),$(this).text($$.lt("remarkHistory.searchCc")).append("<i class='i-icon-search'/>")),!1}),i.append(n),document.createElement("div")),r=$(e);r.addClass("form_remark_ccUser_div");for(var o=0,s=t.ccUsers.length;o<s;o++){var l=t.ccUsers[o],u=document.createElement("span");$(u).text(l.trueName).attr("title",l.trueName+"("+l.tenantUserId+")"),r.append(u)}i.append(e)}}(L,P),!function(t,e){var n,i,a;e.sub===M&&e.subEntry===M||($(t).addClass("remark_item_sub"),n=e.sub||{entry:e.subEntry},i=document.createElement("div"),$(i).addClass("form_remark_sub"),t.appendChild(i),null!=n.remarks&&0<n.remarks.length?new InfoPlus.RemarkRender({subEntryId:n.entry,stepId:h.stepId,progress:n,userId:h.userId,readOnly:$$.params.readOnly,administrable:$$.params.administrable}).draw(i,$(t)):null!=n.entry&&(e=document.createElement("a"),$(e).attr("href","#").addClass("show_sub_workflow").text($$.lt("remarkHistory.subHistory.link")).click(function(){return $$.loadHistory({entryId:n.entry,stepId:$$.params.formStepId,includingTop:!1}).done(function(e){e=e.entities[0];new InfoPlus.RemarkRender({subEntryId:e.entry,stepId:h.stepId,progress:e,userId:h.userId,readOnly:$$.params.readOnly,administrable:$$.params.administrable,slide:!0}).draw(i,$(t))}),!1}),0<(a=$(t).find(".form_remark_title")).size())&&a.append(e))}(L,P),v.appendChild(L),n(v,L,P,O,R)}return f(null,v).css("border-bottom","none"),$$.params.adminView&&$(v).children(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").addClass("show"),v},draw:function(e,t){var n=this,i=null==e?$$.params.holder.remark:$(e);if(0!==i.length&&null!=this.progress){i.hide().empty();var a,r,o,s,e=this.sortSteps(),t=this.createHistoryList(e,t),l=(i.append(t),a=t,n.showAdminButton&&n.administrable&&(r=document.createElement("li"),o=document.createElement("a"),(s=$(o)).attr("href","#"),0<i.find(".ccUser").length?s.text($$.lt("remarkHistory.showAdminOrCc")):s.text($$.lt("remarkHistory.showAdmin")),$(r).addClass("remark_show_admin").append(o).css("border-bottom","none"),a.appendChild(r),$(o).click(function(){var e=$(this).parent().siblings(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill");return e.addClass("show"),$(this).parent().hide(),i.children("ul").children("li").not(".remark_show_admin").not(":last").css("border-bottom",""),i.find("ul li:visible:last").css("border-bottom","none"),$IU.scrollTo(e.first().offset().top-40,500),$(".ccUser").each(function(){var e=$(this).siblings(".form_remark_ccUser_div");e.is(":visible")||(e.show("slide",{direction:"up"},"slow"),$(this).text($$.lt("remarkHistory.searchCc")).append("<i class='i-icon-search'/>"))}),!1})),$("span.remark_display_time").timeago({selector:"span.remark_display_time"}),e);if(!0!==$$.params.snapshot&&!n.readOnly){for(var u=l.length-1;0<=u;u--)if(l[u].isPreviousDone){var d=l[u];break}null==d||$IU.isEmptyStr(d.remark)&&$IU.isEmptyStr(d.review)||$$.visible(function(){n.showPreviousStepRemark(d)})}!0===$$.params.snapshot&&null!=n.currentSnapshotStep&&null!=n.currentSnapshotStep.review&&$$.visible(function(){n.showReviews(n.currentSnapshotStep)}),$(t).find(".relatedUser").click(function(){var e,t=$(this).attr("stepId");null!=t&&(e=$(document).find("meta[itemscope=csrfToken]").attr("content"),new InfoPlus.Render.Candidates({popper:this,requestUrl:$$.params.graphqlUrl+"?csrfToken="+e,requestData:"{candidates(stepId:"+t+",keyword:?){id,name,account,userName,email}}",dataEntityName:"candidates"}))}),0<i.children("ul").children().length&&(!0===n.slide?i.show("slide",{direction:"up"},"slow"):i.show())}}},e.processSubProgress=function(e){var t=e.ancestors;if(e.entryTop!==M&&$IU.isArray(t)&&0<t.length&&t[0].entry===e.entryTop){for(var n=e,i=t.length-1;0<=i;i--){var a=t[i];if(!function(e,t){var n=!1;if(!$IU.isArray(e.remarks))return!1;for(var i=0,a=e.remarks.length;i<a;i++){var r=e.remarks[i];r.subEntry!==M&&(r.subEntry===t.entry?(r.sub=t,n=!0):r.sub={entry:r.subEntry})}return n}(a,n))return;n=a}return t[0]}},define("InfoPlus.RemarkRender",e)}(window),function(n){function e(e){this.milestones=e.milestones,this.status=e.status,this.milestoneHolder=$("#form_milestone_holder")[0]}e.prototype={milestoneHolder:null,status:null,drawMilestone:function(){var e=$(this.milestoneHolder),t=e.find(".form_milestone_holder_wrap_inner"),n=t.children(".form_milestone_view");if(null==this.milestones||0===this.milestones.length)e.remove();else if(null!=this.milestoneHolder){for(var i="done"===this.status,a=(e.hide(),n.empty(),this.milestones),r=0,o=a.length,s="";r<o;r++){var l,u,d=a[r],c=document.createElement("li"),h=$(c),p=(p=d.done,f=d.current,void 0,m="gray",!0===p||!0===f&&i?m="green":!0===f&&(m="blue"),m),f=(h.addClass("form_milestone_step").addClass(p),0===r&&h.addClass("first"),r===o-1&&h.addClass("last"),document.createElement("div")),m=$(f),f=(m.addClass("floater").addClass(p),document.createElement("div")),f=$(f),g=(f.addClass("content"),document.createElement("div")),g=($(g).text(d.name),$(g).addClass("content_name"),f.append(g),document.createElement("div"));$(g).addClass("milestone_tip").addClass("round-corner").addClass("z-depth-1"),!0!==d.current||i?!0===d.done||!0===d.current&&i?void 0!==d.actionTime?(m.addClass("doubleLine"),l=document.createElement("div"),$(l).attr("datetime",$IU.getDateIsoString($IU.unixTimeToLocalTime(d.actionTime))).addClass("content_time"),f.append(l),$(g).text($$.lt("milestone.doAt",$IU.unixTimeToLocalTimeString(d.actionTime)))):(m.addClass("singleLine"),$(g).text($$.lt("milestone.done")).addClass("singleLine")):(m.addClass("singleLine"),$(g).text($$.lt("milestone.todo")).addClass("singleLine")):(m.addClass("singleLine"),$(g).text($$.lt("milestone.doing")).addClass("singleLine")),$$.MOBILE||f.append(g),0<r&&(l=document.createElement("li"),$(l).addClass("form_milestone_step_arrow_li").addClass(p),d=document.createElement("div"),$(d).addClass("form_milestone_step_arrow").addClass(s),g=document.createElement("div"),$(g).addClass("form_milestone_step_arrow").addClass("white"),u=document.createElement("div"),$(u).addClass("form_milestone_step_arrow_wrap").append(d).append(g),$(l).append(u),n.append(l)),h.append(m).append(f),n.append(c),s=p}$$.visibility.milestone&&e.show(),$("div.content_time").timeago({selector:"div.content_time"}),$$.MOBILE&&(t.find(".clear").css("height","10px"),e.addClass("round-corner"));var C=this;$$.visibility.milestone&&($$.visible(function(){C.adjustMilestoneWidth(!0),e.find(".form_milestone_step .milestone_tip").each(function(){var e=$(this),t=e.parent();e.css("left",(t.outerWidth()-e.outerWidth())/2+"px")})}),e.css("visibility","visible"))}},adjustMilestoneWidth:function(e){if($$.visibility.milestone){var n,i,a,t,r,o=$(this.milestoneHolder),s=o.find(".form_milestone_holder_wrap_inner"),l=s.children(".form_milestone_view"),u=o.find(".form_milestone_holder_wrap_outer"),d=$("#form_holder").outerWidth(),c=$("#div_render_container").outerWidth(),h=s.find(".form_milestone_step");if(0!==o.length)if(null==o.data("originalTotalWidth")?(n=[],i=[],a=0,h.each(function(){var e=$(this),t=(n.push(e.width()),i.push(parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10)),e.outerWidth());e.data("originalWidth",t),a+=t}),t=s.find(".form_milestone_step_arrow_li"),r=0,t.each(function(){r+=$(this).outerWidth()||$(this).children().outerWidth()}),a+=r,o.data("stepWidthArray",n),o.data("stepPaddingArray",i),o.data("originalTotalWidth",a),o.data("arrowTotalWidth",r)):a=o.data("originalTotalWidth"),$$.MOBILE)if(a<=c){for(_=this.adjustWidth(o,C=c),E=0,T=h.length;E<T;E++)$(h[E]).width(_[E]);u.width(c),l.width(c),o.width(c)}else{u.width(c),l.width(a+1),o.css("width",""),h.css("width","");var p=!1,f=0,m=0,g=0;h.each(function(){!p&&$(this).hasClass("gray")&&(f=g-c/2,f-=m/2,p=!0),m=$(this).outerWidth(),g+=m;var e=$(this).prev();e.hasClass("form_milestone_step_arrow_li")&&(g+=e.outerWidth())}),0<f?s.scrollLeft(f):s.scrollLeft(0)}else if(!0===e){var C=a<d?d:c<a?c<d?d:c-5:a;if(C!==a){for(var _=this.adjustWidth(o,C),E=0,T=h.length;E<T;E++)$(h[E]).width(_[E]);s.width(C)}}else if(d<a)if(c<a){for(_=this.adjustWidth(o,C=c<d?d:c-5),E=0,T=h.length;E<T;E++)$(h[E]).width(_[E]);s.width(C)}else{for(E=0,T=h.length;E<T;E++)$(h[E]).css("width","");s.css("width","")}}},adjustWidth:function(e,t){var n=e.data("stepWidthArray").slice(0),i=e.data("stepPaddingArray"),a=e.data("originalTotalWidth"),r=0;r+=e.data("arrowTotalWidth");for(var o=0,s=n.length;o<s;o++){var l=i[o];n[o]=Math.round((t-a)/s+l+n[o]),r+=n[o]}if(r!==t)for(var u=Math.ceil((t-r)/n.length),o=0,s=n.length;o<s&&t!==r;o++){if(0<u&&u<t-r||u<0&&t-r<u)n[o]+=u,r+=u;else{if(0===o&&0===u)for(var d=r<t?1:-1,c=0,h=Math.abs(t-r);c<h;c++)n[c]+=d;else n[o]+=t-r;r=t}r!==t&&o===s-1&&(n[o]+=t-r)}return n},processEvent:function(){var e,t=this;$$.MOBILE||((e=$(".form_milestone_step")).mouseenter(function(){function e(e,t){0<t&&(e.data("widthBeforeReduce",e.outerWidth()),e.width(t))}var t,n,i=$(this),a=$(this).prevAll(".form_milestone_step").first(),r=$(this).nextAll(".form_milestone_step").first(),o=i.data("originalWidth")+1,s=o-i.outerWidth();1<s&&(0<a.length?(0<r.length?(n=s-(t=Math.ceil(s/2)),t=a.outerWidth()-t,n=r.outerWidth()-n,e(a,t),e(r,n)):e(a,a.outerWidth()-s),e(i,o)):0<r.length&&(e(r,r.outerWidth()-s),e(i,o)))}),e.mouseleave(function(){function e(e){null!=e.data("widthBeforeReduce")&&(e.width(e.data("widthBeforeReduce")),e.data("widthBeforeReduce",null))}var t=$(this),n=$(this).prevAll(".form_milestone_step").first(),i=$(this).nextAll(".form_milestone_step").first();e(n),e(i),e(t)})),$$.visible(function(){$(n).resize(function(){t.adjustMilestoneWidth(!1)})})},draw:function(){this.drawMilestone(),this.processEvent()}},define("InfoPlus.MilestoneRender",e)}(window),function(T,l){function e(e){this.initializeConfig(e)}function I(e,t){function n(e){if(null!=e&&$IU.isArray(e))for(var t=0,n=e.length;t<n;t++)if(null!=e[t].key&&"style"===e[t].key.toLowerCase())return t;return-1}for(var i,a={renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:!1,renders:[]},r={renderCategory:"Layoutable",renderType:"LayoutTableRow",repeatable:!1,renders:[{renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:!1,renders:[]}]},o=$.extend(!0,{},{attributes:[{key:"class",value:"infoplus_auto_view_table"},{key:"style",value:t?"width:100%":"width:98%"},{key:"cellspacing",value:"0"}],renderCategory:"Layoutable",renderType:"LayoutTable",repeatable:!1,renders:[]}),s=(null!=e.title&&(t=$.extend(!0,{},r),(i=$.extend(!0,{},a)).attributes=[{key:"class",value:"title_div"}],t.renders[0].renders.push(i),i.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:e.title}),o.renders.push(t)),0),l=e.entities.length,u=null;s<l;){var d,c,h,p,f,m,g,C,_,E=e.entities[s];null!=E.field?(function(e){for(var t=["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundCheckList","BoundOptionList","BoundSelect","BoundAnchor","BoundLabel","BoundSuggester","BoundSuggester2","BoundFile","BoundPassword","BoundThing","BoundIFrame"],n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1}((f=E.render).renderType)&&(null==f.attributes&&(f.attributes=[]),-1===(c=n(f.attributes))?f.attributes.push({key:"style",value:"width:100%"}):(d=f.attributes[c]).value=function(e){for(var t="",n=e.split(";"),i=0,a=n.length;i<a;i++){var r=n[i].split(":");2===r.length&&"width"===$IU.trimString(r[0].toLocaleLowerCase())?t+="width:100%;":t+=n[i]+";"}return t}(d.value)),"BoundImage"!==f.renderType&&"BoundPicture"!==f.renderType||-1!==(c=n(f.attributes))&&(h=function(e){for(var t={},n=0,i=e.length;n<i;n++){var a,r=e[n].split(":");1<r.length&&(a=$IU.trimString(r[0]).toLowerCase(),r=$IU.trimString(r[1]).toLowerCase(),"width"===a&&$IU.endWith(r,"px")&&(t.width=parseInt(r)),"height"===a)&&$IU.endWith(r,"px")&&(t.height=parseInt(r))}return t}((d=f.attributes[c]).value.split(";")),p=Math.floor(.98*$(T).width()-6),null!=h.width)&&h.width>p&&(f.attributes[c].value=f.attributes[c].value+";width:"+p+"px",null!=h.height)&&(p=p/h.width*h.height,f.attributes[c].value=f.attributes[c].value+";height:"+p+"px"),"BoundCheck"!==f.renderType&&"BoundOption"!==f.renderType||null==u?(C=$.extend(!0,{},r),(_=$.extend(!0,{},a)).attributes=[{key:"class",value:"row_div"}],C.renders[0].renders.push(_),null!=E.field.label&&_.renders.push({attributes:[{key:"class",value:"label_div"}],renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:!1,renders:[{renderCategory:"Displayable",renderType:"DisplayText",text:E.field.label}]}),_.renders.push(f),o.renders.push(C)):(u.renders.push(f),_=u),u="BoundCheck"===f.renderType||"BoundOption"===f.renderType?(null!=f.label&&_.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:f.label+" "}),_):null,"BoundHidden"===f.renderType&&(C.attributes=[{key:"class",value:"hidden_row"}]),null!=E.field&&s+1<l&&null!=e.entities[s+1].field&&("BoundHelp"===e.entities[s+1].render.renderType||"BoundHidden"===e.entities[s+1].render.renderType)&&(h=e.entities[s+1].render,1<_.renders.length&&null!=E.field.label?(_.renders.splice(1,0,h),null==_.renders[0].attributes&&(_.renders[0].attributes=[]),_.renders[0].attributes.push({key:"style",value:"display:inline-block"})):_.renders.push(h),s++)):(u=null,C=$.extend(!0,{},r),_=$.extend(!0,{},a),null!=E.group.label&&""!==E.group.label&&((p=$.extend(!0,{},a,{attributes:[{key:"class",value:"infoplus_repeat_title"}]})).renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:E.group.label}),C.renders[0].renders.push(p)),"LayoutTable"===E.render.renderType?(f=$.extend(!0,{},a,{attributes:[{key:"class",value:"infoplus_auto_view_repeatTable_wrap_outer"}]}),(m=$.extend(!0,{},a,{attributes:[{key:"class",value:"infoplus_auto_view_repeatTable_wrap_inner"}]})).renders.push(E.render),f.renders.push(m),_.renders.push(f)):(m=$.extend(!0,{},a,{groupName:E.group.name,repeatable:!0}),(g=$.extend(!0,{},a)).renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:E.render.addText||$$.lt("repeatAddLink.defaultText")}),_.attributes=[{key:"class",value:"row_div"}],C.renders[0].attributes=[{key:"style",value:"padding:0"}],_.renders.push(m),_.renders.push(g),m.renders.push(I(E,!0))),C.renders[0].renders.push(_),o.renders.push(C)),s++}return o}e.ACTION_TYPE_SAVE=0,e.ACTION_TYPE_OPERATE=1,e.ACTION_TYPE_UPLOAD=2,e.ACTION_TYPE_DELETE_ATTACHMENT=3,e.ACTION_TYPE_LOAD=4,e.INFOPLUS_SPLITER="|INFOPLUS_SPLITER|";e.prototype={render:null,loadDefault:function(){this.container=$("#div_render_container"),this.command_bar=$("#form_command_bar"),this.printable=!1,this.downloadable=!0,this.withdrawable=!1,this.killable=!1,this.needSwitchMenu=!1,this.printAfterAction=!1,this.boundFields=[]},initPropFromUrl:function(){var e=$IU.getParamFromUrl(T.location.href);this.urlLang=e.lang,this.back=e.back,this.engine=e.engine,this.membership=e.membership,this.showRemark=e.showRemark,this.theme=e.theme,this.snapshot=e.snapshot,this.entrust=e.entrust,this.mobileAutoView=e.mobileAutoView,this.previewReadOnly=e.previewReadOnly,this.entrance=e.entrance,this.cc=null!=e.cc||l,this.width=e.width},initializeConfig:function(e){for(var t in this.loadDefault(),e)e.hasOwnProperty(t)&&"function"!=typeof e[t]&&(this[t]=e[t]);this.initPropFromUrl()},refreshRemarks:function(t){var n;$$.visibility.remark&&0!==$$.params.holder.remark.length&&(n=this,$$.MOBILE||$$.params.holder.remark.addClass("loading").block({message:"<span class='loading'>"+$$.lt("remarkHistory.loading")+"</span>",css:{margin:"0 auto",left:"0",right:"0",padding:"6px","border-radius":"5px","background-color":"#000000",opacity:"0.4","min-width":"300px",border:"none"}}),$$.loadHistory({includingTop:!0}).done(function(e){$$.MOBILE||$$.params.holder.remark.removeClass("loading");e=e.entities[0];n.layout.remarkReady({progress:e,userId:n.userId,isDoing:t})}))},redraw:function(){return null!=this.render&&this.render.draw(),!1},draw:function(e){return $$.params.holder.form.hide(),this.render=new InfoPlus.FormRender({formStepId:this.formStepId,workflowId:this.workflowId,holderId:$$.params.holder.form.attr("id"),entity:e,suggest:this.interface_suggest,suggestInitialize:this.interface_suggestInitialize,fieldChange:this.interface_fieldChange,buttonService:this.interface_buttonClick,tenantTimeZoneOffset:this.tenantTimeZoneOffset,thingService:this.interface_thing}),$$.initCore({viewToken:this.viewToken,formRender:this.render,userId:e.userId,timestamp:this.timestamp,tenantTimeZoneOffset:this.tenantTimeZoneOffset,tenantReadOnlyStyle:this.tenantReadOnlyStyle,tenantDomain:this.tenantDomain,synthesizeEmail:this.synthesizeEmail,formInstanceId:this.instanceId,formEntryId:this.entryId,formEntryIdTop:this.entryIdTop,formEntryIdDisplay:this.entryIdDisplay,formStepId:this.formStepId,workflowId:this.workflowId,release:this.release,isRelease:this.entryRelease,doActionUrl:this.interface_do_action,boundFields:this.boundFields,instanceView:this.instanceView,adminView:this.adminView,baseUrl:this.base_url,printAfterAction:this.printAfterAction&&this.printable,downloadAfterAction:this.printAfterAction&&this.downloadable,saveable:!(this.readOnly&&(!this.adminView||this.withdrawable)),printable:this.printable,downloadable:this.downloadable,withdrawable:this.withdrawable,killable:this.killable,administrable:this.administrable,instructionUrl:this.instructionUrl,printUrl:this.url_print,supportUrl:this.url_support,entrustUrl:this.url_entrust,adminViewUrl:this.url_admin_view,adminUrl:this.url_admin,downloadWordUrl:this.url_download_word,downloadPdfUrl:this.url_download_pdf,reLoginUrl:this.url_reLogin,membership:this.membership,back:this.back,showRemark:this.showRemark,theme:this.theme,lang:this.lang,urlLang:this.urlLang,dynamicParallel:this.dynamicParallel,printInvoice:""!==(this.interface_printInvoice||""),instanceName:this.instanceName,instanceTags:this.instanceTags,receiveThing:this.receiveThing,entrust:this.entrust,entrusts:this.entrusts,uriHistory:this.interface_list_remarks,uriBarcode:this.interface_printInvoice,uriFilePreview:this.interface_filePreviewUrl,uriWordEdit:this.interface_wordEditUrl,uriWordDown:this.interface_wordDownUrl,uriSealSelector:this.interface_sealSelector,uriSave:this.interface_save,uriUsers:this.interface_users,uriEntrust:this.interface_entrust,uriCompare:this.interface_compare,uriCkUploadImage:this.interface_ckUploadImage,uriChangePriority:this.interface_changePriority,uriKill:this.interface_kill,uriWithdraw:this.interface_withdraw,uriListNextSteps:this.interface_list_next_steps,mobileAutoView:this.mobileAutoView,snapshot:"true"===this.snapshot,readOnly:this.readOnly,exportReadOnly:this.exportReadOnly,exportSignature:this.exportSignature,attachmentUrl:this.interface_attachment,attachmentTokenUrl:this.interface_attachmentToken,graphqlUrl:this.interface_graphql,copyright:this.copyright,cc:this.cc,mapKey:this.mapKey,defaultLocation:this.defaultLocation,libs:{ckeditor:this.lib_ckeditor},engine:this.engine}),this.layout=new InfoPlus.Render.Layout({formEntity:e,formRender:this.render}),$$.params.layout=this.layout,$$.beforeRender(),this.render.draw()},processGroups:function(e){if(null!=e)for(var t in e)e.hasOwnProperty(t)&&null!=(t=e[t]).groupName&&(t.groupArray=t.groupName.split("//"))},processFields:function(e){var t=[],n={fields:{}};if(null!=e)for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];if(null!=a.groupName&&(a.groupArray=a.groupName.split("//")),!0===a.bound&&a.name!==l&&(t.push(a.name),null!=a.groupArray))if(1<a.groupArray.length){for(var r=n,o=1;o<a.groupArray.length;o++){var s=a.groupArray[o];null==r.groups&&(r.groups={}),null==r.groups[s]&&(r.groups[s]={fields:{}}),r=r.groups[s]}r.fields[a.name]=a}else n.fields[a.name]=a}this.boundFields=t,this.dataObject=n},traverse:function(e){for(var t={renders:[]},n=[],i=e;null!=i;){"Boundable"===i.renderCategory&&t.renders.push(i),!0===i.repeatable&&t.renders.push(i),null==t.title&&"Layoutable"===i.renderCategory&&"LayoutHeader"===i.renderType&&null!=i.renders&&0<i.renders.length&&null!=(a=i.renders[0]).text&&(t.title=a.text);var a,r=i.renders;if(null!=r)for(var o=r.length-1;0<=o;o--){var s,l,u=r[o],d=u.renderCategory;"Boundable"!==d||"BoundCheck"!==u.renderType&&"BoundOption"!==u.renderType||o+1<r.length&&"Displayable"===(l=r[o+1]).renderCategory&&"DisplayText"===l.renderType&&(u.label=l.text),"Layoutable"===d&&!0===u.repeatable&&o+1<r.length&&null!=(l=r[o+1]).renders&&0<l.renders.length&&"Displayable"===(s=l.renders[0]).renderCategory&&"DisplayText"===s.renderType&&(u.addText=s.text),"Layoutable"!==d&&"Boundable"!==d||n.push(u)}i=n.pop()}return t},getRenderWidth:function(){var e;return null==this.width||""===this.width||(e=parseInt(this.width,10),isNaN(e))?$IU.getWindowWidth():e},preview:function(i){function r(e,t,n,i){var a,r,o,s,l;loadFormError(),"ENTRUST_MOCK_NOT_ALLOWED"===n||"ENTRUST_MODE_NOT_ALLOWED"===n?(a="ENTRUST_MODE_NOT_ALLOWED"===n,r=u.interface_entrust,(o=[]).push({name:$$.lt("common.close"),defaultButton:!0,callback:function(){$IU.closeWindow()}}),o.push({name:a?lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug"),callback:function(){var e,t;e={message:a?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug")},t={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff",cursor:"pointer",width:$$.MOBILE?"65%":"45%",top:"40%",left:$$.MOBILE?"17%":"28%",textAlign:"center"},e.css=$.extend({},t,e.css||{}),$.blockUI(e),$.ajax({type:"POST",url:r,data:{entrusted:!1,app:entrusts.app.id,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content")}}).always(function(){$.unblockUI()}).done(function(){$$.MOBILE?setTimeout(function(){T.location.reload()},600):T.location.reload()})}}),s=$$.lt("preview.loadError"),dialogDiv=$(document.createElement("div")),!0===i&&((l=document.createElement("span")).style.color="#FF0000",$(l).text($$.lt("error.occur")),dialogDiv.append(l)),l=document.createElement("span"),$(l).addClass("error_message_content").html(e),dialogDiv.append(l),new InfoPlus.Render.Dialog({title:s,content:dialogDiv,maxWidth:800,buttons:o}).show()):$IU.errorMessageBox(e,t,$$.lt("preview.loadError"),null,n,i,!0)}var u,a=$.Deferred();return progress($$.lt("load.workflowInfo"),20,60,5e3),null==this.workflowId?(r($$.lt("error.parameter"),null,null,!0),a.reject()):(u=this,$$.ajax({type:"POST",url:this.interface_preview,data:{workflowId:this.workflowId,rand:999*Math.random(),width:this.getRenderWidth()},requestMsg:$$.lt("load.loadWorkflow"),beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:!1}).fail(function(e){var t=e.msg,n=e.errCode,i=null,a=(t=null==t?$$.lt("error.unknown"):t).split("|INFOPLUS_SPLITER|");1<a.length&&(t=a[0],i=a[1]),r(t,i,n,e.errno<0)}).done(function(e){progress($$.lt("load.loading"),60,80,1e3);var e=e.entities[0],t=(u.processFields(e.fields),u.processGroups(e.groups),"true"===u.previewReadOnly&&u.removePagePermission(e),e.permission),n=(i.startable=!0===t.startable&&!0!==i.clear,u.release=i.release,"");$$.params.engine&&"qform"==$$.params.engine&&(t=e.qform)&&t.spec&&t.spec.content&&t.spec.content.text&&(n=t.spec.content.text),u.draw(e).done(function(){var e=new InfoPlus.Preview.Introduce({hide:!0===i.clear,app:i.app}),t=new InfoPlus.Preview.Start({startable:i.startable,onClick:function(){var e;return!!i.startable&&!1!==$IU.doValidate(!1,!0)&&($$.PREVIEW_APP_URI!==l?(document.body.onbeforeunload=null,T.location.href=$$.PREVIEW_APP_URI,!1):(e=u.render.save(e={},!1),e=$.toJSON(e),$$.blockUI({message:"<span class='loading'>"+$$.lt("preview.starting")+"</span>",css:{width:$$.MOBILE?"80%":"45%",left:$$.MOBILE?"10%":"28%"}}),void $$.ajax({type:"POST",url:u.interface_start,data:{idc:i.idc,release:i.release,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content"),formData:e,entrance:u.entrance},requestMsg:$$.lt("preview.start"),errorTitle:$$.lt("preview.refused"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(e){e=e.entities[0];document.body.onbeforeunload=null,T.location.href=$IU.processUrl(e)})))}});new InfoPlus.Preview.Layout({views:u.render.views,introduce:e,start:t,navigation:n});u.layout.createEntrustHelper(),u.layout.showForm(),a.resolve()})}),a.promise())},convertMobileView:function(e){return{id:e.id,index:e.index,name:e.name,mobile:!0,renderCategory:"Layoutable",renderType:"FormView",repeatable:!1,styleSheetUri:e.styleSheetUri,attributes:[{key:"class",value:"infoplus_auto_view"}],renders:[{attributes:[{key:"align",value:"center"}],display:"Inline",renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:!1,renders:[I(e,!1)]}]}},getViewEntity:function(e,t,n){function i(e,t,n){null!=r(e,t.name,"field")&&"BoundOption"!==n.renderType||e.push({name:t.name,type:"field",render:n,field:t})}function a(e,t,n){null!=r(e,t.name,"group")&&"LayoutTable"===n.renderType||e.push({name:t.name,type:"group",render:n,group:t,entities:[]})}for(var r=function(e,t,n){for(var i=e.length-1;0<=i;i--){var a=e[i];if(a.type===n&&a.name===t)return a}return null},o=this.traverse(e),s=o.renders,l={id:e.id,index:e.index,name:e.name,type:"rootView",title:o.title,styleSheetUri:e.styleSheetUri,entities:[]},u=0;u<s.length;u++){var d=s[u];if("Layoutable"===d.renderCategory){var c=n[d.groupName];if(null!=c){var h=l,p=c.groupArray;if(null!=p&&2<p.length){for(var f=1;f<p.length-1;f++){var m=r(h.entities,p[f],"group");if(null==m){g=!0,$IU.debugTip(""+c.name+"","warning");break}h=m}g||a(h.entities,c,d)}else a(l.entities,c,d)}}else{var $=t[d.field];if(null!=$)if(h=l,null!=(p=$.groupArray)&&1<p.length){for(var g=!1,f=1;f<p.length;f++){if(null==(m=r(h.entities,p[f],"group"))){g=!0,$IU.debugTip(""+$.name+"","warning");break}h=m}g||i(h.entities,$,d)}else i(l.entities,$,d)}}return l},initParameter:function(e,t){function n(e){return null==e?[]:((e=e.split("/")).splice(0,1),e)}this.instanceId=t.instanceId,this.entryId=t.entryId,this.entryIdTop=t.entryIdTop,this.entryIdDisplay=t.entryIdDisplay,this.entryRelease=t.entryRelease,this.formStepId=t.flowStepId,this.timestamp=t.timestamp,this.printAfterAction=t.printAfterAction,this.exportReadOnly=t.exportReadOnly,this.exportSignature=t.exportSignature,this.dynamicParallel={splitPath:n(t.splitPath),splitPathGroup:n(t.splitPathGroup)},this.instanceName=t.instanceName,this.instanceTags=t.instanceTags,this.receiveThing=null!=t.thing,this.readOnly=!e.permission.executable,this.printable=e.permission.printable,this.downloadable=e.permission.exportable,this.withdrawable=e.permission.withdrawable,this.killable=e.permission.killable,this.administrable=!0===this.instanceView&&!0===e.permission.administrable,(this.instructionUrl=null)!=e.previewId&&null!=e.step.definitionId&&(this.instructionUrl=this.base_url+"form/"+e.step.definitionId+"/start?clear=true&previewReadOnly=true&preview=true&release="+t.entryRelease,null!=this.theme)&&(this.instructionUrl=this.instructionUrl+"&theme="+this.theme)},preprocessFormEntity:function(e){this.processFields(e.fields),this.processGroups(e.groups)},processMobileAutoView:function(e){if($$.MOBILE)for(var t,n=0,i=e.views.length;n<i;n++)!0!==this.mobileAutoView&&!0!==e.views[n].mobileView||(t=this.getViewEntity(e.views[n],e.fields,e.groups),e.views[n]=this.convertMobileView(t))},processSnapshots:function(e){var t=e.snapshots;if($IU.isArray(t)&&0<t.length){$$.params.sameStepHistoryList=[];for(var n,i=0,a=t.length,r=!1;i<a;i++)$$.params.sameStepHistoryList.push({name:t[i].name,data:t[i].data}),!0===t[i].compare&&!1===r&&(r=!0,n=function(e){return function(){$IU.compareInitData(e)}}(i),$$.visible(function(){setTimeout(n,1e3)}))}},removePrintPagePermission:function(e){$$.PRINT&&this.removePagePermission(e)},removePagePermission:function(e){var t,n,i=e.fields;for(t in i)i.hasOwnProperty(t)&&((n=i[t]).permission!==l&&(-1!==n.permission.indexOf("r")?n.permission="r":n.permission=""),n.fieldChanging!==l&&(n.fieldChanging=!1),n.fieldChangeMappingList!==l)&&(n.fieldChangeMappingList=null);var a,r=e.groups;for(t in r)r.hasOwnProperty(t)&&(a=r[t]).permission!==l&&(-1!==a.permission.indexOf("r")?a.permission="r":a.permission="")},load:function(){function r(e,t,n,i){T.loadFormError!==l&&"function"==typeof T.loadFormError&&loadFormError(),$IU.errorMessageBox(e,t,$$.PRINT?$$.lt("print.fail"):$$.lt("load.fail"),null,n,i,!0)}var e,o,t,s=this,n=$("#renderContent_holder").width(),i=setInterval(function(){null!=s.layout&&n!==$("#renderContent_holder").width()&&(s.layout.onResize(!0),clearInterval(i))},30);return progress($$.lt("load.loadPage"),20,60,5e3),this.formStepId<0&&null==this.instanceId?(r($$.lt("load.paramError"),null,null,!0),$.Deferred().reject()):(e=$$.PRINT?this.interface_print:this.interface_render,o=$.Deferred(),t={stepId:null==this.formStepId?-1:this.formStepId,instanceId:this.instanceId,admin:this.adminView,rand:999*Math.random(),width:this.getRenderWidth(),lang:this.lang},!0===this.cc&&(t.markAsRead=!0),"true"===this.snapshot&&(t.snapshot=!0),$$.ajax({type:"POST",url:e,data:t,requestMsg:$$.lt("load.loadForm"),beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:!1}).fail(function(e){var t,n,i,a;"STEP_PARALLEL"===e.errCode?(T.location.href=$IU.processUrl(e.data.entities[0].step.renderUri),o.reject()):"ACCESS_DENIED"===e.errCode&&null!=s.entrusts&&null!=s.entrusts.entruster?$IU.chooseEntrust(s.entrusts,e,$$.PREVIEW?startPreview:startLoad,s.interface_entrust):(i="|INFOPLUS_SPLITER|",-1!==(a=(t=(n=null)==(t=e.msg)?$$.lt("load.unknownError"):t).indexOf(i))?(n=t.substr(a+i.length),t=t.substring(0,a)):-1!==(a=t.indexOf("\n\n"))&&(n=t.substr(a+"\n\n".length),t=t.substring(0,a)),r(t,n,e.errCode,e.errno<0))}).done(function(e){progress($$.lt("load.loadPage"),60,80,1e3);var t=e.entities[0],n=t.step;n.entryIdDisplay=n.entryId,null!=n.entryIdTop&&n.entryIdTop!=n.entryId&&(e=n.entryId-n.entryIdTop,n.entryIdDisplay=n.entryIdTop+(0<e?"+":"-")+Math.abs(e)),s.preprocessFormEntity(t),s.processMobileAutoView(t),s.initParameter(t,n),s.removePrintPagePermission(t),s.processSnapshots(t),s.draw(t).done(function(){var e;$IU.initValidationEngine(),$$.PRINT||s.layout.render(t,n),s.layout.adjustRender(),s.layout.showForm(),$$.visibility.remark&&s.refreshRemarks((e=n).entryStatus!==InfoPlus.Settings.INSTANCE_STATE_COMPLETE&&e.entryStatus!==InfoPlus.Settings.INSTANCE_STATE_TERMINATED&&e.entryStatus!==InfoPlus.Settings.INSTANCE_STATE_OFFLINE&&2===e.status),o.resolve()}).always(function(){$$.params.initializing=!1})}).always(function(){}),o.promise())},registerGlobalEvents:function(){function e(){$$.MINIPROGRAM=navigator.userAgent.match(/miniprogram/i)||"miniprogram"===T.__wxjs_environment,$$.MINIPROGRAM&&loadAllScript(["https://res.wx.qq.com/open/js/jweixin-1.3.2.js"])}$$.visible(function(){$(T).resize(function(){$IU.adjustRenderWidth(),$IU.updateFormTipsAndViews(!1)}),$$.MOBILE&&$$.resize($(T).width())});var t=null;$(T).on("dragenter",function(e){t=e.target,$(document.body).addClass("dragging-over")}),$(T).on("dragleave",function(e){t===e.target&&($(document.body).removeClass("dragging-over"),e.stopPropagation(),e.preventDefault())}),$(T).on("drop",function(e){$(document.body).removeClass("dragging-over")}),$(document).bind("contextmenu",function(e){var e=e.srcElement||e.target;if($(e).parent().hasClass("infoplus_fileControl_link")){e=$(e).parents(".infoplus_fileControl").data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(null!=e){e=e.field;if(null!=e&&null!=(e=e.settings)&&null!=(e=e.fileSecure)&&!1!==e&&"False"!==e)return!1}}return!0}),$IU.isEmptyStr($$.params.back)||$IU.isPositiveInt($$.params.back)||(T.history.pushState({title:"title",url:"#"},"title","#"),T.addEventListener("popstate",function(e){$IU.backUrlSkip($$.params.back)})),T.WeixinJSBridge&&WeixinJSBridge.invoke?e():document.addEventListener("WeixinJSBridgeReady",e,!1);$$.DINGTALK&&loadAllScript(["https://g.alicdn.com/dingding/dingtalk-jsapi/2.10.3/dingtalk.open.js"],function(){$$.dingTalkJSLoaded=!0})}},define("InfoPlus.Transformer",e)}(window),function(a){function e(e,t,n){this.settings=t=null==t?{}:t,-1===(this.endPoint=e).indexOf("http://")&&(this.endPoint="http://"+e),this.assignSize=!1,this.mode=InfoPlus.ExternalLink.DEFAULT_MODE,null!=t.windowMode&&$IU.isInt(t.windowMode)&&(e=parseInt(t.windowMode,10),!isNaN(e))&&e>=InfoPlus.ExternalLink.MODE_INNER_MODAL&&e<=InfoPlus.ExternalLink.MODE_SELF&&(this.mode=e),null!=t.windowWidth&&$IU.isNumber(t.windowWidth)&&(e=parseFloat(t.windowWidth),isNaN(e)||(this.width=e,this.assignSize=!0)),null!=t.windowHeight&&$IU.isNumber(t.windowHeight)&&(e=parseFloat(t.windowHeight),isNaN(e)||(this.height=e,this.assignSize=!0))}e.MODE_INNER_MODAL=1,e.MODE_INNER_MODALESS=2,e.MODE_OUTER_DIALOG=3,e.MODE_OUTER_MODAL=4,e.MODE_OUTER_MODALESS=5,e.MODE_SELF=6,e.DEFAULT_MODE=e.MODE_INNER_MODAL,e.DEFAULT_DIALOG_WIDTH=$(a).width(),e.DEFAULT_DIALOG_HEIGHT=.7*$(a).height(),e.prototype={assignSize:!1,mode:e.MODE_INNER_MODAL,width:e.DEFAULT_DIALOG_WIDTH,height:e.DEFAULT_DIALOG_HEIGHT,endPoint:null,dialogDiv:null,href:null,openWindow:function(){var e,t,n=!0;switch(this.mode){case InfoPlus.ExternalLink.MODE_INNER_MODAL:case InfoPlus.ExternalLink.MODE_INNER_MODALESS:$$.MOBILE?new InfoPlus.Render.Mobile.Page({title:this.settings.displayText,uri:this.href}).show():(e=(i=$("#title_holder")).height(),t=$("#command_holder").height(),i=parseInt(i.parent().css("top"),10),e=e+t+(isNaN(i)?0:i),t=$(a).height()-e-40-48-4-20,$IU.iframeBox(this.href,this.settings.displayText,this.mode===InfoPlus.ExternalLink.MODE_INNER_MODAL,!1,this.width,this.assignSize?this.height:t));break;case InfoPlus.ExternalLink.MODE_OUTER_DIALOG:var i="directories=0,location=0,menubar=0,resizable=1,scrollbars=1,status=0,titlebar=0,toolbar=0";this.assignSize?i+=",channelmode=0,fullscreen=0,width="+this.width+",height="+this.height+",top="+(screen.availHeight-this.height)/2+",left="+(screen.availWidth-this.width)/2:i+=",channelmode=1,fullscreen=1",a.open(this.href,"",i);break;case InfoPlus.ExternalLink.MODE_OUTER_MODAL:$IU.messageBox($$.lt("anchor.closeAfterAction"),$$.hlt("anchor.closeAfterActionDescription"),null,300),n=!1;break;case InfoPlus.ExternalLink.MODE_SELF:case InfoPlus.ExternalLink.MODE_OUTER_MODALESS:n=!1}return n}},define("InfoPlus.ExternalLink",e)}(window),function(){function e(e,t,n){this.value=e,this.displayValue=t,this.name=t,this.parentId=n}e.prototype={},define("InfoPlus.Controls.Data.ValuePair",e)}(window),function(){function e(e,t){InfoPlus.Controls.Data.ValuePair.call(this,e,t)}e.prototype=$.extend(new InfoPlus.Controls.Data.ValuePair,{}),define("InfoPlus.Controls.Data.Thing",e)}(window),function(){function e(e){this.value=e}e.prototype={},define("InfoPlus.Controls.Data.Uri",e)}(window),function(){function e(e){this.styles=this.splitStyles(e.style),this.condition=e.condition||"",this.isRowStyle=!0===e.isRowStyle,this.isRepeatItemStyle=!0===e.isRepeatItemStyle,this.keyName=e.keyName;var t=e.fieldRowIndexName||"";""!==t&&-1!==this.condition.indexOf("$INDEX")&&(this.condition=this.condition.replace(/\$INDEX/g,"$"+t)),""!==(t=e.fieldGroupCountName||"")&&-1!==this.condition.indexOf("$COUNT")&&(this.condition=this.condition.replace(/\$COUNT/g,"$"+t)),""===this.condition||"true"===this.condition.toLowerCase()?this.ignoreCondition=!0:(this.conditionAsts=$$.parseDynamic(this.condition,this.keyName),e=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts),this.references=e.getReferenceNameArray())}e.prototype={styles:null,ignoreCondition:!1,condition:"",conditionAsts:null,references:[],isRowStyle:!1,isRepeatItemStyle:!1,keyName:"",splitStyles:function(e){for(var t=[],n=e.split(";"),i=0;i<n.length;i++){var a=n[i].split(":");2===a.length&&t.push({name:a[0],value:a[1]})}return t},getReferedStyle:function(e){return new InfoPlus.Dynamics.ReferedStyle(e,this)}},define("InfoPlus.Dynamics.Style",e)}(window),function(){function e(e){this.formula=e.formula,this.condition=e.condition||"",this.keyName=e.keyName;var t=e.fieldRowIndexName||"";""!==t&&(-1!==this.formula.indexOf("$INDEX")&&(this.formula=this.formula.replace(/\$INDEX/g,"$"+t),this.isRowIndex=!0),-1!==this.condition.indexOf("$INDEX"))&&(this.condition=this.condition.replace(/\$INDEX/g,"$"+t));""!==(t=e.fieldGroupCountName||"")&&(-1!==this.formula.indexOf("$COUNT")&&(this.formula=this.formula.replace(/\$COUNT/g,"$"+t)),-1!==this.condition.indexOf("$COUNT"))&&(this.condition=this.condition.replace(/\$COUNT/g,"$"+t));for(var n=[],i=(""===this.condition||"true"===this.condition.toLowerCase()?this.ignoreCondition=!0:(this.conditionAsts=$$.parseDynamic(this.condition,this.keyName),n=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts).getReferenceNameArray()),this.formulaAsts=$$.parseDynamic(this.formula,this.keyName),new InfoPlus.Dynamics.Parser.Compile(this.formulaAsts).getReferenceNameArray()),a=[],r=0;r<i.length;r++){for(var o=i[r],s=!1,l=0;l<n.length;l++)if(n[l]===o){s=!0;break}s||a.push(o)}this.references=a.concat(n)}e.prototype={formula:"",formulaAsts:null,ignoreCondition:!1,condition:"",conditionAsts:null,references:[],isRowIndex:!1,keyName:"",getReferedFormula:function(e){return new InfoPlus.Dynamics.ReferedFormula(e,this)}},define("InfoPlus.Dynamics.Formula",e)}(window),function(){function e(e,t){this.targetFieldName=e,this.formula=t.formula,this.formulaAsts=t.formulaAsts,this.ignoreCondition=t.ignoreCondition,this.condition=t.condition,this.conditionAsts=t.conditionAsts}e.prototype={targetFieldName:"",formula:"",formulaAsts:null,condition:"",conditionAsts:null,ignoreCondition:!1},define("InfoPlus.Dynamics.ReferedFormula",e)}(window),function(){function e(e,t){this.targetFieldName=e,this.styles=t.styles,this.ignoreCondition=t.ignoreCondition,this.condition=t.condition,this.conditionAsts=t.conditionAsts}e.prototype={targetFieldName:"",style:[],condition:"",conditionAsts:null,ignoreCondition:!1},define("InfoPlus.Dynamics.ReferedStyle",e)}(window),function(){function e(e){this.action=e.action,this.condition=e.condition||"",this.isRepeatItemAction=!0===e.isRepeatItemAction,this.keyName=e.keyName;var t=[],n=e.fieldRowIndexName||"";""!==n&&(-1!==this.action.indexOf("$INDEX")&&(this.action=this.action.replace(/\$INDEX/g,"$"+n)),-1!==this.condition.indexOf("$INDEX"))&&(this.condition=this.condition.replace(/\$INDEX/g,"$"+n));""!==(n=e.fieldGroupCountName||"")&&(-1!==this.action.indexOf("$COUNT")&&(this.action=this.action.replace(/\$COUNT/g,"$"+n)),-1!==this.condition.indexOf("$COUNT"))&&(this.condition=this.condition.replace(/\$COUNT/g,"$"+n)),""===this.condition||"true"===this.condition.toLowerCase()?this.ignoreCondition=!0:(this.ignoreCondition=!1,this.conditionAsts=$$.parseDynamic(this.condition,this.keyName),t=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts).getReferenceNameArray()),this.actionAsts=$$.parseDynamic(this.action,this.keyName);for(var i=new InfoPlus.Dynamics.Parser.Compile(this.actionAsts).getReferenceNameArray(),a=[],r=0;r<i.length;r++){for(var o=i[r],s=!1,l=0;l<t.length;l++)if(t[l]===o){s=!0;break}s||a.push(o)}this.references=a.concat(t)}e.prototype={action:"",actionAsts:null,ignoreCondition:!1,condition:"",conditionAsts:null,references:[],isRepeatItemAction:!1,keyName:"",getReferedAction:function(e){return new InfoPlus.Dynamics.ReferedAction(e,this)}},define("InfoPlus.Dynamics.Action",e)}(window),function(){function e(e,t){this.targetFieldName=e,this.action=t.action,this.actionAsts=t.actionAsts,this.ignoreCondition=t.ignoreCondition,this.condition=t.condition,this.conditionAsts=t.conditionAsts}e.prototype={targetFieldName:"",action:"",actionAsts:null,condition:"",conditionAsts:null,ignoreCondition:!0},define("InfoPlus.Dynamics.ReferedAction",e)}(window),function(){function e(e){this.tip=e.tip,this.condition=e.condition||"",this.keyName=e.keyName;var t=e.fieldRowIndexName||"";""!==t&&(-1!==this.tip.indexOf("$INDEX")&&(this.tip=this.tip.replace(/\$INDEX/g,"$"+t)),-1!==this.condition.indexOf("$INDEX"))&&(this.condition=this.condition.replace(/\$INDEX/g,"$"+t));""!==(t=e.fieldGroupCountName||"")&&(-1!==this.tip.indexOf("$COUNT")&&(this.tip=this.tip.replace(/\$COUNT/g,"$"+t)),-1!==this.condition.indexOf("$COUNT"))&&(this.condition=this.condition.replace(/\$COUNT/g,"$"+t));for(var n=[],i=(""===this.condition||"true"===this.condition.toLowerCase()?this.ignoreCondition=!0:(this.conditionAsts=$$.parseDynamic(this.condition,this.keyName),n=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts).getReferenceNameArray()),this.tipAsts=$$.parseDynamic(this.tip,this.keyName),new InfoPlus.Dynamics.Parser.Compile(this.tipAsts).getReferenceNameArray()),a=[],r=0;r<i.length;r++){for(var o=i[r],s=!1,l=0;l<n.length;l++)if(n[l]===o){s=!0;break}s||a.push(o)}this.references=a.concat(n)}e.prototype={tip:"",tipAsts:null,ignoreCondition:!1,condition:"",conditionAsts:null,references:[],keyName:"",getReferedValidation:function(e){return new InfoPlus.Dynamics.ReferedValidation(e,this)}},define("InfoPlus.Dynamics.Validation",e)}(window),function(){function e(e,t){this.targetFieldName=e,this.tip=t.tip,this.tipAsts=t.tipAsts,this.ignoreCondition=t.ignoreCondition,this.condition=t.condition,this.conditionAsts=t.conditionAsts}e.prototype={targetFieldName:"",tip:"",tipAsts:null,condition:"",conditionAsts:null,ignoreCondition:!1},define("InfoPlus.Dynamics.ReferedValidation",e)}(window),function(){function e(){}e.prototype={context:{},build:function(){function t(e){var t=e.path;null==n[t]&&(n[t]=[],r.push(t)),n[t].push(e)}var e,n={},r=[],i={};$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);null!=e&&null!=e.path&&null!=e.field&&t(e)}),$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var e=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);null!=e&&null!=e.path&&null!=e.groupName&&t(e)});for(e in n)if(n.hasOwnProperty(e)){for(var a=$IU.getReferedControlPaths(e),o=function(e){for(var t=[],n=0,i=r.length;n<i;n++){var a=r[n];a.length>e.length&&a.substr(0,e.length)===e&&"_"===a.substr(e.length,1)&&t.push(a)}return t}(e),s=[],l=0,u=(a=a.concat(o)).length;l<u;l++)s=s.concat(n[a[l]]);i[e]=s}this.context=i},get:function(e){var t=this.context;return t.hasOwnProperty(e)?t[e]:[]}},define("InfoPlus.Dynamics.Cache",e)}(window),function(){function e(e){this.element=e.element,this.permission=e.field.permission,this.isValid=e.checkValid()}e.prototype={element:null},define("InfoPlus.Dynamics.ControlReference",e)}(window),function(){function e(e){this.repeatParentElement=e.repeatParentElement,this.permission=e.groupInformation.permission}e.prototype={element:null},define("InfoPlus.Dynamics.RepeatControlReference",e)}(window),function(e,d){function t(e,t,n,i,a,r,o){null!=e&&null!=n&&(this.controlType=e,this.path=t,this.field=n,this.render=i,this.initValue=a,this.initDisplayValue=r,this.initAttributes=o,!0===n.fieldChanging&&(this.onFieldChange=!0),!0===n.needSync&&(this.onFieldSync=!0),null==this.createControl())&&(this.element=null,this.controlContainer=null)}t.CONTROL_TYPE_EDIT="BoundEdit",t.CONTROL_TYPE_TEXT="BoundTextArea",t.CONTROL_TYPE_RICHTEXT="BoundRichText",t.CONTROL_TYPE_DATE="BoundDate",t.CONTROL_TYPE_TIME="BoundTime",t.CONTROL_TYPE_CHECKBOX="BoundCheck",t.CONTROL_TYPE_CHECKBOX_LIST="BoundCheckList",t.CONTROL_TYPE_RADIO="BoundOption",t.CONTROL_TYPE_RADIO_LIST="BoundOptionList",t.CONTROL_TYPE_RADIO_GROUP="BoundOptionGroup",t.CONTROL_TYPE_SELECT="BoundSelect",t.CONTROL_TYPE_REMARK="BoundRemark",t.CONTROL_TYPE_ANCHOR="BoundAnchor",t.CONTROL_TYPE_ACTION="BoundAction",t.CONTROL_TYPE_LABEL="BoundLabel",t.CONTROL_TYPE_HIDDEN="BoundHidden",t.CONTROL_TYPE_SUGGESTER="BoundSuggester",t.CONTROL_TYPE_SUGGESTER2="BoundSuggester2",t.CONTROL_TYPE_FILE="BoundFile",t.CONTROL_TYPE_FILE_LIST="BoundFileList",t.CONTROL_TYPE_IMAGE="BoundImage",t.CONTROL_TYPE_PICTURE="BoundPicture",t.CONTROL_TYPE_HELP="BoundHelp",t.CONTROL_TYPE_BUTTON="BoundButton",t.CONTROL_TYPE_LINK_BUTTON="BoundLinkButton",t.CONTROL_TYPE_CHECK_BUTTON="BoundCheckButton",t.CONTROL_TYPE_PASSWORD="BoundPassword",t.CONTROL_TYPE_IFRAME="BoundIFrame",t.CONTROL_TYPE_THING="BoundThing",t.CONTROL_TYPE_CONVERTED_LABEL="BoundConvertedLabel",t.CONTROL_TYPE_SWITCH="BoundSwitch",t.CONTROL_TYPE_MAP="BoundMap",t.CONTROL_TYPE_SIGNATURE="BoundSignature",t.CONTROL_TYPE_SEAL="BoundSeal",t.CONTROL_TYPE_DOC="BoundDoc",t.DATA_CONTROL_OBJECT="controlObject",t.DATA_TYPE="dataType",t.DATA_TYPE_STRING="string",t.DATA_TYPE_ANYURI="anyURI",t.DATA_TYPE_XHTML="XHTML",t.DATA_TYPE_INT="integer",t.DATA_TYPE_DOUBLE="double",t.DATA_TYPE_BOOL="boolean",t.DATA_TYPE_DATE="date",t.DATA_TYPE_TIME="time",t.DATA_TYPE_DATETIME="dateTime",t.DATA_TYPE_USER="User",t.DATA_TYPE_ORGANIZE="Organize",t.DATA_TYPE_CODE="Code",t.DATA_TYPE_FILE="File",t.DATA_TYPE_THING="Thing",t.DATA_TYPE_DOC="Doc",t.DATA_TYPE_LOCATION="Location",t.DATA_TYPE_SIGNATURE="Signature",t.DATA_TYPE_LIST="List",t.DATA_IS_CONTROL="isControl",t.DATA_PATH="path",t.DATA_RENDER="render",t.DATA_FIELD="field",t.DATA_EXTERNAL_LINK="externalLink",t.DATA_SUGGESTER="suggester",t.DATA_CONTROL_TYPE="controlType",t.DATA_VALIDATOR="validator",t.DATA_VALIDATOR_PROMPT_POSITION="validatorPromptPosition",t.DATA_ORIGIN_INPUT="originInput",t.DATA_ORIGIN_CONTROL="originControl",t.DATA_SOURCE_CONTROL="sourceControl",t.DATA_ORIGIN_STYLE="originStyle",t.DATA_ATTRIBUTES="attributes",t.DATA_VALUE="value",t.DATA_DISPLAY_VALUE="displayValue",t.CLASSNAME_CONTROL="infoplus_control",t.CLASSNAME_READONLY="infoplus_readonly",t.CLASSNAME_WRITABLE="infoplus_writable",t.CLASSNAME_FIELD_CHANGE="infoplus_fieldChange",t.CLASSNAME_VAR="infoplus_var",t.CLASSNAME_ROWINDEX="infoplus_rowIndex",t.CLASSNAME_GROUP_COUNT="infoplus_groupCount",t.prototype={guid:null,compatibleFieldTypes:[],element:null,elementClassName:"",name:"",controlContainer:null,onFieldChange:!1,onFieldRefer:!1,onFieldSync:!1,ignoreClass:!1,ignoreValidation:!1,allowFocus:!0,autoTriggerFieldChangeEvent:!0,fieldChangeProcessor:new InfoPlus.Controls.Event.FieldChangeEventProcessor,dynamicProcessor:new InfoPlus.Dynamics.Processor,events:[],conditionalStyles:[],validatorPromptPosition:"topRight",parentValue:null,maxLength:null,clickFireFieldChange:!1,synced:!1,tooltip:null,dynamicReadonly:!1,dynamicParallelReadonly:!1,hasHiddenElement:!1,getElementClassName:function(){return"infoplus_"+this.name+"Control"},getContainerClassName:function(){return this.getElementClassName()+"Container"},createControl:function(){return!1===this.checkCompatibility()?($IU.delayedErrorMessageBox($$.lt("control.createError",this.field.name)),null):(this.element=this.createElement(),null==this.element?null:(this.hasHiddenElement&&null==$(this.element).data($Control.DATA_ORIGIN_INPUT)&&this.createHiddenElement(),this.guid=$$.guid(),this.setInfopathFormAttributes(),this.setControlData(),this.setElementAttribute(),this.processValidation(),this.processDynamicValidation(),this.specialSetting(),this.setPermission(),this.setPlaceHolder(),this.isReadable()&&(this.setValue(this.initValue,this.initDisplayValue,!0,this.initAttributes),this.setAttributes(this.initAttributes)),this.addFieldChangeClass(),this.registerEvent(),this.element))},createElement:function(){return null},createHiddenElement:function(e){var t;e===d&&(e=this.element),this.controlType==$Control.CONTROL_TYPE_RICHTEXT?(t=$(e).find("textarea")[0],$(e).data($Control.DATA_ORIGIN_INPUT,t),$(t).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType)):((t=document.createElement("input")).type="hidden",$(e).data($Control.DATA_ORIGIN_INPUT,t),$(t).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType),(null==this.controlContainer?e:this.controlContainer).appendChild(t))},syncValue:function(e,t,n){!1===this.autoTriggerFieldChangeEvent&&(this.synced=!0),this.setValue(e,t,!1,n)},setValue:function(e,t,n){$(this.element).val(e)},getValue:function(e){return null!=this.element?$(this.element).val():null},setStyle:function(e,t){$IU.setDynamicStyle(this.element,e,t)},getStyle:function(e){return $IU.getElementStyle(this.element,e)},getId:function(){return this.element.id},checkValid:function(){return!0},getParentValue:function(){return this.parentValue},getAttributes:function(){return $(this.element).data($Control.DATA_ATTRIBUTES)},setAttributes:function(e){null==e?$(this.element).removeData($Control.DATA_ATTRIBUTES):$(this.element).data($Control.DATA_ATTRIBUTES,e)},getSortValue:function(){var e=this.getValue();return e instanceof $Controls.Data.ValuePair?e.displayValue:e instanceof $Controls.Data.Uri?e.value:e},getPosition:function(){var e=null!=this.controlContainer?$(this.controlContainer):$(this.element);return e.is(":visible")?{left:e.offset().left,top:e.offset().top,width:e.outerWidth(),height:e.outerHeight()}:null},setElementAttribute:function(){var e,t;this.hasHiddenElement?this.setHiddenAttribute():(e=this.element,t=this.render,e.id=t.controlId+this.path,$(e).attr("name",t.field+this.path),$(e).data($Control.DATA_FIELD,t.field).data($Control.DATA_RENDER,t),null!=this.controlContainer&&$(this.controlContainer).attr("id",e.id+"_Container"))},setHiddenAttribute:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT),n=this.render,i=this.path;this.element.id=this.name+"_"+$$.guid(),t.id=n.controlId+i,t.name=n.field+i,$(t).data($Control.DATA_PATH,i).data($Control.DATA_FIELD,n.field).data($Control.DATA_RENDER,n).data($Control.DATA_IS_CONTROL,!0).data($Control.DATA_CONTROL_OBJECT,this),e.data($Control.DATA_FIELD,n.field),null!=this.controlContainer&&$(this.controlContainer).attr("id",this.element.id+"_Container")},specialSetting:function(){},getControlContainer:function(){return null!=this.controlContainer?this.controlContainer:this.element},setReadOnly:function(){switch(this.element.readOnly=!0,this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_TIME:case $Control.CONTROL_TYPE_PASSWORD:case $Control.CONTROL_TYPE_SWITCH:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_BUTTON:case $Control.CONTROL_TYPE_CHECK_BUTTON:$(this.element).addClass($Control.CLASSNAME_READONLY),this.element.disabled=!0;break;case $Control.CONTROL_TYPE_RADIO:case $Control.CONTROL_TYPE_RADIO_GROUP:$(this.element).addClass($Control.CLASSNAME_READONLY).addClass("disabled"),this.element.disabled=!0;break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled");var e=$(this).parent();this.checked?e.addClass("checked").removeClass("unchecked"):e.addClass("unchecked").removeClass("checked"),e.addClass($Control.CLASSNAME_READONLY),this.disabled=!0});break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled"),$(this).parent().attr("class",this.checked?"checked":"unchecked").addClass($Control.CLASSNAME_READONLY),this.disabled=!0});break;case $Control.CONTROL_TYPE_SUGGESTER2:var e=$(this.element).data($Control.DATA_ORIGIN_INPUT);$(this.element).addClass($Control.CLASSNAME_READONLY),e.disabled=!0;break;case $Control.CONTROL_TYPE_RICHTEXT:case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:case $Control.CONTROL_TYPE_FILE_LIST:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_LINK_BUTTON:break;case $Control.CONTROL_TYPE_THING:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:case $Control.CONTROL_TYPE_MAP:break;default:$(this.element).addClass($Control.CLASSNAME_READONLY),null!=this.controlContainer&&$(this.controlContainer).addClass($Control.CLASSNAME_READONLY)}},setDynamicReadOnly:function(e){},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setReadOnly()},setWritableClass:function(){switch(this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_RICHTEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_TIME:case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_SUGGESTER2:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_RADIO:$(this.element).addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:break;case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:}},checkCompatibility:function(){return null!=this.field&&null!=this.render&&"Boundable"===this.render.renderCategory&&-1!==$.inArray(this.field.type,this.compatibleFieldTypes)},checkDataType:function(e){switch(this.field.type){case InfoPlus.Controls.Control.DATA_TYPE_STRING:case InfoPlus.Controls.Control.DATA_TYPE_ANYURI:case InfoPlus.Controls.Control.DATA_TYPE_XHTML:case InfoPlus.Controls.Control.DATA_TYPE_USER:case InfoPlus.Controls.Control.DATA_TYPE_ORGANIZE:case InfoPlus.Controls.Control.DATA_TYPE_CODE:return $IU.isString(e);case InfoPlus.Controls.Control.DATA_TYPE_INT:case InfoPlus.Controls.Control.DATA_TYPE_DATE:return $IU.isInt(e);case InfoPlus.Controls.Control.DATA_TYPE_DOUBLE:return $IU.isNumber(e);case InfoPlus.Controls.Control.DATA_TYPE_BOOL:return $IU.isBoolean(e)}return!1},setControlData:function(){$(this.element).data($Control.DATA_TYPE,this.field.type).data($Control.DATA_CONTROL_TYPE,this.controlType).data($Control.DATA_CONTROL_OBJECT,this).data($Control.DATA_IS_CONTROL,!0).data($Control.DATA_PATH,this.path).addClass($Control.CLASSNAME_CONTROL).addClass(this.getElementClassName()),null!=this.controlContainer&&$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this)},processDynamicValidation:function(){if(!this.ignoreValidation&&!this.isReadOnly()){var e=this.element,t=this.render.properties;if(null!=t&&0<t.length)for(var n=0,i=t.length;n<i;n++){var a=t[n];if("validation"===a.key&&null!=a.values){var r,o=$(e).data($Control.DATA_VALIDATOR);null==o&&(o={required:!1,builtIn:!1,dynamics:[]},$(e).data($Control.DATA_VALIDATOR,o),(r=$(e).data($Control.DATA_ORIGIN_INPUT))!==d&&($(r).data($Control.DATA_VALIDATOR,o),null!==this.validatorPromptPosition)&&$(r).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition),null!==this.validatorPromptPosition&&$(e).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition),$IU.addElementValidateClass(e)),null==o.dynamics&&(o.dynamics=[]);for(var s=0,l=a.values.length;s<l;s++){var u=a.values[s];o.dynamics.push({tip:u.value,condition:u.condition,builtIn:u.builtIn})}}}}},processValidation:function(){var e,t,n;this.ignoreValidation||this.isReadOnly()||(t=this.field,e=this.element,!0!==t.notNull&&!t.regEx)||(t={required:t.notNull,regEx:t.regEx,prompt:t.prompt,builtIn:!1},(n=$(e).data($Control.DATA_ORIGIN_INPUT))!==d&&$(n).data($Control.DATA_VALIDATOR,t),$(e).data($Control.DATA_VALIDATOR,t),null!==this.validatorPromptPosition&&$(e).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition),$IU.addElementValidateClass(e))},setInfopathFormAttributes:function(){var e=this.element;if(null!=e){var t=$(e),n=this.render.attributes;if(null!=n&&$IU.isArray(n))for(var i=0;i<n.length;i++){var a=n[i],r=a.key;null!=a.namespace&&""!==a.namespace&&(r=a.namespace+":"+r);try{switch(r.toLocaleLowerCase()){case"class":this.ignoreClass||t.addClass(a.value);break;case"hidefocus":case"tabindex":this.allowFocus&&e.setAttribute(r,a.value);break;case"onclick":case"value":case"contenteditable":break;default:e.setAttribute(r,a.value)}}catch(e){}}}},isWritable:function(){var e=this.field;return null!=e&&-1!==(e.permission||"").indexOf("w")&&!this.dynamicParallelReadonly},isReadable:function(){var e=this.field;return null!=e&&-1!==(e.permission||"").indexOf("r")},isEditable:function(){var e=this.field;return null!=e&&-1!==(e.permission||"").indexOf("e")},isDynamicReadonly:function(){return this.dynamicReadonly},hasNoPowerAtAll:function(){return!this.isWritable()&&!this.isReadable()},isReadOnly:function(){return!this.isWritable()&&this.isReadable()},isVisible:function(){return $(this.controlContainer||this.element).is(":visible")},hideControl:function(){this.element.style.display="none",this.element.disabled=!0},setPermission:function(){null!=this.field&&(this.isReadable()?(this.isReadOnly()&&this.setReadOnly(),this.isWritable()&&this.setWritableClass()):this.visible(!1))},addFieldChangeClass:function(){var e;(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&((e=$(this.element).data($Control.DATA_ORIGIN_INPUT))!==d?$(e):$(this.element)).addClass($Control.CLASSNAME_FIELD_CHANGE)},setDynamicStyle:function(e,t){this.dynamicProcessor.processDynamicStyle(this,e,d,d,t)},doDynamicAction:function(e,t){this.dynamicProcessor.processDynamicAction(this,e,d,d,t)},doDynamicValidation:function(e,t){this.dynamicProcessor.processDynamicValidation(this,e,d,d,t)},setDynamicValue:function(e,t){this.dynamicProcessor.processDynamicFormula(this,e,d,d,d,t)},fieldChangeEvent:function(e){return this.fieldChangeProcessor.fieldChangeEvent(this,e)},fieldReferEvent:function(e,t,n,i,a,r,o){this.dynamicProcessor.fieldReferEvent(this,e,t,n,i,a,r,o)},fieldSyncEvent:function(){for(var e,t,n=this.getValue(),i=this.render.field+this.path,a=this.element,r=(n instanceof $Controls.Data.ValuePair&&(e=n.displayValue,t=this.getAttributes(),n=n.value),n instanceof $Controls.Data.Uri&&(n=n.value),$$.params.fieldSyncing=!0,document.getElementsByName(i)),o=0,s=r.length;o<s;o++){u=$(r[o]),l=void 0;var l,u=l=(l=u.data($Control.DATA_SOURCE_CONTROL))===d?u.data($Control.DATA_CONTROL_OBJECT):l;null==u||r[o]===a||u===this||this.controlType===$Control.CONTROL_TYPE_RADIO&&u.controlType===$Control.CONTROL_TYPE_RADIO||((l=u.getValue())instanceof $Controls.Data.Thing?l.value!==n||l.displayValue!==e:(l=null!=l&&l.value!==d?l.value:l)!==n)&&(u.syncValue(n,e,t),0)}$$.params.fieldSyncing=!1},registerEvent:function(){},shouldFireChangeEvent:function(e){var t,n;return!0===this.synced?this.synced=!1:!!(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&(t=this.getValue(),n=null!=e&&e.value!==d&&e.displayValue!==d,t instanceof $Controls.Data.Uri?t.value!==e:t instanceof $Controls.Data.Thing?n?t.value!==e.value||t.displayValue!==e.displayValue:t.displayValue!==e:t instanceof $Controls.Data.ValuePair?n?t.value!==e.value:t.value!==e:n?t!==e.value:t!==e)},shouldFireChangeEventAgain:function(e){return this.autoTriggerFieldChangeEvent&&this.shouldFireChangeEvent(e)},getDataSource:function(){return null},getDataType:function(){return null==this.field?null:this.field.type},setFocus:function(){if(null!=this.element&&this.isReadable())try{this.element.focus()}catch(e){}},lostFocus:function(){if(null!=this.element&&this.isReadable())try{this.element.blur()}catch(e){}},getDynamicKeyName:function(){return null==this.field?null:this.field.name},getDynamicContextControlName:function(){return null==this.field||null==this.field.name?null:this.field.name+"Ref"},setPlaceHolder:function(){null!=this.element&&this.element.placeholder!==d&&null!=this.field&&null!=this.field.placeHolder&&$(this.element).attr("placeholder",this.field.placeHolder)},setParentValue:function(e){e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri?this.parentValue=e.value:this.parentValue=e},visible:function(e){var t;null!=this.element&&(e?this.isReadable()&&(this.isWritable()&&$(this.element).removeAttr("disabled"),$(this.element).show(),(t=$(this.element).parents(".kt-control"))&&t.size()&&t.show(),null!=this.controlContainer)&&$(this.controlContainer).show():($(this.element).attr("disabled","disabled").hide(),(t=$(this.element).parents(".kt-control"))&&t.size()&&t.hide(),null!=this.controlContainer&&$(this.controlContainer).hide()))},convertEmptyValue:function(e){return null==e||""===e?"":e},getRow:function(){var e=this.controlContainer,e=null==e?this.element:e;return $(e).parents("tr,.infoplus_repeatingSection,.infoplus_view").first()},setMaxLength:function(){var e;null!=this.field.settings&&null!=this.field.settings.maxLength&&(e=parseInt(this.field.settings.maxLength,10),isNaN(e)||0===e||(this.maxLength=e))},getGroupName:function(){var e;return null==this.field||(e=this.field).groupArray.length<2?"":e.groupArray[e.groupArray.length-1]},getGroupRowIndexName:function(){var e;return null==this.field||(e=this.field).groupArray.length<2?"":"field"+(e=(e=e.groupArray[e.groupArray.length-1]).substr(0,1).toUpperCase()+e.substr(1))+"RowIndex"+$$.params.rowIndexSuffix},getGroupCountName:function(){var e;return null==this.field||(e=this.field).groupArray.length<2?"":"field"+(e=(e=e.groupArray[e.groupArray.length-1]).substr(0,1).toUpperCase()+e.substr(1))+"Count"+$$.params.rowIndexSuffix},isDetailControl:function(){return null!=this.element&&(0<$(this.element).parents(".detailCell").size()||0<$(this.element).parents(".detailSection").size())},setTooltip:function(t){try{""===t?this.tooltip=null:(this.tooltip=$.parseJSON(t),"object"!=typeof this.tooltip&&(this.tooltip={tip:t,type:"info"}))}catch(e){this.tooltip={tip:t,type:"info"}}},showTooltip:function(){null!=this.tooltip&&""!==this.tooltip.tip&&($(this.element).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",!0),$(this.element).one("blur",function(){$(this).validationEngine("hidePrompt")}))},markModified:function(){this.setClass("modified")},clearModified:function(){this.removeClass("modified")},setClass:function(e){(null!=this.controlContainer?$(this.controlContainer):$(this.element)).addClass(e)},removeClass:function(e){(null!=this.controlContainer?$(this.controlContainer):$(this.element)).removeClass(e)}},define("InfoPlus.Controls.Control",t),e.$Controls=InfoPlus.Controls,e.$Control=InfoPlus.Controls.Control}(window),function(){var o={defaultOptions:{dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,yearRange:"c-100:c+50",beforeShow:function(e){var t=$(this).data($Control.DATA_VALIDATOR);if(null!=t)return(!0===t.required||t.regEx&&t.prompt)&&$IU.removeElementValidateClass(this),!$(e).attr("readonly")&&void 0},onClose:function(){var e=$(this).data($Control.DATA_VALIDATOR);null!=e&&(!0===e.required||e.regEx&&e.prompt)&&($IU.addElementValidateClass(this),$$.params.renderForm.validationEngine("validateField","#"+this.id))}}};o.create=function(e,t){var n,i,a,r;null!=t.dateFormat&&(n=t.dateFormat,a=n,r=$(e).data($Control.DATA_CONTROL_OBJECT).field,null!=a&&$IU.isString(a)&&(8!=a.length||"yy-mm-"!=a.substr(0,6)||(a=parseInt(a.substr(6,2),10),isNaN(a))||31<a?$IU.debugTip($$.lt("date.errorFormat",r.name),"warning"):(i=parseInt(n.substr(7,2),10),t.showYearMonthOnly=!0,t.showButtonPanel=!0,t.onClose=function(e,t){$(this).datepicker("setDate",new Date(t.selectedYear,t.selectedMonth,i)),o.defaultOptions.onClose()})),t.dateFormat="yy-mm-dd"),t=$.extend({},o.defaultOptions,t),$(e).datepicker(t)},o.destroy=function(e){$(e).datepicker("destroy")},o.setReadOnly=function(e,t){e.readOnly=!0===t},define("InfoPlus.Controls.Adapter.DateAdapter",o)}(window),function(){function e(e,t,n,i,a){$Control.call(this,$Control.CONTROL_TYPE_ANCHOR,e,t,n,i,a)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_CODE],ignoreValidation:!0,allowFocus:!1,name:"anchor",clickFireFieldChange:!0,getAnchorText:function(e){var t=this.field.settings,n=$$.lt("anchor.defaultText");return null!=e&&""!==e?n=e:null!=t&&null!=t.displayText&&(n=t.displayText),n},createElement:function(){var e=this.field,t=this.initValue,n=(null!=t&&""!==t||(t="#"),document.createElement("a")),i=$(n),a=this.getAnchorText(this.initDisplayValue),e=(i.text(a),new InfoPlus.ExternalLink(t,e.settings,a));return n.setAttribute("href",""),n.setAttribute("target",e.mode===InfoPlus.ExternalLink.MODE_SELF?"_self":"_blank"),i.data("href",t).data($Control.DATA_EXTERNAL_LINK,e),n},setValue:function(e,t){var n=$(this.element).data($Control.DATA_EXTERNAL_LINK);null!=n&&(n.endPoint=null!=e&&""!==e?e:"#",n=this.getAnchorText(t),$(this.element).text(n))},getValue:function(){var e=$(this.element).data($Control.DATA_EXTERNAL_LINK);if(null==e)switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri("");case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair("","")}else switch(this.field.type){case $Control.DATA_TYPE_STRING:return"#"===e.endPoint?"":e.endPoint;case $Control.DATA_TYPE_ANYURI:return"#"===e.endPoint?new $Controls.Data.Uri(""):new $Controls.Data.Uri(e.endPoint);case $Control.DATA_TYPE_CODE:return"#"===e.endPoint?new $Controls.Data.ValuePair("",""):new $Controls.Data.ValuePair(e.endPoint,$(this.element).text())}return""},getSortValue:function(){return this.element.innerHTML},getAttributes:function(){var e;return this.field.type===$Control.DATA_TYPE_ANYURI?(e=this.getValue(),$IU.getParamFromUrl(e.value)):null},registerEvent:function(){this.events=InfoPlus.Controls.Anchor.Events.events},setDynamicReadOnly:function(e){e?$(this.element).addClass($Control.CLASSNAME_READONLY):$(this.element).removeClass($Control.CLASSNAME_READONLY)},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setDynamicReadOnly(!0)}}),define("InfoPlus.Controls.Anchor",e);var t={onMouseDown:function(e){var t;if(2===e.which||3===e.which)return e.stopImmediatePropagation(),e.preventDefault(),t=this,setTimeout(function(){$IU.fireClick(t)},3===e.which?200:0),!1},onContextMenu:function(){return!1},onActionClick:function(){var e,t,n=$(this).data($Control.DATA_CONTROL_OBJECT),i=n.field,a=$(this).data($Control.DATA_EXTERNAL_LINK),r=a.endPoint,o=this;return null!=i&&(!0===$(o).data("clickFromCode")?($(o).data("clickFromCode",!1),!0):(e=function(){return o.href=r,a.href=r,!a.openWindow()},!(null!=i.placeHolder&&""!==i.placeHolder&&!confirm(i.placeHolder))&&(!0===i.fieldChanging?(i={},i=(t=$$.getFormRender()).save(i,n.isDetailControl()),n.fieldChangeEvent(i).done(function(){t.doDynamicsAfterFieldChange(),$$.fieldChanged($$(n)),$$(n).fieldChanged()}).fail(function(e){"EVENT_CANCELLED"===e.errCode&&t.doDynamicsAfterFieldChange()}).done(function(){r=$(o).data($Control.DATA_EXTERNAL_LINK).endPoint,e()&&($(o).data("clickFromCode",!0),$IU.fireClick(o.id),setTimeout(function(){$(o).data("clickFromCode",!1)},1e3))}),!1):e())))}};t.events=[{type:"click",handler:t.onActionClick},{type:"mousedown",handler:t.onMouseDown},{type:"contextmenu",handler:t.onContextMenu}],define("InfoPlus.Controls.Anchor.Events",t)}(window),function(){function e(e,t,n,i,a){t.fieldChanging=!0,null!=a&&""!==a||null!=t.settings&&null!=t.settings.displayText&&(a=t.settings.displayText),$Control.call(this,$Control.CONTROL_TYPE_BUTTON,e,t,n,i,a)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_CODE],ignoreClass:!0,ignoreValidation:!0,name:"button",clickFireFieldChange:!0,hasHiddenElement:!0,getButtonText:function(e,t){var n=this.field.settings;return null!=t&&""!==t?t:null!=e&&""!==e?e:null!=n&&null!=n.displayText?n.displayText:$$.lt("button.defaultText")},createElement:function(){var e=document.createElement("button"),t=this.getButtonText(this.initValue,this.initDisplayValue),n=document.createElement("div");return e.setAttribute("type","button"),$(e).text(t),n.appendChild(e),this.controlContainer=n,$(n).addClass("infoplus_buttonControlContainer"),e},setValue:function(e,t){t=this.getButtonText(e,t);$(this.element).text(t).val(e)},getValue:function(){var e=this.convertEmptyValue($(this.element).val());switch(this.field.type){case $Control.DATA_TYPE_STRING:return e;case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(e,$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.Button.Events.events},triggerChange:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT);this.onFieldChange&&e.attr("disabled","disabled"),$(t).change()}}),define("InfoPlus.Controls.Button",e);var t={onButtonClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT),t=e.field;return null==t||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||(null!=t.placeHolder&&""!==t.placeHolder?$IU.yesNoBox(t.placeHolder,400,function(){e.triggerChange()}):e.triggerChange()),!1}};t.events=[{type:"click",handler:t.onButtonClick}],define("InfoPlus.Controls.Button.Events",t)}(window),function(){function e(e,t,n,i,a){t.fieldChanging=!0,null!=a&&""!==a||null!=t.settings&&null!=t.settings.displayText&&(a=t.settings.displayText),$Control.call(this,$Control.CONTROL_TYPE_LINK_BUTTON,e,t,n,i,a)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_CODE],ignoreClass:!0,ignoreValidation:!0,name:"linkButton",hasHiddenElement:!0,clickFireFieldChange:!0,getButtonText:function(e,t){var n=this.field.settings;return null!=t&&""!==t?t:null!=e&&""!==e?e:null!=n&&null!=n.displayText?n.displayText:$$.lt("button.defaultText")},createElement:function(){var e=document.createElement("a"),t=$(e),n=this.getButtonText(this.initValue,this.initDisplayValue),i=document.createElement("div");return t.text(n),e.setAttribute("href",""),i.appendChild(e),this.controlContainer=i,$(i).addClass("infoplus_buttonControlContainer"),e},setValue:function(e,t){t=this.getButtonText(e,t);$(this.element).text(t).val(e)},getValue:function(){var e=this.convertEmptyValue($(this.element).val());switch(this.field.type){case $Control.DATA_TYPE_STRING:return e;case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(e,$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.LinkButton.Events.events},setDynamicReadOnly:function(e){e?$(this.element).addClass($Control.CLASSNAME_READONLY):$(this.element).removeClass($Control.CLASSNAME_READONLY)},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setDynamicReadOnly(!0)},triggerChange:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT);this.onFieldChange&&e.attr("disabled","disabled"),$(t).change()}}),define("InfoPlus.Controls.LinkButton",e);var t={onButtonClick:function(){var e,t;return $(this).is("[disabled]")||null==(t=(e=$(this).data($Control.DATA_CONTROL_OBJECT)).field)||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||(null!=t.placeHolder&&""!==t.placeHolder?$IU.yesNoBox(t.placeHolder,400,function(){e.triggerChange()}):e.triggerChange()),!1}};t.events=[{type:"click",handler:t.onButtonClick}],define("InfoPlus.Controls.LinkButton.Events",t)}(window),function(){function e(e,t,n,i,a,r){null!=a&&""!==a||null!=t.settings&&null!=t.settings.displayText&&(a=t.settings.displayText),$Control.call(this,$Control.CONTROL_TYPE_CHECK_BUTTON,e,t,n,i,a,r)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_CODE],ignoreClass:!0,ignoreValidation:!0,name:"checkButton",clickFireFieldChange:!0,hasHiddenElement:!0,getButtonText:function(e){var t=this.field.settings;return null!=e&&""!==e?e:null!=t&&null!=t.displayText?t.displayText:$$.lt("button.defaultText")},createElement:function(){var e=document.createElement("button"),t=this.getButtonText(this.initDisplayValue),n=document.createElement("div");return e.setAttribute("type","button"),$(e).text(t),n.appendChild(e),this.controlContainer=n,$(n).addClass("infoplus_checkButtonControlContainer"),e},setValue:function(e,t,n,i){t=this.getButtonText(t);$(this.element).data($Control.DATA_ORIGIN_INPUT).value=e,$(this.element).text(t),this.setAttributes(i),this.setCheckClass()},toggleCheckValue:function(){var e;this.field.type===$Control.DATA_TYPE_BOOL?"true"===(e=$(this.element).data($Control.DATA_ORIGIN_INPUT)).value?e.value="false":e.value="true":null==(e=this.getAttributes())?this.setAttributes(e={checked:"true"}):e.checked="true"===e.checked?"false":"true",this.setCheckClass()},setCheckClass:function(){var e;this.field.type===$Control.DATA_TYPE_BOOL?"true"===$(this.element).data($Control.DATA_ORIGIN_INPUT).value?$(this.element).addClass("checked"):$(this.element).removeClass("checked"):null!=(e=this.getAttributes())&&"true"===e.checked?$(this.element).addClass("checked"):$(this.element).removeClass("checked")},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT);switch(this.field.type){case $Control.DATA_TYPE_BOOL:return"true"===e.value.toLowerCase();case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair($(e).val(),$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.CheckButton.Events.events},triggerChange:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT);this.onFieldChange&&e.attr("disabled","disabled"),$(t).change()}}),define("InfoPlus.Controls.CheckButton",e);var t={onButtonClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT),t=e.field;return null==t||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||(e.toggleCheckValue(),null!=t.placeHolder&&""!==t.placeHolder?$IU.yesNoBox(t.placeHolder,400,function(){e.triggerChange()}):e.triggerChange()),!1}};t.events=[{type:"click",handler:t.onButtonClick}],define("InfoPlus.Controls.CheckButton.Events",t)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX,e,t,n,i,null)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],name:"check",createElement:function(){var e=document.createElement("input");return e.type="checkbox",e},initCheck:function(){if(void 0!==this.element)if($$.params.engine&&"qform"==$$.params.engine){var e=this.render.source,e=e&&e.items&&0<e.items.length?e.items:[];0<e.length&&(a=document.createElement("label"),(r=$(a)).html(e[0].text),r.attr("for",this.element.getAttribute("id")).insertAfter(this.element).addClass("infoplus_checkLabel"))}else for(var t=this.element.parentElement.childNodes,n=0,i=t.length;n<i;n++)if(t[n]===this.element&&n<i-1){var a,r,o=t[n+1],o=$(o);o.hasClass($Control.CLASSNAME_CONTROL)||0!==o.find("."+$Control.CLASSNAME_CONTROL).length||(a=document.createElement("label"),r=$(a),o.detach().appendTo(r),r.attr("for",this.element.getAttribute("id")).insertAfter(this.element).addClass("infoplus_checkLabel"));break}},setValue:function(e){null==e&&(e=!1),$IU.isString(e)&&(e="true"===e.toLowerCase()),this.element.checked=!0===e,!0===e?$(this.element).addClass("checked"):$(this.element).removeClass("checked")},getValue:function(){return this.element.checked},getSortValue:function(){return this.getValue()?1:0},setReadOnly:function(){this.element.readOnly=!0,this.element.disabled=!0,$(this.element).addClass($Control.CLASSNAME_READONLY).addClass("disabled")},registerEvent:function(){this.events=InfoPlus.Controls.Check.Events.events},markModified:function(){$(this.element).parent().addClass("modified")},clearModified:function(){$(this.element).parent().removeClass("modified")}}),define("InfoPlus.Controls.Check",e);var t={onCheckChange:function(e){var t,n=$(this).data($Control.DATA_CONTROL_OBJECT),i=n.field;if($(this).is(":checked")?$(this).addClass("checked"):$(this).removeClass("checked"),null!=i&&null!=i.placeHolder&&""!==i.placeHolder){if(!0!==n.checkFromConfirm)return t=$(this).is(":checked"),n.setValue(!t),$IU.yesNoBox(i.placeHolder,400,function(){n.setValue(t),n.checkFromConfirm=!0,$(n.element).change()}),e.stopImmediatePropagation(),!1;n.checkFromConfirm=!1}}};t.events=[{type:"change",handler:t.onCheckChange}],define("InfoPlus.Controls.Check.Events",t)}(window),function(){function u(e,t,n){for(var i=-1!==e.indexOf("\n")?e.split("\n"):e.split(","),a=(a=null!=t?-1!==t.indexOf("\n")?t.split("\n"):t.split(","):a)||[],r=0,o=i.length;r<o;r++)s(i[r],n)||n.unshift({id:i[r],text:a[r]||i[r],enabled:!1})}function e(e,t,n,i,a){var r=null;if(null!=t.code){var o=$$.codeManager.getCode(t.code);if(null!=o)for(var r=[],s=0,l=o.items.length;s<l;s++)r.push({id:o.items[s].codeId,text:o.items[s].codeName,enabled:o.items[s].enabled});(null==r||$IU.isArray(r)&&0===r.length)&&(null==o||null!=o&&"External"===o.codeType)&&$$.codeManager.addRequestCode(t.code,t.name)}null!=i&&""!==i&&u(i,a,r=null==r?[]:r),this.items=r,$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX_LIST,e,t,n,i,a)}var s=function(e,t){for(var n=0,i=t.length;n<i;n++)if(e===t[n].id)return!0;return!1},t=(e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:!0,autoTriggerFieldChangeEvent:!1,name:"checkList",validatorPromptPosition:"topLeft",hasHiddenElement:!0,createElement:function(){var e=document.createElement("div");if(this.createHiddenElement(e),$$.params.engine&&"qform"==$$.params.engine){this.items=[];for(var t=this.render.source,n=t&&t.items&&0<t.items.length?t.items:[],i=0;i<n.length;i++)this.items.push({id:n[i].name+"",text:n[i].text,enabled:!0})}return this.setDataSourceFromItems(e,this.items,!0,!0),e},setValue:function(e,t,n){null==e&&(e="");var n=!n&&this.shouldFireChangeEvent(e),i=$(this.element).data($Control.DATA_ORIGIN_INPUT),a=(this.field.type===$Control.DATA_TYPE_STRING&&(i.value=e,$(i).data("label",t)),e.split(",")),r=this.isReadOnly();$(this.element).find("input[type=checkbox]").each(function(){this.checked=$IU.arrayContains(a,$IU.trimString($(this).val())),r?this.checked?$(this).parent().addClass("checked").removeClass("unchecked"):$(this).parent().addClass("unchecked").removeClass("checked"):this.checked?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked")}),n&&setTimeout(function(){$(i).change()},0)},getValue:function(e){var t,n;return null==this.field||null==this.element?"":!0===e?$(this.element).data($Control.DATA_ORIGIN_INPUT).value:(n=t="",$(this.element).find("input[type=checkbox]").each(function(){this.checked&&(t+=$IU.trimString(this.value)+",",n+=$IU.trimString($(this).data("label"))+",")}),""!==t&&(t=t.substr(0,t.length-1)),""!==n&&(n=n.substr(0,n.length-1)),new $Controls.Data.ValuePair(t,n))},getStringValue:function(e){e=this.getValue(e);return e instanceof $Controls.Data.ValuePair?e.value:e},checkValid:function(){var e=!0;return this.isReadOnly()||$(this.element).find("input[type=checkbox]").each(function(){this.checked&&$(this).parent().hasClass("deprecated")&&(e=!1)}),e},setDataSourceFromItems:function(e,t,n,i){var a,r=$(e).data($Control.DATA_ORIGIN_INPUT),r=n?r.value:this.getValue(),o=null==r||""===r?[]:(r instanceof $Controls.Data.ValuePair?r.value:r).split(","),s=this.isReadOnly(),l=($(e).children("label").remove(),!1);if($IU.isArray(t))for(var u=0,d=t.length;u<d;u++){var c=t[u],h=document.createElement("label"),p=document.createElement("input"),f=$(h),m=(p.type="checkbox",p.value=c.id,$IU.arrayContains(o,$IU.trimString(c.id))&&(p.checked=!0,f.addClass("checked")),$(p).data("label",c.text),document.createElement("span"));$(m).text(c.text),f.append(p),f.append(m),!n||c.enabled||s||(f.addClass("deprecated"),p=document.createElement("i"),$(p).addClass("i-icon-delete-outline"),f.append(p),l=!0),e.appendChild(h)}l&&(r={key:"validation",values:[{value:"'"+$$.lt("checkList.deprecated")+"'",condition:"!$"+this.field.name+"Ref.isValid",builtIn:!0}]},null==(a=this.render.properties)?this.render.properties=[r]:a.push(r)),!0!==i&&this.setDynamicStyle($$.params.formRender,n)},showTooltip:function(){var e;null!=this.tooltip&&""!==this.tooltip.tip&&((e=$(this.element)).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",!0),e.find("input").one("blur",function(){e.validationEngine("hidePrompt")}))},setStyle:function(e,t){for(var n=$(this.element).find("label"),i=0,a=n.length;i<a;i++){var r=n[i];$IU.setDynamicStyle(r,e,t)}},specialSetting:function(){var e=$(this.element).attr("style");null!=e&&-1!==(e=e.toLowerCase()).indexOf("height:")&&($(this.element).css("min-height",$(this.element).css("height")),$(this.element).css("height",""))},registerEvent:function(){this.events=InfoPlus.Controls.CheckList.Events.events},setOptions:function(e,t){null==this.items&&(this.items=[]);for(var n=this.items,i=0,a=t.length;i<a;i++){for(var r=t[i],o=-1,s=0,l=n.length;s<l;s++)if(n[s].id===r.codeId){o=s;break}-1!==o&&n.splice(o,1)}for(var u=0,d=t.length;u<d;u++){var c=t[u];this.items.push({id:c.codeId,text:c.codeName,enabled:c.enabled})}this.setDataSourceFromItems(this.element,this.items,!0),this.setPermission()},setDataSource:function(e,t){if(this.items=[],$IU.isString(e))for(var n=-1!==e.indexOf("\n")?e.split("\n"):e.split(","),i=0,a=n.length;i<a;i++){var r=n[i];this.items.push({id:r,text:r,enabled:!0})}t&&""!==this.initValue&&u(this.initValue,this.initDisplayValue,this.items),this.setDataSourceFromItems(this.element,this.items,t),this.setPermission();e=$(this.element);$(e.data($Control.DATA_ORIGIN_INPUT)).val(this.getStringValue()).change()},setDynamicReadOnly:function(e){e?$(this.element).find("input[type=checkbox]").each(function(){this.checked?$(this).parent().addClass("checked").removeClass("unchecked"):$(this).parent().addClass("unchecked").removeClass("checked"),$(this).addClass($Control.CLASSNAME_READONLY),this.disabled=!0}):($(this.element).find("label").removeAttr("class"),$(this.element).find("input[type=checkbox]").each(function(){$(this).removeClass($Control.CLASSNAME_READONLY),this.disabled=!1}))}}),define("InfoPlus.Controls.CheckList",e),{onClick:function(){var e=$(this).parent(),t=($(this).is(":checked")?e.addClass("checked"):(e.removeClass("checked"),e.hasClass("deprecated")&&e.animate({width:0},function(){e.remove()})),$(this).parent().siblings("input[type=hidden]")),n=$(t).data($Control.DATA_CONTROL_OBJECT);$(t).val(n.getStringValue()),$(t).change()}});t.events=[{type:"click",selector:".infoplus_checkListControl > label > input[type=checkbox]",handler:t.onClick}],define("InfoPlus.Controls.CheckList.Events",t)}(window),function(){function n(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_DATE,e,t,n,i,null)}function a(){return $$.MOBILE&&n.INPUT_TYPE_DATE_SUPPORT&&n.mobileDateSupport}n.DEFAULT_VALIDATOR_REGEX="^(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)$",n.DEFAULT_VALIDATOR_PROMPT=$$.lt("date.validateMessage"),n.INPUT_TYPE_DATE_SUPPORT=!0,n.mobileDateSupport=function(){return!0};n.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_DATE],name:"date",createElement:function(){null!=this.field.format&&""!==this.field.format&&(e=this.field,null!=(t=e.format))&&$IU.isString(t)&&(8!==t.length||"yy-mm-"!==t.substr(0,6)||(t=parseInt(t.substr(6,2),10),isNaN(t))||31<t?$IU.debugTip($$.lt("date.errorFormat",e.name),"warning"):(this.monthOnly=!0,this.monthDay=this.field.format.substr(6,2)));var e,t=document.createElement("input");if(a())try{t.type=this.monthOnly?"month":"date"}catch(e){n.INPUT_TYPE_DATE_SUPPORT=!1,t.type="text"}else t.type="text";return $(t).attr("autocomplete","off"),t},setValue:function(e){""!==(e=null==e?"":e)&&!1===isNaN(e)?(e=$IU.unixTimeToDateString(e),this.element.value=a()&&this.monthOnly?e.substr(0,7):e):this.element.value=""},getValue:function(){var e=a()&&this.monthOnly?this.element.value+"-"+this.monthDay:this.element.value,e=this.convertEmptyValue(e);return null==(e=$IU.dateStringToUnixTime(e))||""===e||isNaN(e)?"":e},getSortValue:function(){var e=this.getValue();return""===e?0:e},addDefaultValidator:function(){var e,t=this.field.permission||"";-1!==t.indexOf("r")&&-1===t.indexOf("w")||(null==(e=(t=$(this.element)).data($Control.DATA_VALIDATOR))?t.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:n.DEFAULT_VALIDATOR_REGEX,prompt:n.DEFAULT_VALIDATOR_PROMPT,builtIn:!0}):null!=e.regEx&&""!==e.regEx||(e.regEx=n.DEFAULT_VALIDATOR_REGEX,e.prompt=n.DEFAULT_VALIDATOR_PROMPT,e.builtIn=!0==!e.required))},specialSetting:function(){this.initDatePicker(),this.addDefaultValidator()},initDatePicker:function(){var e,t;-1!==(this.field.permission||"").indexOf("w")&&("To"===(e=this.field.name).substr(e.length-2)?(t=this,setTimeout(function(){t.initDatePickerOption()},500)):this.initDatePickerOption())},reInitDatePicker:function(){a()||-1!==(this.field.permission||"").indexOf("w")&&($(this.element).datepicker("destroy"),this.initDatePickerOption())},initDatePickerOption:function(e){var t,n;null==(e=null==e?{}:e).minDate&&"To"===(n=this.field.name).substr(n.length-2)&&(t=n.lastIndexOf("To"),n=n.substr(0,t)+n.substr(t).replace(/To/,"From")+this.path,0<(t=$$.params.renderForm.find("."+this.getElementClassName()+"[name='"+n+"'")).length)&&(n=t.data($Control.DATA_CONTROL_OBJECT).getValue(),a()?""!==n?$(this.element).attr("min",$IU.unixTimeToDateString(n)):$(this.element).attr("min",""):""!==n&&(e.minDate=$IU.unixTimeToDate(n))),a()||-1!==(this.field.permission||"").indexOf("w")&&(null!=this.field.format&&""!==this.field.format&&(e.dateFormat=this.field.format),InfoPlus.Controls.Adapter.DateAdapter.create(this.element,e))},onDatePickerBeforeShow:function(e,t){var n=$(this).data($Control.DATA_VALIDATOR);if(null!=n)return(!0===n.required||n.regEx&&n.prompt)&&$IU.removeElementValidateClass(this),!$(e).attr("readonly")&&void 0},onDatePickerClose:function(e,t){var n=$(this).data($Control.DATA_VALIDATOR);null!=n&&(!0===n.required||n.regEx&&n.prompt)&&($IU.addElementValidateClass(this),$$.params.renderForm.validationEngine("validateField","#"+this.id))},registerEvent:function(){this.events=InfoPlus.Controls.Date.Events.events},setDynamicReadOnly:function(e){InfoPlus.Controls.Adapter.DateAdapter.setReadOnly(this.element,e)}}),define("InfoPlus.Controls.Date",n);var e={onChange:function(){var e,t=$(this).data($Control.DATA_CONTROL_OBJECT),n=t.getValue(),i=t.field.name;4<i.length&&"From"===i.substr(i.length-4)&&(e=i.lastIndexOf("From"),i=i.substr(0,e)+i.substr(e).replace(/From/,"To")+t.path,0<(e=$$.params.renderForm.find("."+t.getElementClassName()+"[name='"+i+"'")).length)&&(a()?""!==n?e.attr("min",$IU.unixTimeToDateString(n)):e.attr("min",""):(InfoPlus.Controls.Adapter.DateAdapter.destroy(e[0]),""!==n?e.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption({minDate:$IU.unixTimeToDate(n)}):e.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption()))},onFocus:function(){$$.MOBILE&&/(iPhone|iPad)/i.test(navigator.userAgent)&&null!=this.getAttribute("readonly")&&this.blur()}};e.events=[{type:"change",handler:e.onChange},{type:"focus",handler:e.onFocus}],define("InfoPlus.Controls.Date.Events",e)}(window),function(){function n(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_TIME,e,t,n,i,null)}function i(){return $$.MOBILE&&n.INPUT_TYPE_TIME_SUPPORT}n.DEFAULT_VALIDATOR_REGEX="^(([1-9]{1})|([0-1][0-9])|([1-2][0-3])):([0-5][0-9])$",n.DEFAULT_VALIDATOR_PROMPT=$$.lt("time.validateMessage"),n.INPUT_TYPE_TIME_SUPPORT=!0;n.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_TIME],name:"time",createElement:function(){var t=document.createElement("input");if(i())try{t.type="time"}catch(e){n.INPUT_TYPE_DATE_SUPPORT=!1,t.type="text"}else t.type="text";return $(t).attr("autocomplete","off"),t},setValue:function(e){""!==(e=null==e?"":e)&&!1===isNaN(e)?this.element.value=$IU.unixTimeToTimeString(e):this.element.value=""},getValue:function(){var e=this.convertEmptyValue(this.element.value);return""===e||null==e||null==(e=$IU.timeStringToUnixTime(e))||""===e||isNaN(e)?"":e},getSortValue:function(){var e=this.getValue();return""===e?0:e},addDefaultValidator:function(){var e,t=this.field.permission||"";-1!==t.indexOf("r")&&-1===t.indexOf("w")||(null==(e=(t=$(this.element)).data($Control.DATA_VALIDATOR))?(t.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:n.DEFAULT_VALIDATOR_REGEX,prompt:n.DEFAULT_VALIDATOR_PROMPT,builtIn:!0}),$IU.addElementValidateClass(this.element)):null!=e.regEx&&""!==e.regEx||(e.regEx=n.DEFAULT_VALIDATOR_REGEX,e.prompt=n.DEFAULT_VALIDATOR_PROMPT,e.builtIn=!0==!e.required))},specialSetting:function(){i()||this.initClockPicker(),this.addDefaultValidator()},initClockPicker:function(){var e,t;i()||-1!==(this.field.permission||"").indexOf("w")&&(e=$(this.element),t=$(this.element).clockpicker({autoclose:!0,afterDone:function(){e.change()}}),e.data("clock",t))},setDynamicReadOnly:function(e){var t=this.element;e?i()||null!=(e=$(t).data("clock"))&&(e.clockpicker("remove"),$(t).removeData("clock")):($(t).removeClass($Control.CLASSNAME_READONLY),this.initClockPicker())}}),define("InfoPlus.Controls.Time",n)}(window),function(){function i(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_EDIT,e,t,n,i,null)}i.DEFAULT_VALIDATOR_REGEX_INTEGER="^-?\\d+$",i.DEFAULT_VALIDATOR_REGEX_DOUBLE="^(-?\\d+)(\\.\\d+)?$",i.DEFAULT_VALIDATOR_PROMPT_INTEGER=$$.lt("edit.validateIntegerMessage"),i.DEFAULT_VALIDATOR_PROMPT_DOUBLE=$$.lt("edit.validateFloatMessage"),i.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE],name:"edit",createElement:function(){var e=document.createElement("input");return e.type="text",null!=this.field.placeHolder&&$(e).attr("placeholder",this.field.placeHolder),e},addDefaultValidator:function(){var e,t,n=this.field.permission||"";-1!==n.indexOf("r")&&-1===n.indexOf("w")||(n=this.field.type)!==$Control.DATA_TYPE_INT&&n!==$Control.DATA_TYPE_DOUBLE||(null==(t=(e=$(this.element)).data($Control.DATA_VALIDATOR))?(n===$Control.DATA_TYPE_INT?e.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:i.DEFAULT_VALIDATOR_REGEX_INTEGER,prompt:i.DEFAULT_VALIDATOR_PROMPT_INTEGER,builtIn:!0}):e.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:i.DEFAULT_VALIDATOR_REGEX_DOUBLE,prompt:i.DEFAULT_VALIDATOR_PROMPT_DOUBLE,builtIn:!0}),$IU.addElementValidateClass(this.element)):null!=t.regEx&&""!==t.regEx||(t.regEx=n===$Control.DATA_TYPE_INT?i.DEFAULT_VALIDATOR_REGEX_INTEGER:i.DEFAULT_VALIDATOR_REGEX_DOUBLE,t.prompt=n===$Control.DATA_TYPE_INT?i.DEFAULT_VALIDATOR_PROMPT_INTEGER:i.DEFAULT_VALIDATOR_PROMPT_DOUBLE,t.builtIn=!0==!t.required,$IU.addElementValidateClass(this.element)))},specialSetting:function(){this.setCleaveFormat(),this.setMaxLength(),null!=this.maxLength&&$(this.element).attr("maxlength",this.maxLength),this.addDefaultValidator()},setCleaveFormat:function(){var e,t=this.element,n=this.field.format;null!=n&&""!=n&&(e="","#,###.##"==n?e="thousand":"#,####.##"==n?e="wan":$IU.debugTip($$.lt("edit.formatWarning",this.field.name),"warning"),e)&&setTimeout(function(){"undefined"!=typeof Cleave&&($(t).addClass("hasCleaveFormat"),new Cleave(t,{numeral:!0,numeralThousandsGroupStyle:e}))},0)},setValue:function(e){switch(null==e&&(e=""),this.field.type){case $Control.DATA_TYPE_STRING:null!=this.maxLength&&(e=e.substr(0,this.maxLength)),$(this.element).val(e);break;case $Control.DATA_TYPE_INT:var t=parseInt(e,10);$(this.element).val(isNaN(t)?"":t);break;case $Control.DATA_TYPE_DOUBLE:t=parseFloat(e);$(this.element).val(isNaN(t)?"":t)}},getValue:function(){if(null!=this.field&&null!=this.element){var e=this.convertEmptyValue(this.element.value),t=this.field.format;switch(null==t||""==t||"#,###.##"!=t&&"#,####.##"!=t||(e=e.replace(/,/g,"")),this.field.type){case $Control.DATA_TYPE_STRING:return e=e||"",e=null!=this.maxLength?e.substr(0,this.maxLength):e;case $Control.DATA_TYPE_INT:var n=parseInt(e);return isNaN(n)?"":n;case $Control.DATA_TYPE_DOUBLE:n=parseFloat(e);return isNaN(n)?"":n}}return""},getSortValue:function(){var e=this.getValue();return this.field.type!==$Control.DATA_TYPE_INT&&this.field.type!==$Control.DATA_TYPE_DOUBLE||""!==e?e:0}}),define("InfoPlus.Controls.Edit",i)}(window),function(){function n(e,t,n,i,a,r){$Control.call(this,$Control.CONTROL_TYPE_HIDDEN,e,t,n,i,a,r)}n.ERROR_CODE_PERMISSION_DENIED=1,n.ERROR_CODE_POSITION_UNAVAILABLE=2,n.ERROR_CODE_TIMEOUT=3,n.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_LOCATION],autoTriggerFieldChangeEvent:!1,ignoreValidation:!0,allowFocus:!1,name:"hidden",createElement:function(){var e=document.createElement("input");return e.type="hidden",e},getAttributes:function(){var e;return this.field.type===$Control.DATA_TYPE_ANYURI?(e=this.getValue(),$IU.getParamFromUrl(e.value)):$(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(e,t,n,i){null==e&&(e="");var n=!n&&this.shouldFireChangeEvent(e),a=$(this.element);a.val(e),this.setAttributes(i),a.data($Control.DATA_DISPLAY_VALUE,t),n&&setTimeout(function(){a.change()},0)},getValue:function(){if(null!=this.field&&null!=this.element){var e=this.convertEmptyValue(this.element.value),t=$(this.element).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:case $Control.DATA_TYPE_FILE:return e;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(e);case $Control.DATA_TYPE_INT:var n=parseInt(e);return isNaN(n)?"":n;case $Control.DATA_TYPE_DOUBLE:n=parseFloat(e);return isNaN(n)?"":n;case $Control.DATA_TYPE_BOOL:return"true"===e.toLowerCase();case $Control.DATA_TYPE_DATE:n=parseInt(e);return isNaN(n)?"":n;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:return new $Controls.Data.ValuePair(e,t);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(e,t)}}return""},getSortValue:function(){var e=this.getValue(),t=this.field.type;return t===$Control.DATA_TYPE_BOOL?e?1:0:t!==$Control.DATA_TYPE_INT&&t!==$Control.DATA_TYPE_DOUBLE&&t!==$Control.DATA_TYPE_DATE||""!==e?t===$Control.DATA_TYPE_USER||t===$Control.DATA_TYPE_ORGANIZE||t===$Control.DATA_TYPE_CODE||t===$Control.DATA_TYPE_THING||t===$Control.DATA_TYPE_LOCATION?e.displayValue:e:0},specialSetting:function(){var t=this;this.field.type===$Control.DATA_TYPE_LOCATION&&this.isWritable()&&$IU.isEmptyStr(this.initValue)&&null!=navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t.setValue(e.coords.longitude+","+e.coords.latitude,$$.lt("map.autoPosition"),!0)},function(e){switch(e.code){case n.ERROR_CODE_PERMISSION_DENIED:$IU.messageBox(null,$$.lt("map.geolocation.denied"),null,300);break;case n.ERROR_CODE_POSITION_UNAVAILABLE:$IU.messageBox(null,$$.lt("map.geolocation.unavailable"),null,300);break;case n.ERROR_CODE_TIMEOUT:$IU.messageBox(null,$$.lt("map.geolocation.timeout"),null,300)}},{enableHighAccuracy:!0,maximumAge:0})}}),define("InfoPlus.Controls.Hidden",n)}(window),function(){function e(e,t,n,i,a,r,o){this.isConverted=!0===o,$Control.call(this,$Control.CONTROL_TYPE_LABEL,e,t,n,i,a,r)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_TIME,$Control.DATA_TYPE_DATETIME,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_LOCATION],ignoreClass:!0,ignoreValidation:!0,allowFocus:!1,autoTriggerFieldChangeEvent:!1,name:"label",hasHiddenElement:!0,isConverted:!1,createElement:function(){var e,t=document.createElement("div"),n=$(t);return this.controlContainer=t,n.addClass("infoplus_labelControlContainer"),this.isConverted&&"Underline"===$$.params.tenantReadOnlyStyle&&n.addClass("underline"),this.field.type===$Control.DATA_TYPE_XHTML?((e=document.createElement("iframe")).setAttribute("scrolling","auto"),e.setAttribute("frameborder","0"),n.addClass("iframe")):e=document.createElement("div"),n.append(e),e},getAttributes:function(){var e;return this.field.type===$Control.DATA_TYPE_ANYURI?(e=this.getValue(),$IU.getParamFromUrl(e.value)):$(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(o,e,t,n){if(null==o&&(o=""),null==e&&(e="",this.field.type===$Control.DATA_TYPE_CODE)&&null!=this.items)for(var i=0,a=this.items.length;i<a;i++){var r=this.items[i];r.codeId===o&&(e=r.codeName)}var s,l=!t&&this.shouldFireChangeEvent(o),u=$(this.element),d=u.data($Control.DATA_ORIGIN_INPUT),c=(d.value=o,this.field.format);switch(null!=c&&""!=c&&(s="","#,###.##"==c?s="thousand":"#,####.##"==c?s="wan":$IU.debugTip($$.lt("label.formatWarning",this.field.name),"warning"),s)&&"undefined"!=typeof Cleave&&new Cleave(d,{numeral:!0,numeralThousandsGroupStyle:s}),o=d.value,this.field.type){case $Control.DATA_TYPE_DATE:""!==o&&!1===isNaN(o)?(o=parseInt(o,10),u.text($IU.unixTimeToDateString(o))):u.text("");break;case $Control.DATA_TYPE_TIME:""!==o&&!1===isNaN(o)?(o=parseInt(o,10),u.text($IU.unixTimeToTimeString(o))):u.text("");break;case $Control.DATA_TYPE_DATETIME:""!==o&&!1===isNaN(o)?(o=parseInt(o,10),$IU.isSameTimezone()?u.text($IU.unixTimeToLocalTimeString(o)):(f=document.createElement("span"),$(f).text($IU.unixTimeToLocalTimeString(o)),u.append(f),i=document.createElement("i"),(f=$(i)).addClass("i-icon-clock-o help"),u.append(i),h=$$.lt("label.timezone")+":"+$IU.getTimezoneString(-$IU.stdTimezoneOffset())+"<br>",h+=$IU.getTimezoneString($$.params.tenantTimeZoneOffset/60)+" "+$IU.unixTimeToString(o),f.attr("original-title",h),f.tipsy({html:!0,fade:!0,gravity:"w",trigger:"manual",opacity:.9}),f.click(function(){$(this).tipsy("show")}).mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")}))):u.text("");break;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:u.text(e).data($Control.DATA_DISPLAY_VALUE,e);break;case $Control.DATA_TYPE_XHTML:setTimeout(function(){function t(){var e=n.document.body.scrollHeight;e!==a||10<r++?u.css("height",e+10+"px").css("max-height",""):setTimeout(t,50)}var e="overflow:auto;overflow-y:hidden;"+function(e){for(var t="",n=e.split(";"),i=0,a=n.length;i<a;i++){var r,o=n[i];-1===o.indexOf(":")||"color"!==(r=$IU.trimString(o.substr(0,o.indexOf(":"))))&&"font"!==r.substr(0,4)||(t+=o+";")}return t}(u.attr("style")||""),n=u[0].contentWindow,i=n.document,a=(i.open(),i.write("<html><body style='"+e+"'>"+o+"</body></html>"),i.close(),u.css("height","").css("max-height","0px"),n.document.body.scrollHeight),r=0;setTimeout(t,50)},0);break;case $Control.DATA_TYPE_INT:var h=parseInt(o,10);u.text(isNaN(h)?"":h);break;case $Control.DATA_TYPE_THING:u.text(e);break;case $Control.DATA_TYPE_FILE:if($IU.isString(o))try{var p=$.parseJSON(o);u.text(p.name)}catch(e){p=null}break;default:var f=InfoPlus.Utilities.htmlEncode(o.toString()||"");u.html(f)}this.setAttributes(n),!0!==t&&this.adjustHeightStyle(),l&&setTimeout(function(){$(d).change()},0)},getValue:function(){if(null!=this.field&&null!=this.element){var e=this.element,t=$(e).data($Control.DATA_ORIGIN_INPUT),n=t.value,i=this.field.format,a=(null==i||""==i||"#,###.##"!=i&&"#,####.##"!=i||(n=n.replace(/,/g,""),t.value=n),this.convertEmptyValue(t.value)),r=$(e).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:case $Control.DATA_TYPE_FILE:return a;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(a);case $Control.DATA_TYPE_DATE:case $Control.DATA_TYPE_TIME:case $Control.DATA_TYPE_DATETIME:var o=parseInt(a);return isNaN(o)?"":o;case $Control.DATA_TYPE_INT:o=parseInt(a);return isNaN(o)?"":o;case $Control.DATA_TYPE_DOUBLE:o=parseFloat(a);return isNaN(o)?"":o;case $Control.DATA_TYPE_BOOL:return"true"===a.toLowerCase();case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:return new $Controls.Data.ValuePair(a,r);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(a,r)}}return""},getSortValue:function(){var e=this.getValue(),t=this.field.type;return t===$Control.DATA_TYPE_BOOL?e?1:0:t!==$Control.DATA_TYPE_INT&&t!==$Control.DATA_TYPE_DOUBLE&&t!==$Control.DATA_TYPE_DATE&&t!==$Control.DATA_TYPE_DATETIME||""!==e?t===$Control.DATA_TYPE_USER||t===$Control.DATA_TYPE_ORGANIZE||t===$Control.DATA_TYPE_CODE||t===$Control.DATA_TYPE_THING||t===$Control.DATA_TYPE_LOCATION?e.displayValue:e:0},adjustHeightStyle:function(){var e,t,n=$(this.element);"BoundConvertedLabel"===this.render.renderType?!0!==this.render.convertFromText&&(e=parseInt(n.css("line-height"),10),!isNaN(e))&&0<e&&n.height()>e&&(n.css("height",n.css("line-height")),n.css("line-height","")):this.field.type!==$Control.DATA_TYPE_XHTML&&(t=parseInt(n.css("min-height"),10),!isNaN(t))&&0<t&&(n.height()>t?(e=parseInt(n.css("line-height"),10),!isNaN(e)&&0<e&&n.height()>e&&n.css("line-height","")):(n.css("line-height",n.css("min-height")),n.height()>parseInt(n.css("line-height"),10)&&n.css("line-height","")))},addRepeatInitHeightStyle:function(){this.adjustHeightStyle()},initHeightStyle:function(){var e,t=$(this.element).attr("style"),n=!1;null==t||-1===(t=t.toLowerCase()).indexOf("height:")?n=!0:(e=$(this.element),"BoundConvertedLabel"===this.render.renderType?!0===this.render.convertFromText?(e.css("min-height",e.css("height")),e.css("height","")):(e.css("line-height",e.css("height")),e.css("height",""),!0===$$.params.initializing&&$$.visible(function(){e.height()>parseInt(e.css("line-height"),10)&&(e.css("height",e.css("line-height")),e.css("line-height",""))})):(e.css("min-height",e.css("height")),e.css("height",""),!0===$$.params.initializing&&this.field.type!==$Control.DATA_TYPE_XHTML&&$$.visible(function(){e.height()>parseInt(e.css("min-height"),10)||(e.css("line-height",e.css("min-height")),e.height()>parseInt(e.css("line-height"),10)&&e.css("line-height",""))}))),n&&($(this.element).addClass("inline"),$(this.controlContainer).addClass("inline"))},specialSetting:function(){this.initHeightStyle(),this.isWritable()&&this.field.type===$Control.DATA_TYPE_XHTML&&$IU.debugTip($$.lt("label.xhtmlWarning",this.field.name),"warning")},setDataSource:function(e,t){if(this.field.type===$Control.DATA_TYPE_CODE){if(this.items=[],$IU.isString(e))for(var n=$IU.splitAttribute(e),i=0,a=n.length;i<a;i++)this.items.push({codeId:n[i],codeName:n[i],enabled:!0});else if($IU.isArray(e))for(i=0,a=e.length;i<a;i++){var r=e[i];void 0!==r.value&&void 0!==r.displayValue&&this.items.push({codeId:r.value,codeName:r.displayValue,enabled:!0,parentId:r.parentId})}for(var o=$(this.element).data($Control.DATA_ORIGIN_INPUT).value,i=0,a=this.items.length;i<a;i++){var s=this.items[i];s.codeId===o&&$(this.element).text(s.codeName).data($Control.DATA_DISPLAY_VALUE,s.codeName)}}}}),define("InfoPlus.Controls.Label",e)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_RADIO,e,t,n,i,null)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],name:"radio",createElement:function(){var e=document.createElement("input");return e.type="radio",e.value=this.render.onValue,e},initRadio:function(){if(void 0!==this.element)if($$.params.engine&&"qform"==$$.params.engine){var e=this.render.source,t=e&&e.items&&0<e.items.length?e.items:[];if(0<t.length){var n=document.createElement("div");$(n).addClass("kt-style-radio-group");for(var i=0;i<t.length;i++){var a=document.createElement("div"),r=($(a).addClass("kt-style-radio"),n.append(a),document.createElement("input")),o=this.element.getAttribute("id")+"_"+i,s=this.element.getAttribute("name"),l=(r.setAttribute("type","radio"),r.setAttribute("id",o),r.setAttribute("name",s),r.setAttribute("value",t[i].name),r.classList=this.element.classList,a.append(r),document.createElement("label"));(c=$(l)).html(t[i].text),c.attr("for",o).insertAfter($(r)).addClass("infoplus_checkLabel"),a.append(l)}$(this.element).parent(".kt-control-content").html(n),this.element=n}}else for(var u=this.element.parentElement.childNodes,i=0,d=u.length;i<d;i++)if(u[i]===this.element&&i<d-1){var c,h=u[i+1],h=$(h);h.hasClass($Control.CLASSNAME_CONTROL)||0!==h.find("."+$Control.CLASSNAME_CONTROL).length||(l=document.createElement("label"),c=$(l),h.detach().appendTo(c),c.attr("for",this.element.getAttribute("id")).insertAfter(this.element).addClass("infoplus_radioLabel"));break}},setValue:function(e){this.element.checked=(e=null==e?"":e)===this.element.value,this.element.checked?$(this.element).addClass("checked"):$(this.element).removeClass("checked"),$("."+this.getElementClassName()+"[name="+this.element.name+"]").each(function(){this.checked?$(this).addClass("checked"):$(this).removeClass("checked")})},getValue:function(){var e,t=this;return this.element.checked?this.convertEmptyValue(this.element.value):(e="",$("."+this.getElementClassName()+"[name="+this.element.name+"]").each(function(){this.checked&&(e=t.convertEmptyValue(this.value))}),e)},shouldFireChangeEventAgain:function(e){return e===this.element.value&&this.shouldFireChangeEvent(e)},registerEvent:function(){this.events=InfoPlus.Controls.Radio.Events.events},markModified:function(){$(this.element).parent().addClass("modified")},clearModified:function(){$(this.element).parent().removeClass("modified")}}),define("InfoPlus.Controls.Radio",e);var t={onClick:function(e){var t=$(this).attr("name");$("input:radio[name='"+t+"']").each(function(){$(this).is(":checked")?$(this).addClass("checked"):$(this).removeClass("checked")})}};t.events=[{type:"click",handler:t.onClick}],define("InfoPlus.Controls.Radio.Events",t)}(window),function(){function e(e,t,n,i,a,r,o){var s,l=null;null!=t.code&&(null==(l=null!=(s=$$.codeManager.getCode(t.code))?s.items:l)||$IU.isArray(l)&&0===l.length)&&(null==s||null!=s&&"External"===s.codeType)&&$$.codeManager.addRequestCode(t.code,t.name),this.items=l,this.parentValue=r,""!==i&&(null==l||$IU.isArray(l)&&0===l.length)&&(this.items=[{codeId:i,codeName:a,enabled:!0,parentId:r,attributes:o}]),$Control.call(this,$Control.CONTROL_TYPE_RADIO_LIST,e,t,n,i,a,o)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],ignoreClass:!0,name:"radioList",validatorPromptPosition:"topLeft",createElement:function(){var e=document.createElement("div");return $IU.isArray(this.items)&&this.setOptions(e,this.items,this.initValue,!0,!0),e},setValue:function(e,t,n,i){null==e&&(e="");var a=this.isReadOnly();if(null!=i){if(null!=i.datasource||null!=i.datasource_Codes){for(var r=[],o=null!=i.datasource?$IU.splitAttribute(i.datasource):$IU.splitAttribute(i.datasource_Codes),s=$IU.splitAttribute(i.datasource_Names),l=0,u=o.length;l<u;l++)r.push({codeId:o[l],codeName:(null!=s[l]?s:o)[l],enabled:!0,attributes:i});this.setOptions(this.element,r,e,n)}this.setAttributes(i)}else for(var d=$(this.element).find("input[type=radio]"),l=0,u=d.length;l<u;l++){var c=d[l];c.checked=c.value===e,a?c.checked?$(c).parent().addClass("checked").removeClass("unchecked"):$(c).parent().addClass("unchecked").removeClass("checked"):c.checked?$(c).parent().addClass("checked"):$(c).parent().removeClass("checked")}},getValue:function(){for(var e=$(this.element).find("input[type=radio]"),t=0,n=e.length;t<n;t++){var i,a=e[t];if(a.checked)return i=$(a).parent().text(),new $Controls.Data.ValuePair(a.value,i,this.parentValue)}return new $Controls.Data.ValuePair("","",this.parentValue)},setDataSourceFromItems:function(e,t,n,i){this.getValue();this.setOptions(e,t,n,i)},setElementAttribute:function(){var e=$(this.element),t=this.render;this.element.id="optionListDiv_"+$$.guid(),e.attr("name",t.field+this.path),e.data($Control.DATA_FIELD,t.field).data($Control.DATA_RENDER,t)},setStyle:function(e,t){for(var n=$(this.element).find("label"),i=0,a=n.length;i<a;i++){var r=n[i];$IU.setDynamicStyle(r,e,t)}},addValidation:function(e){var t,n=this.field;!0!==n.notNull&&!n.regEx||-1!==(t=n.permission||"").indexOf("r")&&-1===t.indexOf("w")||($(e).data($Control.DATA_VALIDATOR,{required:n.notNull,regEx:n.regEx,prompt:n.prompt,builtIn:!1}).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition),$IU.addElementValidateClass(e))},processValidation:function(){var e=this.field,t=this.element,n=$(t).find("input[type=radio]");if(!0===e.notNull||e.regEx){t=e.permission||"";if(-1!==t.indexOf("r")&&-1===t.indexOf("w"))return;n.data($Control.DATA_VALIDATOR,{required:e.notNull,regEx:e.regEx,prompt:e.prompt,builtIn:!1}),null!==this.validatorPromptPosition&&n.data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition);for(var i=0,a=n.length;i<a;i++){var r=n[i];$IU.addElementValidateClass(r)}}var o=this.render.properties;if(null!=o&&0<o.length)for(i=0,a=o.length;i<a;i++){var s=o[i];if("validation"===s.key&&null!=s.values){var l=n.data($Control.DATA_VALIDATOR);if(null==l)for(l={required:!1,builtIn:!1,dynamics:[]},n.data($Control.DATA_VALIDATOR,l),null!==this.validatorPromptPosition&&n.data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition),i=0,a=n.length;i<a;i++)r=n[i],$IU.addElementValidateClass(r);null==l.dynamics&&(l.dynamics=[]);for(var u=0,d=s.values.length;u<d;u++){var c=s.values[u];l.dynamics.push({tip:c.value,condition:c.condition})}}}},registerEvent:function(){this.events=InfoPlus.Controls.RadioList.Events.events},setOptions:function(e,t,n,i,a){var r=this.field,o=this.parentValue,s=this.path,l=this.render.field+s,u=this.isReadOnly();void 0===n&&(n=this.initValue);if($(e).children("label").remove(),$IU.isArray(t))for(var d=0,c=t.length;d<c;d++){var h,p,f,m=t[d];!1!==(h=m).isEnabled&&!1!==h.enabled&&(h=m,r.code,null==r.parent||o===h.parentId)&&(h=document.createElement("label"),(p=document.createElement("input")).type="radio",p.value=m.codeId,p.name="radioList-"+l,p.id=l+"-"+d,$(p).data($Control.DATA_ATTRIBUTES,m.attributes),n===$IU.trimString(m.codeId)&&(p.checked=!0),u?p.checked?$(h).addClass("checked").removeClass("unchecked"):$(h).addClass("unchecked").removeClass("checked"):p.checked&&$(h).addClass("checked"),$(p).data($Control.DATA_IS_CONTROL,!0).data($Control.DATA_CONTROL_OBJECT,this),f=m.codeName,""!==(m.description||"")&&(f=f+"("+$IU.trimString(m.description)+")"),m=document.createTextNode(f),$(h).append(p),$(h).append(m),e.appendChild(h),this.addValidation(p))}this.items=t,!0!==a&&this.setDynamicStyle($$.params.formRender,i)},showTooltip:function(){var e;null!=this.tooltip&&""!==this.tooltip.tip&&((e=$(this.element)).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",!0),e.find("input").one("blur",function(){e.validationEngine("hidePrompt")}))},setDataSource:function(e,t){var n,i=null==(i=this.getValue())?"":i.value,a=!1;if(e instanceof InfoPlus.Dynamics.Params&&(1<(n=e.params).length&&!0===n[1]&&(a=!0),e=n[0]),this.items=[],$IU.isString(e))for(var r=$IU.splitAttribute(e),o=0,s=r.length;o<s;o++)this.items.push({codeId:r[o],codeName:r[o],enabled:!0});else if($IU.isArray(e))for(o=0,s=e.length;o<s;o++){var l=e[o];void 0!==l.value&&void 0!==l.displayValue&&this.items.push({codeId:l.value,codeName:l.displayValue,enabled:!0,parentId:l.parentId})}t||a&&0<this.items.length&&(i=this.items[0].codeId),this.setOptions(this.element,this.items,i,t),this.setPermission()},getAttributes:function(){for(var e=$(this.element).find("input[type=radio]"),t=0,n=e.length;t<n;t++){var i=e[t];if(i.checked)return $(i).data($Control.DATA_ATTRIBUTES)}return null},setParentValue:function(e,t){var n=null==(n=this.getValue())?"":n.value;e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri?this.parentValue=e.value:this.parentValue=e,this.setOptions(this.element,this.items,n,t)},setDynamicReadOnly:function(e){e?$(this.element).find("input[type=radio]").each(function(){this.checked?$(this).parent().addClass("checked").removeClass("unchecked"):$(this).parent().addClass("unchecked").removeClass("checked"),$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled"),this.disabled=!0}):($(this.element).find("label").removeAttr("class"),$(this.element).find("input[type=radio]").each(function(){$(this).removeClass($Control.CLASSNAME_READONLY).removeClass("disabled"),this.disabled=!1}))}}),define("InfoPlus.Controls.RadioList",e);var t={onClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);$(e.element).find("input[type=radio]").each(function(){this.checked?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked")})}};t.events=[{type:"click",handler:t.onClick}],define("InfoPlus.Controls.RadioList.Events",t)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_RADIO_GROUP,e,t,n,i,null)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],name:"radioGroup",createElement:function(){var e=document.createElement("input");return e.type="radio",e.value=!0,e},unselectSiblings:function(){var t=this.path;!0===this.getValue()&&$$("&"+this.field.name).each(function(){var e=this.control;$IU.isSibling(t,e.path)&&e.setValue(!1)})},setValue:function(e){!0===e?(this.element.checked=!0,this.unselectSiblings()):this.element.checked=!1},getValue:function(){return this.element.checked},registerEvent:function(){this.events=InfoPlus.Controls.RadioGroup.Events.events}}),define("InfoPlus.Controls.RadioGroup",e);var t={onClick:function(){$(this).data($Control.DATA_CONTROL_OBJECT).unselectSiblings()}};t.events=[{type:"click",handler:t.onClick}],define("InfoPlus.Controls.RadioGroup.Events",t)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_REMARK,e,t,n,i,null)}e.HAS_VALUE="infoplus_remarkControl_has_value",e.NO_VALUE="infoplus_remarkControl_no_value",e.prototype=$.extend(new $Controls.Control,{autoTriggerFieldChangeEvent:!1,compatibleFieldTypes:[$Control.DATA_TYPE_STRING],allowFocus:!1,remarkValue:"",name:"remark",hasHiddenElement:!0,createElement:function(){var e=document.createElement("div");return $(e).tipsy({html:!0,fade:!0,gravity:$.fn.tipsy.autoWE,trigger:"manual"}),e},setValue:function(e,t,n){null==e&&(e=""),null!=this.maxLength&&(e=e.substr(0,this.maxLength));var i=this.element,a=$(i).data($Control.DATA_ORIGIN_INPUT),n=!n&&this.shouldFireChangeEvent(e),e=(""===(a.value=e)?$(i).removeClass(InfoPlus.Controls.Remark.HAS_VALUE).addClass(InfoPlus.Controls.Remark.NO_VALUE):$(i).removeClass(InfoPlus.Controls.Remark.NO_VALUE).addClass(InfoPlus.Controls.Remark.HAS_VALUE),'<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(e)+"</div>");i.setAttribute("original-title",e),n&&setTimeout(function(){$(a).change()},0)},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=(e=this.convertEmptyValue(e.value)).replace(/\r\n/g,"\n");return e=null!=this.maxLength?e.substr(0,this.maxLength):e},setTipEncodeInnerHtml:function(e,t){function n(e,t){e.style.width=52<t?"365px":parseInt(7*t)+5+"px",e.style.whiteSpace="normal"}var i="";if(null==e||0==e.length)n(t,0),t.innerHTML="";else{for(var a=1,r=0,o=0,s=0;s<e.length;s++){if(s>t.maxCharCount)return $(t).html(i+"..."),void n(t,r=r<(o+=3)?o:r);switch(127<e.charCodeAt(s)||94==e.charCodeAt(s)?o+=2:o+=1,r<o&&(r=o),e.substr(s,1)){case"<":i+="&lt;";break;case">":i+="&gt;";break;case"&":i+="&amp;";break;case" ":" "==e.substr(s+1,1)?(i+=" &nbsp;",s++):i+=" ";break;case'"':i+="&quot;";break;case"\n":if(++a>t.maxLineCount)return $(t).html(i+"..."),void n(t,r=r<(o+=3)?o:r);i+="<br>",o=0;break;default:i+=e.substr(s,1)}}n(t,r),$(t).html(i)}},showRemarkDialog:function(){var i,e,t=this.element,n=this,r=document.createElement("textarea"),a=null==this.field.label?$$.lt("remark.inputValue"):this.field.label,o=(r.setAttribute("id","form_remark_textarea"),null!=this.field.placeHolder&&$(r).attr("placeholder",this.field.placeHolder),r),s=(null!=this.maxLength&&this.isWritable()&&(e=document.createElement("div"),(s=$(e)).addClass("infoplus_textareaControlContainer"),s.append(r),i=document.createElement("span"),$(i).addClass("infoplus_textareaControlMaxLengthTip"),s.append(i),$(i).hide(),o=e,s.css("margin-bottom","20px"),$(i).css("bottom","-17px")),!0===t.readOnly&&(r.readOnly=!0,$(r).addClass($Control.CLASSNAME_READONLY)),$(r).val($(t).data($Control.DATA_ORIGIN_INPUT).value),e=!0===t.readOnly?[]:[{name:$$.lt("common.ok"),defaultButton:!0,callOnClose:!0,callback:function(){n.setValue($(r).val());var e=$(t).data($Control.DATA_VALIDATOR);null!=e&&(!0===e.required||e.regEx&&e.prompt)&&$$.params.renderForm.validationEngine("validateField","#"+t.id)}},{name:$$.lt("common.cancel")}],{container:$$.params.renderForm,title:a,content:o,maxWidth:600,buttons:e});null!=this.tooltip&&""!=this.tooltip.tip&&(s.onShow=function(){setTimeout(function(){$(r).validationEngine("showPrompt",$IU.htmlEncode(n.tooltip.tip),n.tooltip.type,"topRight",!0),$(r).on("blur",function(){$(this).validationEngine("hidePrompt")}),$(r).on("focus",function(){$(r).validationEngine("showPrompt",$IU.htmlEncode(n.tooltip.tip),n.tooltip.type,"topRight",!0)})},300)},s.onClose=function(){$(r).validationEngine("hidePrompt")});new InfoPlus.Render.Dialog(s).show();var l,u,d=this.maxLength;return null!=d&&this.isWritable()&&(l=function(){var e=$(r).val().replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:e,remaining:d-e}},u=function(e){var t=l(),n=$(i),t=(n.text(t.used+"/"+d),0<t.remaining?n.css("color","green"):n.css("color","red"),null!=n.data("hideTipTimer")&&clearTimeout(n.data("hideTipTimer")),!0===e?n.show("slide",{direction:"right"},500):n.show(),setTimeout(function(){n.fadeOut(1e3)},3e3));n.data("hideTipTimer",t)},$(r).keypress(function(e){var t=$(r).val().replace(/\r\n/g,"~").replace(/\n/g,"~").length,n=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||"\0"==n||t<d}),$(r).focus(function(e){var t,n;t=l(),(n=$(i)).text($$.lt("remark.maxLength",d)),0<t.remaining?n.css("color","green"):n.css("color","red"),null!=n.data("hideTipTimer")&&clearTimeout(n.data("hideTipTimer")),n.show(),t=setTimeout(function(){n.hide("slide",{direction:"right"},1e3,function(){u(!0)})},5e3),n.data("hideTipTimer",t)}),$(r).keyup(function(e){u();var t=l();if(!(0<=t.remaining)){for(var t=r,n=$(t).val().split(/\r\n|\n/),i="",a=0;i.length<d&&a<n.length;)i+=n[a].substring(0,d-i.length)+"\n",a++;$(t).val(i.substring(0,d)),t.scrollTop=t.scrollHeight,u()}})),!1},registerEvent:function(){this.events=InfoPlus.Controls.Remark.Events.events},specialSetting:function(){this.setMaxLength(),$(this.element).css("width","").css("height","")},showTooltip:function(){}}),define("InfoPlus.Controls.Remark",e);var t={onClick:function(){$(this).data($Control.DATA_CONTROL_OBJECT).showRemarkDialog()},onMouseEnter:function(){$$.MOBILE||""!=$(this).data($Control.DATA_ORIGIN_INPUT).value&&$(this).tipsy("show")},onMouseLeave:function(){$$.MOBILE||$(this).tipsy("hide")}};t.events=[{type:"mouseenter",handler:t.onMouseEnter},{type:"mouseleave",handler:t.onMouseLeave},{type:"click",handler:t.onClick}],define("InfoPlus.Controls.Remark.Events",t)}(window),function(s){function e(e,t,n,i,a){$Control.call(this,$Control.CONTROL_TYPE_SIGNATURE,e,t,n,i,a)}e.IFRAME_ID="iframeId",e.IFRAME_DIALOG="iframeDialog",e.eventRegistered=!1,e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_SIGNATURE],ignoreClass:!0,name:"seal",clickFireFieldChange:!0,hasHiddenElement:!0,createElement:function(){var e,t,n=document.createElement("div");return this.isWritable()&&(e=document.createElement("div"),$(e).addClass("signatureAdd"),null!=this.field.placeHolder&&($(e).addClass("hasPlaceHolder"),$(e).append("<p>"+this.field.placeHolder+"</p>")),n.appendChild(e)),this.isReadable()&&(e=document.createElement("div"),$(e).addClass("signatureImgContainer"),t=document.createElement("img"),$(t).addClass("signatureImg"),e.appendChild(t),$(e).hide(),n.appendChild(e)),n},setValue:function(e,t){""!=e&&null!=e&&(e=JSON.parse(e),this.getCheckedSignatureData(e,this.element))},getValue:function(){var e=this.convertEmptyValue($(this.element).data($Control.DATA_ORIGIN_INPUT).value);if(this.field.type===$Control.DATA_TYPE_SIGNATURE)return e},requestSealInfo:function(u){var d=this,e=$(document).find("meta[itemscope=csrfToken]").attr("content"),e=$$.params.graphqlUrl+"?csrfToken="+e,t=u.name,n=null==$$.params.formStepId?-1:$$.params.formStepId;$.ajax({type:"POST",url:e,contentType:"application/json",data:$.toJSON({query:'{sealSignatures(seal:"'+t+'", stepId:'+n+") {seal{name,text,certificate{name,version,issuer,subject,description,validStart,validLimit,algorithm,signature,publicKey}},text,signer{name,account},timestamp,comment}}"})}).done(function(e){var e=e.data,t=$("<div class='sealSignatures'></div>");if(u&&(i=$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealInfo.title")+"</div><div class='sectionBody sealInfo'><p class='sectionListp'><span>"+$$.lt("seal.sealSignatures.sealInfo.sealText")+":</span><span>"+u.text+"</span></p><p class='sectionListp'><span>"+$$.lt("seal.sealSignatures.sealInfo.sealImage")+":</span><span><img src='"+u.image+"'></span></p></div></div>"),t.append(i)),e&&e.sealSignatures&&0<e.sealSignatures.length){var n=e.sealSignatures,i=n[0].seal.certificate,e=$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealCertificate.title")+"</div><div class='sectionBody'></div></div>"),a=e.find(".sectionBody"),i=(d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.subject"),i.subject,a),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.issuer"),i.issuer,a),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.signature"),i.signature,a),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.serialNumber"),i.name,a),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.termOfValidity"),d.sealDateFormat(i.validStart)+" - "+d.sealDateFormat(i.validLimit),a),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.intendedUse"),i.description,a),t.append(e),$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealUse.title")+"</div><div class='sectionBody'></div></div>")),r=i.find(".sectionBody");t.append(i);for(var o=0;o<n.length;o++){var s=n[o],l=$("<div></div>");d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.signatory"),s.signer.name,l),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.signatureTime"),d.sealDateFormat(s.timestamp),l),d.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.comment"),s.comment,l),o==n.length-1&&l.addClass("last"),r.append(l)}}a=$$.lt("seal.sealSignatures.title");($$.MOBILE?new InfoPlus.Render.Mobile.Page({title:a,content:t}):new InfoPlus.Render.Dialog({title:a,content:t,maxWidth:650,showFooter:!1,showCloseButton:!0,buttons:[]})).show()})},sealDateFormat:function(e){return e?(e=new Date(1e3*e),$IU.dateFormat(e,"yyyy/MM/dd hh:mm")):""},createSealSectionBodyItem:function(e,t,n){e=$("<p class='sectionListp'><span>"+e+":</span><span>"+(t||"")+"</span></p>");n.append(e)},registerEvent:function(){var n;this.events=InfoPlus.Controls.Seal.Events.events,InfoPlus.Controls.Seal.eventRegistered||(n=this,$(s).on("message",function(e){var t;try{t=e.originalEvent.data}catch(e){}null!=t&&null!=t.command&&("createSignature"==t.command?n.closeIframeDialog(t):"closeSignature"==t.command&&n.iframeDialog.hide())}),InfoPlus.Controls.Signature.eventRegistered=!0)},closeIframeDialog:function(e){var t,e=e.data,n=e.iframeId,i="."+this.getElementClassName(),a=null;n&&$(i).each(function(){$(this).data(InfoPlus.Controls.Seal.IFRAME_ID)==n&&(a=this)}),a&&(t=$(a).data(InfoPlus.Controls.Seal.IFRAME_DIALOG),this.getCheckedSignatureData(e,a,function(){$$.MOBILE?t.close():t.hide()}))},getCheckedSignatureData:function(e,t,n){var i,a,r,o,s,l;e&&((i=e.seal)&&i.name&&i.image?((r={}).name=i.name,r.image=i.image,i.text&&(r.text=i.text),i.kind&&(r.kind=i.kind),i.certificate&&(r.certificate=i.certificate),(a={}).seal=r,e.attributes&&(a.attributes=e.attributes),e=(r=$(t)).data($Control.DATA_ORIGIN_INPUT),$(e).val(JSON.stringify(a)),(o=r.find(".signatureAdd")).hide(),r.find(".signatureImg").attr("src",i.image),(s=r.find(".signatureImgContainer")).show(),this.isReadable()&&(e=[],(l=this).isWritable()&&e.push({id:"edit",text:$$.lt("seal.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:-1px",click:function(){l.triggerChange()}}),e.push({id:"view",text:$$.lt("seal.menu.view"),iconClass:"i-icon-search2",iconCss:"left:-1px",click:function(){return l.requestSealInfo(i),!1}}),this.isWritable()&&e.push({id:"remove",text:$$.lt("seal.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){return s.hide().find("img").attr("src",""),o.show(),$(t).data($Control.DATA_ORIGIN_INPUT).value="",!1}}),e)&&0<e.length&&new InfoPlus.Render.PopMenu({container:s,items:e,horizontalMenuItem:!0,position:"bottom-left"}),null!=n&&"function"==typeof n&&n()):$IU.messageBox(null,$$.lt("seal.dialog.missSealInfo"),null,300))},openIframeDialog:function(e,t,n,i,a,r){var o=document.createElement("iframe"),r=($(o).attr("id",this.field.name+"_signature_iframe"),$(o).addClass("signature_iframe"),o.src=e,o.setAttribute("width","100%"),o.setAttribute("height",(0===r||null==r?.75*$(s).height():r)+"px"),new InfoPlus.Render.Dialog({title:t,content:o,maxWidth:null==a||0===a?$(s).width:a,openNewUrl:e,showFooter:!1,showCloseButton:!0,showOpenNewButton:i,showMinimiseButton:!n,modal:n}));r.show(),this.iframeLoaded(o,r)},iframeLoaded:function(t,n){var i;t&&(i=this,t.onload=function(){var e={iframeId:"signature_"+$$.guid()};$(i.element).data(InfoPlus.Controls.Seal.IFRAME_ID,e.iframeId),$(i.element).data(InfoPlus.Controls.Seal.IFRAME_DIALOG,n),t.contentWindow.postMessage({command:"initSignature",data:e},"*")})},triggerChange:function(){var e,t,n=$$.params.uriSealSelector,i=(n=(n=(n=n.replace("%2",this.field.name)).replace("%1",$$.params.formStepId)).replace("%path",this.path||""),$$.lt("seal.dialog.title"));$$.MOBILE?((e=new InfoPlus.Render.Mobile.Page({title:i,uri:n})).show(),t=$(e.element).find("iframe")[0],this.iframeLoaded(t,e)):this.openIframeDialog(n,i,!0,!1,"400px","360px")}}),define("InfoPlus.Controls.Seal",e);var t={onSignatureClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);return null==e.field||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||"none"==$(e.element).find(".signatureImgContainer").css("display")&&e.triggerChange(),!1}};t.events=[{type:"click",handler:t.onSignatureClick}],define("InfoPlus.Controls.Seal.Events",t)}(window),function(){function e(e,t,n,i,a,r,o){var s,l=null;null!=t.code&&(null==(l=null!=(s=$$.codeManager.getCode(t.code))?s.items:l)||$IU.isArray(l)&&0===l.length)&&(null==s||null!=s&&"External"===s.codeType)&&$$.codeManager.addRequestCode(t.code,t.name),this.items=l,this.parentValue=r,""!==i&&(null==l||$IU.isArray(l)&&0===l.length)&&(this.items=[{codeId:i,codeName:a,enabled:!0,parentId:r,attributes:o}]),$Control.call(this,$Control.CONTROL_TYPE_SELECT,e,t,n,i,a,o)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],name:"select",emptyOption:null,setDataSourceFromItems:function(e,t,n,i){var a=this.getValue();this.setOptions(e,t,n),!0!==i&&(0===e.selectedIndex&&!0===this.field.notNull&&2===e.options.length&&(e.options[1].selected=!0),$IU.highLightElement(e),t=this.getValue(),this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&a.value!==t.value&&setTimeout(function(){$(e).change()},0)},createElement:function(){var e,t=document.createElement("select");return this.isReadOnly()?null!=this.initValue&&((e=document.createElement("option")).value=this.initValue,e.text=this.initDisplayValue,e.selected=!0,t.add(e)):((e=document.createElement("option")).value="",e.text=$$.lt("select.choose"),$(e).addClass("emptyOption"),!0===this.field.notNull&&e.setAttribute("disabled","disabled"),t.add(e),this.emptyOption=e,$IU.isArray(this.items)&&this.setOptions(t,this.items,this.initValue)),t},setPlaceHolder:function(){null!=this.emptyOption&&null!=this.field&&null!=this.field.placeHolder&&""!==this.field.placeHolder&&$($(this.element).children()[0]).text(this.field.placeHolder)},setValue:function(e,t,n,i){if(null==e&&(e=""),null!=i){if(null!=i.datasource||null!=i.datasource_Codes){for(var a=[],r=null!=i.datasource?$IU.splitAttribute(i.datasource):$IU.splitAttribute(i.datasource_Codes),o=$IU.splitAttribute(i.datasource_Names),s=0,l=r.length;s<l;s++)a.push({codeId:r[s],codeName:(null!=o[s]?o:r)[s],enabled:!0,attributes:i});this.setOptions(this.element,a,e)}this.setAttributes(i)}else{for(var u=this.element.options,l=u.length,d=!1,s=1;s<l;s++)u[s].value===e&&(d=u[s].selected=!0);d||(!0!==n||null!=e&&""!==e||!0!==this.field.notNull||2!==l?this.element.selectedIndex=0:this.element.selectedIndex=1)}},getValue:function(){var e,t,n=this.element.selectedIndex;return n<0?new $Controls.Data.ValuePair("","",this.parentValue):(e=this.element.options[n].value,t=this.element.options[n].text,0===n&&""===e&&(t=""),new $Controls.Data.ValuePair(e,t,this.parentValue))},getAttributes:function(){var e=this.element.selectedIndex;if(-1!==e&&null!=this.items){var t=this.element.options[e].value;if(""!==t&&$IU.isArray(this.items))for(var n=0,i=this.items.length;n<i;n++)if(!0===this.items[n].enabled&&this.items[n].codeId===t)return this.items[n].attributes}return null},getDataSource:function(){for(var e=[],t=this.element.options,n=0,i=t.length;n<i;n++){var a=t[n];0===n&&""===a.value||e.push(new $Controls.Data.ValuePair(a.value,a.text,this.parentValue))}return e},setOptions:function(e,t,n){var i=this.field,a=this.parentValue;void 0===n&&(n=e.value);if(e.options.length=1,$IU.isArray(t)){for(var r=!1,o=0,s=t.length;o<s;o++){var l,u=t[o];!1!==(l=u).isEnabled&&!1!==l.enabled&&(l=u,i.code,null==i.parent||a===l.parentId)&&((l=document.createElement("option")).value=u.codeId,l.text=u.codeName,u.codeId===n?r=l.selected=!0:l.selected=!1,e.add(l))}r||(e.value=""),this.items=t}},setDataSource:function(e,t){if(this.isWritable()){var n,i=this.element.value,a=!1;if(e instanceof InfoPlus.Dynamics.Params&&(1<(n=e.params).length&&!0===n[1]&&(a=!0),e=n[0]),this.items=[],$IU.isString(e))for(var r=$IU.splitAttribute(e),o=0,s=r.length;o<s;o++)this.items.push({codeId:r[o],codeName:r[o],enabled:!0});else if($IU.isArray(e))for(o=0,s=e.length;o<s;o++){var l=e[o];void 0!==l.value&&void 0!==l.displayValue&&this.items.push({codeId:l.value,codeName:l.displayValue,enabled:!0,parentId:l.parentId})}t||a&&0<this.items.length&&(i=this.items[0].codeId),this.setDataSourceFromItems(this.element,this.items,i,t)}},setParentValue:function(e,t){var n=this.element.value;e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri?this.parentValue=e.value:this.parentValue=e,this.setDataSourceFromItems(this.element,this.items,n,t)},specialSetting:function(){var e=$(this.element);"right"===e.css("text-align").toLocaleLowerCase()&&e.attr("dir","rtl")}}),define("InfoPlus.Controls.Select",e)}(window),function(s){function e(e,t,n,i,a){$Control.call(this,$Control.CONTROL_TYPE_SIGNATURE,e,t,n,i,a)}e.IFRAME_ID="iframeId",e.IFRAME_DIALOG="iframeDialog",e.eventRegistered=!1,e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_SIGNATURE],ignoreClass:!0,name:"signature",clickFireFieldChange:!0,hasHiddenElement:!0,createElement:function(){var e,t,n,i=document.createElement("div");return this.isWritable()&&(e=document.createElement("div"),$(e).addClass("signatureAdd"),null!=this.field.placeHolder&&($(e).addClass("hasPlaceHolder"),$(e).append("<p>"+this.field.placeHolder+"</p>")),i.appendChild(e)),this.isReadable()&&(e=document.createElement("div"),$(e).addClass("signatureImgContainer"),t=document.createElement("img"),$(t).addClass("signatureImg"),n=document.createElement("div"),$(n).addClass("signatureInvaild").hide(),e.appendChild(t),e.appendChild(n),$(e).hide(),i.appendChild(e)),i},setValue:function(e,t){""!=e&&null!=e&&(e=JSON.parse(e),this.getCheckedSignatureData(e,this.element))},checkSignature:function(e){var t=this.getFormatContent(),t=$.md5(t);e&&t!=e&&$(this.element).find(".signatureInvaild").show()},getFormatContent:function(){function e(e,t,n,i){return null==t?e:null==i?(e=e.replace(new RegExp("\\$"+n,"gm"),t)).replace(new RegExp("\\${"+n+"}","gm"),t):null!=t[i]?(e=e.replace(new RegExp("\\$"+n+"\\."+i,"gm"),t[i])).replace(new RegExp("\\${"+n+"\\."+i+"}","gm"),t[i]):e}for(var i=this,t=this.field.format||"",n=function(){$$.dynamics.cache.build();var e,t=i.dynamicProcessor.getControlContext(i,void 0,!0),n=new InfoPlus.QuickSortArray;for(e in t)t.hasOwnProperty(e)&&n.push({name:e,obj:t[e]});return n.sort(function(e,t){e=e.name.length,t=t.name.length;return t<e?-1:e===t?0:1}),n}(),a=0,r=n.length;a<r;a++){var o=n[a],s=o.name;t=e(t,o.obj,s,"displayValue"),t=e(t,o.obj,s,"name"),o.name!==i.field.name&&(t=e(t,o.obj,s,"value"),t=e(t,o.obj,s))}return t},getValue:function(e){var t=this.convertEmptyValue($(this.element).data($Control.DATA_ORIGIN_INPUT).value);if(this.field.type===$Control.DATA_TYPE_SIGNATURE)return t&&e&&this.isWritable()&&(t=JSON.parse(t),e=this.getFormatContent(),t.text=e,e=$.md5(e),t.textHash=e,t=JSON.stringify(t)),t},registerEvent:function(){var n;this.events=InfoPlus.Controls.Signature.Events.events,InfoPlus.Controls.Signature.eventRegistered||(n=this,$(s).on("message",function(e){var t;try{t=e.originalEvent.data}catch(e){}null!=t&&null!=t.command&&("createSignature"==t.command?n.closeIframeDialog(t):"closeSignature"==t.command&&n.iframeDialog.hide())}),InfoPlus.Controls.Signature.eventRegistered=!0)},closeIframeDialog:function(e){var t,e=e.data,n=e.iframeId,i="."+this.getElementClassName(),a=null;n&&$(i).each(function(){$(this).data(InfoPlus.Controls.Signature.IFRAME_ID)==n&&(a=this)}),a&&(t=$(a).data(InfoPlus.Controls.Signature.IFRAME_DIALOG),this.getCheckedSignatureData(e,a,function(){$$.MOBILE?t.close():t.hide()}))},getCheckedSignatureData:function(e,t,n){var i,a,r,o,s,l,u;e&&((i=e.seal)&&i.name&&i.image?((s={}).name=i.name,s.image=i.image,i.text&&(s.text=i.text),i.kind&&(s.kind=i.kind),i.certificate&&(s.certificate=i.certificate),(a={}).seal=s,e.signer&&(a.signer=e.signer),e.mfa&&(a.mfa=e.mfa),e.algorithm&&(a.algorithm=e.algorithm),e.signature&&(a.signature=e.signature),e.timestamp&&(a.timestamp=e.timestamp),e.comment&&(a.comment=e.comment),e.text&&(a.text=e.text),e.textHash&&(a.textHash=e.textHash),e.uri&&(a.uri=e.uri),e.attributes&&(a.attributes=e.attributes),(r=this).isReadable()&&!this.isWritable()&&(o=e.textHash,setTimeout(function(){r.checkSignature(o)},0)),e=(s=$(t)).data($Control.DATA_ORIGIN_INPUT),$(e).val(JSON.stringify(a)),(l=s.find(".signatureAdd")).hide(),s.find(".signatureImg").attr("src",i.image),(u=s.find(".signatureImgContainer")).show(),this.isReadable()&&this.isWritable()&&((e=[]).push({id:"edit",text:$$.lt("seal.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:-1px",click:function(){r.triggerChange()}}),e.push({id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){return u.hide().find("img").attr("src",""),l.show(),$(t).data($Control.DATA_ORIGIN_INPUT).value="",!1}}),new InfoPlus.Render.PopMenu({container:u,items:e,horizontalMenuItem:!0,position:"bottom-right"})),null!=n&&"function"==typeof n&&n()):$IU.messageBox(null,$$.lt("signature.dialog.missSealInfo"),null,300))},openIframeDialog:function(e,t,n,i,a,r){var o=document.createElement("iframe"),r=($(o).attr("id",this.field.name+"_signature_iframe"),$(o).addClass("signature_iframe"),o.src=e,o.setAttribute("width","100%"),o.setAttribute("height",(0===r||null==r?.75*$(s).height():r)+"px"),new InfoPlus.Render.Dialog({title:t,content:o,maxWidth:null==a||0===a?$(s).width:a,openNewUrl:e,showFooter:!1,showCloseButton:!0,showOpenNewButton:i,showMinimiseButton:!n,modal:n}));r.show(),this.iframeLoaded(o,r)},iframeLoaded:function(t,n){var i;t&&(i=this,t.onload=function(){var e={iframeId:"signature_"+$$.guid()};$(i.element).data(InfoPlus.Controls.Signature.IFRAME_ID,e.iframeId),$(i.element).data(InfoPlus.Controls.Signature.IFRAME_DIALOG,n),t.contentWindow.postMessage({command:"initSignature",data:e},"*")})},triggerChange:function(){var e,t,n=$$.params.uriSealSelector,i=(n=(n=(n=n.replace("%2",this.field.name)).replace("%1",$$.params.formStepId)).replace("%path",this.path||""),$$.lt("signature.dialog.title"));$$.MOBILE?((e=new InfoPlus.Render.Mobile.Page({title:i,uri:n})).show(),t=$(e.element).find("iframe")[0],this.iframeLoaded(t,e)):this.openIframeDialog(n,i,!0,!1,"400px","360px")}}),define("InfoPlus.Controls.Signature",e);var t={onSignatureClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);return null==e.field||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||"none"==$(e.element).find(".signatureImgContainer").css("display")&&e.triggerChange(),!1}};t.events=[{type:"click",handler:t.onSignatureClick}],define("InfoPlus.Controls.Signature.Events",t)}(window),function(){function e(e,t,n,i,a,r,o,s,l,u,d){this.parentValue=o,this.suggestService=l,this.initializeService=u,this.tipFormat=s,this.formRender=i,$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER,e,t,n,a,r,d)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],autoTriggerFieldChangeEvent:!1,name:"suggester",createElement:function(){return document.createElement("select")},setValue:function(e,t,n,i){null==e&&(e=""),null==t&&(t="");var a=$(this.element).data($Control.DATA_SUGGESTER);null!=a&&(this.setAttributes(i),a.setData({codeId:e,codeName:t,attributes:i},t))},getValue:function(){var e=this.element,t=this.convertEmptyValue(e.value),e=$(e).data($Control.DATA_SUGGESTER);return null==e?new $Controls.Data.ValuePair("","",this.parentValue):(e=e.text||"",new $Controls.Data.ValuePair(t,e,this.parentValue))},getSortValue:function(){return this.getValue().displayValue},setStyle:function(e,t){$(this.element).data($Control.DATA_SUGGESTER).setSuggesterStyle(e,t)},getStyle:function(e){return $(this.element).data($Control.DATA_SUGGESTER).getSuggesterStyle(e)},specialSetting:function(){this.createSuggester()},setDynamicReadOnly:function(e){var t;e?(this.element.readOnly=!0,t=$(this.element).data($Control.DATA_SUGGESTER),$(t.activeInput).addClass(InfoPlus.Suggester.CLASSNAME_READONLY)):(this.element.readOnly=!1,t=$(this.element).data($Control.DATA_SUGGESTER),$(t.activeInput).removeClass(InfoPlus.Suggester.CLASSNAME_READONLY))},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setDynamicReadOnly(!0)},createSuggester:function(){var e,t=this.field,n=this.element,i=t.type,a=t.code;return i===$Control.DATA_TYPE_CODE&&null==a?($IU.delayedErrorMessageBox($$.lt("suggester.noCode",t.name)),null):(e=this.configSuggesterMode(),t=new InfoPlus.Suggester(t,n,this.initValue,this.initDisplayValue,i,a,e,this.tipFormat,this.suggestService,this.initializeService),$(n).data($Control.DATA_SUGGESTER,t),this.controlContainer=t.container,$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this).attr("id",this.element.id+"_Container"),"right"===$(n).css("text-align").toLocaleLowerCase()&&$(t.activeInput).css("text-align","right"),t)},configSuggesterMode:function(){var e=this.field.permission||"",t=this.field,n=t.type,i=0;return e.indexOf("w")<0&&(i|=InfoPlus.Suggester.MODE_FLAG_READONLY),e.indexOf("w")<0&&e.indexOf("r")<0&&(i|=InfoPlus.Suggester.MODE_FLAG_DISAPPEAR),n!==$Control.DATA_TYPE_USER||null!=t.settings&&!0===t.settings.userTraversal||(i|=InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE),!1===t.notNull&&(i|=InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR),!0===t.allowExternalCode&&(i|=InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE),i},setPlaceHolder:function(){var e;null!=this.field&&null!=this.field.placeHolder&&null!=(e=$(this.element).data($Control.DATA_SUGGESTER))&&null!=(e=e.activeInput)&&void 0!==e.placeholder&&$(e).attr("placeholder",this.field.placeHolder)},setFocus:function(){$(this.element).data($Control.DATA_SUGGESTER).containerClick()},lostFocus:function(){var e=$(this.element).data($Control.DATA_SUGGESTER);e.activeInput&&e.activeInput.blur()},hideControl:function(){this.controlContainer.style.display="none"},getDataSource:function(){var e=$(this.element).data($Control.DATA_SUGGESTER);if(null==e)return[];for(var t=[],n=0,i=e.suggestData,a=i.length;n<a;n++)t.push({value:i[n].codeId,displayValue:i[n].codeName});return t},showTooltip:function(){var e;null!=this.tooltip&&""!==this.tooltip.tip&&((e=$(this.controlContainer).find(".active_input")).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",!0),e.one("blur",function(){$(this).validationEngine("hidePrompt")}))},setParentValue:function(e,t){var n=this.parentValue;e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri?this.parentValue=e.value:this.parentValue=e,!0!==t&&null==$$.params.fieldChanging&&n!==this.parentValue&&(this.setValue("",""),$IU.highLightElement(this.element))},visible:function(e){null!=this.controlContainer&&(e?$(this.controlContainer).show():$(this.controlContainer).hide())}}),define("InfoPlus.Controls.Suggester",e)}(window),function(){function g(e,t,n,i,a,r,o,s,l){this.isOnPagePopup=null!=l;var u={ajax:{url:o,delay:250,dataType:"json",type:"POST",data:this.getQueryData(t),processResults:this.processQueryResults,transport:this.ajaxTransport(t)},allowClear:!0,dropdownAutoWidth:!this.isOnPagePopup,language:{errorLoading:function(){return $$.lt("suggester2.errorLoading")},inputTooLong:function(e){e=e.input.length-e.maximum;return $$.lt("suggester2.tooLong",e)},inputTooShort:function(e){e=e.minimum-e.input.length;return $$.lt("suggester2.tooShort",e)},loadingMore:function(){return $$.lt("suggester2.loadMore")},maximumSelected:function(e){return $$.lt("suggester2.maxSelect",e.maximum)},noResults:function(){return $$.lt("suggester2.noResult")},searching:function(e){return $$.params.suggeseter2={query:e},0===(e.term||"").length?"user"===t.type.toLocaleLowerCase()?$$.lt("suggester2.emptyUser"):$$.lt("suggester2.emptyHint"):$$.lt("suggester2.searching")}},templateResult:this.formatState},r=(this.option=u,this.parentValue=r,this.initAttributes=s,this.suggestService=o,this.dataType=t.type,this.isOnPagePopup&&(this.originSuggester=l,t.needSync=!0),$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER2,e,t,n,i,a,s),$(this.element).data($Control.DATA_ORIGIN_INPUT));$(r).data("ajaxOption",u)}g.PAGE_ITEM_COUNT=15,g.isPagePopup=function(){return!0},g.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],name:"suggester2",autoTriggerFieldChangeEvent:!1,searchResults:[],formatState:function(e){function t(e){var t=0,n="";if(null!=e){for(var i=0;i<e.length;i++)e.charCodeAt(i)<0||255<e.charCodeAt(i)?t+=2:t++;for(t=Math.round(t/2),i=0;i<t;i++)n+=""}return n}function r(e,t){var n=($$.params.suggeseter2.query.term||"").toLocaleLowerCase().split(/[ ]|,/);if(0===n.length)return{index:-1,len:0};for(var i,a=-1,r=0,o=0,s=n.length;o<s;o++)0!==n[o].length&&-1!==(i=e.indexOf(n[o],t))&&(-1===a||i<a)&&(a=i,r=n[o].length);return{index:a,len:r}}function n(e){for(var t=e.toLocaleLowerCase(),n=0,i="",a=r(t,n);-1!==a.index;)i=(i+=e.substring(n,a.index))+("<u>"+e.substr(a.index,a.len))+"</u>",n=a.index+a.len,a=r(t,n);return i+=e.substr(n)}var i;return null==e.item?e.text:!0===e.item.external?$("<span class='externalCode'>"+n(e.text)+"</span>"):(i=e.item.codeIdReadable||e.item.codeId,!0===e.item.duplicated||-1!==r(i,0).index?$("<span>"+(n(e.text)+t(i))+'</span><span class="tip">'+n(i)+"</span>"):$("<span>"+n(e.text)+"</span>"))},getQueryData:function(n){return function(e){var t=this.data($Control.DATA_CONTROL_OBJECT);return null==t?null:{prefix:null==e.term?"":e.term,type:n.type,code:n.code||"",parent:t.parentValue||"",isTopLevel:null==n.parent,pageNo:isNaN(e.page)?0:e.page-1,rand:999*Math.random(),settings:$.toJSON(null==n.settings?{}:n.settings)}}},processQueryResults:function(e,t){function n(e){var t=$IU.trimString(e.codeName)||"";return null!=e.description&&""!==e.description&&(t+="("+$IU.trimString(e.description)+")"),t}for(var i=e.items,a=this.$element.data($Control.DATA_CONTROL_OBJECT),r=a.field,o=null!=r.settings&&!0===r.settings.userTraversal,s=("query"===t._type&&(a.searchResults=[]),0),l=i.length,u=[];s<l;s++){var d=i[s],c=n(d),h=function(e,t){for(var n=[],i=0,a=e.length;i<a;i++){var r=e[i];(r.codeName||"")===(t.codeName||"")&&n.push(r)}return n}(a.searchResults,d);if(0<h.length){d.duplicated=!0;for(var p=0,f=h.length;p<f;p++){var m=h[p],m=(m.duplicated=!0,function(e,t){for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a.id===t.codeId)return a}return null}(u,m));null!=m?m.item.duplicated=!0:this.container.$results.find(".select2-results__option").each(function(){var e=$(this).data("data");null!=e&&$(this).html(a.formatState(e))})}}d.text=c,a.searchResults.push(d),u.push({id:d.codeId,name:$IU.trimString(d.codeName)||"",text:c,attributes:d.attributes,item:d})}return!0===r.allowExternalCode&&0===u.length&&(r={external:!0,codeId:t.term,codeName:t.term},a.searchResults.push(r),u.push({id:t.term,name:t.term,text:n(r),attributes:null,item:r})),"user"===a.dataType.toLocaleLowerCase()&&!o&&e.total>g.PAGE_ITEM_COUNT&&u.push({id:" ",name:"",text:$$.lt("suggester2.moreUser",1e5<(t=e.total)?$$.lt("suggester2.inaccurateTotal.hundredThousand"):1e4<t?$$.lt("suggester2.inaccurateTotal.tenThousand"):1e3<t?$$.lt("suggester2.inaccurateTotal.thousand"):t),attributes:null,item:null}),{results:u,pagination:{more:"user"===a.dataType.toLocaleLowerCase()?o:g.PAGE_ITEM_COUNT<=l}}},ajaxTransport:function(a){return function(e,t,n){if("user"===e.data.type.toLocaleLowerCase()){var i=e.data.prefix||"";if(i.length<2&&(null==a.settings||!0!==a.settings.userTraversal))return}e.needParse=!1,e.showParseErrMsg=!1,e.showAjaxErrMsg=!1,e.addFormParam=!0,$$.ajax(e).done(t).fail(n)}},createElement:function(){var e=document.createElement("div"),t=document.createElement("select"),n=document.createElement("option");return n.value="",n.text="",t.add(n),null!=this.initValue&&""!==this.initValue&&((n=document.createElement("option")).value=this.initValue||"",n.text=this.initDisplayValue||"",n.selected=!0,t.add(n)),$(e).data($Control.DATA_ORIGIN_INPUT,t),$(t).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType),this.controlContainer=e,$(e).addClass("infoplus_suggester2ControlContainer").addClass("infoplus_select2"),e.appendChild(t),e},getAttributes:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=$(e);return null!=e.data("select2Object")?null!=(e=e.select2("data"))&&0<e.length?e[0].attributes:null:this.initAttributes},setValue:function(e,t,n,i){null==e&&(e=""),null==t&&(t="");var n=!n&&this.shouldFireChangeEvent(e),a=$(this.element).data($Control.DATA_ORIGIN_INPUT),r=$(a).data("select2Object"),o=(a.options.length=0,document.createElement("option"));o.value="",o.text="",a.add(o),""!==e&&((o=document.createElement("option")).value=e,o.text=t,o.selected=!0,a.add(o)),null!=r&&(r.val(e),null!=(o=$(a).find("option:selected").data("data"))?(o.name=o.text,o.attributes=i):(o={id:e,text:t,name:t,attributes:i,selected:!0,title:"",disabled:!1},$(a).find("option:selected").data("data",o)),n)&&setTimeout(function(){r.trigger("change")},0)},getValue:function(){var e,t=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(null!=$(t).data("select2Object"))return null!=(e=$(t).select2("data"))&&0<e.length?new $Controls.Data.ValuePair($IU.trimString(e[0].id),e[0].name,this.parentValue):new $Controls.Data.ValuePair("","",this.parentValue);for(var n=t.options,i=n.length,a=0;a<i;a++){var r=n[a];if(!0===r.selected)return new $Controls.Data.ValuePair(r.value,r.text,this.parentValue)}return new $Controls.Data.ValuePair("","",this.parentValue)},getSortValue:function(){return this.getValue().displayValue},setElementAttribute:function(){this.setHiddenAttribute("suggester2")},specialSetting:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT),t=this.element.getAttribute("style");null!=t&&e.setAttribute("style",t)},initSelect2:function(){var e,t=$(this.element).data($Control.DATA_ORIGIN_INPUT),t=$(t),n=$IU.getElementStyle(this.element,"height"),i=t.data("ajaxOption"),i=t.select2(i),i=(t.removeAttr("style"),t.data("select2Object",i),t.find("option:selected").data("data")),i=(null!=i&&(i.name=i.text,i.attributes=this.initAttributes),this.isReadable()||this.visible(!1),t.siblings(".select2")),t=i.find(".select2-selection__arrow");t.children().remove(),e=$IU.endWith(n,"rem")?(e=parseFloat($("html").css("font-size")),parseFloat(n)*e):parseInt(n,10),isNaN(e)||0===e||((n=i.find(".select2-selection")).css("height",e+"px"),n.find(".select2-selection__rendered").css("height",e+"px").css("line-height",e+"px"),t.css("height",e-2+"px")),t.addClass(this.dataType.toLocaleLowerCase()),!0===this.isOnPagePopup&&($(this.element).css("width","100%"),i.css("width","100%")),this.initEvent()},initEvent:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT),n=$(e).data("select2Object"),i=this;null!=this.field.parent?n.on("select2:opening",function(e){var t=$(this);return!0!==t.data("openAgain")?(setTimeout(function(){t.data("openAgain",!0),n.select2("open"),t.data("openAgain",!1)},0),!1):$IU.shouldShowSuggesterPage()&&!0!==i.isOnPagePopup&&1==g.isPagePopup()?($IU.clearAllError(),$IU.showSuggester2Page(i),!1):void 0}):$IU.shouldShowSuggesterPage()&&!0!==i.isOnPagePopup&&1==g.isPagePopup()&&n.on("select2:opening",function(e){return $IU.clearAllError(),$IU.showSuggester2Page(i),!1}),$IU.shouldShowSuggesterPage()&&!0!==i.isOnPagePopup&&0==g.isPagePopup()&&$(e).siblings(".select2-container").attr("isPagePopup","false"),n.on("select2:select",function(e){var t=$(this),n=t.find("option:selected"),e=(n.text(e.params.data.name),n.data("data"));e.text=e.name,t.find("option").not(":selected").each(function(){""!==$(this).val()&&$(this).remove()}),!0===i.isOnPagePopup&&0<(n=t.closest(".mobile_page_div")).length&&null!=(e=n.data(InfoPlus.Render.Mobile.Page.DATA_PAGE_OBJECT))&&e.close()}),"user"===this.dataType.toLocaleLowerCase()&&n.on("select2:selecting",function(e){if(""===($IU.trimString(e.params.args.data.id)||""))return!1}),n.on("select2:open",function(){var e=$(this).closest("div.dialog");0<e.length&&""!==((e=e.parent().css("z-index"))||"")&&n.data("select2").$dropdown.css("z-index",e),!0===i.isOnPagePopup&&0<(e=$(this).closest(".mobile_page_div")).length&&n.data("select2").$dropdown.css("z-index",e.css("z-index"))})},setPlaceHolder:function(){null!=this.field&&null!=this.field.placeHolder?this.option.placeholder=this.field.placeHolder:this.option.placeholder=""},showTooltip:function(){var t,n;null!=this.tooltip&&""!==this.tooltip.tip&&(t=this.tooltip,n=$(this.element),setTimeout(function(){var e=null;$(".select2-container").each(function(){$(this).hasClass("select2")||(e=$(this))}),null!=e&&(e.offset().top<n.offset().top?n.validationEngine("showPrompt",$IU.htmlEncode(t.tip),t.type,"bottomLeft",!0):n.validationEngine("showPrompt",$IU.htmlEncode(t.tip),t.type,"topLeft",!0),$(".select2-search__field").one("blur",function(){n.validationEngine("hidePrompt")}))},300))},setParentValue:function(e,t){e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri?this.parentValue=e.value:this.parentValue=e;e=$(this.element).data($Control.DATA_ORIGIN_INPUT);!0!==t&&null==$$.params.fieldChanging&&(this.setValue("",""),null!=$(e).data("select2Object"))&&$IU.highLightElement(e)},visible:function(e){var t,n;null!=this.element&&(t=$(this.element).data($Control.DATA_ORIGIN_INPUT),n=(t=$(t)).data("select2Object"),e?t.show():t.hide(),null!=n&&(n=t.siblings(".select2"),e?n.show():n.hide()),e?$(this.controlContainer).show():$(this.controlContainer).hide())},setDynamicReadOnly:function(e){var t=$(this.element),n=t.data($Control.DATA_ORIGIN_INPUT);e?(n.disabled=!0,t.addClass($Control.CLASSNAME_READONLY)):(n.disabled=!1,t.removeClass($Control.CLASSNAME_READONLY))}}),define("InfoPlus.Controls.Suggester2",g)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_TEXT,e,t,n,i,null)}function s(e){var t=$(e.element).val().replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:t,remaining:e.maxLength-t}}function r(e,t,n){0<e.remaining?t.removeClass("incorrect").addClass("correct"):t.removeClass("correct").addClass("incorrect"),n?t.addClass("length"):t.removeClass("length")}function l(e,t){var n=e.maxLength,i=s(e),a=$(e.maxLengthTipSpan);a.text(i.used+"/"+n),r(i,a,!0),null!=e.hideTipTimer&&clearTimeout(e.hideTipTimer),!0===t?a.show("slide",{direction:"right"},500):a.show(),e.hideTipTimer=setTimeout(function(){a.fadeOut(1e3)},3e3)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML],name:"textarea",createElement:function(){var e=document.createElement("textarea");return null!=this.field.placeHolder&&$(e).attr("placeholder",this.field.placeHolder),e},setValue:function(e){null==e&&(e="");var t=$(this.element);null!=this.maxLength&&(e=e.substr(0,this.maxLength)),t.val(e),!0===this.render.settings.autoSize&&t.autoheight("init")},registerEvent:function(){null!=this.maxLength&&this.isWritable()&&(this.events=InfoPlus.Controls.Text.Events.events)},specialSetting:function(){var e,t,n,i=$(this.element);this.setMaxLength(),null!=this.maxLength&&this.isWritable()&&(e=document.createElement("div"),(t=$(e)).addClass("infoplus_textareaControlContainer"),t.append(this.element),n=document.createElement("span"),$(n).addClass("infoplus_textareaControlMaxLengthTip"),t.append(n),null!=this.element.style.width&&t.css("width",this.element.style.width),this.maxLengthTipSpan=n,this.controlContainer=e,$(n).hide()),this.isWritable()&&this.field.type===$Control.DATA_TYPE_XHTML&&$IU.debugTip($$.lt("text.xhtmlWarning",this.field.name),"warning"),!0===this.render.settings.autoSize&&(i.autoheight(),i.css("min-height",i.height()))},getValue:function(){var e=(e=this.convertEmptyValue(this.element.value)).replace(/\r\n/g,"\n");return e=null!=this.maxLength?e.substr(0,this.maxLength):e}}),define("InfoPlus.Controls.Text",e);var t={onKeyPress:function(e){var t,n=$(this).data($Control.DATA_CONTROL_OBJECT),i=n.maxLength,n=$(n.element).val().replace(/\r\n/g,"~").replace(/\n/g,"~").length;return null==i||(t=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey)||e.metaKey||"\0"===t||n<i},onKeyUp:function(e){var t=$(this).data($Control.DATA_CONTROL_OBJECT);if(null!=t.maxLength&&null!=t.maxLengthTipSpan){l(t);var n=s(t);if(!(0<=n.remaining)){for(var n=t.element,i=t.maxLength,a=$(n).val().split(/\r\n|\n/),r="",o=0;r.length<i&&o<a.length;)r+=a[o].substring(0,i-r.length)+"\n",o++;$(n).val(r.substring(0,i)),n.scrollTop=n.scrollHeight,l(t)}}},focus:function(){var e,t,n,i=$(this).data($Control.DATA_CONTROL_OBJECT);null!=i.maxLength&&null!=i.maxLengthTipSpan&&(i=(e=i).maxLength,t=s(e),(n=$(e.maxLengthTipSpan)).text($$.lt("text.maxLength",i)),r(t,n,!1),null!=e.hideTipTimer&&clearTimeout(e.hideTipTimer),n.show(),e.hideTipTimer=setTimeout(function(){n.hide("slide",{direction:"right"},1e3,function(){l(e,!0)})},5e3))},onPaste:function(e){},onCut:function(e){}};t.events=[{type:"keypress",handler:t.onKeyPress},{type:"keyup",handler:t.onKeyUp},{type:"focus",handler:t.focus}],define("InfoPlus.Controls.Text.Events",t)}(window),function(e){function t(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_RICHTEXT,e,t,n,i,null)}t.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_XHTML],name:"richText",editor:null,hasHiddenElement:!0,autoTriggerFieldChangeEvent:!1,oldValue:"",init:function(){var e=this.render.settings||{},t={language:$$.params.lang},t=!0===e.autoSize?$.extend(t,{removePlugins:"resize"}):$.extend(t,{removePlugins:"autogrow"}),e=$$.params.uriCkUploadImage+"?stepId="+(null==$$.params.formStepId?-1:$$.params.formStepId)+"&field="+this.field.name,n=(null!=$$.params.formInstanceId&&(e+="&instanceId="+$$.params.formInstanceId),null!=$$.params.workflowId&&(e+="&workflowId="+$$.params.workflowId),null!=$$.params.release&&(e+="&release="+$$.params.release),t.imageUploadURL=e,this.editor=CKEDITOR.replace(this.element.id+"_text",t),this),i=this.dynamicReadonly,a=this.dynamicParallelReadonly;this.editor.on("blur",function(e){var t=this.getData();n.setValue(t)}),this.editor.on("focus",function(e){var t=this.getData();n.oldValue=t}),setTimeout(function(){(i||a)&&n.setDynamicReadOnly(!0,!1)},1e3)},createElement:function(){var e=document.createElement("div"),t=document.createElement("textarea");return null!=this.field.placeHolder&&$(t).attr("placeholder",this.field.placeHolder),$(e).append(t),e},shouldFireChangeEvent:function(e){return!0===this.synced?this.synced=!1:!!(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&this.oldValue!=e},setValue:function(e,t,n){null==e&&(e="");var i=$(this.element).data($Control.DATA_ORIGIN_INPUT);i.value=e,!n&&this.shouldFireChangeEvent(e)&&setTimeout(function(){$(i).change()},0)},getValue:function(){return null!=e.CKEDITOR&&CKEDITOR.instances[this.element.id+"_text"]?CKEDITOR.instances[this.element.id+"_text"].getData():this.initValue},setEditorData:function(){var e=this.getValue();CKEDITOR.instances[this.element.id+"_text"].destroy(!0),this.editor=this.init(),CKEDITOR.instances[this.element.id+"_text"].setData(e)},setElementAttribute:function(){var e=this.element,t=this.render;e.id=t.controlId+this.path,$(e).children("textarea").attr("id",e.id+"_text"),$(e).attr("name",t.field+this.path),$(e).data($Control.DATA_FIELD,t.field).data($Control.DATA_RENDER,t)},setInfopathFormAttributes:function(){var e=this.element;if(null!=e){var t=$(e).children("textarea"),n=this.render.attributes;if(null!=n&&$IU.isArray(n))for(var i=0;i<n.length;i++){var a=n[i],r=a.key;null!=a.namespace&&""!==a.namespace&&(r=a.namespace+":"+r);try{switch(r.toLocaleLowerCase()){case"class":case"hidefocus":case"tabindex":case"onclick":case"value":case"contenteditable":break;default:t.attr(r,a.value)}}catch(e){}}}},visible:function(e,t){null!=this.element&&(e?this.isReadable()&&(t||!this.isWritable()||this.isDynamicReadonly()||null!=this.editor&&this.editor.setReadOnly(!1),$(this.element).show()):$(this.element).hide())},setDynamicReadOnly:function(e,t){t||null!=this.editor&&this.editor.setReadOnly(e)},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0}}),define("InfoPlus.Controls.RichText",t)}(window),function(p,C){function _(e,t,n,i){this.supportXhr=qq.isXhrUploadSupported(),$Control.call(this,$Control.CONTROL_TYPE_FILE,e,t,n,i)}function o(e,t,n,i){var e=e.width()-16-16,a=t.width(),n=n.width();a+n+i.outerWidth()<e?_.MAX_PERCENT_WIDTH<e-a-n?i.css("width",_.MAX_PERCENT_WIDTH+"px"):i.css("width",e-a-n+"px"):(i.css("width",""),t.css("width",e-n-_.MIN_PERCENT_WIDTH+"px"))}function E(e){var t;return null!=e&&-1!==(t=e.lastIndexOf("."))&&t+1<e.length?e.substring(t+1).toLowerCase():""}function d(e){if($$.APP){e=E(e.name);if(""!==e)return"&type="+e}return""}function h(e,t){if(e&&0<e.length)for(var n=0;n<e.length;n++)if(e[n].id==t){e.splice(n,1);break}}function c(e,t){var n=null;if(e&&0<e.length)for(var i=0;i<e.length;i++)if(e[i].id==t){n=e[i];break}return n}function f(e,t,n,i){var a;!function(){if(!!p.ActiveXObject||"ActiveXObject"in p)return true;else return false}()?setTimeout(function(){var e=$('<iframe style="display: none;"></iframe>');e.attr("src",t),$(document.body).after(e),setTimeout(function(){e.remove()},i)},n):(n=e,e=t,a="text/plain; charset=UTF-8",e="function"==typeof File?new File([e],n,{type:a}):new Blob([e],{type:a}),void 0!==p.navigator.msSaveBlob?p.navigator.msSaveBlob(e,n):(a=(p.URL||p.webkitURL).createObjectURL(e),p.location=a))}function m(e){return null!=e&&null!=(e=e.fileSecure)&&!1!==e&&"False"!==e}_.UPLOAD_LIST_OUT="uploadListOut",_.FILE_LIST_CLICK_FILEID="clickFileId",_.UPLOAD_PROGRESS_DIV="uploadProgressDiv",_.DISPLAY_DIV="displayDiv",_.UPLOAD_DIV="uploadDiv",_.UPLOAD_FILE_ID="uploadingFileId",_.CLASS_UPLOAD_FILE_NAME="uploadFileName",_.CLASS_UPLOAD_FILE_SIZE="uploadFileSize",_.CLASS_CANCEL="infoplus_fileControl_cancel",_.CLASS_LINK="infoplus_fileControl_link",_.OFFICE_FILE_SUFFIX=["doc","docx","xls","xlsx","ppt","pptx"],_.OFFICE365_FILE_SUFFIX=["docx","xlsx"],_.APP_NATIVE_OPEN_FILE_SUFFIX=["pdf","png","jpg","jpeg","gif"],_.MAX_PERCENT_WIDTH=100,_.MIN_PERCENT_WIDTH=40,$$.APP||_.OFFICE_FILE_SUFFIX.push("pdf");_.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_DOC,$Control.DATA_TYPE_LIST],ignoreClass:!0,allowFocus:!0,fileInfo:null,fileInfoList:[],events:[],supportXhr:!1,autoTriggerFieldChangeEvent:!1,validatorPromptPosition:"topLeft",name:"file",hasHiddenElement:!0,uploadCallbacks:{onCancel:function(e,t){},onError:function(e,t,n){},onSubmit:function(e,t){var n,i,a=$($(this._options.button).data("container")),r=a.data($Control.DATA_CONTROL_OBJECT);e=(r=((r.field.type==$Control.DATA_TYPE_LIST?(a.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,e),n=r.field.name+"_fileList_"+e,i=(n=(a=r.createFileListLi(n)).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)).find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(t)).css("width",""),n.find(".pi").css("width","0%"),n.removeClass("focus"),i[0].setAttribute("title",$$.lt("file.uploading",t)),a.data(InfoPlus.Controls.File.DISPLAY_DIV)):(i=(n=a.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)).find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(t)).css("width",""),n.find(".pi").css("width","0%"),n.removeClass("focus"),a.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,e),i[0].setAttribute("title",$$.lt("file.uploading",t)),a.data(InfoPlus.Controls.File.DISPLAY_DIV).hide(),a.data(InfoPlus.Controls.File.UPLOAD_DIV).hide(),a.find(".uploadFileTip"))).hide(),a.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).show(),n.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).empty()),n.find(".po")),o(n,i,r,e)},onUpload:function(e,t){},onProgress:function(e,t,n,i){var a=$($(this._options.button).data("container")),r=a.data($Control.DATA_CONTROL_OBJECT),r=(a=r.field.type==$Control.DATA_TYPE_LIST?a.find("#"+r.field.name+"_fileList_"+e):a).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV),e=$IU.convertFileSize(i),a=r.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+e.size+e.unit+")"),n=(n<i?(e=Math.round(n/i*100),r.find(".pi").css("width",e+"%")):r.find(".pi").css("width","100%"),r.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME)),i=r.find(".po");o(r,n,a,i)},onComplete:function(e,t,n){var i,a=$($(this._options.button).data("container")),r=a.data($Control.DATA_CONTROL_OBJECT);r.field.type==$Control.DATA_TYPE_LIST?0<(a=a.find("#"+r.field.name+"_fileList_"+e)).size()&&(a.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus"),a.data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus"),a.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,null),n.success&&null!=n.infoPlusFile?(i=n.infoPlusFile,a.attr("id",r.field.name+"_fileList_"+i.id),r.setValue({uploadSuccess:!0,id:i.id,name:i.name,size:i.size,uri:i.uri,mime:i.mime,createTime:i.createTime})):($IU.messageBox(null,$$.lt("file.uploadFail"),null,300),a.remove())):(a.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus"),a.data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus"),a.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,null),n.success&&null!=n.infoPlusFile?(i=n.infoPlusFile,r.setValue({uploadSuccess:!0,id:i.id,name:i.name,size:i.size,uri:i.uri,mime:i.mime,createTime:i.createTime})):($IU.messageBox(null,$$.lt("file.uploadFail"),null,300),r.setValue(null)))},onValidateBatch:function(e){var t=this._options.validation;if(t!==C&&null!==t)for(var n=e.length,i=0;i<n;i++){var a=e[i];if(a.name!==C&&t.allowedExtensions!==C&&0<t.allowedExtensions.length){for(var r=E(a.name),o=t.allowedExtensions,s=t.allowedExtensions.length,l=!1,u="",d=0;d<s;d++)u=u+o[d]+(d!==s-1?",":""),r===o[d]&&(l=!0);if(!l)return $IU.messageBox(null,$$.lt("file.suffix",u),null,300),!1}if(a.size!==C){var c=t.sizeLimit;if(null!==c&&!isNaN(c)&&0!==c)if(a.size>c)return a=$IU.convertFileSize(c),$IU.messageBox(null,$$.lt("file.sizeLimit",a.size+a.unit),null,360),!1}}return!0}},hasFile:function(){var e=this.fileInfo;return null!=e&&null!=e.id},setPlaceHolder:function(){var e,t;null!=this.field&&null!=this.field.placeHolder&&""!==this.field.placeHolder&&(e=this.element,t=document.createElement("span"),$(t).text(this.field.placeHolder),$(e).find(".uploadFileButton").append(t))},setFileListClickFileId:function(e){this.field.type==$Control.DATA_TYPE_LIST&&(e=$(e).parents(".uploadItemContainer").attr("id").split("_fileList_")[1])&&$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,e)},createDisplayDiv:function(e){var t=document.createElement("div"),n=($(t).addClass("display").hide().data("container",e),document.createElement("a")),i=($(n).attr("target","_blank").attr("href","#").addClass(InfoPlus.Controls.File.CLASS_LINK),document.createElement("div")),a=(i.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),document.createElement("div")),r=(a.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE),n.appendChild(i),n.appendChild(a),t.appendChild(n),this.isWritable()&&((i=document.createElement("span")).setAttribute("class","uploadSuccess"),$(i).css("display","none"),$(i).text($$.lt("file.uploadSuccess")),t.appendChild(i)),e.appendChild(t),$(e).data(InfoPlus.Controls.File.DISPLAY_DIV,$(t)),this),a=[],n=(this.field.type===$Control.DATA_TYPE_DOC?((this.isWritable()||this.isEditable())&&null!=$$.params.uriWordEdit&&""!==$$.params.uriWordEdit&&a.push({id:"edit",text:$$.lt("file.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:1px",link:!0}),a.push({id:"preview",text:$$.lt("file.menu.preview"),iconClass:"i-icon-search2",initVisible:!1,click:function(){r.preview()}})):a.push({id:"preview",text:$$.lt("file.menu.preview"),iconClass:"i-icon-search2",initVisible:!1,click:function(){r.setFileListClickFileId(t),r.preview()}}),a.push({id:"download",text:$$.lt("file.menu.download"),iconClass:"i-icon-cloud-download",link:!0,click:function(){return r.setFileListClickFileId(t),r.download()}}),this.isWritable()&&a.push({id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){r.setFileListClickFileId(t),r.deleteFile()}}),this.field.type==$Control.DATA_TYPE_LIST&&a.push({id:"batches",text:$$.lt("file.batchMenu.batchButton"),iconClass:"i-icon-my-library-books",iconCss:"left:-1px",initVisible:!1,click:function(){r.showBatchesDialog()}}),new InfoPlus.Render.PopMenu({container:t,items:a,horizontalMenuItem:!0,position:"top-left"}));this.field.type==$Control.DATA_TYPE_LIST?$(t).data("popMenu",n):this.popMenu=n},createUploadProgressDiv:function(e){var t,n,i,a,r,o,s,l,u=document.createElement("div");$(u).addClass("uploadProgress").hide().data("container",e),this.supportXhr?((n=document.createElement("table")).setAttribute("class","uploadProgressTable"),i=document.createElement("tbody"),a=document.createElement("tr"),(r=document.createElement("td")).setAttribute("class","uploadTd"),(l=document.createElement("span")).setAttribute("class","uploadSpan"),(t=document.createElement("div")).setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),(o=document.createElement("div")).setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE),l.appendChild(t),l.appendChild(o),r.appendChild(l),a.appendChild(r),(r=document.createElement("td")).setAttribute("class","uploadTd"),o=document.createElement("div"),l=document.createElement("div"),(s=document.createElement("div")).setAttribute("class","pi"),s.setAttribute("style","width:0%"),l.setAttribute("class","po"),l.appendChild(s),o.appendChild(l),r.appendChild(o),a.appendChild(r),(r=document.createElement("td")).setAttribute("class","uploadTd"),(s=document.createElement("div")).setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL),s.setAttribute("title",$$.lt("common.cancel")),r.appendChild(s),a.appendChild(r),i.appendChild(a),n.appendChild(i),u.appendChild(n)):((t=document.createElement("div")).setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),(l=document.createElement("div")).setAttribute("class","uploading"),(s=document.createElement("div")).setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL),s.setAttribute("title",$$.lt("common.cancel")),u.appendChild(t),u.appendChild(l),u.appendChild(s)),e.appendChild(u),$(e).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV,$(u))},createUploadButtonDiv:function(e){var t=document.createElement("div"),n=(null!=this.field.settings&&this.field.settings.displayText!==C&&$(t).text(this.field.settings.displayText),$(t).addClass("uploadFileButton droppable").data("container",e),$(t).css("display","inline-block").hide(),$$.params.attachmentUrl+"?stepId="+(null==$$.params.formStepId?-1:$$.params.formStepId)+"&field="+this.field.name),n=(null!=$$.params.formInstanceId&&(n+="&instanceId="+$$.params.formInstanceId),null!=$$.params.workflowId&&(n+="&workflowId="+$$.params.workflowId),null!=$$.params.release&&(n+="&release="+$$.params.release),{request:{endpoint:n},button:t,multiple:!1,debug:!1,callbacks:this.uploadCallbacks}),i=(this.field.type==$Control.DATA_TYPE_LIST&&(n.multiple=!0,t.classList.add("uploadFileListButton")),this.field.settings),a={},r=!1,o=(i!==C&&null!==i&&(i.fileTypes!==C&&(a.allowedExtensions=i.fileTypes.split(","),r=!0),a.sizeLimit=i.fileSizeMax!==C&&$IU.isNumber(i.fileSizeMax)?parseInt(i.fileSizeMax,10):i.maxLength!==C&&$IU.isNumber(i.maxLength)?parseInt(i.maxLength,10):void 0),this.field.type!==$Control.DATA_TYPE_DOC||r||(a.allowedExtensions=_.OFFICE365_FILE_SUFFIX),a.allowedExtensions===C&&a.sizeLimit===C||(n.validation=a),new qq.FineUploaderBasic(n));null!=qq.DragAndDrop&&new qq.DragAndDrop({dropZoneElements:[t],classes:{dropActive:"dropActive"},callbacks:{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){o.addFiles(e)}}}),e.appendChild(t),$(e).data(InfoPlus.Controls.File.UPLOAD_DIV,$(t)).data("uploader",o)},createElement:function(){var e,t,n=document.createElement("div");return this.field.type==$Control.DATA_TYPE_LIST?(this.isReadable()&&((e=document.createElement("div")).classList.add("uploadListOutDiv"),(t=document.createElement("ul")).classList.add("uploadListOut"),t.classList.add("clearfix"),e.appendChild(t),n.appendChild(e),$(n).data(InfoPlus.Controls.File.UPLOAD_LIST_OUT,t)),this.isWritable()&&this.createUploadButtonDiv(n)):(this.isReadable()&&this.createDisplayDiv(n),this.isWritable()&&(this.createUploadProgressDiv(n),this.createUploadButtonDiv(n))),n},ifBatchesButtonShow:function(){var e=$(this.element).find(".uploadItemContainer");1<e.size()?e.each(function(e,t){t=$(t).data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu");t&&t.showMenuItem("batches")}):e.each(function(e,t){t=$(t).data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu");t&&t.hideMenuItem("batches")})},createFileListLi:function(e){var t=document.createElement("li"),e=(t.classList.add("uploadItemContainer"),t.setAttribute("id",e),$(this.element).data(InfoPlus.Controls.File.UPLOAD_LIST_OUT));return e&&(e.appendChild(t),this.createDisplayDiv(t),this.createUploadProgressDiv(t)),this.specialSetting(t),this.setDynamicStyle(this.render,!1),$(t)},createBatchDialogContent:function(){var t=$("<div class='fileBatchesDialog'></div>"),e=$(this.element).find(".uploadItemContainer");if(0<e.size()){for(var n=$("<ul></ul>"),i=0;i<e.size();i++){var a=e.eq(i),r=a.find(".display").find(".uploadFileName").text(),o=a.find(".display").find(".uploadFileSize").text(),r=$("<li><input type='checkbox' class='batchChb' id='batchChb"+i+"' /><label for='batchChb"+i+"'><span class='uploadFileName'>"+r+"</span><span class='uploadFileSize'>"+o+"</span></label></li>");r.data("fileId",a.attr("id").split("_fileList_")[1]),n.append(r)}t.append($("<div id='batchCheckAllContainer'><input type='checkbox' id='batchCheckAll' /><label for='batchCheckAll'>"+$$.lt("file.batchMenu.dialog.selectAll")+"</label></div>")),t.append(n),t.find("#batchCheckAll").change(function(){var e=$(this).prop("checked");t.find(".batchChb").prop("checked",e)})}return t},showBatchesDialog:function(){var e=this,t=e.createBatchDialogContent(),n=$$.lt("file.batchMenu.dialog.title"),i=$$.lt("file.batchMenu.dialog.download"),a=e.field,a=(m(a.settings)&&(i=$$.lt("file.batchMenu.dialog.secureLinkDownload")),[{name:$$.lt("common.close")}]);this.isWritable()&&a.push({name:$$.lt("file.batchMenu.dialog.deleteText"),callback:function(){e.fileBatchesDelete()}}),a.push({defaultButton:!0,name:i,callback:function(){e.fileBatchesDownload()}}),new InfoPlus.Render.Dialog({title:n,titleColor:"",content:t,maxWidth:"600px",buttons:a}).show()},fileBatchesDownload:function(){var i=this,a=m(field.settings),e=$(".fileBatchesDialog").find(".batchChb:checked");0<e.size()?e.each(function(e,t){var n,t=$(t).parents("li").eq(0).data("fileId");t&&(n=i.fileInfoList,n=c(n,t),a?i.download(n,!0):f(n.name,n.uri,100,1e3))}):$IU.messageBox(null,$$.lt("file.batchMenu.selectMoreMessage"),null,300)},fileBatchesDelete:function(){var n=this,i=[],a=n.fileInfoList;$(".fileBatchesDialog").find(".batchChb:checked").each(function(e,t){t=$(t).parents("li").eq(0).data("fileId");t&&i.push(t)}),0<i.length?$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){for(var e=0;e<i.length;e++){var t=i[e];h(a,t),t&&0<(t=$(n.element).find("#"+n.field.name+"_fileList_"+t)).size()&&t.remove()}n.ifBatchesButtonShow()}):$IU.messageBox(null,$$.lt("file.batchMenu.selectMoreMessage"),null,300)},shouldFireChangeEvent:function(e){return!0===this.synced?this.synced=!1:!!(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&(null==this.fileInfo?null!=e:null==e||e.id!==this.fileInfo.id)},setStyle:function(e,t){for(var n=$(this.element).find(".uploadItemContainer"),i=0,a=n.length;i<a;i++){var r=n[i];$IU.setDynamicStyle(r,e,t)}},setValue:function(e,t,n){if(this.field.type==$Control.DATA_TYPE_LIST){var i=function(e){var t=[];if($IU.isString(e))for(var n=e.split("\n"),i=0;i<n.length;i++){try{var a=$.parseJSON(n[i])}catch(e){a=null}a&&t.push(a)}else e&&t.push(e);return t}(e),a=!n&&this.shouldFireChangeEvent(l);this.canPreview=!1;var r=(c=$(this.element)).data($Control.DATA_ORIGIN_INPUT);if(n&&(this.fileInfoList=[]),i&&0<i.length)for(var o=0;o<i.length;o++){var s,l=i[o];0==(u=$(this.element).find("#"+this.field.name+"_fileList_"+l.id)).size()&&(s=this.field.name+"_fileList_"+l.id,u=this.createFileListLi(s)),this.fileInfoList.push(l),r.value=l.id,this.setDisplayDivContent(u,l)}else{c.data($Control.DATA_ORIGIN_INPUT).value="";var u,d=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID);d&&(h(this.fileInfoList,d),u=$(this.element).find("#"+this.field.name+"_fileList_"+d))&&u.remove()}c.data(InfoPlus.Controls.File.UPLOAD_DIV)!==C&&(c.data(InfoPlus.Controls.File.UPLOAD_DIV).css("display","inline-block"),c.find(".uploadFileTip").show()),this.ifBatchesButtonShow()}else{if($IU.isString(e))try{l=$.parseJSON(e)}catch(e){l=null}else l=e;a=!n&&this.shouldFireChangeEvent(l);this.fileInfo=l,this.canPreview=!1;var c,r=(c=$(this.element)).data($Control.DATA_ORIGIN_INPUT);null!=l&&null!=l.id?(r.value=l.id,this.setDisplayDivContent(c,l),c.data(InfoPlus.Controls.File.UPLOAD_DIV)!==C&&(c.data(InfoPlus.Controls.File.UPLOAD_DIV).hide(),c.find(".uploadFileTip").hide())):(c.data($Control.DATA_ORIGIN_INPUT).value="",c.data(InfoPlus.Controls.File.DISPLAY_DIV).hide(),c.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==C&&c.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide(),c.data(InfoPlus.Controls.File.UPLOAD_DIV)!==C&&(c.data(InfoPlus.Controls.File.UPLOAD_DIV).css("display","inline-block"),c.find(".uploadFileTip").show()))}a&&setTimeout(function(){$(r).change()},0)},setDisplayDivContent:function(e,t){f=(f=t).uri||"",(g=document.createElement("a")).setAttribute("href",f);var n,i,a,r,o,s,l,u,d,c,h,p,f=$(g)[0].href,m=(f&&(t.uri=f),e),g=m.find(".display a")[0];null!=g?(f=$(g),g.setAttribute("href",(p=(e=t).uri||"",$$.APP&&""!==(e=E(e.name))&&(p+="?type="+e),p)),this.fileUri=t.uri||"",p=(e=m.find(".infoplus_popMenu")).attr("id"),e.find("#"+p+"_download_link").attr("href",g.href),(this.isWritable()||this.isEditable())&&this.field.type===$Control.DATA_TYPE_DOC&&null!=$$.params.uriWordEdit&&""!==$$.params.uriWordEdit&&(o=0<$$.params.formStepId?$$.params.formStepId:"e"+$$.params.formEntryId,r=(r=(r=(r=(r=$$.params.uriWordEdit.replace("%1",o)).replace("%2",this.field.name)).replace("%mime",t.mime!==C?encodeURIComponent(t.mime):"")).replace("%uri",encodeURIComponent(t.uri))).replace("%path",this.path||""),e.find("#"+p+"_edit_link").attr("href",r),g.setAttribute("href",r),null!=$$.params.uriWordDown)&&""!==$$.params.uriWordDown&&((n=e.find("#"+p+"_download")).addClass("infoplus_popMenuItem_choose"),r=e.find("#"+p+"_download_link").attr("href"),p=(p=(p=(p=(p=$$.params.uriWordDown.replace("%1",o)).replace("%2",this.field.name)).replace("%mime",t.mime!==C?encodeURIComponent(t.mime):"")).replace("%uri",encodeURIComponent(t.uri))).replace("%path",this.path||""),n.append("<span class='infoplus_popMenuItemSelect'><i class='i-icon-triangle-down'></i></span>"),o=$("<div class='infoplus_popMenuItemSelectGroup'><a href='"+r+"' target='_blank' >"+$$.lt("file.menu.beforeEdit")+"</a><a href='"+p+"' target='_blank' >"+$$.lt("file.menu.afterEdit")+"</a></div>"),(i=n.find(".infoplus_popMenuItemSelect")).append(o),i.click(function(e){e.stopPropagation(),n.toggleClass("show"),n.hasClass("show")?$(this).find("i").removeClass("i-icon-triangle-down").addClass("i-icon-triangle-up"):$(this).find("i").removeClass("i-icon-triangle-up").addClass("i-icon-triangle-down")}),e.hover(function(){},function(){n.removeClass("show"),i.find("i").removeClass("i-icon-triangle-up").addClass("i-icon-triangle-down")})),r="",null!=t.name&&(r=t.name),null!=t.createTime&&(r+=" "+$$.lt("file.createAt",$IU.dateFormat(new Date(1e3*t.createTime),"yyyy-MM-dd hh:mm:ss"))),g.setAttribute("title",r),f.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).text(t.name||" "),p=$IU.convertFileSize(t.size),f.children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+p.size+p.unit+")"),!0===t.uploadSuccess&&(o=m.find(".display span.uploadSuccess")[0],$(o).css("display","")),a=m.data(InfoPlus.Controls.File.DISPLAY_DIV).find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),r=0<(e=m.find(".display span.uploadSuccess")).length&&"none"!==e[0].style.display,f=$(this.element).css("font-size"),$IU.isEmptyStr(f)||(o=null==(p=f)||p.length<2?null:p.substr(p.length-2).toLocaleLowerCase(),s=parseFloat(f),"pt"==o&&(s=4*s/3)),isNaN(s)&&(s=16),l=this.element.style.width,u=r?9*s+12+12+2:5*s+12,d=function(e,t){var n=e.children(".display"),e=parseInt(e.width(),10),n=parseInt(n.css("max-width"),10);return isNaN(n)||e<n?t<e?e-t:0:t<n?n-t:0},null!=l&&""!==l?"%"!==l.substring(l.length-1)?this.field.type==$Control.DATA_TYPE_LIST?(a.css("max-width","0px"),h=function(){0===m.width()?setTimeout(function(){h()},100):a.css("max-width",d(m,u)+"px")},setTimeout(function(){h()},300)):a.css("max-width",d(m,u)+"px"):0!==m.width()&&m.width()!==parseInt(l,10)?a.css("max-width",d(m,u)+"px"):(a.css("max-width","0px"),c=function(){var e,t;m.width()!==parseInt(l,10)&&(e=d(m,u),t=parseFloat(a.css("max-width"),10),a.css("max-width",e+"px"),Math.floor(e)===Math.floor(t))&&0!==e||setTimeout(function(){c()},300)},setTimeout(function(){c()},300)):(a.css("max-width","0px"),h=function(){0===m.width()?setTimeout(function(){h()},100):a.css("max-width",d(m,u)+"px")},setTimeout(function(){h()},300)),e=this.popMenu,this.field.type==$Control.DATA_TYPE_LIST&&(e=m.data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu")),p=E(t.name),""!==($$.params.uriFilePreview||"")&&-1!==$.inArray(p,_.OFFICE_FILE_SUFFIX)?(e.showMenuItem("preview"),this.canPreview=!0):e.hideMenuItem("preview"),$$.APP&&(-1!==$.inArray(p,_.APP_NATIVE_OPEN_FILE_SUFFIX)?e.setMenuItemText("download",$$.lt("file.menu.open")):e.setMenuItemText("download",$$.lt("file.menu.download")))):$(g).children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html("&nbsp;"),m.data(InfoPlus.Controls.File.DISPLAY_DIV).show(),m.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==C&&m.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide()},getValue:function(){var e;return this.field.type==$Control.DATA_TYPE_LIST?(e=function(e){var t="";if(e&&0<e.length)for(var n=0;n<e.length;n++)delete e[n].uploadSuccess,t=t+$.toJSON(e[n])+"\n";return t=t&&t.substr(0,t.length-1)}(this.fileInfoList),null==this.field||null==this.element||""==e?"":e):null==this.field||null==this.element||null==this.fileInfo?"":(delete(e=this.fileInfo).uploadSuccess,$.toJSON(e))},getSortValue:function(){return null==this.field||null==this.element||null==this.fileInfo?"":this.fileInfo.name},specialSetting:function(e){var t,n=this.element,i=$(n),e=(e&&(i=$(e)),n.style.width),a=(null!=e&&"%"!==e.substring(e.length-1)&&(e=parseInt(e,10),a=this.supportXhr?e-230:e-70,i.data(InfoPlus.Controls.File.DISPLAY_DIV)!==C&&(t=0<(t=i.data(InfoPlus.Controls.File.DISPLAY_DIV).find("span.uploadSuccess")).length&&"none"!==t[0].style.display?$$.MOBILE?210:165:$$.MOBILE?130:105,i.data(InfoPlus.Controls.File.DISPLAY_DIV).css("max-width",e+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",e-t+"px")),i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==C)&&(i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).css("max-width",e+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",a+"px"),this.supportXhr||(i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadSpan").css("max-width"+(e-30)+"px"),0!==(t=i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadProgressTable")).length&&(t[0].setAttribute("width",e-14),t.find("td.uploadTd")[0].width=e-30,t.find("td.uploadTd")[1].width=16))),n.style.height);null!=a&&$(n).css("height","").css("min-height",a)},registerEvent:function(){this.events=InfoPlus.Controls.File.Events.events},setDynamicReadOnly:function(e){var t,n=this.element;e?($(n).addClass($Control.CLASSNAME_READONLY),this.popMenu.hideMenuItem("remove"),this.popMenu.hideMenuItem("edit")):($(n).removeClass($Control.CLASSNAME_READONLY),this.popMenu.showMenuItem("remove"),this.popMenu.showMenuItem("edit")),this.field.type===$Control.DATA_TYPE_DOC&&null!=$$.params.uriWordEdit&&""!==$$.params.uriWordEdit&&(n=this.fileUri)&&(t=$(this.element).find(".display"))&&0<t.size()&&(t=t.find("."+InfoPlus.Controls.File.CLASS_LINK))&&0<t.size()&&(e?(this.popMenu.showMenuItem("preview"),t.data("uriWordEdit",t.attr("href")),t.attr("href",n)):(this.popMenu.hideMenuItem("preview"),e=t.data("uriWordEdit"),t.attr("href",e)))},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setDynamicReadOnly(!0)},preview:function(){var e,n,i,a,t;return null!=$$.params.uriFilePreview&&""!==$$.params.uriFilePreview&&(this.field.type==$Control.DATA_TYPE_LIST&&(e=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID),i=c(this.fileInfoList,e),this.fileUri=i.uri,this.fileInfo=i),e=this.field,n=this.fileUri,i=this.fileInfo,t=$(this.element).data($Control.DATA_ORIGIN_INPUT),a=$(t).attr("id"),m(e.settings)?$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:!0,data:{field:e.name,fileUri:n}}).done(function(e){var t;null!=e&&(0===e.errno?(t=e.entities[0],$IU.isObject(t)&&(t=t.token),n+=(-1!==n.indexOf("?")?"&":"?")+"access_token="+t,t=$$.params.uriFilePreview.replace("%s",encodeURIComponent(n)),$$.MOBILE?new InfoPlus.Render.Mobile.Page({title:i.name,uri:t}).show():$IU.iframeBox(t,i.name,!1,!0,null,null,a)):$$.debug(e.error))}):(t=$$.params.uriFilePreview.replace("%s",encodeURIComponent(n)),$$.MOBILE?new InfoPlus.Render.Mobile.Page({title:i.name,uri:t}).show():$IU.iframeBox(t,i.name,!1,!0,null,null,a))),!1},download:function(i,a){var e,r,o,s,l,u=this.field;return u.type==$Control.DATA_TYPE_LIST&&(a||(e=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID),i=c(this.fileInfoList,e)),this.fileInfo=i,this.fileUri=i.uri),m(u.settings)?(null!=this.popupDownloadTip&&this.popupDownloadTip.close(!0),r=t(this),this.popupDownloadTip=r,o=this.fileInfo.name,s=this.fileUri,l=this,$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:!0,data:{field:u.name,fileUri:s}}).done(function(e){var t,n;null!=e&&(0===e.errno?(n=e.entities[0],$IU.isObject(n)&&(t=n.expireIn,n=n.token),s=(s+=(-1!==s.indexOf("?")?"&":"?")+"access_token="+n)+d(l.fileInfo),setTimeout(function(){u.type==$Control.DATA_TYPE_LIST&&a?f(i.name,s,100,1e3):g(r,s,o,t)},1e3)):$$.debug(e.error))}),!1):$$.MINIPROGRAM&&p.openWxWebviewDownloadFile?($IU.wxWebviewDownloadFile(this.fileUri,this.fileInfo.name),!1):void 0},deleteFile:function(){var e=this;$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){e.setValue(null)})}}),define("InfoPlus.Controls.File",_);var t=function(e){var t,n=!1,i=(e.field.type==$Control.DATA_TYPE_LIST&&(n=!0,t=$(e.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID),t=$(e.element).find("#"+e.field.name+"_fileList_"+t)),document.createElement("div")),a=$(i),r=document.createElement("span");return $(r).text($$.lt("file.prepareSecureLink")).addClass("loadingSecureLink"),a.append(r),new InfoPlus.Render.PopTip({popper:n?t:e.element,content:i,showCloseButton:!0,backgroundColor:"#f8eda5",placement:"top"})},g=function(e,t,n,i){var a,r,o,s,l=document.createElement("div"),u=$(l),d=document.createElement("span"),c=document.createElement("span"),h=document.createElement("a");$(d).text($$.lt("file.secureLinkReady")),$(c).text($$.lt("file.download")),$$.MINIPROGRAM&&p.openWxWebviewDownloadFile?($(h).text($$.lt("file.link")).attr("href","javascript:;").addClass("secureFileLink"),$(h).click(function(){$IU.wxWebviewDownloadFile(t,n)})):$(h).text($$.lt("file.link")).attr("href",t).attr("target","_blank").addClass("secureFileLink"),u.append(d).append(h).append(c).css(""),i!==C&&(a=new Date,r=i-Math.round(a.getTime()/1e3),o=document.createElement("span"),$(o).text($$.lt("file.invalidText",r)),u.append(o),s=setInterval(function(){a=new Date,0<(r=i-Math.round(a.getTime()/1e3))?$(o).text($$.lt("file.invalidText",r)):(e.close(),clearInterval(s))},1e3)),e.changeContent(l)},e={onCancel:function(){var e=$(this).parents("."+$Control.CLASSNAME_CONTROL),t=e.data(InfoPlus.Controls.File.UPLOAD_FILE_ID);null!=t&&(e.data("uploader").cancel(t),(t=e.data($Control.DATA_CONTROL_OBJECT))&&t.field.type==$Control.DATA_TYPE_LIST&&(e=$(this).parents(".uploadItemContainer").attr("id").split("_fileList_")[1],$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,e)),t.setValue(null))},onFocusIn:function(){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==C&&$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).addClass("focus"),$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==C&&$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).addClass("focus")},onFocusOut:function(){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==C&&$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus"),$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==C&&$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus")},onLinkClick:function(){if($$.MOBILE)return!1;var e,t=$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(t&&t.field.type==$Control.DATA_TYPE_LIST&&(e=$(this).parents(".uploadItemContainer").attr("id").split("_fileList_")[1],$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,e)),null!=t){if(t.field.type===$Control.DATA_TYPE_DOC&&(t.isWritable()||t.isEditable())&&null!=$$.params.uriWordEdit&&""!==$$.params.uriWordEdit)return!0;if(!0===t.canPreview)return t.preview(),!1}return t.download()},onMouseDown:function(e){var i,a,r,o;if(2===e.button)return(e=(i=$(this).data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT)).field).type!=$Control.DATA_TYPE_LIST&&(m(e.settings)?(null!=i.popupDownloadTip&&i.popupDownloadTip.close(!0),a=t(i),i.popupDownloadTip=a,r=i.fileUri,o=i.name,$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:!0,data:{field:e.name,fileUri:r}}).done(function(e){var t,n;null!=e&&(0===e.errno?(n=e.entities[0],$IU.isObject(n)&&(t=n.expireIn,n=n.token),r=(r+=(-1!==r.indexOf("?")?"&":"?")+"access_token="+n)+d(i.fileInfo),setTimeout(function(){g(a,r,o,t)},1e3)):$$.debug(e.error))}),!1):void 0)}};e.events=[{selector:"."+InfoPlus.Controls.File.CLASS_CANCEL,type:"click",handler:e.onCancel},{selector:"."+InfoPlus.Controls.File.CLASS_LINK,type:"click",handler:e.onLinkClick},{type:"focusin",handler:e.onFocusIn},{type:"focusout",handler:e.onFocusOut},{type:"mousedown",handler:e.onMouseDown}],define("InfoPlus.Controls.File.Events",e)}(window),function(p){function d(e,t,n,i){this.supportXhr=qq.isXhrUploadSupported(),$Control.call(this,$Control.CONTROL_TYPE_DOC,e,t,n,i)}function o(e,t,n,i){var e=e.width()-16-16,a=t.width(),n=n.width();a+n+i.outerWidth()<e?d.MAX_PERCENT_WIDTH<e-a-n?i.css("width",d.MAX_PERCENT_WIDTH+"px"):i.css("width",e-a-n+"px"):(i.css("width",""),t.css("width",e-n-d.MIN_PERCENT_WIDTH+"px"))}d.UPLOAD_PROGRESS_DIV="uploadProgressDiv",d.DISPLAY_DIV="displayDiv",d.UPLOAD_DIV="uploadDiv",d.UPLOAD_FILE_ID="uploadingFileId",d.CLASS_UPLOAD_FILE_NAME="uploadFileName",d.CLASS_UPLOAD_FILE_SIZE="uploadFileSize",d.CLASS_CANCEL="infoplus_fileControl_cancel",d.OFFICE_FILE_SUFFIX=["doc","docx","xls","xlsx","ppt","pptx"],d.OFFICE365_FILE_SUFFIX=["docx","xlsx"],d.MAX_PERCENT_WIDTH=100,d.MIN_PERCENT_WIDTH=40;d.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_DOC],ignoreClass:!0,allowFocus:!0,fileInfo:null,events:[],supportXhr:!1,autoTriggerFieldChangeEvent:!1,validatorPromptPosition:"topLeft",name:"doc",hasHiddenElement:!0,uploadCallbacks:{onCancel:function(e,t){},onError:function(e,t,n){},onSubmit:function(e,t){var n=$($(this._options.button).data("container")),i=n.data(d.UPLOAD_PROGRESS_DIV),a=i.find("."+d.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(t)).css("width",""),e=(i.find(".pi").css("width","0%"),i.removeClass("focus"),n.data(d.UPLOAD_FILE_ID,e),a[0].setAttribute("title",$$.lt("file.uploading",t)),n.data(d.UPLOAD_DIV).hide(),n.data(d.UPLOAD_PROGRESS_DIV).show(),i.find("."+d.CLASS_UPLOAD_FILE_SIZE).empty()),t=i.find(".po");o(i,a,e,t)},onUpload:function(e,t){},onProgress:function(e,t,n,i){var a=$($(this._options.button).data("container")).data(d.UPLOAD_PROGRESS_DIV),r=$IU.convertFileSize(i),r=a.find("."+d.CLASS_UPLOAD_FILE_SIZE).html("("+r.size+r.unit+")"),i=(n<i?(n=Math.round(n/i*100),a.find(".pi").css("width",n+"%")):a.find(".pi").css("width","100%"),a.find("."+d.CLASS_UPLOAD_FILE_NAME)),n=a.find(".po");o(a,i,r,n)},onComplete:function(e,t,n){var i=$($(this._options.button).data("container")),i=(i.data(d.UPLOAD_PROGRESS_DIV).removeClass("focus"),i.data(d.DISPLAY_DIV).removeClass("focus"),i.data(d.UPLOAD_FILE_ID,null),i.data($Control.DATA_CONTROL_OBJECT));n.success&&null!=n.infoPlusFile?(n=n.infoPlusFile,i.setValue({uploadSuccess:!0,id:n.id,name:n.name,size:n.size,uri:n.uri,mime:n.mime,createTime:n.createTime})):($IU.messageBox(null,$$.lt("file.uploadFail"),null,300),i.setValue(null))},onValidateBatch:function(e){var t=this._options.validation;if(t!==p&&null!==t)for(var n=e.length,i=0;i<n;i++){var a=e[i];if(a.name!==p&&t.allowedExtensions!==p&&0<t.allowedExtensions.length){h=a.name,c=void 0;for(var r=-1!==(c=h.lastIndexOf("."))&&c+1<h.length?h.substring(c+1).toLowerCase():"",o=t.allowedExtensions,s=t.allowedExtensions.length,l=!1,u="",d=0;d<s;d++)u=u+o[d]+(d!==s-1?",":""),r===o[d]&&(l=!0);if(!l)return $IU.messageBox(null,$$.lt("file.suffix",u),null,300),!1}if(a.size!==p){var c,h=t.sizeLimit;if(null!==h&&!isNaN(h)&&0!==h)if(a.size>h)return c=$IU.convertFileSize(h),$IU.messageBox(null,$$.lt("file.sizeLimit",c.size+c.unit),null,360),!1}}return!0}},hasFile:function(){var e=this.fileInfo;return null!=e&&null!=e.id},setPlaceHolder:function(){var e,t;null!=this.field&&null!=this.field.placeHolder&&""!==this.field.placeHolder&&(e=this.element,t=document.createElement("span"),$(t).text(this.field.placeHolder),$(e).find(".uploadFileButton").append(t))},createIframe:function(e){var t=document.createElement("iframe");return t.setAttribute("scrolling","auto"),e.appendChild(t),t},createDisplayDiv:function(e){var t,n=document.createElement("div"),i=$(n);i.addClass("display").hide().data("container",e),this.createIframe(n),e.appendChild(n),$(e).data(d.DISPLAY_DIV,i),this.isWritable()&&(t=this,e=[{id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){t.deleteFile()}}],this.popMenu=new InfoPlus.Render.PopMenu({container:n,items:e,horizontalMenuItem:!0,position:"top-left"}))},createUploadProgressDiv:function(e){var t,n,i,a,r,o,s,l,u=document.createElement("div");$(u).addClass("uploadProgress").hide().data("container",e),this.supportXhr?((n=document.createElement("table")).setAttribute("class","uploadProgressTable"),i=document.createElement("tbody"),a=document.createElement("tr"),(r=document.createElement("td")).setAttribute("class","uploadTd"),(l=document.createElement("span")).setAttribute("class","uploadSpan"),(t=document.createElement("div")).setAttribute("class",d.CLASS_UPLOAD_FILE_NAME),(o=document.createElement("div")).setAttribute("class",d.CLASS_UPLOAD_FILE_SIZE),l.appendChild(t),l.appendChild(o),r.appendChild(l),a.appendChild(r),(r=document.createElement("td")).setAttribute("class","uploadTd"),o=document.createElement("div"),l=document.createElement("div"),(s=document.createElement("div")).setAttribute("class","pi"),s.setAttribute("style","width:0%"),l.setAttribute("class","po"),l.appendChild(s),o.appendChild(l),r.appendChild(o),a.appendChild(r),(r=document.createElement("td")).setAttribute("class","uploadTd"),(s=document.createElement("div")).setAttribute("class",d.CLASS_CANCEL),s.setAttribute("title",$$.lt("common.cancel")),r.appendChild(s),a.appendChild(r),i.appendChild(a),n.appendChild(i),u.appendChild(n)):((t=document.createElement("div")).setAttribute("class",d.CLASS_UPLOAD_FILE_NAME),(l=document.createElement("div")).setAttribute("class","uploading"),(s=document.createElement("div")).setAttribute("class",d.CLASS_CANCEL),s.setAttribute("title",$$.lt("common.cancel")),u.appendChild(t),u.appendChild(l),u.appendChild(s)),e.appendChild(u),$(e).data(d.UPLOAD_PROGRESS_DIV,$(u))},createUploadButtonDiv:function(e){var t=document.createElement("div"),n=(null!=this.field.settings&&this.field.settings.displayText!==p&&$(t).text(this.field.settings.displayText),$(t).addClass("uploadFileButton droppable").data("container",e),$(t).css("display","inline-block").hide(),$$.params.attachmentUrl+"?stepId="+(null==$$.params.formStepId?-1:$$.params.formStepId)+"&field="+this.field.name),n=(null!=$$.params.formInstanceId&&(n+="&instanceId="+$$.params.formInstanceId),null!=$$.params.workflowId&&(n+="&workflowId="+$$.params.workflowId),null!=$$.params.release&&(n+="&release="+$$.params.release),{request:{endpoint:n},button:t,multiple:!1,debug:!1,callbacks:this.uploadCallbacks,validation:{allowedExtensions:d.OFFICE365_FILE_SUFFIX}}),i=this.field.settings,a=(i!==p&&null!==i&&(i.fileTypes!==p&&(n.validation.allowedExtensions=i.fileTypes.split(",")),n.validation.sizeLimit=i.fileSizeMax!==p&&$IU.isNumber(i.fileSizeMax)?parseInt(i.fileSizeMax,10):i.maxLength!==p&&$IU.isNumber(i.maxLength)?parseInt(i.maxLength,10):void 0),new qq.FineUploaderBasic(n));null!=qq.DragAndDrop&&new qq.DragAndDrop({dropZoneElements:[t],classes:{dropActive:"dropActive"},callbacks:{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){a.addFiles(e)}}}),e.appendChild(t),$(e).data(d.UPLOAD_DIV,$(t)).data("uploader",a)},createElement:function(){var e=document.createElement("div");return this.isReadable()&&this.createDisplayDiv(e),this.isWritable()&&(this.createUploadProgressDiv(e),this.createUploadButtonDiv(e)),e},shouldFireChangeEvent:function(e){return!0===this.synced?this.synced=!1:!!(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&(null==this.fileInfo?null!=e:null==e||e.id!==this.fileInfo.id)},setValue:function(e,t,n){var i;if($IU.isString(e))try{i=$.parseJSON(e)}catch(e){i=null}else i=e;var a,r,e=!n&&this.shouldFireChangeEvent(i),n=(this.fileInfo=i,this.canPreview=!1,$(this.element)),o=n.data($Control.DATA_ORIGIN_INPUT),s=$(this.element).find("iframe");null!=i&&null!=i.id?(o.value=i.id,0!==s.length&&(!this.isWritable()&&!this.isEditable()||$$.MOBILE?null!=$$.params.uriFilePreview&&""!==$$.params.uriFilePreview&&(r=$$.params.uriFilePreview.replace("%s",encodeURIComponent(i.uri)),s.attr("src",r)):null!=$$.params.uriWordEdit&&""!==$$.params.uriWordEdit&&(a=0<$$.params.formStepId?$$.params.formStepId:"e"+$$.params.formEntryId,r=(r=(r=(r=(r=$$.params.uriWordEdit.replace("%1",a)).replace("%2",this.field.name)).replace("%mime",i.mime!==p?encodeURIComponent(i.mime):"")).replace("%uri",encodeURIComponent(i.uri))).replace("%path",this.path||""),s.attr("src",r))),n.data(d.DISPLAY_DIV).show(),n.data(d.UPLOAD_PROGRESS_DIV)!==p&&n.data(d.UPLOAD_PROGRESS_DIV).hide(),n.data(d.UPLOAD_DIV)!==p&&n.data(d.UPLOAD_DIV).hide()):(n.data($Control.DATA_ORIGIN_INPUT).value="",n.data(d.DISPLAY_DIV).hide(),n.data(d.UPLOAD_PROGRESS_DIV)!==p&&n.data(d.UPLOAD_PROGRESS_DIV).hide(),n.data(d.UPLOAD_DIV)!==p&&n.data(d.UPLOAD_DIV).css("display","inline-block"),s.attr("src","")),e&&setTimeout(function(){$(o).change()},0)},getValue:function(){var e;return null==this.field||null==this.element||null==this.fileInfo?"":(delete(e=this.fileInfo).uploadSuccess,$.toJSON(e))},getSortValue:function(){return null==this.field||null==this.element||null==this.fileInfo?"":this.fileInfo.name},specialSetting:function(){var e=this.element,t=$(e),n=t.find("iframe"),i=e.style.width,e=(null!=i&&n.css("width",i),e.style.height);null!=e&&n.css("height",e),t.data("size",{width:i,height:e}).css("width","").css("height","")},closeIframe:function(){this.hasFile()&&($(this.element).find("iframe").attr("src",""),$(this.element).data("iframeClosed",!0))},reopenIframe:function(){$(this.element).data("iframeClosed")&&this.setValue(this.fileInfo)},registerEvent:function(){this.events=d.Events.events},setDynamicReadOnly:function(e){var t=this.element;e?($(t).addClass($Control.CLASSNAME_READONLY),this.popMenu!==p&&this.popMenu.hideMenuItem("remove")):($(t).removeClass($Control.CLASSNAME_READONLY),this.popMenu!==p&&this.popMenu.showMenuItem("remove"))},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=!0,this.setDynamicReadOnly(!0)},deleteFile:function(){var e=this;$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){e.setValue(null)})}}),define("InfoPlus.Controls.Doc",d);var e={onCancel:function(){var e=$(this).parents("."+$Control.CLASSNAME_CONTROL),t=e.data(d.UPLOAD_FILE_ID);null!=t&&(e.data("uploader").cancel(t),e.data($Control.DATA_CONTROL_OBJECT).setValue(null))},onFocusIn:function(){$(this).data(d.UPLOAD_PROGRESS_DIV)!==p&&$(this).data(d.UPLOAD_PROGRESS_DIV).addClass("focus")},onFocusOut:function(){$(this).data(d.UPLOAD_PROGRESS_DIV)!==p&&$(this).data(d.UPLOAD_PROGRESS_DIV).removeClass("focus")}};e.events=[{selector:"."+d.CLASS_CANCEL,type:"click",handler:e.onCancel},{type:"focusin",handler:e.onFocusIn},{type:"focusout",handler:e.onFocusOut}],define("InfoPlus.Controls.Doc.Events",e)}(void window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_HELP,e,t,n,i)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:!0,ignoreValidation:!0,allowFocus:!1,autoTriggerFieldChangeEvent:!1,name:"help",hasHiddenElement:!0,createElement:function(){var e=document.createElement("div");return $(e).data("showTitle",!1).tipsy({html:!0,fade:!0,gravity:$.fn.tipsy.autoWE,trigger:"manual",opacity:.9}),e},setValue:function(e,t,n){null==e&&(e="");var n=!n&&this.shouldFireChangeEvent(e),i='<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(e)+"</div>",a=(this.element.setAttribute("original-title",i),$(this.element).data($Control.DATA_ORIGIN_INPUT));a.value=e,n&&setTimeout(function(){$(a).change()},0)},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT);return this.convertEmptyValue(e.value).replace(/\r\n/g,"\n")},registerEvent:function(){this.events=InfoPlus.Controls.Help.Events.events}}),define("InfoPlus.Controls.Help",e);var t={onClick:function(){$(this).data("showTitle",!0).tipsy("show")},onMouseEnter:function(){$$.MOBILE||$(this).data("showTitle",!0).tipsy("show")},onMouseLeave:function(){$$.MOBILE||$(this).data("showTitle",!1).tipsy("hide")},onTouchStart:function(){return!0===$(this).data("showTitle")?$(this).data("showTitle",!1).tipsy("hide"):$(this).data("showTitle",!0).tipsy("show"),!1}};t.events=[{type:"mouseenter",handler:t.onMouseEnter},{type:"mouseleave",handler:t.onMouseLeave},{type:"click",handler:t.onClick},{type:"touchstart",handler:t.onTouchStart}],define("InfoPlus.Controls.Help.Events",t)}(window),function(){function l(e,t,n,i,a,r){$Control.call(this,$Control.CONTROL_TYPE_IMAGE,e,t,n,i,a,r)}l.DATA_IMG="img",l.DATA_IMG_LOADED="loaded",l.DATA_IMG_LOADFAIL_COUNT="failCount",l.MAX_IMG_LOADFAIL_COUNT=10,l.CLASS_IMAGE="infoplus_imageControl_image",l.DEFAULT_FORMAT="jpeg",l.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_THING],ignoreClass:!0,ignoreValidation:!0,allowFocus:!1,imageInfo:null,name:"image",hasHiddenElement:!0,createElement:function(){var e=document.createElement("div"),t=document.createElement("a"),n=(t.setAttribute("data-lightbox",$$.guid()),document.createElement("img"));return n.setAttribute("class",l.CLASS_IMAGE),t.appendChild(n),e.appendChild(t),$(e).data(InfoPlus.Controls.Image.DATA_IMG,n),e},setValue:function(e,t,n,i){if(this.field.type===$Control.DATA_TYPE_THING)a={uri:$IU.getBarcodePrintUrl(e)};else if($IU.isString(e))if($IU.isUrl(e))a={uri:e};else try{a=$.parseJSON(e)}catch(e){a=null}else a=e;this.imageInfo=a;var a,r=$(this.element),o=r.data($Control.DATA_ORIGIN_INPUT),s=r.data(InfoPlus.Controls.Image.DATA_IMG),s=$(s);null!=a?(this.field.type===$Control.DATA_TYPE_THING||$IU.isUrl(e)?o.value=e:o.value=$.toJSON({id:a.id,name:a.name,size:a.size,uri:a.uri,mime:a.mime}),s.attr("src",a.uri).data(InfoPlus.Controls.Image.DATA_IMG_LOADFAIL_COUNT,0),s.parent().attr("href",a.uri)):null!=e&&""!==e?(a="data:image/"+(a="png"!==(a=(this.field.format||"jpeg").toLowerCase())&&"gif"!==a&&"jpeg"!==a?l.DEFAULT_FORMAT:a)+";base64,"+e,o.value=e,s.attr("src",a),s.parent().attr("href",a)):(o.value="",s.removeAttr("src").hide(),s.parent().attr("href","")),this.setAttributes(i),r.data($Control.DATA_DISPLAY_VALUE,t)},getValue:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT),n=this.convertEmptyValue(t.value);switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(n);case $Control.DATA_TYPE_THING:var i=e.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.Thing(n,i);default:return n}},getAttributes:function(){var e;return this.field.type===$Control.DATA_TYPE_ANYURI?(e=this.getValue(),$IU.getParamFromUrl(e.value)):this.field.type===$Control.DATA_TYPE_THING?$(this.element).data($Control.DATA_ATTRIBUTES):null},getSortValue:function(){return null==this.field||null==this.element||null==this.imgageInfo?"":this.imageInfo.name},setElementAttribute:function(){var e=$(this.element),t=e[0].style.width,n=e[0].style.height,i=(this.setHiddenAttribute(),$(e.data(l.DATA_IMG)));i.css("width",t),i.css("height",n),i.css("cursor","pointer"),e.attr("style","float:left;margin:0; padding:0;")},specialSetting:function(){var e=$($(this.element).data(l.DATA_IMG));e.data(l.DATA_IMG_LOADED,!1),e.on("load",function(){$(this).data(l.DATA_IMG_LOADED,!0),$(this).fadeIn().data(l.DATA_IMG_LOADFAIL_COUNT,0)}).on("error",function(){var e,t,n=$(this).data(l.DATA_IMG_LOADFAIL_COUNT)+1;n<l.MAX_IMG_LOADFAIL_COUNT&&($(this).data(l.DATA_IMG_LOADFAIL_COUNT,n),e=$(this).parent().attr("href"),t=this,setTimeout(function(){$(t).attr("src",e)},1e3+200*n))})}}),define("InfoPlus.Controls.Image",l)}(window),function(r,f){function o(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_PICTURE,e,t,n,i)}o.UPLOAD_PICTURE_ID="uploadingPictureId",o.DISPLAY_DIV="displayDiv",o.DISPLAY_IMG="displayImg",o.PREVIEW_IMG="previewImg",o.UPLOAD_DIV="uploadDiv",o.MASK_DIV="maskDiv",o.UPLOAD_FILE_ID="uploadingFileId",o.CLASS_DELETE_PICTURE="infoplus_pictureControl_delete",o.DISPLAY_DIV_MAX_WIDTH="maxW",o.DISPLAY_DIV_MAX_HEIGHT="maxH",o.IMG_LOAD_LOCAL="ll",o.DATA_IMG_LOADFAIL_COUNT="failCount",o.DATA_URL="url";o.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE],ignoreClass:!0,autoTriggerFieldChangeEvent:!1,validatorPromptPosition:"topLeft",name:"picture",hasHiddenElement:!0,pictureInfo:null,uploadCallbacks:{onCancel:function(e,t){},onError:function(e,t,n){},onSubmit:function(n,e,t){var i,a,r,o,s=$($(this._options.button).data("container")),l=s.data(InfoPlus.Controls.Picture.DISPLAY_DIV),u=s.data(InfoPlus.Controls.Picture.UPLOAD_DIV),d=l.data(InfoPlus.Controls.Picture.PREVIEW_IMG),c=$(l.data(InfoPlus.Controls.Picture.DISPLAY_IMG)),h=$(d),p=$($(d).parent()[0]),f=this._buttons[0].getInput(),m=this,g=s.data($Control.DATA_CONTROL_OBJECT),C=g.field.settings||{};f.files&&f.files[0]?(h.data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,!0),h.css("margin-top",g.getMaxHeight()+1+"px"),h.css("margin-left",g.getMaxWidth()+1+"px").show(),(o=new FileReader).onload=function(e){C.fileEdit?g.createCropPictureDialog(e.target.result,f.files[0],function(t){$IU.fileTobase64Img(t,function(e){d.src=e,p.attr("href",d.src),s.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,n),m.removeFileRef(n),m.clearStoredFiles(),setTimeout(function(){m.addFiles(t),m.uploadStoredFiles()},0)})}):(d.src=e.target.result,p.attr("href",d.src))},o.readAsDataURL(f.files[0])):d.filters&&t&&(c.hide(),h.css("margin-top",g.getMaxHeight()+1+"px"),h.css("margin-left",g.getMaxWidth()+1+"px").show(),l.show(),u.hide(),$.browser.msie&&"9"===$.browser.version.substr(0,1)?(i=d.offsetWidth,a=d.offsetHeight,d.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=t,r=setInterval(function(){var e;d.offsetWidth===i&&d.offsetHeight===a||(e=$IU.clacImgZoomParam(g.getMaxWidth(),g.getMaxHeight(),d.offsetWidth,d.offsetHeight),g.setDisplayDivSize(e.width,e.height),l.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+t+'"'),h.hide(),clearTimeout(r))},500)):(d.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=t,o=$IU.clacImgZoomParam(g.getMaxWidth(),g.getMaxHeight(),d.offsetWidth,d.offsetHeight),g.setDisplayDivSize(o.width,o.height),l.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+t+'"'),$(d).hide())),C.fileEdit||(s.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,n),setTimeout(function(){m.uploadStoredFiles()},0))},onUpload:function(e,t){var n=$($(this._options.button).data("container")),i=n.data(InfoPlus.Controls.Picture.DISPLAY_DIV),a=i.data(InfoPlus.Controls.Picture.MASK_DIV),n=n.data($Control.DATA_CONTROL_OBJECT),a=(a.css("top","0%"),a[0].style.width=i[0].style.width,a[0].style.height=i[0].style.height,a.show(),n.getMaxWidth()),n=n.getMaxHeight(),n=n<a?n:a,a=10+parseInt(n/25,10),r=5+parseInt(n/10,10),o=4+parseInt(n/100,10),a={lines:a,length:4+parseInt(n/80,10),width:o,radius:r,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},n=new Spinner(a).spin(i[0]),o=document.createElement("div");$(o).css("font-size","12px").css("white-space","nowrap").css("word-wrap","normal").css("top","50%").css("left","50%").css("margin-left","-25px").css("margin-top","-6px").css("color",a.color).text(""),n.el.appendChild(o),i.data("spin",n)},onProgress:function(e,t,n,i){var a=$($(this._options.button).data("container")).data(InfoPlus.Controls.Picture.DISPLAY_DIV).data(InfoPlus.Controls.Picture.MASK_DIV),n=n<i?Math.round(n/i*100):100;a.css("top",n+"%")},onComplete:function(e,t,n){var i=$($(this._options.button).data("container")),a=i.data(InfoPlus.Controls.Picture.DISPLAY_DIV),r=a.data(InfoPlus.Controls.Picture.MASK_DIV),o=i.data($Control.DATA_CONTROL_OBJECT),a=a.data("spin");null!=a&&a.stop(),r.css("top","100%").hide(),i.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,null),n.success&&null!=n.infoPlusFile?(a=n.infoPlusFile,o.setValue({uploadSuccess:!0,id:a.id,name:a.name,size:a.size,uri:a.uri,mime:a.mime})):($IU.messageBox(null,$$.lt("picture.uploadFail"),null,300),o.setValue(null))},onValidateBatch:function(e){var t=this._options.validation;if(t!==f&&null!==t)for(var n=e.length,i=0;i<n;i++){var a=e[i];if(a.name!==f&&t.allowedExtensions!==f&&0<t.allowedExtensions.length){c=a.name,h=void 0;for(var r=-1!==(h=c.lastIndexOf("."))&&h+1<c.length?c.substring(h+1).toLowerCase():"",o=t.allowedExtensions,s=t.allowedExtensions.length,l=!1,u="",d=0;d<s;d++)u=u+o[d]+(d!==s-1?",":""),r===o[d]&&(l=!0);if(!l)return $IU.messageBox(null,$$.lt("picture.suffix",u),null,300),!1}var c=$($(this._options.button).data("container")).data($Control.DATA_CONTROL_OBJECT),h=c.field.settings||{};if(!h.fileEdit&&a.size!==f){var p=t.sizeLimit;if(null!==p&&!isNaN(p)&&0!==p)if(a.size>p)return a=$IU.convertFileSize(p),$IU.messageBox(null,$$.lt("picture.sizeLimit",a.size+a.unit),null,360),!1}}return!0}},createCropPictureDialog:function(e,i,a){var r=this,t=this.field.settings,o=0,s=t&&t.pictureCropMask,n=$$.lt("picture.cropper.title"),l=$('<div class="picture-cropper-container"><div class="picture-cropper-box"><img src="" id="imageId" alt="" class="image" /></div><div class="picture-cropper-tools"><img src="'+$$.params.baseUrl+'static/img/cropper/cropper.png" id="toggleCropperBtn"  /><img src="'+$$.params.baseUrl+'static/img/cropper/rotate-left.png" id="rotateLeftBtn"  /><img src="'+$$.params.baseUrl+'static/img/cropper/rotate-right.png" id="rotateRightBtn" /><img src="'+$$.params.baseUrl+'static/img/cropper/zoom-in.png" id="zoomInBtn" /><img src="'+$$.params.baseUrl+'static/img/cropper/zoom-out.png" id="zoomOutBtn" /><img src="'+$$.params.baseUrl+'static/img/cropper/reset.png" id="resetBtn" /></div></div>'),u=l.find("#imageId"),d=(u.attr("src",e),{viewMode:1,dragMode:"move",background:!0,autoCropArea:.8,zoomOnWheel:!0,cropBoxResizable:!0,cropBoxMovable:!0,rotatable:!0,moveable:!0,ready:function(){t&&t.pictureCropMask&&($cropperFace=l.find(".cropper-crop-box .cropper-face")).size()&&$cropperFace.css({background:"rgba(255, 255, 255, 0.1) url("+t.pictureCropMask+") no-repeat center","background-size":"100% 100%",opacity:1})}});function c(e,t){t?(e.dragMode="move",e.autoCrop=!0):(e.dragMode="none",e.autoCrop=!1)}e=[];function h(e){var t=0;1==e?o+=t=90:(t=-90,o-=90),u.cropper("rotate",t)}s?l.find(".picture-cropper-tools").find("#toggleCropperBtn").remove():c(d,!1),e.push({name:$$.lt("common.save"),defaultButton:!0,callOnClose:!1,preventDefault:!0,callback:function(){var e,t,n;0!=o||s?(e=u.cropper("getCroppedCanvas"),t=i.type||"image/png",e=e.toDataURL(t),(t=i.name)&&-1!==(n=t.lastIndexOf("."))&&n+1<t.length&&(t=t.substring(0,n)),n=$IU.base64ImgtoFile(e,t),r.compressionRequired(i,n,a)):a(i)}}),e.push({name:$$.lt("common.close")}),($$.MOBILE?(l.addClass("isMobile"),new InfoPlus.Render.Mobile.Page({title:n,content:l,buttons:e,onShow:function(){setTimeout(function(){var e=r.initialAspectRatio();e&&(d.aspectRatio=e),u.cropper(d)},0)}})):new InfoPlus.Render.Dialog({title:n,content:l,maxWidth:800,showCloseButton:!0,buttons:e,onShow:function(){var e=r.initialAspectRatio();e&&(d.aspectRatio=e),u.cropper(d)}})).show(),l.find("#toggleCropperBtn").click(function(){o=0,u.cropper("destroy"),c(d,s=!s),u.cropper(d)}),l.find("#rotateLeftBtn").click(function(){h("-1")}),l.find("#rotateRightBtn").click(function(){h("1")}),l.find("#zoomInBtn").click(function(){u.cropper("zoom",.1)}),l.find("#zoomOutBtn").click(function(){u.cropper("zoom",-.1)}),l.find("#resetBtn").click(function(){u.cropper("reset")})},compressionRequired:function(e,t,n){var i=this.field.settings||{},a=i.maxLength;null===a||isNaN(a)||0===a?i.pictureWidth||i.pictureHeight?this.toCompress(e,t,1,i,n):n(t):t.size<a?n(t):this.toCompress(e,t,null,i,n)},toCompress:function(n,i,a,r,o){var s=this,e={quality:a=a||.8,success:function(e){e=new File([e],n.name,{type:n.type,lastModified:Date.now()});var t=r.maxLength;null===t||isNaN(t)||0===t||e.size<t?o(e):a<.8?(e=$IU.convertFileSize(t),$IU.messageBox(null,$$.lt("picture.sizeLimit",e.size+e.unit),null,360)):s.toCompress(n,i,.6,r,o)},error:function(e){console.log(e.message)}};r.pictureWidth&&(e.maxWidth=r.pictureWidth),r.pictureHeight&&(e.maxHeight=r.pictureHeight),new Compressor(i,e)},initialAspectRatio:function(){var e=null,t=this.field.settings||{},n=t.pictureWidth,t=t.pictureHeight;return e=n&&t?n/t:e},createUploader:function(e,t){var n=$$.params.attachmentUrl+"?stepId="+(null==$$.params.formStepId?-1:$$.params.formStepId)+"&field="+this.field.name,n=(null!=$$.params.formInstanceId&&(n+="&instanceId="+$$.params.formInstanceId),null!=$$.params.workflowId&&(n+="&workflowId="+$$.params.workflowId),null!=$$.params.release&&(n+="&release="+$$.params.release),{request:{endpoint:n},button:t,multiple:!1,debug:!1,autoUpload:!1,callbacks:this.uploadCallbacks}),t=this.field.settings,i={allowedExtensions:["jpg","jpeg","gif","png"]},a=(i.acceptFiles="image/*",t!==f&&null!==t&&null!=(a=t.fileSizeMax!==f&&$IU.isNumber(t.fileSizeMax)?parseInt(t.fileSizeMax,10):t.maxLength!==f&&$IU.isNumber(t.maxLength)?parseInt(t.maxLength,10):null)&&(i.sizeLimit=a),t=t||{},(r.ActiveXObject||"ActiveXObject"in r)&&(t.fileEdit=!1),t.fileEdit!=f&&!t.fileEdit||(t.fileEdit=!0,i.sizeLimit=0),n.validation=i,new qq.FineUploaderBasic(n));$(e).data("uploader",a)},createUploadDiv:function(e){var t=document.createElement("div");$(t).attr("title",$$.lt("picture.upload")).addClass("uploadDiv").data("container",e).hide(),e.appendChild(t),this.createUploader(e,t),$(e).data(InfoPlus.Controls.File.UPLOAD_DIV,$(t))},getMaxWidth:function(){var e=$(this.element),t=e.data(InfoPlus.Controls.Picture.DISPLAY_DIV).data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH);return t="%"===t.substr(t.length-1)?e.outerWidth()*parseInt(t,10)/100:parseFloat(t)},getMaxHeight:function(){var e=$(this.element),t=e.data(InfoPlus.Controls.Picture.DISPLAY_DIV).data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT);return t="%"===t.substr(t.length-1)?e.outerHeight()*parseInt(t,10)/100:parseFloat(t)},createDisplayDiv:function(e){var u=this,d=document.createElement("div"),t=document.createElement("a"),c=$(d),h=$(e),p=(t.setAttribute("data-lightbox",$$.guid()),document.createElement("img")),n=($(p).attr("border","0").addClass("preview").data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,!1).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(d)),$(p).load(function(){var e=h.data(InfoPlus.Controls.Picture.UPLOAD_DIV),t=u.getMaxWidth(),n=u.getMaxHeight(),e=(c.addClass("uploading"),e.hide(),c.show(),$IU.clacImgZoomParam(t,n,this.width,this.height));this.width=e.width,this.height=e.height,$(this).css("margin-left","0px").css("margin-top","0px"),u.setDisplayDivSize(e.width,e.height),$(this).data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,!1)}),t.appendChild(p),document.createElement("img")),i=($(n).attr("border","0").data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(d)),$(n).load(function(){function e(){var e=s(n),t=l(n),e=(i.data("naturalWidth",e).data("naturalHeight",t),$IU.clacImgZoomParam(r,o,e,t));n.width=e.width,n.height=e.height,$(n).css("margin-left","0px").css("margin-top","0px"),null!=$(d).css("filter")&&$(d).css("filter",""),u.setDisplayDivSize(e.width,e.height),c.show(),$(p).hide(),$(n).show(),null!=a&&a.hide(),$(n).parent().attr("href",n.src)}var t,n=this,i=$(n),a=h.data(InfoPlus.Controls.Picture.UPLOAD_DIV),r=u.getMaxWidth(),o=u.getMaxHeight(),s=(i.css("margin-top",o+1+"px").css("margin-left",r+1+"px").show(),function(e){return null!=e.naturalWidth?e.naturalWidth:e.width}),l=function(e){return null!=e.naturalHeight?e.naturalHeight:e.height};0===s(n)||0===l(n)?t=setInterval(function(){0!==s(n)&&0!==l(n)&&(e(),clearTimeout(t))},100):e(),c.removeClass("loading")}).error(function(){}),t.appendChild(n),d.appendChild(t),document.createElement("div")),a=$(i);a.addClass(InfoPlus.Controls.Picture.MASK_DIV).hide(),d.appendChild(i),this.isWritable()&&(i=document.createElement("div"),$(i).attr("title",$$.lt("common.deleteText")).addClass(o.CLASS_DELETE_PICTURE),d.appendChild(i)),e.appendChild(d),$(d).addClass(InfoPlus.Controls.Picture.DISPLAY_DIV).data("container",e).data(InfoPlus.Controls.Picture.PREVIEW_IMG,p).data(InfoPlus.Controls.Picture.DISPLAY_IMG,n).data(InfoPlus.Controls.Picture.MASK_DIV,a),$(e).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(d)),$(t).data("pictureControl",this)},createElement:function(){var e=document.createElement("div");return this.isReadable()&&this.createDisplayDiv(e),this.isWritable()&&this.createUploadDiv(e),e},shouldFireChangeEvent:function(e){return!0===this.synced?this.synced=!1:!!(this.onFieldChange||this.onFieldRefer||this.onFieldSync)&&(null==this.pictureInfo?null!=e:null==e||e.id!==this.pictureInfo.id)},setValue:function(e,t,n){function i(i,a){function e(n){$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:!0,data:{field:l.name,fileUri:a}}).done(function(e){var t;null!=e&&(0===e.errno?(t=e.entities[0],$IU.isObject(t)&&(t=t.token),t=a+(-1!==a.indexOf("?")?"&":"?")+"access_token="+t,n?(r=!0,o.parent().attr("href",t),o.click(),r=!1):(i.src=t,o.data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,0))):$$.debug(e.error))})}var r,t,o=$(i);""!==a?(o.hide(),o.parents(".displayDiv").removeClass("uploading").addClass("loading"),null!=s.name&&o.attr("alt",s.name),null!=(t=l.settings)&&null!=(t=t.fileSecure)&&!1!==t&&"False"!==t?(e(!1),r=!1,o.unbind("click").click(function(){if(!r)return e(!0),!1})):(i.src=a,o.data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,0))):(o.removeAttr("src").removeAttr("width").removeAttr("height").removeAttr("style"),o.parent().removeAttr("href")),o.data(InfoPlus.Controls.Picture.DATA_URL,a)}var s,l=this.field;if($IU.isString(e))try{s=$.parseJSON(e)}catch(e){s=null}else s=e;var e=!n&&this.shouldFireChangeEvent(s),n=(this.pictureInfo=s,$(this.element)),a=n.data($Control.DATA_ORIGIN_INPUT),r=n.data(InfoPlus.Controls.Picture.DISPLAY_DIV),n=n.data(InfoPlus.Controls.Picture.UPLOAD_DIV),o=r.data(InfoPlus.Controls.Picture.DISPLAY_IMG),u=r.data(InfoPlus.Controls.Picture.PREVIEW_IMG);null!=s&&null!=s.id?(a.value=s.id,i(o,s.uri)):(a.value="",r.hide(),null!=n&&(n.children("input")[0].style.height=n[0].style.height,n.show()),i(o,""),$(u).removeAttr("width").removeAttr("height").removeAttr("style").removeAttr("src")),e&&setTimeout(function(){$(a).change()},0)},getValue:function(){var e,t;return null==this.field||null==this.element||null==this.pictureInfo?"":(e=$(this.element).data(InfoPlus.Controls.Picture.DISPLAY_DIV),e=$(e.data(InfoPlus.Controls.Picture.DISPLAY_IMG)),t=this.pictureInfo,$.toJSON({id:t.id,name:t.name,size:t.size,uri:t.uri,mime:t.mime,width:e.data("naturalWidth"),height:e.data("naturalHeight")}))},getSortValue:function(){return null==this.field||null==this.element||null==this.pictureInfo?"":this.pictureInfo.name},setDisplayDivSize:function(e,t){var n,i=$(this.element).data(InfoPlus.Controls.Picture.DISPLAY_DIV);null!=i&&(n=i.data(InfoPlus.Controls.Picture.MASK_DIV),i.css("width",e),i.css("height",t),null!=n)&&(n.css("width",e),n.css("height",t))},specialSetting:function(){var e=$(this.element),t=e.data(InfoPlus.Controls.Picture.DISPLAY_DIV),n=e.data(InfoPlus.Controls.Picture.UPLOAD_DIV),i=e[0].style.width,a=e[0].style.height;"%"===i.substr(i.length-1)&&$IU.debugTip($$.lt("picture.widthWarning",this.field.name)),null!=t&&(t.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH,i),t.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT,a)),this.setDisplayDivSize(i,a),null!=n&&(n.css("width",i),n.css("height",a),n.children("input")[0].style.height=a),e.css("width",""),e.css("height","")},deletePicture:function(e){var t=this;$IU.confirmBox($$.lt("picture.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){t.setValue(null),null!=e&&"function"==typeof e&&e()})},registerEvent:function(){this.events=InfoPlus.Controls.Picture.Events.events},setDynamicReadOnly:function(e){var t=this.element;e?$(t).addClass($Control.CLASSNAME_READONLY):$(t).removeClass($Control.CLASSNAME_READONLY)}}),define("InfoPlus.Controls.Picture",o);var e={onImgLoad:function(){},onCancel:function(){var e=$(this).parents("."+$Control.CLASSNAME_CONTROL),t=e.data(InfoPlus.Controls.Picture.UPLOAD_PICTURE_ID);null!=t&&(e.data("uploader").cancel(t),e.data($Control.DATA_CONTROL_OBJECT).setValue(null))},onDelete:function(){return $(this).parents("."+$Control.CLASSNAME_CONTROL).data($Control.DATA_CONTROL_OBJECT).deletePicture(),!1}};e.events=[{selector:"."+InfoPlus.Controls.Picture.CLASS_DELETE_PICTURE,type:"click",handler:e.onDelete}],define("InfoPlus.Controls.Picture.Events",e)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_PASSWORD,e,t,n,i,null)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],name:"password",createElement:function(){var e=document.createElement("input");return e.type="password",e},setValue:function(e){null==e&&(e=""),$(this.element).val(e)},getValue:function(){return null==this.field||null==this.element?"":this.convertEmptyValue(this.element.value)}}),define("InfoPlus.Controls.Password",e)}(window),function(c){function h(e,t,n,i){var a;InfoPlus.Controls.Iframe.initialized||((a=document.createElement("div")).setAttribute("id",p),$(a).addClass("round-corner"),h.flyoutDiv=a,$(document.body).append(a),InfoPlus.Controls.Iframe.initialized=!0),$Control.call(this,$Control.CONTROL_TYPE_IFRAME,e,t,n,i)}h.eventRegistered=!1,h.initialized=!1;var p="infoplus_iframe_flyout_div",f=/^.+:\/\/[^/]+/;h.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_ANYURI],ignoreValidation:!0,allowFocus:!1,autoTriggerFieldChangeEvent:!1,name:"iframe",hasHiddenElement:!0,flyoutIframe:null,flyoutIframeId:null,innerId:null,flyoutInnerId:null,flyoutPage:null,createElement:function(){var e=document.createElement("div"),t=document.createElement("iframe");return t.setAttribute("scrolling","auto"),e.appendChild(t),this.controlContainer=e,$(e).addClass("infoplus_iframeControlContainer"),t},sendMessage:function(e){var t=this.element,n=t.src.match(f)[0];t.contentWindow.postMessage($.toJSON(e),n)},flyoutWindowSendMessage:function(e){var t,n;null!=this.flyoutIframeId&&0<(t=$("#"+this.flyoutIframeId)).length&&(n=t[0].src.match(f)[0],t[0].contentWindow.postMessage($.toJSON(e),n))},closeFlyout:function(e){null!=this.flyoutIframeId&&($(h.flyoutDiv).empty().detach().removeData("iframeControl").removeClass("center"),$(document.body).append(h.flyoutDiv),this.flyoutIframe=null,this.flyoutIframeId=null),null!=this.flyoutPage&&(!0!==e&&this.flyoutPage.close(),this.flyoutPage=null)},registerEvent:function(){var o,a,i,r,s,l,u,d;InfoPlus.Controls.Iframe.eventRegistered||(o="iframe."+this.getElementClassName(),a=function(e,t,n){n=n?null!=e.flyoutIframe?e.flyoutIframe.src.match(f)[0]:null:null!=e.element?e.element.src.match(f)[0]:null;return n===t},i=function(t,n,i){null!=t.cid&&null!=t.pid&&$(o).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);a(e,n,i)&&t.pid===this.id&&(i?e.flyoutInnerId=t.cid:e.innerId=t.cid)})},r=function(t,n,i){null!=t.cid&&$(o).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);a(e,n,i)&&(i?e.flyoutWindowSendMessage({command:"queryFlyout",cid:t.cid,pid:this.id}):e.sendMessage({command:"query",cid:t.cid,pid:this.id}))})},s=function(){var e=$(InfoPlus.Controls.Iframe.flyoutDiv).data("iframeControl");null!=e&&e.closeFlyout()},l=300,u=100,d=function(i){function a(e){var t="flyout_"+$$.guid(),n=document.createElement("iframe");n.setAttribute("id",t),n.setAttribute("frameborder","0"),n.setAttribute("class","infoplus_iframeControl_flyout"),$(h.flyoutDiv).append(n).data("iframeControl",e),e.flyoutIframeId=t,e.flyoutIframe=n}function r(e,t){var n=e.flyoutIframe;if(n.setAttribute("scrolling","auto"),n.getAttribute("src")!==t.src&&n.setAttribute("src",t.src),!$$.MOBILE){var i=null!=t.height?parseInt(t.height,10):u,a=(n.setAttribute("height",i+""),null!=t.width?parseInt(t.width,10):l),r=(n.setAttribute("width",a+""),a),o=i+=14;switch(t.position){case"top":$(h.flyoutDiv).css("top","-"+o+"px").css("left","0");break;case"bottom":$(h.flyoutDiv).css("top",$(e.element).outerHeight()+"px").css("left","0");break;case"left":$(h.flyoutDiv).css("top","0").css("left","-"+r+"px");break;case"right":$(h.flyoutDiv).css("top","0").css("left",$(e.element).outerWidth()+"px");break;case"center":$(h.flyoutDiv).css("top",($(c).height()-o)/2+"px").css("left",($(c).width()-r)/2+"px").addClass("center");break;default:$(e.element).offset().top-$(c).scrollTop()+$(e.element).height()+o<=$(c).height()||$(e.element).offset().top-$(c).scrollTop()<o?$(h.flyoutDiv).css("top",$(e.element).outerHeight()+"px"):$(h.flyoutDiv).css("top","-"+o+"px")}!1!==t.shadow?$(h.flyoutDiv).addClass("z-depth-1"):$(h.flyoutDiv).removeClass("z-depth-1")}}null!=i.cid&&$(o).each(function(){var e,t,n=$(this).data($Control.DATA_CONTROL_OBJECT);i.cid===n.innerId&&(e=i.options,$$.MOBILE?(null==n.flyoutIframe&&a(n),r(n,e),t={content:$(h.flyoutDiv),buttons:[{name:$$.lt("common.close"),callOnClose:!0,defaultButton:!0,callback:function(){n.closeFlyout(!0)}}]},t=new InfoPlus.Render.Mobile.Page(t),(n.flyoutPage=t).show()):(null==n.flyoutIframe&&(s(),a(n),"center"!==e.position)&&n.controlContainer.appendChild(h.flyoutDiv),r(n,e)))})},$(c).on("message",function(e){var t,n,a;try{t=$.parseJSON(e.originalEvent.data)}catch(e){}if(null!=t&&null!=t.command)switch(t.command){case"change":null!=(a=t).cid&&$(o).each(function(){var e,t,n,i=$(this).data($Control.DATA_CONTROL_OBJECT);a.cid===i.innerId&&(e=a.url||"",t=i.shouldFireChangeEvent(e),(n=$(i.element).data($Control.DATA_ORIGIN_INPUT)).value=e,t)&&setTimeout(function(){$(n).change()},0)});break;case"create":r(t,e.originalEvent.origin,!1);break;case"createFlyout":r(t,e.originalEvent.origin,!0);break;case"openFlyout":d(t);break;case"closeFlyout":null!=(n=t).cid&&$(o).each(function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);n.cid===e.flyoutInnerId&&(e.sendMessage({command:"closeFlyout",data:n.data,pid:this.id}),e.closeFlyout()),n.cid===e.innerId&&e.closeFlyout()});break;case"confirm":i(t,e.originalEvent.origin,!1);break;case"confirmFlyout":i(t,e.originalEvent.origin,!0)}}),$$.MOBILE||$(document).mousedown(function(e){e.target.id!==p&&s()}),InfoPlus.Controls.Iframe.eventRegistered=!0)},getAttributes:function(){var e=this.getValue();return $IU.getParamFromUrl(e.value)},resetInnerId:function(){this.innerId=null,this.flyoutInnerId=null},setValue:function(e,t,n){null==e&&(e="");var n=!n&&this.shouldFireChangeEvent(e),i=(this.resetInnerId(),$(this.element)),a=i.data($Control.DATA_ORIGIN_INPUT);a.value=e,i.attr("src",e),n&&setTimeout(function(){$(a).change()},0)},getValue:function(){var e;return null==this.field||null==this.element?"":(e=$(this.element).data($Control.DATA_ORIGIN_INPUT),new $Controls.Data.Uri(e.value))}}),define("InfoPlus.Controls.Iframe",h)}(window),function(o){function E(e,t,n,i,a,r){$Control.call(this,$Control.CONTROL_TYPE_THING,e,t,n,i,a,r)}E.BARCODE_LENGTH=13,E.HAS_VALUE="infoplus_thingControl_has_value",E.NO_VALUE="infoplus_thingControl_no_value",E.CLASS_INPUT_NAME_DIV="infoplus_thingControl_inputNameDiv",E.CLASS_INPUT_BARCODE_DIV="infoplus_thingControl_inputBarcodeDiv",E.CLASS_NAME_DIV="infoplus_thingControl_nameDiv",E.CLASS_PRINT_DIV="infoplus_thingControl_printDiv",E.CLASS_DELETE_DIV="infoplus_thingControl_deleteDiv",E.CODE_REG=/^\d{13}$/,E.IMG_HOLDER="INFOPLUS_THING_IMG_HOLDER",E.prototype=$.extend(new $Controls.Control,{autoTriggerFieldChangeEvent:!1,compatibleFieldTypes:[$Control.DATA_TYPE_THING],allowFocus:!1,name:"thing",hasHiddenElement:!0,getCheckCode:function(e){for(var t=0,n=0,i=0;i<=11;i++)i%2==0?t+=parseInt(e[i]):n+=parseInt(e[i]);return((10-(t+3*n)%10)%10).toString()},getNewBarCode:function(){for(var e=""+(690+Math.round(5*Math.random())),t=0;t<9;t++)e+=""+Math.ceil(9*Math.random());return e+=this.getCheckCode(e)},getPrintContent:function(a,r){var o=$IU.getBarcodePrintUrl(this.getValue().value);if(null==o)return null;var s=this,e=document.createElement("div"),l=$(e),u=function(){$$.dynamics.cache.build();var e,t=s.dynamicProcessor.getControlContext(s,void 0,!0),n=new InfoPlus.QuickSortArray;for(e in t)t.hasOwnProperty(e)&&n.push({name:e,obj:t[e]});return n.sort(function(e,t){e=e.name.length,t=t.name.length;return t<e?-1:e===t?0:1}),n},t=function(){function e(){i.complete?(a[t]=!0,r()):setTimeout(e,300)}var t=a.length,n=(a[t]=!1,document.createElement("div")),i=document.createElement("img");i.src=o,n.appendChild(i),n.setAttribute("style","margin:15px 0 15px -5px");setTimeout(e,300),l.append(n)},d=function(e,t,n,i){return null==t?e:null==i?(e=e.replace(new RegExp("\\$"+n,"gm"),t)).replace(new RegExp("\\${"+n+"}","gm"),t):null!=t[i]?(e=e.replace(new RegExp("\\$"+n+"\\."+i,"gm"),t[i])).replace(new RegExp("\\${"+n+"\\."+i+"}","gm"),t[i]):e},c=function(e,t){return e=(e=(e=(e=e.replace(new RegExp("\\$"+t+"\\.value","gm"),E.IMG_HOLDER)).replace(new RegExp("\\${"+t+"\\.value}","gm"),E.IMG_HOLDER)).replace(new RegExp("\\$"+t,"gm"),E.IMG_HOLDER)).replace(new RegExp("\\${"+t+"}","gm"),E.IMG_HOLDER)},n=function(e){for(var t=u(),n=0,i=t.length;n<i;n++){var a=t[n],r=a.name;e=d(e,a.obj,r,"displayValue"),e=d(e,a.obj,r,"name"),e=a.name!==s.field.name?(e=d(e,a.obj,r,"value"),d(e,a.obj,r)):c(e,r)}return e.split("\n")},i=this.field.format||"";if(""!==i)for(var h=new RegExp(/^-(\d|-)*-$/),p=n(i),f=0,m=p.length;f<m;f++){var g,C,_=p[f];-1!==_.indexOf(E.IMG_HOLDER)?t():(C=$IU.trimString(_),!0===h.test(C)?(C=parseInt(C.replace(/-/g,""),10),isNaN(C)&&(C=10),(g=document.createElement("div")).setAttribute("style","height:"+C+"px"),l.append(g)):(C=document.createElement("div"),$(C).text(_),l.append(C)))}else n=document.createElement("div"),$(n).text($$.params.instanceName),l.append(n),""!==($$.params.instanceTags||"")&&(n=document.createElement("div"),$(n).text($$.params.instanceTags),l.append(n)),t(),n=document.createElement("div"),$(n).text($$.lt("thing.name")+""+s.getValue().name),l.append(n);return l.attr("style","text-align:left"),e},print:function(){var n=[],i=!1,a=o.open(),e=function(){if(i){for(var e=0,t=n.length;e<t;e++)if(!n[e])return;setTimeout(function(){a.focus(),a.print(),a.close()},1e3)}},t=$("#div_invoice"),r=(t.empty(),this.getPrintContent(n,e));null!=r&&(t.append(r),r=t.html(),a.document.write("<style>body {text-align:center}</style>"+r),a.document.close(),t=function(){i||(i=!0,e())},$(a).load(t),$(a.document).ready(t))},createElement:function(){var e=document.createElement("div"),t=document.createElement("div"),t=(t.setAttribute("class",E.CLASS_INPUT_NAME_DIV),e.appendChild(t),document.createElement("div")),t=(t.setAttribute("class",E.CLASS_NAME_DIV),e.appendChild(t),document.createElement("div")),t=(t.setAttribute("class",E.CLASS_DELETE_DIV),t.setAttribute("title",$$.lt("common.deleteText")),e.appendChild(t),document.createElement("div")),n=(t.setAttribute("class",E.CLASS_PRINT_DIV),document.createElement("i"));return n.setAttribute("class","i-icon-print"),t.appendChild(n),e.appendChild(t),e},setValue:function(e,t,n,i){null==e&&(t=e="",i=null);var a,r,o,s=$(this.element),l=s.data($Control.DATA_ORIGIN_INPUT),n=!n&&this.shouldFireChangeEvent(e);l.value=e,s.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(t),""===t?s.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE):(s.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE),null!=(a=this.element.style.width)&&""!==a&&(e=s.find("."+E.CLASS_PRINT_DIV).width()+s.find("."+E.CLASS_DELETE_DIV).width(),"%"!==a.substring(a.length-1)?(r=parseInt(a,10),0===e&&(e=$$.MOBILE?48:32),s.find("."+E.CLASS_NAME_DIV).css("max-width",r-e-24+"px")):(o=function(){var e;s.width()===parseInt(a,10)?setTimeout(function(){o()},300):(r=parseInt(s.width(),10),e=s.find("."+E.CLASS_PRINT_DIV).width()+s.find("."+E.CLASS_DELETE_DIV).width(),s.find("."+E.CLASS_NAME_DIV).css("max-width",r-e-24+"px"))})())),this.setAttributes(i),s.data($Control.DATA_DISPLAY_VALUE,t),n&&setTimeout(function(){$(l).change()},0)},setName:function(e){null==e&&(e="");var t=$(this.element),n=t.data($Control.DATA_ORIGIN_INPUT),i=this.shouldFireChangeEvent(e);t.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(e),""===e?t.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE):t.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE),t.data($Control.DATA_DISPLAY_VALUE,e),i&&setTimeout(function(){$(n).change()},0)},getValue:function(){var e=$(this.element),t=e.data($Control.DATA_ORIGIN_INPUT),t=this.convertEmptyValue(t.value),e=e.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.Thing(t,e)},setPlaceHolder:function(){var e,t,n;null!=this.field&&null!=this.field.placeHolder&&""!==this.field.placeHolder&&(e=this.element,t=document.createElement("div"),(n=document.createElement("a")).setAttribute("href","#"),$(n).text(this.field.placeHolder),t.appendChild(n),$(t).addClass("thingTip"),$(e).find("."+E.CLASS_INPUT_NAME_DIV).after(t),$(t).click(function(){return $IU.fireClick($(this).siblings("."+E.CLASS_INPUT_NAME_DIV)[0]),!1}))},showThingDialog:function(e){var t=this.getValue(),n=(""===t.value&&(t.value=this.getNewBarCode()),this.element),i=this,a=document.createElement("div"),r=$(a),o=document.createElement("input"),s=$(o),l=document.createElement("input"),u=$(l),d=$$.lt("thing.pleaseInput"),c=document.createElement("div");return r.attr("id","form_thing_id").css("display","inline-block").css("position","relative"),s.attr("id","form_thing_id_input").attr("type","text").attr("maxlength",E.BARCODE_LENGTH).val(t.value),u.attr("id","form_thing_name").attr("type","text"),!0===n.readOnly&&(o.readOnly=!0,s.addClass($Control.CLASSNAME_READONLY),s.hide(),l.readOnly=!0,u.addClass($Control.CLASSNAME_READONLY)),r.text(t.value).css("margin-left","10px"),e?(r.hide(),s.css("display","inline-block")):s.hide(),s.css("margin-left","10px").css("width","235px"),u.val(t.displayValue).css("margin-left","10px").css("width","235px"),$(c).append("<span>"+$$.lt("thing.code")+"</span>").append(a).append(o).append("<br>").append("<span>"+$$.lt("thing.name")+"</span>").append(l),$(c).css("line-height","30px"),s.keyup(function(e){s.val().length===E.BARCODE_LENGTH&&!0!==s.data("requesting")&&(s.data("requesting",!0),$$.ajax({type:"GET",url:$$.params.formRender.thingService+"/"+s.val(),data:{},needParse:!1,showParseErrMsg:!1,showAjaxErrMsg:!1,addFormParam:!0}).done(function(e){0===e.entities.length?$IU.messageBox(null,$$.lt("thing.notFound"),null,300):(e=e.entities[0],u.val(e.name),s.data("attr",e.attributes))}).fail(function(e){50001===e.errno?$IU.messageBox(null,$$.lt("thing.notFound"),null,300):$IU.messageBox(null,e.msg,null)}).always(function(){setTimeout(function(){s.removeData("requesting")},300)})),13===e.keyCode&&$(l).focus()}),e=!0===n.readOnly?[]:[{name:$$.lt("common.save"),defaultButton:!0,callOnClose:!1,preventDefault:!0,callback:function(){if(s.is(":visible")){if(""===s.val())return $IU.messageBox(null,$$.lt("thing.check.code"),null,200),!1;var e=s.val();if(13!==e.length||i.getCheckCode(e.substr(0,12))!==e.substr(12))return $IU.messageBox(null,$$.lt("thing.check.codeError"),null,240),!1}else if(""===u.val())return $IU.messageBox(null,$$.lt("thing.check.name"),null,200),!1;if(""===u.val())return $IU.messageBox(null,$$.lt("thing.check.name"),null,200),!1;i.setValue(s.val(),u.val(),!1,s.data("attr"))}},{name:$$.lt("common.cancel")},{name:$$.lt("thing.scan"),preventDefault:!0,callback:function(){return r.hide(),s.val("").css("display","inline-block").focus(),!1}}],new InfoPlus.Render.Dialog({title:d,content:c,maxWidth:340,buttons:e}).show(),!1},registerEvent:function(){this.events=InfoPlus.Controls.Thing.Events.events},specialSetting:function(){var e=$(this.element);e.css("height",""),e.children("."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV).attr("title",$$.lt("thing.clickToInput")),e.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).attr("title",$$.lt("thing.clickToInput")),e.children("."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV).attr("title",$$.lt("thing.print"))}}),define("InfoPlus.Controls.Thing",E);var e={inputNameClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);return null!=e&&e.showThingDialog(!1),!1},nameClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);return null!=e&&e.showThingDialog(),!1},printClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);return null!=e&&e.print(),!1},deleteClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);return null!=e&&$IU.confirmBox($$.lt("thing.deleteConfirm"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){e.setValue("","",!1,null)}),!1}};e.events=[{selector:"."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV,type:"click",handler:e.inputNameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_NAME_DIV,type:"click",handler:e.nameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV,type:"click",handler:e.printClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_DELETE_DIV,type:"click",handler:e.deleteClick}],define("InfoPlus.Controls.Thing.Events",e)}(window),function(){function e(e,t,n,i){$Control.call(this,$Control.CONTROL_TYPE_SWITCH,e,t,n,i)}e.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],autoTriggerFieldChangeEvent:!1,name:"switch",hasHiddenElement:!0,createElement:function(){var e=document.createElement("div"),t=document.createElement("div");return $(t).addClass("switchButton"),$(e).append(t),e},setValue:function(e,t,n){null==e&&(e="");var n=!n&&this.shouldFireChangeEvent(e),i=$(this.element).data($Control.DATA_ORIGIN_INPUT);i.value=e,this.setSwitchClass(i.value),n&&setTimeout(function(){$(i).change()},0)},getValue:function(){var e;return null==this.field||null==this.element?"":(e=this.element,e=$(e).data($Control.DATA_ORIGIN_INPUT),"true"===this.convertEmptyValue(e.value).toLowerCase())},getSortValue:function(){return this.getValue()?1:0},setSwitchClass:function(e){"true"===e?$(this.element).addClass("checked"):$(this.element).removeClass("checked")},toggleValue:function(){!0===this.getValue()?this.setValue(!1):this.setValue(!0)},registerEvent:function(){this.events=InfoPlus.Controls.Switch.Events.events}}),define("InfoPlus.Controls.Switch",e);var t={onButtonClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);return null==e.field||e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)||e.toggleValue(),!1}};t.events=[{type:"click",handler:t.onButtonClick}],define("InfoPlus.Controls.Switch.Events",t)}(window),function(d){function r(){this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(0,0)}var g=function(e,t,n,i,a,r){var o,s;"unload"===g.jsLoadStatus&&(g.jsLoadStatus="loading",o=document.getElementsByTagName("head")[0],(s=document.createElement("script")).src="https://api.map.baidu.com/api?v=3.0&ak="+$$.params.mapKey+"&callback=InfoPlus.Controls.Map.loadCallback",s.type="text/javascript",s.onload=s.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s.onload=s.onreadystatechange=null)},o.appendChild(s)),"loaded"!==g.jsLoadStatus&&g.waitingMapControls.push(this),null!=a&&""!==a||null!=t.settings&&null!=t.settings.displayText&&(a=t.settings.displayText),$Control.call(this,$Control.CONTROL_TYPE_MAP,e,t,n,i,a,r)};g.DEFAULT_ZOOM_LEVEL=17,g.DEFAULT_CITY_ZOOM_LEVEL=11,g.jsLoadStatus="unload",g.waitingMapControls=[],g.LABEL_STYLE={"font-size":"14px",border:"1px solid #ababab","background-color":"white",color:"#2196F3"},g.loadCallback=function(){g.jsLoadStatus="loaded",(r.prototype=new BMap.Control).convertedPoint=null,r.prototype.initialize=function(e){var t=document.createElement("div"),n=document.createElement("span"),i=document.createElement("span"),a=($(n).text($$.lt("map.currentPosition",$$.lt("map.noPosition"))),document.createElement("i")),r=document.createElement("span"),u=($(a).addClass("i-icon-navigation"),$(r).text($$.lt("map.navigation")),$(i).append(a).append(r).addClass("map_navigation").hide(),$(t).append(n).append(i).addClass("map_position"),e.getContainer().appendChild(t),this.textSpan=n,this.naviSpan=i,this);return $(n).click(function(){null!=u.marker&&e.panTo(u.marker.getPosition())}),$(i).click(function(){if(null==u.marker)return!1;var e=navigator.userAgent.toLowerCase(),e=(isAndroid=/android/i.test(e),isIos=/mac os/i.test(e),u.marker.getPosition()),t=u.marker.getLabel(),n=e.lat,e=e.lng,i=(t.getContent(),[]);if(isAndroid?(i[0]="bdapp://map/direction?destination="+n+","+e+"&mode=walking",null!=u.convertedPoint&&(i[1]="amapuri://route/plan/?dlat="+u.convertedPoint.lat+"&dlon="+u.convertedPoint.lng+"&dev=0&t=2",i[2]="qqmap://map/routeplan?type=walk&fromcoord=CurrentLocation&tocoord="+u.convertedPoint.lat+","+u.convertedPoint.lng+"&referer=infoplusweb")):isIos&&(i[0]="baidumap://map/direction?destination="+n+","+e+"&mode=walking",null!=u.convertedPoint)&&(i[1]="iosamap://route/plan/?dlat="+u.convertedPoint.lat+"&dlon="+u.convertedPoint.lng+"&dev=0&t=2",i[2]="qqmap://map/routeplan?type=walk&fromcoord=CurrentLocation&tocoord="+u.convertedPoint.lat+","+u.convertedPoint.lng+"&referer=infoplusweb",i[3]="http://maps.apple.com/?daddr="+u.convertedPoint.lat+","+u.convertedPoint.lng+"&dirflg=w"),0===i.length)return!1;function a(e){try{d.location.href=e}catch(e){}}t=document.createElement("div"),n=$(t),e=document.createElement("span"),$(e).text($$.lt("map.naviTip")),n.append(e),r=new InfoPlus.Render.CommandBarHelper({content:t,position:"top",backgroundColor:"#fff9c4"}),(0<(n=$("#form_command_bar")).length?n:$(document.body)).append(r.element),r.show(0===n.length),setTimeout(function(){r.hide()},6e3),a(i[0]);var r,o=[];if(null!=u.convertedPoint)for(var s=1,l=i.length;s<l;s++)o[s-1]=setTimeout(function(e){return function(){a(i[e])}}(s),(isIos?4e3:2e3)*s);d.beforeunload=d.pagehide=d.onblur=function(){for(var e=0,t=o.length;e<t;e++)clearTimeout(o[e])}}),t},r.prototype.setMarker=function(e){var t,n;null==e?this.setValue(null):(t=e.getPosition(),n=null!=(n=e.getLabel())?n.getContent():t.lng+","+t.lat,this.setValue(n),n=InfoPlus.CoordTransform.bdtogcj(t.lng,t.lat),this.convertedPoint=new BMap.Point(n[0],n[1])),this.marker=e},r.prototype.setValue=function(e){$(this.textSpan).text($$.lt("map.currentPosition",null==e?$$.lt("map.noPosition"):e)),!$IU.isEmptyStr(e)&&$$.MOBILE?$(this.naviSpan).show():$(this.naviSpan).hide()},r.prototype.addEvent=function(e,t){};for(var e=g.waitingMapControls,t=0,n=e.length;t<n;t++)e[t].initMap()},g.prototype=$.extend(new $Controls.Control,{compatibleFieldTypes:[$Control.DATA_TYPE_LOCATION],ignoreClass:!0,autoTriggerFieldChangeEvent:!1,allowFocus:!1,name:"map",hasHiddenElement:!0,map:null,currentMarker:null,currentPosition:null,markerClicking:!1,getMapPoint:function(e){var t;return!$IU.isString(e)||$IU.isEmptyStr(e)||(e=e.split(",")).length<2||(t=parseFloat(e[0]),e=parseFloat(e[1]),isNaN(t))||isNaN(e)?null:(t=InfoPlus.CoordTransform.wgstobd(t,e),new BMap.Point(t[0],t[1]))},getMapZoomLevel:function(e){return!$IU.isString(e)||$IU.isEmptyStr(e)||3!==(e=e.split(",")).length||(e=parseInt(e[2],10),isNaN(e))||19<e||e<0?g.DEFAULT_ZOOM_LEVEL:e},setMapMarker:function(e,t){var n,i;null!=e?(n=e.getPosition(),i=e.getLabel(),this.currentPosition.setMarker(e),this.currentMarker=e,e=InfoPlus.CoordTransform.bdtowgs(n.lng,n.lat),this.setValue(e[0]+","+e[1],null!=i?i.getContent():"",t,null,!0)):(this.currentPosition.setMarker(null),this.currentMarker=null,this.setValue("","",t,null,!0))},createInfoWindow:function(n,e){function t(){var e,t=$(d).val();""!==$IU.trimString(t)?(n.closeInfoWindow(),null==n.getLabel()?((e=new BMap.Label(t,{offset:new BMap.Size(15,-22)})).setStyle(g.LABEL_STYLE),n.setLabel(e)):n.getLabel().setContent(t),null!=a.currentMarker&&a.currentMarker!==n&&a.map.removeOverlay(a.currentMarker),a.setMapMarker(n,!1)):$IU.messageBox(null,$$.lt("map.inputLabel"),null,300)}var i,a=this,r=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div"),u=document.createElement("ul"),d=document.createElement("input"),c=document.createElement("a");$(o).text($$.lt("map.selectCurrentPositionTitle")).addClass("map_info_title"),$(d).attr("type","text").attr("maxLength","50").addClass("labelInput"),null!=n.getLabel()?($(d).val(n.getLabel().content),i=document.createElement("a"),$(i).text($$.lt("map.deletePosition")).attr("href","#").addClass("deleteLink").click(function(){$IU.confirmBox($$.lt("map.confirmDelete",n.getLabel().content),null,$$.lt("common.ok"),300,function(){a.map.removeOverlay(n),a.setMapMarker(null,!1)})}),$(l).append(i)):0<e.length&&$(d).val(e[0]);$(c).text($$.lt("map.usePoint")).attr("href","#").addClass("okLink").click(function(){return t(),!1}),$(d).keypress(function(e){if(13===e.keyCode)return t(),!1}),$(s).append(d),$(u).addClass("map_sug_list");for(var h=0,p=e.length;h<p;h++){var f=document.createElement("li"),m=document.createElement("span");$(m).text(e[h]).attr("title",""),$(f).append(m),$(u).append(f)}return $(l).append(c).addClass("confirmDiv"),$(r).append(o).append(s).append(u).append(l).addClass("map_info_window"),$(u).on("click","li",function(){$(d).val($(this).children("span").text())}),r},addMarker:function(e,t,n,i,a){var r=this,o=this.map;if(!1!==i)o.clearOverlays();else for(var s=o.getOverlays(),l=0;l<s.length;l++)s[l]!==this.currentMarker&&o.removeOverlay(s[l]);a&&(t=new BMap.Label($$.lt("map.autoPosition"),{offset:new BMap.Size(15,-22)})).setStyle(o.LABEL_STYLE);var u=new BMap.Marker(e,{enableClicking:!0});return this.isWritable()&&u.addEventListener("click",function(){if(!r.isDynamicReadonly()){r.markerClicking=!0;for(var e=o.getOverlays(),t=0;t<e.length;t++)e[t]!==this&&o.removeOverlay(e[t]);null!=n?u.openInfoWindow(new BMap.InfoWindow(r.createInfoWindow(u,n),{enableCloseOnClick:!1})):(new BMap.Geocoder).getLocation(this.getPosition(),function(e){e=r.getSugs(e);u.openInfoWindow(new BMap.InfoWindow(r.createInfoWindow(u,e),{enableCloseOnClick:!1}))},{poiRadius:50})}return!1}),null!=t&&u.setLabel(t),o.addOverlay(u),u},getSugs:function(e){for(var t=[],n=(""!==e.addressComponents.streetNumber?t.push(e.address):e.addressComponents.street&&t.push(e.addressComponents.street),e.surroundingPois),i=0,a=n.length;i<a;i++)t.push(n[i].title);return t},initMap:function(){function o(){var e,t=!1;$IU.isEmptyStr($$.params.defaultLocation)||null!=(e=s.getMapPoint($$.params.defaultLocation))&&(n=s.getMapZoomLevel($$.params.defaultLocation),l.centerAndZoom(e,n),t=!0),t||(new BMap.LocalCity).get(function(e){e=e.name;l.centerAndZoom(e,g.DEFAULT_CITY_ZOOM_LEVEL)})}var n,e,t,s=this,l=new BMap.Map(this.element.getAttribute("id")),i=(this.map=l,new r),i=(l.addControl(i),i.addEvent("click",function(){null!=s.currentMarker&&l.panTo(s.currentMarker.getPosition())}),this.currentPosition=i,new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL})),u=(l.addControl(i),function(n,i){var e={poiRadius:50};$$.MOBILE&&(e.numPois=5),(new BMap.Geocoder).getLocation(n,function(e){var e=s.getSugs(e),t=s.addMarker(n,null,e,!1,i),e=new BMap.InfoWindow(s.createInfoWindow(t,e),{enableCloseOnClick:!1});e.enableAutoPan(),e.addEventListener("clickclose",function(){t!==s.currentMarker&&l.removeOverlay(t)}),t.openInfoWindow(e),i&&s.setMapMarker(t,!0)},e)}),a=this.getMapPoint(this.initValue);null!=a?(n=this.getMapZoomLevel(this.initValue),setTimeout(function(){l.centerAndZoom(a,n)},1e3),$IU.isEmptyStr(this.initDisplayValue)||(e=new BMap.Label(this.initDisplayValue,{offset:new BMap.Size(15,-22)})).setStyle(g.LABEL_STYLE),i=this.addMarker(a,e,null,!1,!1),this.setMapMarker(i,!0)):((e=new BMap.Geolocation).enableSDKLocation(),e.getCurrentPosition(function(e){switch(this.getStatus()){case BMAP_STATUS_SUCCESS:var t=new BMap.Point(e.point.lng,e.point.lat);l.centerAndZoom(t,g.DEFAULT_ZOOM_LEVEL),s.isWritable()&&u(e.point,!0);break;case BMAP_STATUS_TIMEOUT:$IU.messageBox(null,$$.lt("map.geolocation.timeout"),null,300);break;case BMAP_STATUS_PERMISSION_DENIED:for(var n=!1,i=$("iframe"),a=0,r=i.length;a<r;a++)if(-1!==i[a].src.indexOf("baidu.com")){n=!0;break}n&&null!=navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){e=InfoPlus.CoordTransform.wgstobd(e.coords.longitude,e.coords.latitude),e=new BMap.Point(e[0],e[1]);l.centerAndZoom(e,g.DEFAULT_ZOOM_LEVEL),s.isWritable()&&u(e,!0)},function(e){o()},{enableHighAccuracy:!0,maximumAge:0}):($IU.messageBox(null,$$.lt("map.geolocation.denied"),null,300),o());break;case BMAP_STATUS_UNKNOWN_LOCATION:$IU.messageBox(null,$$.lt("map.geolocation.unknown"),null,300)}},{enableHighAccuracy:!0})),s.isWritable()&&(t=function(e,t){u(t,!1)},$$.MOBILE?(l.addEventListener("touchstart",function(e){return!s.isDynamicReadonly()&&(s.markerClicking?s.markerClicking=!1:void(s.touchPoint=e.pixel))}),l.addEventListener("touchend",function(e){return!s.isDynamicReadonly()&&(s.markerClicking?s.markerClicking=!1:(null!=s.touchPoint&&Math.abs(s.touchPoint.x-e.pixel.x)<3&&Math.abs(s.touchPoint.y-e.pixel.y)<3&&t(0,e.point),void(s.touchPoint=null)))})):l.addEventListener("click",function(e){return!s.isDynamicReadonly()&&(s.markerClicking?s.markerClicking=!1:void t(0,e.point))}))},createElement:function(){var e=document.createElement("div"),t=$(e),e=(this.controlContainer=e,t.addClass("infoplus_mapControlContainer"),document.createElement("div"));return t.append(e),e},setMapValue:function(e,t){var n,e=this.getMapPoint(e);null!=e&&(this.map.centerAndZoom(e,this.map.getZoom()),$IU.isEmptyStr(t)||(n=new BMap.Label(t,{offset:new BMap.Size(15,-22)})).setStyle(g.LABEL_STYLE),t=this.addMarker(e,n,null!=n?[n.getContent()]:[""],!0,!1),this.setMapMarker(t,!1))},setValue:function(e,t,n,i,a){var r,o;"loaded"===g.jsLoadStatus&&null!=this.map&&(null==e&&(e=""),n=!n&&this.shouldFireChangeEvent(e),r=$(this.element),o=r.data($Control.DATA_ORIGIN_INPUT),"loaded"===g.jsLoadStatus&&!0!==a&&(null==t&&2<(a=e.split(",")).length&&(t=a[2],e=[a[0],a[1]].join(",")),this.setMapValue(e,t)),o.value=e,r.data($Control.DATA_DISPLAY_VALUE,t),this.setAttributes(i),n)&&setTimeout(function(){$(o).change()},0)},getValue:function(){var e,t;return null==this.field||null==this.element?"":(e=(t=$(this.element)).data($Control.DATA_ORIGIN_INPUT).value,$IU.isEmptyStr(e)||null==this.map||(e=e+","+this.map.getZoom()),t=t.data($Control.DATA_DISPLAY_VALUE),new $Controls.Data.ValuePair(e,t))},specialSetting:function(){var e=this;"loaded"===g.jsLoadStatus&&setTimeout(function(){e.initMap()},100)}}),define("InfoPlus.Controls.Map",g)}(window),function(i,r){function u(){$(".help_block").remove()}function s(e,t,n,i){return 1===t?0===e?0:1===e?n.left:n.left+n.width:0===e?0:1===e?i.left:i.left+i.width}function l(e,t,n,i){return 1===t?0===e?0:1===e?n.top:n.top+n.height:0===e?i.top:i.top+i.height}function d(e,t,n,i){return 1===t?0===e?n.left:1===e?n.width:(screen.width>$(document).width()?screen.width:$(document).width())-n.left-n.width:0===e?i.left:1===e?i.width:(screen.width>$(document).width()?screen.width:$(document).width())-i.left-i.width}function c(e,t,n,i){return 1===t?0===e?n.top:1===e?n.height:i.top-n.top-n.height:0===e?i.height:screen.height>$(document).height()?screen.height:$(document).height()-i.top-i.height}function h(e,t,n){return(0===e?0:1===e?t:t+n)+"px"}function p(e,t,n){return(0===e?0:1===e?t:t+n)+"px"}function f(e,t,n){return(0===e?t:1===e?n:(screen.width>$(document).width()?screen.width:$(document).width())-t-n)+"px"}function m(e,t,n){return(0===e?t:1===e?n:(screen.height>$(document).height()?screen.height:$(document).height())-t-n)+"px"}function g(e){$(i).off("resize",A);var t,o=C[e],s=$("#nav_menu"),l=$("#form_holder"),u=$("#title_description"),n=(u.is(":visible")||(u=$("#title_description_short")),function(){var e=$("#form_command_bar");switch(o){case"input":return[{left:u.offset().left,top:u.offset().top,width:u.width(),height:u.height(),helpContentLeft:l.offset().left,helpContentTop:0},{left:l.offset().left,top:l.offset().top,width:l.width(),height:l.height()}];case"toolbar":return{left:e.offset().left,top:e.offset().top,width:e.width(),height:e.height(),helpContentLeft:e.offset().left,helpContentTop:e.offset().top+e.height()};case"inputArea":return{left:l.offset().left,top:l.offset().top,width:l.width(),height:l.height(),helpContentLeft:l.offset().left,helpContentTop:0};case"numberArea":return{left:u.offset().left,top:u.offset().top,width:u.width(),height:u.height(),helpContentRight:20,helpContentTop:u.offset().top+u.height()};case"command":var t=e.find("li.command_button").filter(":visible"),n=0,i=0,a=(i=0<t.length?(n=$(t[0]).offset().left,$(t[t.length-1]).offset().left-n+$(t[t.length-1]).width()):(n=(a=e.find("#command_menu")).offset().left,a.width()),e.offset().top),r=e.height();return{left:n,top:a,width:i,height:r,helpContentLeft:n,helpContentTop:a+r+5};case"save":return t=e.find("li.tool_button"),n=$(t[t.length-1]).offset().left,i=$(t[0]).offset().left-$(t[t.length-1]).offset().left+$(t[t.length-1]).width(),r=e.height(),{left:n,top:a=e.offset().top,width:i,height:r,helpContentRight:20,helpContentTop:a+r+5};case"navMenu":t=$("#title_icon");return{left:t.offset().left,top:t.offset().top,width:t.width(),height:t.height(),helpContentLeft:0,helpContentTop:t.offset().top+t.height()+5};case"navContent":return{left:0,top:s.offset().top,width:s.width(),height:s.height(),helpContentLeft:0,helpContentTop:s.offset().top}}});"end"===o?($("#help_content").hide(),$(".help_block").remove(),$(document).scrollTop(0),$(document.body).css("overflow",""),$(document).off("keypress",y)):("navContent"===o&&s.show(),"remark"===o&&(s.hide(),0<$(document.body).height()-$(i).height()?$(document).scrollTop($(document.body).height()-$(i).height()):$(document).scrollTop(0)),t=n(),"[object Array]"!==Object.prototype.toString.call(t)?(_(t.left,t.top,t.width,t.height,e),v(e,t.helpContentLeft,t.helpContentRight,t.helpContentTop,t.helpContentBottom)):(a(t[0],t[1],e),v(e,t[0].helpContentLeft,t[0].helpContentRight,t[0].helpContentTop,t[0].helpContentBottom)),A=function(){var e=n();"[object Array]"!==Object.prototype.toString.call(t)?(E(e.left,e.top,e.width,e.height),I(e.helpContentLeft,e.helpContentRight,e.helpContentTop,e.helpContentBottom)):(T(e[0],e[1]),I(e[0].helpContentLeft,e[0].helpContentRight,e[0].helpContentTop,e[0].helpContentBottom))},$(i).resize(A))}var C=["index","input","toolbar","navMenu","end"],a=function(e,t,n){u(),$(document.body).css("overflow","hidden");for(var i=0;i<3;i++)for(var a=0;a<3;a++){var r=document.createElement("div"),o=$(r);o.attr("id","help_block_1_"+i+"_"+a).addClass("help_block"),1===i&&1===a?o.addClass("help_highlight"):o.addClass("help_background"),o.css("left",s(i,1,e,t)+"px").css("top",l(a,1,e,t)+"px").css("width",d(i,1,e,t)+"px").css("height",c(a,1,e,t)+"px"),o.data("step",n),document.body.appendChild(r)}for(i=0;i<3;i++)for(a=0;a<2;a++)r=document.createElement("div"),(o=$(r)).attr("id","help_block_2_"+i+"_"+a).addClass("help_block"),1===i&&0===a?o.addClass("help_highlight"):o.addClass("help_background"),o.css("left",s(i,2,e,t)+"px").css("top",l(a,2,e,t)+"px").css("width",d(i,2,e,t)+"px").css("height",c(a,2,e,t)+"px"),o.data("step",n),document.body.appendChild(r);$(".help_block").unbind().click(function(){g(n+1)})},_=function(e,t,n,i,a){u(),$(document.body).css("overflow","hidden");for(var r=0;r<3;r++)for(var o=0;o<3;o++){var s=document.createElement("div"),l=$(s);l.attr("id","help_block_"+r+"_"+o).addClass("help_block"),1===r&&1===o?l.addClass("help_highlight"):l.addClass("help_background"),l.css("left",h(r,e,n)).css("top",p(o,t,i)).css("width",f(r,e,n)).css("height",m(o,t,i)),l.data("step",a),document.body.appendChild(s)}$(".help_block").unbind().click(function(){g(a+1)})},E=function(e,t,n,i){for(var a=0;a<3;a++)for(var r=0;r<3;r++)$("#help_block_"+a+"_"+r).css("left",h(a,e,n)).css("top",p(r,t,i)).css("width",f(a,e,n)).css("height",m(r,t,i))},T=function(e,t){for(var n=0;n<3;n++)for(var i=0;i<3;i++)$("#help_block_1_"+n+"_"+i).css("left",s(n,1,e,t)+"px").css("top",l(i,1,e,t)+"px").css("width",d(n,1,e,t)+"px").css("height",c(i,1,e,t)+"px");for(n=0;n<3;n++)for(i=0;i<2;i++)$("#help_block_2_"+n+"_"+i).css("left",s(n,2,e,t)+"px").css("top",l(i,2,e,t)+"px").css("width",d(n,2,e,t)+"px").css("height",c(i,2,e,t)+"px")},I=function(e,t,n,i){var a=$("#help_content");e!==r&&a.css("left",e+"px"),t!==r&&a.css("right",t+"px"),n!==r&&a.css("top",n+"px"),i!==r&&a.css("bottom",i+"px")},v=function(e,t,n,i,a){var r=$("#help_content"),o=C[e];r.attr("class","").css("left","").css("top","").css("right","").css("bottom","").hide(),I(t,n,i,a),r.addClass("help_"+o).data("step",e).fadeIn(1500),r.unbind().click(function(){g(e+1)}),r.show()},A=function(){},y=function(){return!1};i.loadHelp=function(){$$.params.showTutorial&&($(document).keypress(y),$("html, body").scrollTop(0).scrollLeft(0),_(0,0,0,0,0),v(0))}}(window);